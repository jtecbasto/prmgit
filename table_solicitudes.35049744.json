{
	"orderInfo": [
		{
			"index": 44,
			"field": "lat",
			"expr": "solicitudes.idsolicitud",
			"asc": false
		}
	],
	"sql": "SELECT\n\tsolicitudes.idtipoventa,\n\tsolicitudes.fecha,\n\tsolicitudes.fechacaptura,\n\tsolicitudes.idcliente,\n\tsolicitudes.idproducto,\n\tsolicitudes.idplan,\n\tsolicitudes.usuario,\n\tsolicitudes.idtienda,\n\tsolicitudes.fechamodif,\n\tsolicitudes.orden,\n\tsolicitudes.solicitudimg,\n\tsolicitudes.estatus,\n\tsolicitudes.idsolrazon,\n\tsolicitudes.importeatt,\n\tsolicitudes.importesms,\n\tsolicitudes.plazo,\n\tsolicitudes.observaciones,\n\tsolicitudes.equipoincluido,\n\tsolicitudes.rfc,\n\tsolicitudes.idtratamiento,\n\tsolicitudes.riesgo,\n\tsolicitudes.observacionest,\n\tsolicitudes.idcli,\n\tsolicitudes.fecha1avta,\n\tsolicitudes.idplan1avta,\n\tsolicitudes.dn1avta,\n\tsolicitudes.idproceso,\n\tsolicitudes.idorigenventa,\n\tsolicitudes.estatusentrega,\n\tcte.nombre,\n\tcte.paterno,\n\tcte.materno,\n\tcte.nombre_completo,\n\tev.estado,\n\tev.ciudad,\n\tev.cp,\n\tev.calle,\n\tev.numeroext,\n\tev.numeroint,\n\tev.colonia,\n\tp.descripcion,\n\tCONCAT('https://www.google.com/maps/search/?api=1&query=', REPLACE(TRIM(CONCAT_WS(' ',\n             IFNULL(ev.numeroext,''),IFNULL(ev.calle,''),IFNULL(ev.numeroint,''),\n             IFNULL(ev.colonia,''),IFNULL(ev.cp,''),IFNULL(ev.ciudad,''),IFNULL(ev.estado,'')\n           )),' ','+')) AS maps_url,\n\tCONCAT(TRIM(CONCAT_WS(' ',\n      IF(IFNULL(ev.calle,'')='','', CONCAT('C.',ev.calle)),\n      IFNULL(CONCAT('No.',ev.numeroext),''),\n      IFNULL(CONCAT('Int.',ev.numeroint),''),\n      IFNULL(ev.colonia,''), IFNULL(CONCAT('C.P.',ev.cp),''),\n      IFNULL(ev.ciudad,''), IFNULL(ev.estado,'')\n    ))) AS direccion,\n\tsolicitudes.idsolicitud AS idsolicitud,\n\tsolicitudes.esnimei AS noserie,\n\tsolicitudes.simcard as simcard,\n\tev.lat,\n\tev.lng,\n\tsolicitudes.dn AS dn,\n\tsolicitudes.dnpreferido AS dnpreferido,\n\tsolicitudes.cuenta AS cuenta,\n\tsolicitudes.contrato AS contrato,\n\tsolicitudes.contratoportal AS contratoportal,\n\tsolicitudes.plazopendiente AS plazopendiente,\n\tsolicitudes.Factura AS factura,\n\tsolicitudes.fechavenci AS fechavenci,\n\tsolicitudes.ciclo AS ciclo,\n\tsolicitudes.renta AS renta,\n\tsolicitudes.ine,\n\tsolicitudes.cartaburocredito,\n\tsolicitudes.polizaseguro,\n\tsolicitudes.contratodocto,\n\tsolicitudes.contratolog,\n\tsolicitudes.anticipolog,\n\tsolicitudes.fechahoraentrega,\n\tsolicitudes.totalapagar\nFROM\n\tsolicitudes AS solicitudes\n\tLEFT OUTER JOIN clientes AS cte ON cte.idcliente = solicitudes.idcliente\n\tLEFT OUTER JOIN entregasvnp AS ev ON ev.idsolicitud = solicitudes.idsolicitud\n\tLEFT OUTER JOIN productos AS p ON p.idproducto = solicitudes.idproducto\n\tleft join tiposventa AS t on solicitudes.idtipoventa=t.idtipoventa\n\tleft join gtiposventa as g on t.idgtipoventa=g.idgtipoventa\n   left join serviciosmoviles_ugmembers m  on solicitudes.usuario=m.username\n    left join serviciosmoviles_uggroups u on m.GroupID=u.groupid\n\nwhere solicitudes.idtienda=146 and g.idggtipoventa=:session.idggtipoventa and if(solicitudes.usuario=':session.UserID' OR upper(solicitudes.usuario)='ADMIN',true,if(upper(':session.Label') in ('MESADECONTROL','VALIDADOR','GERENTES'),true,false))\nORDER BY\n\tsolicitudes.idsolicitud DESC\n",
	"connId": "conn",
	"originalTable": "solicitudes",
	"name": "solicitudes",
	"shortTableName": "solicitudes",
	"dbType": 0,
	"tableOwnerIdField": "idsolicitud",
	"usersOwnerIdField": "ID",
	"pageSizeRecords": 50,
	"pageSizeSelectorRecords": [
		"20",
		"30",
		"50",
		"100",
		"500",
		"all"
	],
	"keyFields": [
		"idsolicitud"
	],
	"detailsBadgeColor": "1e90ff",
	"detailsTables": [
		3847630651,
		2027119892,
		2796458642
	],
	"fields": [
		{
			"name": "idsolicitud",
			"sqlExpression": "solicitudes.idsolicitud",
			"index": 44,
			"strField": "idsolicitud",
			"type": 3,
			"autoinc": true,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Idsolicitud"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idtipoventa",
			"sqlExpression": "solicitudes.idtipoventa",
			"index": 1,
			"strField": "idtipoventa",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"required": true,
					"lookupType": 2,
					"lookupTable": "tiposventa",
					"lookupTableConnection": "conn",
					"lookupLinkField": "idtipoventa",
					"lookupDisplayField": "tipoventa",
					"lookupOrderBy": "tipoventa",
					"lookupWhere": "uso='VIGENTE' "
				}
			],
			"label": {
				"English": "Idtipoventa",
				"Spanish": "Tipo de Venta"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "fecha",
			"sqlExpression": "solicitudes.fecha",
			"index": 2,
			"strField": "fecha",
			"type": 7,
			"separateEditViewFormats": true,
			"viewFormats": [
				{
					"format": "Short Date"
				},
				{
					"format": "Short Date",
					"pageType": "list"
				},
				{
					"format": "Short Date",
					"pageType": "print"
				},
				{
					"format": "Short Date",
					"pageType": "export"
				}
			],
			"editFormats": [
				{
					"format": "Readonly",
					"dateEditType": 11
				},
				{
					"format": "Readonly",
					"pageType": "add",
					"dateEditType": 11
				},
				{
					"format": "Date",
					"pageType": "search",
					"dateEditType": 11,
					"dateLastYearFactor": 1
				}
			],
			"defaultSearchOption": "Between",
			"searchOptions": [
				"Between"
			],
			"label": {
				"English": "Fecha"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "fechacaptura",
			"sqlExpression": "solicitudes.fechacaptura",
			"index": 3,
			"strField": "fechacaptura",
			"type": 135,
			"viewFormats": [
				{
					"format": "Short Date"
				}
			],
			"editFormats": [
				{
					"format": "Date",
					"dateEditType": 11
				}
			],
			"label": {
				"English": "Fechacaptura"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idcliente",
			"sqlExpression": "solicitudes.idcliente",
			"index": 4,
			"strField": "idcliente",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"required": true,
					"denyDuplicateMessage": {
						"text": "El cliente %value% ya existe",
						"type": 0
					},
					"lookupType": 2,
					"lookupTable": "clientes",
					"lookupTableConnection": "conn",
					"lookupLinkField": "idcliente",
					"lookupDisplayField": "nombre_completo",
					"lookupAllowAdd": true,
					"lookupAllowEdit": true,
					"lookupControlType": 2,
					"lookupListPage": "list",
					"lookupAddPage": "add",
					"lookupEditPage": "edit",
					"lookupAutofillFields": [
						{
							"masterField": "nombre",
							"lookupField": "nombre"
						},
						{
							"masterField": "paterno",
							"lookupField": "paterno"
						},
						{
							"masterField": "materno",
							"lookupField": "materno"
						},
						{
							"masterField": "rfc",
							"lookupField": "rfc"
						},
						{
							"masterField": "cliente_id",
							"lookupField": "idcliente"
						}
					]
				}
			],
			"label": {
				"English": "Idcliente",
				"Spanish": "Cliente"
			},
			"placeholder": {
				"Spanish": "Seleccione al cliente"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idproducto",
			"sqlExpression": "solicitudes.idproducto",
			"index": 5,
			"strField": "idproducto",
			"type": 3,
			"viewFormats": [
				{
					"textShowFirstN": 20
				}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"required": true,
					"lookupType": 2,
					"lookupTable": "productos",
					"lookupTableConnection": "conn",
					"lookupLinkField": "idproducto",
					"lookupDisplayField": "descripcion",
					"lookupControlType": 2,
					"lookupListPage": "list"
				}
			],
			"filterFormat": {
				"format": "Values list"
			},
			"label": {
				"English": "Idproducto",
				"Spanish": "Equipo"
			},
			"placeholder": {
				"Spanish": "Seleccione el equipo"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idplan",
			"sqlExpression": "solicitudes.idplan",
			"index": 6,
			"strField": "idplan",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"required": true,
					"lookupType": 2,
					"lookupTable": "planes",
					"lookupTableConnection": "conn",
					"lookupLinkField": "idplan",
					"lookupDisplayField": "plan",
					"lookupWhere": "uso = 'Vigente' and tipo='Masivo'",
					"lookupAutofillFields": [
						{
							"masterField": "renta",
							"lookupField": "renta"
						}
					]
				}
			],
			"label": {
				"English": "Idplan",
				"Spanish": "Plan"
			},
			"placeholder": {
				"Spanish": "Seleccione el plan"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "usuario",
			"sqlExpression": "solicitudes.usuario",
			"index": 7,
			"strField": "usuario",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Usuario"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idtienda",
			"sqlExpression": "solicitudes.idtienda",
			"index": 8,
			"strField": "idtienda",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"lookupTable": "tiendas",
					"lookupTableConnection": "conn",
					"lookupLinkField": "IdTienda",
					"lookupDisplayField": "Tienda",
					"lookupOrderBy": "Tienda"
				}
			],
			"label": {
				"English": "Idtienda"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "fechamodif",
			"sqlExpression": "solicitudes.fechamodif",
			"index": 9,
			"strField": "fechamodif",
			"type": 135,
			"viewFormats": [
				{
					"format": "Short Date"
				}
			],
			"editFormats": [
				{
					"format": "Date",
					"dateEditType": 11
				}
			],
			"label": {
				"English": "Fechamodif"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "orden",
			"sqlExpression": "solicitudes.orden",
			"index": 10,
			"strField": "orden",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"required": true,
					"validateAs": "Regular expression",
					"validateRegex": "^[A-Z0-9]{11}$",
					"validateRegexMessage": {
						"text": "El valor es inválido",
						"type": 0
					},
					"textboxMaxLenth": 11
				}
			],
			"label": {
				"English": "Orden"
			},
			"placeholder": {
				"Spanish": "Ingrese la orden"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "solicitudimg",
			"sqlExpression": "solicitudes.solicitudimg",
			"index": 11,
			"strField": "solicitudimg",
			"type": 201,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Text area"
				}
			],
			"label": {
				"English": "Solicitudimg"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "estatus",
			"sqlExpression": "solicitudes.estatus",
			"index": 12,
			"strField": "estatus",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Readonly",
					"lookupType": 2,
					"lookupTable": "decisionessolicitud_lookup",
					"lookupTableConnection": "conn",
					"lookupLinkField": "decisionsolicitud",
					"lookupDisplayField": "decisionsolicitud",
					"lookupOrderBy": "decisionsolicitud"
				}
			],
			"label": {
				"English": "Estatus"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idsolrazon",
			"sqlExpression": "solicitudes.idsolrazon",
			"index": 13,
			"strField": "idsolrazon",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Idsolrazon"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "importeatt",
			"sqlExpression": "solicitudes.importeatt",
			"index": 14,
			"strField": "importeatt",
			"type": 5,
			"viewFormats": [
				{
					"format": "Number"
				}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Importeatt"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "importesms",
			"sqlExpression": "solicitudes.importesms",
			"index": 15,
			"strField": "importesms",
			"type": 5,
			"viewFormats": [
				{
					"format": "Number"
				}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Importesms"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "plazo",
			"sqlExpression": "solicitudes.plazo",
			"index": 16,
			"strField": "plazo",
			"type": 2,
			"separateEditViewFormats": true,
			"viewFormats": [
				{},
				{
					"pageType": "list"
				},
				{
					"pageType": "print"
				},
				{
					"pageType": "export"
				}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"lookupTable": "plazos",
					"lookupTableConnection": "conn",
					"lookupLinkField": "plazo",
					"lookupDisplayField": "plazo",
					"lookupOrderBy": "plazo"
				},
				{
					"format": "Lookup wizard",
					"pageType": "add",
					"lookupTable": "plazos",
					"lookupTableConnection": "conn",
					"lookupLinkField": "plazo",
					"lookupDisplayField": "plazo",
					"lookupOrderBy": "plazo"
				},
				{
					"format": "Readonly",
					"pageType": "search",
					"required": true,
					"lookupTable": "plazos",
					"lookupTableConnection": "conn",
					"lookupLinkField": "plazo",
					"lookupDisplayField": "plazo",
					"lookupOrderBy": "plazo"
				}
			],
			"label": {
				"English": "Plazo"
			},
			"placeholder": {
				"Spanish": "Ingrese el plazo"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "observaciones",
			"sqlExpression": "solicitudes.observaciones",
			"index": 17,
			"strField": "observaciones",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Text area"
				}
			],
			"label": {
				"English": "Observaciones",
				"Spanish": "Observaciones"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "equipoincluido",
			"sqlExpression": "solicitudes.equipoincluido",
			"index": 18,
			"strField": "equipoincluido",
			"type": 2,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Equipoincluido"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "rfc",
			"sqlExpression": "solicitudes.rfc",
			"index": 19,
			"strField": "rfc",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Readonly"
				}
			],
			"label": {
				"English": "Rfc"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idtratamiento",
			"sqlExpression": "solicitudes.idtratamiento",
			"index": 20,
			"strField": "idtratamiento",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Idtratamiento"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "riesgo",
			"sqlExpression": "solicitudes.riesgo",
			"index": 21,
			"strField": "riesgo",
			"type": 129,
			"viewFormats": [
				{
					"linkDisplay": 2,
					"linkDisplayField": "direccion"
				}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Riesgo"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "observacionest",
			"sqlExpression": "solicitudes.observacionest",
			"index": 22,
			"strField": "observacionest",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Observacionest"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idcli",
			"sqlExpression": "solicitudes.idcli",
			"index": 23,
			"strField": "idcli",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Idcli",
				"Spanish": "Cliente ID"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "fecha1avta",
			"sqlExpression": "solicitudes.fecha1avta",
			"index": 24,
			"strField": "fecha1avta",
			"type": 7,
			"viewFormats": [
				{
					"format": "Short Date"
				}
			],
			"editFormats": [
				{
					"format": "Date",
					"dateEditType": 11
				}
			],
			"label": {
				"English": "Fecha1avta"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idplan1avta",
			"sqlExpression": "solicitudes.idplan1avta",
			"index": 25,
			"strField": "idplan1avta",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Idplan1avta"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "dn1avta",
			"sqlExpression": "solicitudes.dn1avta",
			"index": 26,
			"strField": "dn1avta",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Dn1avta"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idproceso",
			"sqlExpression": "solicitudes.idproceso",
			"index": 27,
			"strField": "idproceso",
			"type": 2,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Idproceso"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idorigenventa",
			"sqlExpression": "solicitudes.idorigenventa",
			"index": 28,
			"strField": "idorigenventa",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Idorigenventa"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "nombre",
			"sqlExpression": "cte.nombre",
			"index": 30,
			"strField": "nombre",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Readonly"
				}
			],
			"label": {
				"Spanish": "Nombre(s)"
			},
			"placeholder": {
				"Spanish": "Nombre(s) del cliente"
			},
			"tableName": "clientes"
		},
		{
			"name": "paterno",
			"sqlExpression": "cte.paterno",
			"index": 31,
			"strField": "paterno",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Readonly"
				}
			],
			"label": {
				"Spanish": "Paterno"
			},
			"placeholder": {
				"Spanish": "Apellido paterno"
			},
			"tableName": "clientes"
		},
		{
			"name": "materno",
			"sqlExpression": "cte.materno",
			"index": 32,
			"strField": "materno",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Readonly"
				}
			],
			"label": {
				"Spanish": "Materno"
			},
			"placeholder": {
				"Spanish": "Apellido materno"
			},
			"tableName": "clientes"
		},
		{
			"name": "estado",
			"sqlExpression": "ev.estado",
			"index": 34,
			"strField": "estado",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"textHTML5Input": "Text"
				}
			],
			"label": {
				"Spanish": "Estado"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "ciudad",
			"sqlExpression": "ev.ciudad",
			"index": 35,
			"strField": "ciudad",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Ciudad"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "cp",
			"sqlExpression": "ev.cp",
			"index": 36,
			"strField": "cp",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "CP"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "calle",
			"sqlExpression": "ev.calle",
			"index": 37,
			"strField": "calle",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Calle"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "numeroext",
			"sqlExpression": "ev.numeroext",
			"index": 38,
			"strField": "numeroext",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "# Ext"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "numeroint",
			"sqlExpression": "ev.numeroint",
			"index": 39,
			"strField": "numeroint",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "# Int"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "colonia",
			"sqlExpression": "ev.colonia",
			"index": 40,
			"strField": "colonia",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Colonia"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "descripcion",
			"sqlExpression": "p.descripcion",
			"index": 41,
			"strField": "descripcion",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Readonly"
				}
			],
			"label": {
				"Spanish": "Descripción"
			},
			"tableName": "productos"
		},
		{
			"name": "maps_url",
			"sqlExpression": "CONCAT('https://www.google.com/maps/search/?api=1&query=', REPLACE(TRIM(CONCAT_WS(' ',\n             IFNULL(ev.numeroext,''),IFNULL(ev.calle,''),IFNULL(ev.numeroint,''),\n             IFNULL(ev.colonia,''),IFNULL(ev.cp,''),IFNULL(ev.ciudad,''),IFNULL(ev.estado,'')\n           )),' ','+'))",
			"index": 42,
			"strField": "maps_url",
			"type": 200,
			"viewFormats": [
				{
					"format": "Hyperlink",
					"linkNewWindow": true,
					"linkDisplay": 2,
					"linkDisplayField": "direccion",
					"linkDisplayText": {
						"text": "Dirección de entrega...",
						"type": 0
					}
				}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Maps Url"
			},
			"tableName": ""
		},
		{
			"name": "direccion",
			"sqlExpression": "CONCAT(TRIM(CONCAT_WS(' ',\n      IF(IFNULL(ev.calle,'')='','', CONCAT('C.',ev.calle)),\n      IFNULL(CONCAT('No.',ev.numeroext),''),\n      IFNULL(CONCAT('Int.',ev.numeroint),''),\n      IFNULL(ev.colonia,''), IFNULL(CONCAT('C.P.',ev.cp),''),\n      IFNULL(ev.ciudad,''), IFNULL(ev.estado,'')\n    )))",
			"index": 43,
			"strField": "direccion",
			"type": 200,
			"viewFormats": [
				{
					"format": "Custom",
					"customExpression": "\r\n"
				}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Direccion"
			},
			"tableName": ""
		},
		{
			"name": "estatusentrega",
			"sqlExpression": "solicitudes.estatusentrega",
			"index": 29,
			"strField": "estatusentrega",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Readonly",
					"lookupTable": "estatusentregas",
					"lookupTableConnection": "conn",
					"lookupLinkField": "id",
					"lookupDisplayField": "estatusentrega"
				}
			],
			"label": {
				"Spanish": "Estatus entrega"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "lat",
			"sqlExpression": "ev.lat",
			"index": 47,
			"strField": "lat",
			"type": 14,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"validateAs": "Number"
				}
			],
			"label": {
				"Spanish": "Latitud"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "lng",
			"sqlExpression": "ev.lng",
			"index": 48,
			"strField": "lng",
			"type": 14,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Longitud"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "noserie",
			"sqlExpression": "solicitudes.esnimei",
			"index": 45,
			"strField": "esnimei",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"required": true
				}
			],
			"label": {
				"Spanish": "IMEI"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "dn",
			"sqlExpression": "solicitudes.dn",
			"index": 49,
			"strField": "dn",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"required": true,
					"textboxMaxLenth": 10,
					"textboxMask": "9999999999"
				}
			],
			"label": {
				"Spanish": "DN"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "cuenta",
			"sqlExpression": "solicitudes.cuenta",
			"index": 51,
			"strField": "cuenta",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"validateAs": "Number",
					"textboxMaxLenth": 50
				}
			],
			"label": {
				"Spanish": "Cuenta"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "contrato",
			"sqlExpression": "solicitudes.contrato",
			"index": 52,
			"strField": "contrato",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"textboxMaxLenth": 10
				}
			],
			"label": {
				"Spanish": "Contrato"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "contratoportal",
			"sqlExpression": "solicitudes.contratoportal",
			"index": 53,
			"strField": "contratoportal",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Contrato Portal"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "plazopendiente",
			"sqlExpression": "solicitudes.plazopendiente",
			"index": 54,
			"strField": "plazopendiente",
			"type": 2,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"validateAs": "Number"
				}
			],
			"label": {
				"Spanish": "Plazo pendiente"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "factura",
			"sqlExpression": "solicitudes.Factura",
			"index": 55,
			"strField": "Factura",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"textboxMaxLenth": 18
				}
			],
			"label": {
				"Spanish": "Factura"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "fechavenci",
			"sqlExpression": "solicitudes.fechavenci",
			"index": 56,
			"strField": "fechavenci",
			"type": 7,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Date",
					"dateEditType": 11
				}
			],
			"label": {
				"Spanish": "Vencimiento"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "ciclo",
			"sqlExpression": "solicitudes.ciclo",
			"index": 57,
			"strField": "ciclo",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"required": true,
					"lookupType": 2,
					"lookupTable": "ciclos",
					"lookupTableConnection": "conn",
					"lookupLinkField": "ciclo",
					"lookupDisplayField": "corte",
					"lookupOrderBy": "corte",
					"lookupWhere": "clasif = 2"
				}
			],
			"label": {
				"Spanish": "Ciclo"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "dnpreferido",
			"sqlExpression": "solicitudes.dnpreferido",
			"index": 50,
			"strField": "dnpreferido",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"textboxMaxLenth": 10
				}
			],
			"label": {
				"Spanish": "DN Preferido"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "simcard",
			"sqlExpression": "solicitudes.simcard",
			"index": 46,
			"strField": "simcard",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Simcard"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "renta",
			"sqlExpression": "solicitudes.renta",
			"index": 58,
			"strField": "renta",
			"type": 14,
			"viewFormats": [
				{
					"format": "Number"
				}
			],
			"editFormats": [
				{
					"format": "Readonly"
				}
			],
			"label": {
				"Spanish": "Renta"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "ine",
			"sqlExpression": "solicitudes.ine",
			"index": 59,
			"strField": "ine",
			"type": 201,
			"viewFormats": [
				{
					"textShowFirstN": 20
				}
			],
			"editFormats": [
				{
					"format": "Document upload",
					"fileTypes": [
						"bmp",
						"jpg",
						"png",
						"gif",
						"pdf",
						"doc",
						"docx",
						"rtf"
					]
				}
			],
			"deleteFile": true,
			"label": {
				"Spanish": "Documentos"
			},
			"placeholder": {
				"Spanish": ""
			},
			"tableName": "solicitudes"
		},
		{
			"name": "cartaburocredito",
			"sqlExpression": "solicitudes.cartaburocredito",
			"index": 60,
			"strField": "cartaburocredito",
			"type": 201,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Document upload"
				}
			],
			"deleteFile": true,
			"label": {
				"Spanish": "Carta buró de crédito"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "polizaseguro",
			"sqlExpression": "solicitudes.polizaseguro",
			"index": 61,
			"strField": "polizaseguro",
			"type": 201,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Document upload"
				}
			],
			"deleteFile": true,
			"label": {
				"Spanish": "Póliza de seguro"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "contratodocto",
			"sqlExpression": "solicitudes.contratodocto",
			"index": 62,
			"strField": "contratodocto",
			"type": 201,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Document upload"
				}
			],
			"label": {
				"Spanish": "Contrato"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "nombre_completo",
			"sqlExpression": "cte.nombre_completo",
			"index": 33,
			"strField": "nombre_completo",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Nombre Completo"
			},
			"tableName": "clientes"
		},
		{
			"name": "contratolog",
			"sqlExpression": "solicitudes.contratolog",
			"index": 63,
			"strField": "contratolog",
			"type": 2,
			"viewFormats": [
				{
					"format": "Checkbox"
				}
			],
			"editFormats": [
				{
					"format": "Checkbox"
				}
			],
			"label": {
				"Spanish": "Contrato Firma"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "anticipolog",
			"sqlExpression": "solicitudes.anticipolog",
			"index": 64,
			"strField": "anticipolog",
			"type": 2,
			"viewFormats": [
				{
					"format": "Checkbox"
				}
			],
			"editFormats": [
				{
					"format": "Checkbox"
				}
			],
			"label": {
				"Spanish": "Anticipo"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "fechahoraentrega",
			"sqlExpression": "solicitudes.fechahoraentrega",
			"index": 65,
			"strField": "fechahoraentrega",
			"type": 135,
			"viewFormats": [
				{
					"format": "Datetime"
				}
			],
			"editFormats": [
				{
					"format": "Date",
					"dateEditType": 11,
					"dateShowTime": true
				}
			],
			"label": {
				"Spanish": "Fecha/hora entrega"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "totalapagar",
			"sqlExpression": "solicitudes.totalapagar",
			"index": 66,
			"strField": "totalapagar",
			"type": 14,
			"viewFormats": [
				{
					"format": "Number"
				}
			],
			"editFormats": [
				{
					"validateAs": "Number"
				}
			],
			"label": {
				"Spanish": "Total a pagar"
			},
			"tableName": "solicitudes"
		}
	],
	"whereTabs": [
		{
			"where": "\n "
		}
	],
	"queryContext": {
		"session.idggtipoventa": "1",
		"session.UserID": "SMORAV",
		"session.Label": "VALIDADOR"
	},
	"eventHandlers": [
		{
			"eventId": "EVENT_BEFOREMOVENEXT_LIST",
			"pageType": "list",
			"code": "date_default_timezone_set('America/Mexico_City');\r\n\r\n\r\n$data[\"tienda\"]=$_SESSION[\"Tienda\"];\r\n$data['fechacaptura']=date('Y-m-d H:i:s');\r\n$data[\"almacenatt\"]=$_SESSION[\"Tienda\"];\r\n$data['ventadomicilio'] = 1;\r\n$data['equipoincluido']=1;\r\n$data['tiendamovil']=1;\r\n$data['clasif']=1;\r\n\r\n\r\n\r\n\r\n//$pageObject->hideItem(\"btnCarta\", $recordId);\r\n\r\n\r\n\r\n\r\n\r\n// Coloring por estatus (igual que ya tienes)\r\n$st = (int)$data[\"estatusentrega\"];\r\nswitch ($st) {\r\n  case 2:  $cls = 'table-success'; break;\r\n  case 3:  $cls = 'table-danger';  break;\r\n  default: $cls = 'table-warning';\r\n}\r\nif (!isset($row[\"rowattrs\"])) $row[\"rowattrs\"] = '';\r\n$row[\"rowattrs\"] .= ' class=\"'.$cls.'\"';\r\n\r\nif ($st === 3) {\r\n    $record[\"css\"]                  = 'background:#FF3A30';\r\n    $record['fecha_css']            = 'color:white';\r\n    $record['idcliente_css']        = 'color:white';\r\n    $record['descripcion_css']      = 'color:white';\r\n    $record['estatus_css']          = 'color:white';\r\n    $record['plazo_css']            = 'color:white';\r\n    $record['orden_css']            = 'color:white';\r\n    $record['maps_url_css']         = 'color:white';\r\n    $record['estatusentrega_css']   = 'color:white';\r\n    $record['equipo_css']           = 'color:white';\r\n    $record['chip_css']             = 'color:white';\r\n}\r\n\r\n// PK\r\n// PK\r\n$pk = $data[\"idsolicitud\"];\r\nif (!$pk) return;\r\n\r\n// Elige la página (usa tu lógica real)\r\n$role = strtoupper($_SESSION[\"Label\"] ?? ''); \r\n\r\n// === 2) Elegir página target ===\r\n// === 2) Página destino ===\r\n$targetPage = ($role === 'MESADECONTROL') ? 'edit1' : 'edit';\r\n\r\n// === 3) Base SIEMPRE a \"edit\" para obtener solicitudes_edit.php\r\n$baseHref = GetTableLink(\"solicitudes\", \"edit\"); // => solicitudes_edit.php\r\n\r\n// === 4) Querystring: page=..., editid1=..., menuItemId (si existe)\r\n$qs = [];\r\n$qs[] = \"page=\".$targetPage;\r\n$qs[] = \"editid1=\".$pk;\r\n\r\n// Conserva menuItemId si llegó por GET/POST\r\n$menuItemId = postvalue(\"menuItemId\");\r\nif( strlen($menuItemId) ){\r\n    $qs[] = \"menuItemId=\".rawurlencode($menuItemId);\r\n}\r\n\r\n$href = $baseHref . \"?\" . implode(\"&\", $qs);\r\n\r\n// === 5) Data-attrs que PHPRunner usa para popup/handlers ===\r\n$keys = array(\"idsolicitud\" => $pk);\r\n$keysJson = runner_htmlspecialchars(my_json_encode($keys));\r\n\r\n$attrs  = 'href=\"'.runner_htmlspecialchars($href).'\"';\r\n$attrs .= ' data-href=\"'.runner_htmlspecialchars($href).'\"';\r\n$attrs .= ' data-table=\"'.GetTableURL(\"solicitudes\").'\"';\r\n$attrs .= ' data-pagetype=\"edit\"';\r\n$attrs .= ' data-page=\"'.$targetPage.'\"';\r\n$attrs .= ' data-keys=\"'.$keysJson.'\"';\r\n$attrs .= ' class=\"rnr-editlink\"';\r\n\r\n// === 6) Reasignar a los tres puntos de enlace comunes ===\r\n$record[\"editlink_attrs\"]        = $attrs;\r\n$record[\"editlink_attrs_icon\"]   = $attrs;\r\n$record[\"editlink_button_attrs\"] = $attrs;\r\n\r\n\r\n  //  global $record;\r\n\r\n    // Normalizar estatus\r\n    error_log(\"estatus row: [\".$data[\"estatus\"].\"]\".PHP_EOL, 3, \"debug_log.log\");\r\nif ($data[\"estatus\"]=='ACEPTADA'){\r\n    // --- PRUEBA: pintar TODAS las filas de amarillo ---\r\n   $record[\"css\"]='background:blue;';\r\n}\r\n    return true;\r\n\r\n\r\n\r\n\r\n\r\n// Debug\r\n//error_log(\"DEBUG-REDIR: Role=$role TargetPage=$targetPage Href=$href\", 3, 'debug_file.log');"
		},
		{
			"eventId": "EVENT_BEFOREQUERY_LIST",
			"pageType": "list",
			"code": "/*\nswitch (true) {\n\n\t//case ($_SESSION[\"Acceso\"]===0 OR strtoupper($_SESSION['UserID'])=='ADMIN'):\n\tcase ( strtoupper($_SESSION['UserID'])=='ADMIN'):\n\t\t\t\t\tbreak;\n\t\tcase (strtoupper($_SESSION[\"Label\"])=='VALIDADOR'  || strtoupper($_SESSION[\"Label\"])=='MESADECONTROL'):\n    //   $strWhereClause=WhereAdd($strWhereClause,\"solicitudes.idtipoventa in (1,11,21,22)\");\n\t       break;\n\t\t\t\n\t\t\tcase ($_SESSION[\"Acceso\"]==1):\n       $strWhereClause=WhereAdd($strWhereClause,\"//solicitudes.idtipoventa not in (1,11,21,22) and solicitudes.idtienda=\".$_SESSION[\"Tienda\"]); //solicitado por Diego\n \n        break;\n  /* case ($_SESSION[\"Acceso\"]==2):\n\t\t\t\t\n         $strWhereClause=WhereAdd($strWhereClause,\"solicitudes.idtipoventa>1 AND solicitudes.idtienda=\".$_SESSION[\"Tienda\"]);\n        break;*//*\n    case ($_SESSION[\"Acceso\"]===10 ):\n        $strWhereClause=whereAdd($strWhereClause,\" solicitudes.idtienda in (\nselect distinct t.idtienda from tiendas t inner join\n userssectores us on t.idsector=us.idsector\n where username='\".$_SESSION[\"UserID\"].\"')\");\n        break;\n\t\tdefault:\n\t\t\t\t$strWhereClause=whereAdd($strWhereClause,\"solicitudes.usuario='\".$_SESSION['UserID'].\"'\");\n\t\t\t\tbreak;\n}\n*/\n\n/*\nswitch (true) {\n\n\n\tcase ( strtoupper($_SESSION['UserID'])=='ADMIN'):\n\t\t\t\t\tbreak;\n\t\tcase (strtoupper($_SESSION[\"Label\"])=='VALIDADOR'):\n       $strWhereClause=WhereAdd($strWhereClause,\"solicitudes.idtipoventa in (1,11,21,22)\");\n\t       break;\n\t\t\t\n\t\t\tcase ($_SESSION[\"Acceso\"]==1):\n       $strWhereClause=WhereAdd($strWhereClause,\"solicitudes.idtipoventa not in (1,11,21,22) and solicitudes.idtienda=\".$_SESSION[\"Tienda\"]); \n \n        break;\n\n    case ($_SESSION[\"Acceso\"]===10 ):\n        $strWhereClause=whereAdd($strWhereClause,\" solicitudes.idtienda in (\nselect distinct t.idtienda from tiendas t inner join\n userssectores us on t.idsector=us.idsector\n where username='\".$_SESSION[\"UserID\"].\"')\");\n        break;\n\t\tdefault:\n\t\t\t\t$strWhereClause=whereAdd($strWhereClause,\"solicitudes.usuario='\".$_SESSION['UserID'].\"'\");\n\t\t\t\tbreak;\n}\n*/\n\n\n\n// Antes de SQL Query (& $where, & $orderby, $pageObject)\n/*\n$tipoventa_from_url = postvalue(\"tipoventa\");\n\nif (!empty($tipoventa_from_url)) {\n    \n    // 1. Construir la condición usando el alias de la tabla 'g'\n    // La clave es referenciar 'g.idggtipoventa'\n    $filtro = \"g.idggtipoventa = \" . (int)$tipoventa_from_url;\n\n    // 2. Agregar el filtro a la cláusula $where existente\n    if (strlen($where) > 0) {\n        // Si ya hay un WHERE, lo concatenamos\n        $where.= \" AND ( \" . $filtro . \" ) \";\n    } else {\n        // Si no hay WHERE, este es el único filtro\n        $where = $filtro;\n    }\n    \n  \n  //  error_log(\"Filtro aplicado por IDGG: \" . $where, 3, \"debug_log.log\");\n}\n\n//return true;\n*/\n/*\n// 1) Tomar fechas en este orden de prioridad: GET -> SESSION -> defaults\n$in  = isset($_GET['FechaIn']) ? $_GET['FechaIn'] : ( isset($_SESSION['FechaIn']) ? $_SESSION['FechaIn'] : date('Y-m-d', strtotime('-30 days')) );\n$fn  = isset($_GET['FechaFn']) ? $_GET['FechaFn'] : ( isset($_SESSION['FechaFn']) ? $_SESSION['FechaFn'] : date('Y-m-d') );\n\n// 2) Validar formato (YYYY-MM-DD); si no es válido, poner defaults\n$check = function($d){\n    $dt = DateTime::createFromFormat('Y-m-d', $d);\n    return $dt && $dt->format('Y-m-d') === $d;\n};\nif( !$check($in) ) $in = date('Y-m-d', strtotime('-30 days'));\nif( !$check($fn) ) $fn = date('Y-m-d');\n\n// 3) Si el usuario invirtió el rango, corregir (swap)\nif( $in > $fn ){\n    $tmp = $in; $in = $fn; $fn = $tmp;\n}\n\n// 4) Guardar en sesión (para siguientes cargas)\n$_SESSION['FechaIn'] = $in;\n$_SESSION['FechaFn'] = $fn;\n\n// 5) Construir el WHERE\n//    - Si tu campo 'fecha' es DATE, BETWEEN es inclusivo y esto basta.\n//    - Si fuese DATETIME y quieres incluir todo el día final, usa <= DATE_ADD($fn, INTERVAL 1 DAY)\nif( $strWhereClause != \"\" ) {\n    $strWhereClause .= \" AND \";\n}\n$strWhereClause .= \" solicitudes.fecha BETWEEN \" . add_db_quotes(\"fecha\", $in) . \" AND \" . add_db_quotes(\"fecha\", $fn);\n*/\n// Para depurar:\n// LogInfo(\"Rango aplicado: $in a $fn\");\n// LogInfo(\"WHERE: \".$strWhereClause);\n"
		},
		{
			"eventId": "EVENT_BEFORESHOW_LIST",
			"pageType": "list",
			"code": "// Place event code here.\n// Use \"Add Action\" button to add code snippets.\n\n// Detecta ADMIN y otras banderas servidor-side\n// Detecta ADMIN y otras banderas servidor-side\n// --- Reglas de acceso ---\n$userId      = isset($_SESSION['UserID']) ? strtoupper((string)$_SESSION['UserID']) : '';\n$isAdmin     = ($userId === 'ADMIN');\n$isValidador = (isset($_SESSION['Label'])  && $_SESSION['Label'] === 'VALIDADOR');\n$hasAcceso   = (isset($_SESSION['Acceso']) && intval($_SESSION['Acceso']) === 1);\n\n$role = $_SESSION['Label'];\n\n$pageObject->hideField(\"idsolicitud\");\n$pageObject->hideField(\"nombre_completo\");\n$pageObject->hideField(\"idtienda\");\n//$pageObject->hideField(\"ine\");\n$pageObject->hideField(\"cartaburocredito\");\n$pageObject->hideField(\"polizaseguro\");\n$pageObject->hideField(\"contratodocto\");\n$pageObject->hideField(\"direccion\");\n\n\n\n\n\n\n$pageObject->setProxyValue(\"currentRole\", $role);\n$pageObject->setProxyValue(\"currentUser\", $userId);\n// Cambia la condición a tu gusto:\n$allowLogistic =  $isAdmin || ($isValidador && $hasAcceso);\n\n// IMPORTANTE: usa el *itemid* real del botón en el diseñador (Builder).\n// Te recomiendo renombrarlo a \"logistic_btn\". Si en tu HTML ves data-itemid=\"custom_button\",\n// entonces cambia \"logistic_btn\" por \"custom_button\".\nif (!$allowLogistic) {\n  //  $pageObject->hideItem(\"logistic_btn\");   // oculta la columna/botón para ese usuario\n} else {\n    // lo exponemos por si quieres usarlo del lado cliente (opcional)\n    $pageObject->setProxyValue(\"allowLogistic\", true);\n}\n\n\n\n"
		},
		{
			"eventId": "EVENT_BEFOREPROCESS_LIST",
			"pageType": "list",
			"code": "\t$_SESSION[\"Modulo\"]=1;\n\n// BeforeProcessList (o BeforeSQLQuery si usas un query de SQL)\n\n$tipoventa_from_url = postvalue(\"tipoventa\");\n\nif (!empty($tipoventa_from_url)) {\n    // 1. Construir la condición de filtro\n   // $where = \"idggtipoventa = \" . (int)$tipoventa_from_url;\n    $_SESSION['idggtipoventa']=(int)$tipoventa_from_url;\n     // Versión 10+ (Recomendada):\n  //  $pageObject->setTableFilter($where);\n    \n    // Versiones anteriores (o si tienes $gQuery):\n    // $gQuery->setWhere( $gQuery->getWhere() . \" AND \" . $where );\n}\n\n"
		},
		{
			"eventId": "EVENT_JS_ONLOAD",
			"pageType": "add",
			"code": "// ====================== CONFIG ======================\nwindow.STORAGE_KEY   = 'solicitud_vnp_draft';\nwindow.ENDPOINT      = 'serial_reserve.php';        // reserva/libera series\nwindow.API_SAVE      = 'solicitud_save_api.php';    // guarda solicitud vía API\n\nwindow.FIELDS = [\n  'idcliente','idproducto','idtipoventa','idplan','orden','plazo','rfc','idcli',\n  'estado','ciudad','colonia','calle','numeroext','numeroint','noserie','simcard','cp',\n  'dn','cuenta','contrato','contratoportal','plazopendiente','dnpreferido','idtienda','renta','ciclo','fechahoraentrega',\n  'factura','fechavenci','observaciones','contratolog','anticipolog','ine','cartaburocredito','polizaseguro','contratodocto'];\n  \n  \n  // ====================== CAMPOS OBLIGATORIOS (nuevo) ======================\nwindow.REQUIRED_FIELDS = [\n  { name:'idcliente',   label:'Cliente' },\n  { name:'idproducto',  label:'Producto' },\n  { name:'idtipoventa', label:'Tipo de venta' },\n  { name:'idplan',      label:'Plan' },\n  { name:'noserie',     label:'Equipo (IMEI)' },\n  { name:'dn',          label:'DN' },\n  { name:'orden',          label:'Orden' },\n  { name:'ciclo',          label:'Ciclo' }\n  \n  // agrega o quita según tus mandatory reales en PHPRunner\n];\n\n\nwindow.__recovering  = false;\nwindow.__res_noserie = null;\nwindow.__saving      = false;\n\nvar DRAFT_TTL = 2 * 60 * 60 * 1000; // 2 horas\n\n// ====================== CARGAR SWEETALERT2 (si no existe) ======================\n(function ensureSwal(){\n  if (typeof Swal !== 'undefined') return;\n  var s = document.createElement('script');\n  s.src = \"https://cdn.jsdelivr.net/npm/sweetalert2@11\";\n  s.async = true;\n  document.head.appendChild(s);\n})();\n\n// ====================== HELPERS BÁSICOS ======================\nfunction getPid(){\n  return $('[data-pageid]').first().attr('data-pageid') || '';\n}\nfunction getCtrl(f){\n  try { return Runner.getControl(getPid(), f); } catch(e){ return null; }\n}\nfunction readVal(f){\n  var c = getCtrl(f);\n  if (c && typeof c.getValue === 'function') return c.getValue();\n  var pid = getPid();\n  var $el = $('#value_'+f+'_'+pid);\n  return $el.length ? $el.val() : '';\n}\nfunction setVal(f,v,fire){\n  var c = getCtrl(f);\n  if (c && typeof c.setControlValue === 'function') {\n    c.setControlValue(v);\n    if (fire && typeof c.fireEvent === 'function') c.fireEvent('change');\n    return;\n  }\n  var pid = getPid();\n  var $el = $('#value_'+f+'_'+pid);\n  if ($el.length){\n    $el.val(v);\n    if (fire) $el.trigger('change');\n  }\n}\nfunction log(){ if (window.console && console.log) console.log.apply(console, arguments); }\n\n// ====================== VALIDACIÓN DE OBLIGATORIOS (nuevo) ======================\nfunction validateMandatory(){\n  if (!window.REQUIRED_FIELDS || !window.REQUIRED_FIELDS.length) return true;\n\n  var missing = [];\n\n  window.REQUIRED_FIELDS.forEach(function(f){\n    var v = readVal(f.name);\n    if (v === null || v === undefined) v = '';\n    v = String(v).trim();\n\n    // Si quieres considerar \"0\" como vacío para combos, puedes descomentar:\n    // if (v === '' || v === '0') { ... }\n\n    if (!v){\n      missing.push(f);\n    }\n  });\n\n  if (missing.length){\n    var msg = 'Debes capturar los siguientes campos obligatorios:\\n\\n' +\n      missing.map(function(f){ return '• ' + f.label; }).join('\\n');\n\n    showError(msg);\n\n    // Enfocar el primer campo faltante (si existe control PHPRunner)\n    var first = missing[0];\n    var c = getCtrl(first.name);\n    if (c && typeof c.setFocus === 'function'){\n      setTimeout(function(){ c.setFocus(); }, 200);\n    }\n\n    return false;\n  }\n\n  return true;\n}\n\n\n\n\n\n\n\n\n// ====================== SWEETALERT WRAPPERS ======================\nfunction showSuccess(msg, cb){\n  if (typeof Swal !== 'undefined') {\n    Swal.fire({\n      title: 'Guardado correctamente',\n      text: msg || '',\n      icon: 'success',\n      confirmButtonText: 'Aceptar',\n      timer: 2200,\n      timerProgressBar: true\n    }).then(function(){ if (typeof cb === 'function') cb(); });\n  } else {\n    alert(msg || 'Guardado correctamente.');\n    if (typeof cb === 'function') cb();\n  }\n}\nfunction showError(msg){\n  if (typeof Swal !== 'undefined') {\n    Swal.fire({ title: 'Error', text: msg || 'Ocurrió un error.', icon: 'error', confirmButtonText: 'Aceptar' });\n  } else {\n    alert(msg || 'Ocurrió un error.');\n  }\n}\n\n// ====================== AUTOSAVE ======================\nfunction buildDraft(){\n  var d = {};\n  (window.FIELDS || []).forEach(function(f){\n    var v = readVal(f);\n    if (v !== null && v !== undefined && v !== '') d[f] = v;\n  });\n  d.timestamp = Date.now();\n  return d;\n}\nfunction saveDraft(){\n  if (window.__recovering) return;\n  try {\n    var d = buildDraft();\n    sessionStorage.setItem(window.STORAGE_KEY, JSON.stringify(d));\n  } catch(e){ log('Error saveDraft', e); }\n}\nfunction recoverDraft(){\n  var raw = sessionStorage.getItem(window.STORAGE_KEY);\n  if (!raw) return;\n  try {\n    var d = JSON.parse(raw);\n    if (!d.timestamp || (Date.now() - d.timestamp) > DRAFT_TTL) {\n      sessionStorage.removeItem(window.STORAGE_KEY);\n      return;\n    }\n    window.__recovering = true;\n    log('Draft encontrado', d);\n\n    if (d.idproducto){\n      setVal('idproducto', d.idproducto, true);\n      setTimeout(function(){\n        Object.keys(d).forEach(function(k){\n          if (k !== 'timestamp' && k !== 'idproducto') setVal(k, d[k], false);\n        });\n        window.__recovering = false;\n      }, 300);\n    } else {\n      Object.keys(d).forEach(function(k){\n        if (k !== 'timestamp') setVal(k, d[k], false);\n      });\n      window.__recovering = false;\n    }\n  } catch(e){ log('Draft inválido', e); }\n  sessionStorage.removeItem(window.STORAGE_KEY);\n}\n\n// ====================== RESERVAS (serial_reserve.php) ======================\nfunction releasePrev(){\n  if (!window.__res_noserie) return;\n  log('Liberando reserva previa', window.__res_noserie);\n  $.post(window.ENDPOINT, { action:'release', noserie: window.__res_noserie });\n  window.__res_noserie = null;\n}\nfunction reserveForProduct(productId){\n  if (!productId || window.__recovering) return;\n  log('Reservando serie para producto', productId);\n\n  releasePrev();\n  setVal('noserie','',true);\n\n  $.post(window.ENDPOINT, { action:'reserve_by_product', product_id: productId })\n    .done(function(resp){\n      var r = (typeof resp === 'object') ? resp : (function(){ try {return JSON.parse(resp);}catch(e){return null;} })();\n      log('Respuesta reserva', r);\n\n      if (r && r.ok && r.noserie) {\n        window.__res_noserie = r.noserie;\n        setVal('noserie', r.noserie, true);\n        saveDraft();\n      } else if (r && r.error === 'no-stock') {\n        showError('No hay series disponibles para este producto.');\n        setVal('idproducto','',true);\n      } else {\n        showError('No se pudo reservar la serie.');\n        setVal('idproducto','',true);\n      }\n    })\n    .fail(function(){\n      showError('Error de comunicación al reservar la serie.');\n      setVal('idproducto','',true);\n    });\n}\n\n// ====================== RESET UI INMEDIATO (nuevo) ======================\nfunction resetAddFormUI(){\n  try {\n    var pid = getPid();\n\n    // 1) reset nativo por si el form existe\n    var frm = $('form').get(0);\n    if (frm && typeof frm.reset === 'function') frm.reset();\n\n    // 2) limpiar controles PHPRunner\n    (window.FIELDS || []).forEach(function(f){\n      try {\n        var c = getCtrl(f);\n        if (c && typeof c.setValue === 'function') {\n          c.setValue('');\n          if (typeof c.fireEvent === 'function') c.fireEvent('change');\n        } else {\n          // fallback DOM\n          var $el = $('#value_'+f+'_'+pid);\n          if ($el.length) { $el.val(''); $el.trigger('change'); }\n        }\n      } catch(e){}\n    });\n\n    // 3) limpiar select2 si existiera\n    $('.select2').each(function(){ try { $(this).val(null).trigger('change'); } catch(e){} });\n\n  } catch(e){ /* ignore */ }\n}\n\n// ====================== CLEAN FORM TRAS ÉXITO (modificado) ======================\nfunction cleanAfterSuccess(){\n  // Libera serie reservada si existe\n  if (window.__res_noserie) {\n    $.post(window.ENDPOINT, { action:'release', noserie: window.__res_noserie });\n    window.__res_noserie = null;\n  }\n\n  // Limpieza visual inmediata (sin esperar reload)\n  resetAddFormUI();\n\n  // Borrar draft\n  try { sessionStorage.removeItem(window.STORAGE_KEY); } catch(e){}\n\n  // Disparo silencioso para que el BeforeDisplay/BeforeProcess limpie la sesión\n  // (tu evento PHP mira clean=1 y hace unset de las *_add_values)\n  $.post('solicitudes_add.php', { clean: 1, ajax_clean: 1 });\n\n  // Recargamos con clean=1 para garantizar formulario fresco\n  var url = window.location.pathname + '?new=1&clean=1&_t=' + Date.now();\n  window.location.href = url;\n}\n\n// ====================== API SAVE (solicitud_save_api.php) ======================\nfunction sendToAPI(){\n  if (window.__saving) return;\n\n  // === NUEVO: validar obligatorios antes de llamar a la API ===\n  if (!validateMandatory()){\n    return; // no continúa, NO llama a la API\n  }\n\n  window.__saving = true;\n\n  var datos = {};\n  (window.FIELDS || []).forEach(function(f){ datos[f] = readVal(f); });\n\n  log('Payload a API_SAVE:', datos);\n\n  $.post(window.API_SAVE, datos, function(respRaw){\n    var r = (typeof respRaw === 'object') ? respRaw : (function(){ try { return JSON.parse(respRaw); } catch(e){ return null; } })();\n    log('Respuesta API_SAVE:', r || respRaw);\n\n    if (!r) {\n      showError('Respuesta inválida del servidor.');\n      window.__saving = false;\n      return;\n    }\n\n    var ok = (r.ok === true || r.ok === 1 || r.ok === \"1\" || r.ok === \"ok\" || r.ok === \"OK\");\n\n    if (ok) {\n      var msg = r.message || 'Solicitud guardada correctamente.';\n      showSuccess(msg, function(){ cleanAfterSuccess(); });\n    } else {\n      showError(r.error || 'Error desconocido al guardar.');\n    }\n\n    window.__saving = false;\n  })\n  .fail(function(xhr){\n    log('Fallo AJAX API_SAVE:', xhr.status, xhr.responseText);\n    showError('Error de comunicación con el servidor.');\n    window.__saving = false;\n  });\n}\n\n\n// ====================== INIT ======================\n$(function(){\n  var pid      = getPid();\n  var ctrlProd = getCtrl('idproducto');\n\n  log('INIT solicitudes_add pid=', pid, 'ctrlProd=', !!ctrlProd);\n\n  // 1) Recuperar borrador si existe\n  recoverDraft();\n\n  // 2) Autosave en cambios\n  var sel = (window.FIELDS || []).map(function(f){\n    return \"[data-field='\"+f+\"'][data-pageid='\"+pid+\"'] input,\" +\n           \"[data-field='\"+f+\"'][data-pageid='\"+pid+\"'] select,\" +\n           \"[data-field='\"+f+\"'][data-pageid='\"+pid+\"'] textarea\";\n  }).join(',');\n  if (sel) {\n    $(document).on('input change', sel, function(){ saveDraft(); });\n  }\n\n  // 3) Reserva automática al cambiar producto\n  if (ctrlProd) {\n    ctrlProd.on('change', function(){\n      if (window.__recovering) return;\n      var v = ctrlProd.getValue();\n      log('Cambio de idproducto =>', v);\n      if (v) reserveForProduct(v);\n    });\n  }\n\n  // 4) Botón personalizado \"Guardar VNP\"\n  var saveSelector =\n    \"[data-itemid='btnGuardarVNP'] a, \" +\n    \"[data-itemid='btnGuardarVNP'] button, \" +\n    \"#btnGuardarVNP\";\n\n  $(document).on('click', saveSelector, function(e){\n    e.preventDefault();\n    log('Click en botón VNP detectado');\n    sendToAPI();\n  });\n\n  // 5) Bloquear submit clásico\n  $('form').on('submit', function(e){ e.preventDefault(); return false; });\n\n  // 6) Liberar reserva al salir si no se está guardando\n  $(window).on('beforeunload pagehide', function(){\n    if (!window.__saving) {\n      releasePrev();\n      saveDraft();\n    }\n  });\n});\n\n\n(function(){\n  var $ = window.jQuery || window.$;\n  if (!$) return;\n\n  // ------------- Config -------------\n  var LOOKUP_IFR_SELECTOR = 'iframe[src*=\"_list.php\"]'; // iframes de LIST del lookup\n  var ADD_HINT = 'Alta rápida';                          // texto del botón fallback\n\n  // ------------- Portal en TOP -------------\n  function ensureTopPortal(){\n    var topDoc = window.top.document;\n    if (!topDoc.getElementById('lkpAddPortal')){\n      var wrap = topDoc.createElement('div');\n      wrap.id = 'lkpAddPortal';\n      wrap.innerHTML =\n        '<div class=\"shell\">' +\n          '<div class=\"close-btn\" id=\"lkpAddPortalClose\">Cerrar</div>' +\n          '<iframe id=\"lkpAddPortalFrame\" src=\"about:blank\" allow=\"clipboard-write; clipboard-read\"></iframe>' +\n        '</div>';\n      topDoc.body.appendChild(wrap);\n      topDoc.getElementById('lkpAddPortalClose').addEventListener('click', closeTopPortal);\n    }\n  }\n  function openTopPortal(url, onClose){\n    ensureTopPortal();\n    var topDoc = window.top.document;\n    var portal = topDoc.getElementById('lkpAddPortal');\n    var frame  = topDoc.getElementById('lkpAddPortalFrame');\n\n    // bloquear scroll del top mientras está abierto\n    window.top.document.body.style.overflow = 'hidden';\n\n    // abre el _add en el iframe del portal\n    if (url.indexOf('embedded=1') === -1){\n      url += (url.indexOf('?')>-1 ? '&' : '?') + 'embedded=1';\n    }\n    frame.src = url;\n\n    // marca handler de cierre\n    portal._onClose = (typeof onClose === 'function') ? onClose : null;\n\n    portal.style.display = 'block';\n  }\n  function closeTopPortal(){\n    var topDoc = window.top.document;\n    var portal = topDoc.getElementById('lkpAddPortal');\n    var frame  = topDoc.getElementById('lkpAddPortalFrame');\n    if (!portal) return;\n\n    // limpia y oculta\n    try { frame.src = 'about:blank'; } catch(e){}\n    portal.style.display = 'none';\n    window.top.document.body.style.overflow = '';\n\n    // callback para recargar la LIST\n    if (portal._onClose){ try { portal._onClose(); } catch(e){} }\n    portal._onClose = null;\n  }\n\n  // Permite que el _add (si es mismo origen) pueda enviar un postMessage {type:'lkp-add-close'}\n  window.top.addEventListener('message', function(ev){\n    try {\n      if (ev && ev.data && ev.data.type === 'lkp-add-close') closeTopPortal();\n    } catch(e){}\n  });\n\n  // ------------- Fijar tamaño del modal del LIST (padre) -------------\n  function fitListModal(){\n    var $modal = $('.modal:has(' + LOOKUP_IFR_SELECTOR + ')');\n    if (!$modal.length) return;\n    $modal.find('.modal-dialog').css({ maxWidth: '95vw', width: '92vw' });\n    $modal.find('.modal-body').css({ height: '85vh' });\n    $(LOOKUP_IFR_SELECTOR).css({ width: '100%', height: '100%', minHeight: '600px' });\n  }\n\n  // ------------- Hook del botón \"Add\" dentro del LIST (si es mismo origen) -------------\n  function hookAddInsideIframe($ifr){\n    if ($ifr.data('wiredAdd')) return;\n    $ifr.data('wiredAdd', true);\n\n    $ifr.on('load', function(){\n      fitListModal();\n\n      try {\n        var idoc  = this.contentDocument || this.contentWindow.document;\n        var $idoc = window.jQuery(idoc);\n\n        function rewire(){\n          // enlaces o botones que llevan al _add\n          $idoc.find('a[href*=\"_add.php\"], button[id*=\"add\"]').off('.lkp3').on('click.lkp3', (ev)=>{\n            ev.preventDefault(); ev.stopPropagation();\n\n            // construye URL del add\n            var addUrl = ev.currentTarget.href || '';\n            if (!addUrl){\n              var cur = idoc.location.href;\n              addUrl = cur.replace('_list.php','_add.php').replace(/\\?.*/,'');\n            }\n\n            // abre en portal TOP, y al cerrar recarga la LIST\n            openTopPortal(addUrl, ()=>{ try { idoc.location.reload(true); } catch(e){} });\n            return false;\n          });\n        }\n\n        rewire();\n        // si la LIST es AJAX, reengancha\n        var mo = new (window.MutationObserver || window.WebKitMutationObserver)(rewire);\n        mo.observe(idoc.body, { childList:true, subtree:true });\n\n        // Si el _add que se abre dentro del propio iframe se intentara inyectar,\n        // evitamos que cambie el src del iframe (defensa adicional):\n        var originalSrc = this.src;\n        var self = this;\n        setInterval(function(){\n          if (self.src.indexOf('_add.php')>-1) self.src = originalSrc;\n        }, 300);\n\n      } catch(e){\n        // cross-origin: no podemos enganchar dentro\n      }\n    });\n  }\n\n  // ------------- Fallback CROSS-ORIGIN (botón \"Alta rápida\") -------------\n  var floatingBtn;\n  function ensureFloatingButton(){\n    if (floatingBtn && document.body.contains(floatingBtn)) return floatingBtn;\n    floatingBtn = document.createElement('div');\n    floatingBtn.className = 'lkp-floating-add';\n    floatingBtn.textContent = ADD_HINT;\n    document.body.appendChild(floatingBtn);\n    return floatingBtn;\n  }\n  function wireFloatingButton($ifr){\n    var btn = ensureFloatingButton();\n    // Calcula la URL del ADD a partir del src del LIST (esto SÍ se puede leer cross-origin)\n    var src = $ifr.attr('src') || '';\n    if (!src || src.indexOf('_list.php') === -1){\n      btn.style.display = 'none';\n      return;\n    }\n    var addUrl = src.replace('_list.php','_add.php').replace(/\\?.*/,'');\n    btn.onclick = function(){\n      openTopPortal(addUrl, function(){\n        // intenta recargar el iframe de la LIST\n        try { $ifr[0].contentWindow.location.reload(true); } catch(e){ /* cross-origin: ignora */ }\n        // como fallback cross-origin, fuerza recargar el src:\n        var s = $ifr.attr('src');\n        $ifr.attr('src', s);\n      });\n    };\n    btn.style.display = 'block';\n  }\n\n  // ------------- Escaneo + Observers -------------\n  function scan(){\n    fitListModal();\n    $(LOOKUP_IFR_SELECTOR).each(function(){\n      var $ifr = $(this);\n      hookAddInsideIframe($ifr);\n      // Activa botón flotante siempre, sirve de fallback y es cómodo\n      wireFloatingButton($ifr);\n    });\n  }\n\n  var mo = new (window.MutationObserver || window.WebKitMutationObserver)(scan);\n  mo.observe(document.body, { childList:true, subtree:true });\n  scan();\n\n  // Ajuste por resize del viewport\n  $(window).on('resize.lkp3', fitListModal);\n})();\n\n\n\n\n\n"
		},
		{
			"eventId": "EVENT_BEFORESHOW_EDIT",
			"pageType": "edit",
			"code": "// BeforeShowEdit(&$xt, &$templatefile, $pageObject)\r\n\r\nglobal $pageObject;\r\n\r\n$values['estatus'] = \r\n/*$userGroupID = Security::getUserGroupID();\r\n$userName = Security::getUserName*/\r\n$pageObject->setProxyValue(\"currentUser\", $_SESSION[\"UserID\"]);\r\n$pageObject->setProxyValue(\"currentRole\", $_SESSION[\"Label\"]);\r\n$pageObject->setProxyValue(\"currentStatus\", $values[\"estatus\"]);\r\n\r\n/*\r\necho \"<script type='text/javascript'>\r\n    window.userRole = '{$userGroupID}';\r\n    window.userName = '{$userName}';\r\n</script>\";\r\n*/\r\n// Aseguramos que tenemos los valores actuales del registro\r\n$idsolicitud = isset($values[\"idsolicitud\"]) ? (int)$values[\"idsolicitud\"] : 0;\r\n$idproducto  = isset($values[\"idproducto\"])  ? (int)$values[\"idproducto\"]  : 0;\r\n\r\n\r\n\r\n// Guardamos en sesión para que el lookup pueda incluir este producto\r\n$_SESSION[\"CurrIdSolicitud\"] = $idsolicitud;\r\n$_SESSION[\"CurrIdProducto\"]  = $idproducto;\r\n\r\n// Buscar la serie (esnimei) actualmente asociada a esta solicitud\r\n$noserie = \"\";\r\nif ($idsolicitud > 0) {\r\n    $sql = \"SELECT esnimei \r\n            FROM seriessolicitadas \r\n            WHERE idsolicitud = \".$idsolicitud.\"\r\n            LIMIT 1\";\r\n    $rs  = DB::Query($sql);\r\n    if ($rs) {\r\n        $data = $rs->fetchAssoc();\r\n        if ($data && isset($data[\"esnimei\"])) {\r\n            $noserie = $data[\"esnimei\"];\r\n        }\r\n    }\r\n}\r\n\r\n// Exponer datos originales al JS\r\n$pageid = $pageObject->id;\r\n\r\necho \"<script>\r\nwindow.EDIT_PAGEID    = \".json_encode((string)$pageid).\";\r\nwindow.ORIG_IDPRODUCTO = \".(int)$idproducto.\";\r\nwindow.ORIG_NOSERIE    = \".json_encode((string)$noserie).\";\r\nwindow.ENDPOINT        = 'serial_reserve.php';\r\n</script>\";\r\n\r\nreturn true;\r\n"
		},
		{
			"eventId": "EVENT_JS_ONLOAD",
			"pageType": "edit",
			"code": "// ================== CONFIG ==================\r\nwindow.API_UPDATE   = 'solicitud_update_api.php';\r\nwindow.ENDPOINT     = 'serial_reserve.php';\r\n\r\nwindow.__saving_edit   = false;\r\nwindow.__origSolicitud = null;\r\nwindow.__res_noserie   = null;\r\n// flag por si en algún momento se requiere\r\nwindow.__nativeSubmit  = false;\r\n\r\nfunction getPid() {\r\n  return $('[data-pageid]').first().attr('data-pageid') || '';\r\n}\r\nfunction getCtrl(f){\r\n  try { return Runner.getControl(getPid(), f); } catch(e){ return null; }\r\n}\r\nfunction readVal(f){\r\n  var c = getCtrl(f);\r\n  if (c && typeof c.getValue === 'function') return c.getValue();\r\n  var pid = getPid();\r\n  var $el = $('#value_'+f+'_'+pid);\r\n  return $el.length ? $el.val() : '';\r\n}\r\nfunction setVal(f,v,trig){\r\n  var c = getCtrl(f);\r\n  if (c && typeof c.setControlValue === 'function') {\r\n    c.setControlValue(v);\r\n    if (trig && typeof c.fireEvent === 'function') c.fireEvent('change');\r\n    return;\r\n  }\r\n  var pid = getPid();\r\n  var $el = $('#value_'+f+'_'+pid);\r\n  if ($el.length) {\r\n    $el.val(v);\r\n    if (trig) $el.trigger('change');\r\n  }\r\n}\r\nfunction log(){ if(window.console && console.log) console.log.apply(console, arguments); }\r\n\r\n// SweetAlert helpers\r\nfunction swalOk(msg){\r\n  return Swal.fire({\r\n    title: 'Éxito',\r\n    text: msg || 'Operación realizada correctamente.',\r\n    icon: 'success',\r\n    confirmButtonText: 'OK'\r\n  });\r\n}\r\nfunction swalError(msg){\r\n  return Swal.fire({\r\n    title: 'Error',\r\n    text: msg || 'Ocurrió un error al guardar la solicitud.',\r\n    icon: 'error',\r\n    confirmButtonText: 'OK'\r\n  });\r\n}\r\n\r\n// ================== RESERVA SOLO SI CAMBIA PRODUCTO ==================\r\nfunction releasePrev(){\r\n  if (!window.__res_noserie) return;\r\n  $.post(window.ENDPOINT, { action:'release', noserie: window.__res_noserie });\r\n  window.__res_noserie = null;\r\n}\r\n\r\nfunction reserveForProductEdit(productId){\r\n  if (!productId) return;\r\n  \r\n  log('=== INICIANDO CAMBIO DE PRODUCTO ===');\r\n  log('Nuevo producto ID:', productId);\r\n  \r\n  // suspender permisos para poder tocar noserie\r\n  window.__suspendPermissions = true;\r\n  \r\n  releasePrev();\r\n  \r\n  const pid = getPid();\r\n  const $noserie = $('#value_noserie_' + pid);\r\n  $noserie.prop('readonly', false).val('');\r\n\r\n  $.post(window.ENDPOINT, { action:'reserve_by_product', product_id: productId })\r\n    .done(function(resp){\r\n      var r = (typeof resp === 'object') ? resp : (function(){ try {return JSON.parse(resp);}catch(e){return null;} })();\r\n      log('Respuesta reserva (edit):', r);\r\n      \r\n      if (r && r.ok && r.noserie) {\r\n        window.__res_noserie = r.noserie;\r\n        log('Nueva serie asignada:', r.noserie);\r\n        \r\n        $noserie.prop('readonly', false).prop('disabled', false);\r\n        $noserie.val(r.noserie);\r\n        setVal('noserie', r.noserie, true);\r\n        \r\n        setTimeout(function(){\r\n          const valorActual = readVal('noserie');\r\n          log('Verificación - Valor actual de noserie:', valorActual);\r\n          if (valorActual !== r.noserie) {\r\n            log('⚠️ El valor no se asignó correctamente, reintentando...');\r\n            $noserie.val(r.noserie).trigger('change');\r\n          }\r\n          $noserie.prop('readonly', true);\r\n        }, 100);\r\n        \r\n      } else if (r && r.error === 'no-stock') {\r\n        swalError('No hay series disponibles para el producto seleccionado.');\r\n        setVal('idproducto', '', true);\r\n      } else {\r\n        swalError('No se pudo reservar la serie.');\r\n        setVal('idproducto', '', true);\r\n      }\r\n    })\r\n    .fail(function(xhr, status, error){\r\n      log('Error AJAX reserva:', status, error);\r\n      swalError('Error de comunicación al reservar la serie.');\r\n      setVal('idproducto', '', true);\r\n    })\r\n    .always(function(){\r\n      setTimeout(function(){\r\n        log('=== RESTAURANDO PERMISOS ===');\r\n        window.__suspendPermissions = false;\r\n        \r\n        const pid = getPid();\r\n        const $noserie = $('#value_noserie_' + pid);\r\n        $noserie.prop('readonly', true).addClass('ph-disabled');\r\n        \r\n        if (typeof applyRules === 'function') {\r\n          applyRules();\r\n        }\r\n      }, 1000);\r\n    });\r\n}\r\n\r\n// ================== OBTENER ID SOLICITUD DESDE URL ==================\r\nfunction getQS(name){\r\n  var m = new RegExp('[?&]'+name+'=([^&]*)').exec(location.search);\r\n  return m ? decodeURIComponent(m[1].replace(/\\+/g,' ')) : null;\r\n}\r\n\r\n// ================== ENVIAR UPDATE (API) ==================\r\nfunction sendUpdateAPI(){\r\n  if (window.__saving_edit) {\r\n    log('Update en curso, click ignorado');\r\n    return;\r\n  }\r\n  window.__saving_edit = true;\r\n\r\n  var idsol = parseInt(getQS('editid1') || 0, 10);\r\n  if (!idsol) {\r\n    window.__saving_edit = false;\r\n    swalError('No se pudo determinar el ID de la solicitud.');\r\n    return;\r\n  }\r\n\r\n  var datos = {\r\n    idsolicitud: idsol,\r\n\r\n    // originales para lógica en PHP\r\n    orig_idproducto: window.__origSolicitud ? window.__origSolicitud.idproducto : '',\r\n    orig_noserie:    window.__origSolicitud ? window.__origSolicitud.noserie    : '',\r\n\r\n    // nuevos valores del formulario\r\n    idproducto:    readVal('idproducto'),\r\n    idtipoventa:   readVal('idtipoventa'),\r\n    idplan:        readVal('idplan'),\r\n    idcliente:     readVal('idcliente'),\r\n    orden:         readVal('orden'),\r\n    plazo:         readVal('plazo'),\r\n    rfc:           readVal('rfc'),\r\n    idcli:         readVal('idcli'),\r\n    dn:            readVal('dn'),\r\n    cuenta:        readVal('cuenta'),\r\n    contrato:      readVal('contrato'),\r\n    contratoportal:readVal('contratoportal'),\r\n    plazopendiente:readVal('plazopendiente'),\r\n    dnpreferido:   readVal('dnpreferido'),\r\n    factura:       readVal('factura'),\r\n    fechavenci:    readVal('fechavenci'),\r\n        fechahoraentrega:    readVal('fechahoraentrega'),\r\n\r\n   ciclo:    readVal('ciclo'),\r\n\r\n    noserie:       readVal('noserie'),\r\n    simcard:       readVal('simcard'),\r\n    observaciones: readVal('observaciones'),\r\n    contratolog:   readVal('contratolog'),\r\n    anticipolog:   readVal('anticipolog'),\r\n    ine:           readVal('ine'),\r\n    cartaburocredito: readVal('cartaburocredito'),\r\n    polizaseguro:  readVal('polizaseguro'),\r\n    contratodocto: readVal('contratodocto'),\r\n    renta:         readVal('renta'),\r\n\r\n    estado:        readVal('estado'),\r\n    ciudad:        readVal('ciudad'),\r\n    cp:            readVal('cp'),\r\n    calle:         readVal('calle'),\r\n    numeroext:     readVal('numeroext'),\r\n    numeroint:     readVal('numeroint'),\r\n    colonia:       readVal('colonia'),\r\n    lat:           readVal('lat'),\r\n    lng:           readVal('lng'),\r\n    idtienda:      readVal('idtienda')\r\n  };\r\n\r\n  log('Payload UPDATE API:', datos);\r\n\r\n  $.post(window.API_UPDATE, datos, function(respRaw){\r\n    var r = (typeof respRaw === 'object')\r\n      ? respRaw\r\n      : (function(){ try { return JSON.parse(respRaw); } catch(e){ return null; } })();\r\n\r\n    log('Respuesta UPDATE API:', r || respRaw);\r\n\r\n    if (!r) {\r\n      window.__saving_edit = false;\r\n      swalError('Respuesta inválida del servidor.');\r\n      return;\r\n    }\r\n\r\n    if (r.ok) {\r\n      releasePrev();\r\n      // IMPORTANTE: liberamos el flag aquí, antes del flujo de archivos\r\n      window.__saving_edit = false;\r\n\r\n      swalOk(r.message || 'Solicitud actualizada correctamente.')\r\n        .then(function () {\r\n\r\n          // 1) Buscar botón Guardar nativo de PHPRunner\r\n          var $saveBtn = $(\r\n            \"[data-itemid='save'] a, \" +\r\n            \"[data-itemid='save'] button, \" +\r\n            \"[data-itemid='edit_save'] a, \" +\r\n            \"[data-itemid='edit_save'] button, \" +\r\n            \"a[id^='saveButton'], button[id^='saveButton']\"\r\n          ).first();\r\n\r\n          if ($saveBtn.length) {\r\n            console.log('[edit] Botón Guardar PHPRunner detectado =>', $saveBtn[0]);\r\n\r\n            // 2) Asegurar hidden files_only=1 cerca del page container\r\n            var pid = getPid();\r\n            var $container = $(\"[data-pageid='\"+pid+\"']\").first();\r\n            if (!$container.length) $container = $('body');\r\n\r\n            var $filesOnly = $container.find(\"input[name='files_only']\");\r\n            if (!$filesOnly.length) {\r\n              $filesOnly = $('<input/>', {\r\n                type: 'hidden',\r\n                name: 'files_only',\r\n                value: '1'\r\n              }).appendTo($container);\r\n            } else {\r\n              $filesOnly.val('1');\r\n            }\r\n\r\n            // 3) Disparar click nativo => PHPRunner manda el EDIT normal\r\n            console.log('[edit] Disparando click en botón Guardar nativo');\r\n            $saveBtn.trigger('click');\r\n          } else {\r\n            console.warn('[edit] No se encontró botón Guardar nativo; recargando página');\r\n            location.reload();\r\n          }\r\n        });\r\n\r\n    } else {\r\n      window.__saving_edit = false;\r\n      swalError(r.error || 'Error desconocido al actualizar.');\r\n    }\r\n  })\r\n  .fail(function(xhr){\r\n    log('Fallo AJAX UPDATE:', xhr.status, xhr.responseText);\r\n    window.__saving_edit = false;\r\n    swalError('Error de comunicación con el servidor.');\r\n  });\r\n}\r\n\r\n// ====================================================================\r\n// ================== SISTEMA DE PERMISOS POR ROL ==================\r\n// ====================================================================\r\n(function () {\r\n  const CONFIG = {\r\n    // TODOS los campos que se controlarán\r\n   /*   fields: ['estatus', 'estatusentrega', 'idproducto', 'idplan', 'idtipoventa', 'orden', 'plazo', 'rfc', 'idcli', \r\n             'dn', 'cuenta', 'contrato', 'contratoportal', 'plazopendiente', 'dnpreferido', 'factura', 'fechavenci',\r\n              'estado', 'ciudad', 'cp', 'calle', 'numeroext', 'numeroint', 'colonia', 'lat', 'lng', 'observaciones',\r\n             'idcliente', 'ciclo'],  */\r\n    \r\n    fields: ['estatus', 'estatusentrega', 'idproducto', 'idplan', 'idtipoventa', 'orden', 'plazo', 'rfc', 'idcli', \r\n             'dn', 'cuenta', 'contrato', 'contratoportal', 'plazopendiente', 'dnpreferido', 'factura', 'fechavenci','renta',\r\n             'idcliente', 'ciclo','contratolog', 'anticipolog','btnEstatusEntrega'],\r\n\r\n    // Mapeo de GroupID numéricos a nombres\r\n    roleAliases: { \r\n      '1': 'ADMIN', \r\n      '2': 'VALIDADOR',\r\n      '3': 'VENDEDORES',\r\n      '4': 'GERENTES',\r\n      '5': 'MESADECONTROL'\r\n    },\r\n\r\n    // Reglas de permisos (primera que coincida se aplica)\r\n    rules: [\r\n      // ADMIN puede editar todo siempre\r\n      { match: { user: ['ADMIN'] }, enable: ['*'], readonly: ['noserie'] },    \r\n      { match: { role: ['ADMIN'] }, enable: ['*'], readonly: ['noserie'] },\r\n      \r\n      // VALIDADOR: puede editar todo EXCEPTO estatusentrega y noserie\r\n      { match: { role: ['VALIDADOR'] }, \r\n        enable: ['*'], \r\n      /*  disable: ['estatusentrega','estatus'],*/\r\n        readonly: ['noserie','simcard','estatusentrega','estatus']\r\n      },\r\n      \r\n      // MESADECONTROL: si estatus es ACEPTADA, solo 'estatusentrega'\r\n      { match: { role: ['MESADECONTROL'], statusCondition: 'ACEPTADA' }, \r\n        enable: ['estatusentrega'],\r\n        readonly: ['noserie','simcard','estatusentrega','estatus']\r\n      },\r\n      \r\n      // MESADECONTROL: si NO es ACEPTADA, solo 'estatusentrega' también\r\n      { match: { role: ['MESADECONTROL'] }, \r\n        disable: ['*'],\r\n        readonly: ['noserie','simcard','estatusentrega','estatus']\r\n      },\r\n      \r\n  // VENDEDORES y GERENTES: si es ACEPTADA, bloquear todos\r\n  { match: { role: ['VENDEDORES','GERENTES'], statusCondition: 'ACEPTADA' }, \r\n    disable: ['*'],\r\n    readonly: ['noserie','simcard','estatus','estatusentrega']  // opcional, solo por estilo\r\n  },\r\n\r\n  // VENDEDORES y GERENTES: si NO es ACEPTADA, editar todo EXCEPTO estos campos\r\n  { match: { role: ['VENDEDORES','GERENTES'], statusCondition: '!ACEPTADA' }, \r\n    disable: ['noserie','simcard','estatus','estatusentrega']\r\n  },\r\n\r\n  { match: { default: true }, disable: ['*'] }\r\n]\r\n  };\r\n\r\n  const DEBUG = false; // Cambia a true para debugging\r\n  const plog = (...a)=>{ if (DEBUG) console.log('[permisos]', ...a); };\r\n  \r\n  // ⭐ Variable para suspender permisos temporalmente\r\n  window.__suspendPermissions = false;\r\n\r\n  // ========== OBTENER ROL Y USUARIO ==========\r\n  function getUserInfo() {\r\n    let role = '';\r\n    let user = '';\r\n    \r\n    plog('=== OBTENIENDO INFORMACIÓN VÍA PROXY ===');\r\n    \r\n    // Método correcto para PHPRunner usando proxy\r\n    if (typeof proxy !== 'undefined') {\r\n      role = (proxy.currentRole || '').toString().trim();\r\n      user = (proxy.currentUser || '').toString().trim();\r\n      plog('✓ Obtenido desde proxy.currentRole:', role);\r\n      plog('✓ Obtenido desde proxy.currentUser:', user);\r\n    } else {\r\n      plog('❌ Objeto proxy no disponible');\r\n    }\r\n    \r\n    // Fallback: desde window\r\n    if (!role && window.userRole) {\r\n      role = window.userRole.toString();\r\n      plog('✓ Fallback desde window.userRole:', role);\r\n    }\r\n    if (!user && window.userName) {\r\n      user = window.userName.toString();\r\n      plog('✓ Fallback desde window.userName:', user);\r\n    }\r\n    \r\n    plog('=== RESULTADO FINAL ===');\r\n    plog('Rol:', role || 'NO ENCONTRADO');\r\n    plog('Usuario:', user || 'NO ENCONTRADO');\r\n    \r\n    return { role, user };\r\n  }\r\n  \r\n  const userInfo = getUserInfo();\r\n  let ROLE = userInfo.role.trim();\r\n  let USER = userInfo.user.trim().toUpperCase();\r\n  \r\n  // Aplicar alias si existe\r\n  if (CONFIG.roleAliases[ROLE]) {\r\n    plog('Aplicando alias:', ROLE, '->', CONFIG.roleAliases[ROLE]);\r\n    ROLE = CONFIG.roleAliases[ROLE];\r\n  }\r\n  ROLE = ROLE.toUpperCase();\r\n  \r\n  plog('==========================================');\r\n  plog('ROL FINAL:', ROLE);\r\n  plog('USUARIO FINAL:', USER);\r\n  plog('==========================================');\r\n\r\n  // ---- OBTENER EL VALOR ACTUAL DEL ESTATUS ----\r\n  function getCurrentStatus() {\r\n    let currentStatus = '';\r\n    \r\n    plog('=== OBTENIENDO ESTATUS ===');\r\n    \r\n    // Método 1: Desde proxy (PREFERIDO si se pasó desde PHP)\r\n    if (typeof proxy !== 'undefined' && proxy.currentStatus) {\r\n      currentStatus = proxy.currentStatus.toString().trim().toUpperCase();\r\n      plog('✓ Estatus desde proxy:', currentStatus);\r\n      return currentStatus;\r\n    }\r\n    \r\n    // Método 2: Desde el DOM\r\n    const $estatusField = $('[id^=\"value_estatus_\"],[id^=\"display_value_estatus_\"]').first();\r\n    \r\n    if ($estatusField.length) {\r\n      if ($estatusField.is('select')) {\r\n        const selectedText = $estatusField.find('option:selected').text().trim();\r\n        const selectedVal = $estatusField.val();\r\n        currentStatus = (selectedText || selectedVal || '').toUpperCase();\r\n      } else {\r\n        currentStatus = ($estatusField.val() || '').trim().toUpperCase();\r\n      }\r\n      plog('Estatus desde DOM:', currentStatus);\r\n    }\r\n    \r\n    // Método 3: Desde readonly\r\n    if (!currentStatus) {\r\n      const $displayField = $('[id^=\"readonly_value_estatus_\"]').first();\r\n      if ($displayField.length) {\r\n        currentStatus = $displayField.text().trim().toUpperCase();\r\n        plog('Estatus desde readonly:', currentStatus);\r\n      }\r\n    }\r\n    \r\n    plog('>>> ESTATUS FINAL:', currentStatus || '⚠️ VACÍO');\r\n    return currentStatus;\r\n  }\r\n\r\n  // ---- Motor de reglas ----\r\n  function resolveRule() {\r\n    const currentStatus = getCurrentStatus();\r\n    plog('Resolviendo regla para ROL:', ROLE, '| ESTATUS:', currentStatus);\r\n    \r\n    for (let i = 0; i < CONFIG.rules.length; i++) {\r\n      const r = CONFIG.rules[i];\r\n      const m = r.match || {};\r\n      \r\n      if (m.default) {\r\n        plog('✓ Aplicando regla DEFAULT');\r\n        return r;\r\n      }\r\n      \r\n      const byRole = !m.role || m.role.map(x=>x.toString().toUpperCase()).includes(ROLE);\r\n      const byUser = !m.user || m.user.map(x=>x.toString().toUpperCase()).includes(USER);\r\n      \r\n      let byStatus = true;\r\n      if (m.statusCondition) {\r\n        if (m.statusCondition === 'ACEPTADA') {\r\n          byStatus = currentStatus === 'ACEPTADA';\r\n        } else if (m.statusCondition === '!ACEPTADA') {\r\n          byStatus = currentStatus !== 'ACEPTADA';\r\n        }\r\n      }\r\n      \r\n      plog(`Regla #${i}: byRole=${byRole}, byUser=${byUser}, byStatus=${byStatus}`);\r\n      \r\n      if (byRole && byUser && byStatus) {\r\n        plog('✓✓✓ REGLA APLICADA #' + i + ':', r);\r\n        return r;\r\n      }\r\n    }\r\n    \r\n    plog('Ninguna regla coincidió, aplicando fallback');\r\n    return { disable: ['*'] };\r\n  }\r\n  \r\n  function expand(list) {\r\n    if (!list) return [];\r\n    return list.includes('*') ? CONFIG.fields.slice() : list.slice();\r\n  }\r\n  \r\n  \r\n    function toggleBtnEstatusEntrega() {\r\n    const currentStatus = getCurrentStatus(); // reutilizamos tu función\r\n    // Ajusta el selector según cómo esté tu botón:\r\n    // - data-button-id=\"btnEstatusEntrega\" (custom button de PHPRunner)\r\n    // - o id=\"btnEstatusEntrega\"\r\n    const $btn = $('[data-button-id=\"btnEstatusEntrega\"], #btnEstatusEntrega');\r\n\r\n    if (!$btn.length) return;\r\n\r\n    // Regla de ejemplo:\r\n    // VENDEDORES y GERENTES: solo pueden usar el botón si estatus = ACEPTADA\r\n    let debeDesactivar = false;\r\n\r\n    if (['VENDEDORES', 'GERENTES'].includes(ROLE)) {\r\n      if (currentStatus !== 'ACEPTADA') {\r\n        debeDesactivar = true;\r\n      }\r\n    }\r\n\r\n    // Si quieres que otros roles también lo tengan bloqueado, puedes agregar más condiciones arriba\r\n\r\n    if (debeDesactivar) {\r\n      $btn\r\n        .addClass('ph-disabled disabled')\r\n        .prop('disabled', true)\r\n        .css('pointer-events', 'none')\r\n        .on('click._lockEntrega', function(e){\r\n          e.preventDefault();\r\n          e.stopImmediatePropagation();\r\n          return false;\r\n        });\r\n    } else {\r\n      $btn\r\n        .removeClass('ph-disabled disabled')\r\n        .prop('disabled', false)\r\n        .css('pointer-events', '')\r\n        .off('click._lockEntrega');\r\n    }\r\n  }\r\n\r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n\r\n   function applyRules() {\r\n    // ⭐ Si los permisos están suspendidos, no aplicar nada\r\n    if (window.__suspendPermissions) {\r\n      plog('⚠️ Permisos suspendidos temporalmente');\r\n      return;\r\n    }\r\n\r\n    // Tomamos SIEMPRE el estatus actual\r\n    const currentStatus = getCurrentStatus();\r\n    plog('>>> applyRules() – ROLE=', ROLE, 'STATUS=', currentStatus);\r\n\r\n    // Regla normal según la tabla\r\n    let rule = resolveRule();\r\n\r\n    // 🔒 OVERRIDE DURO:\r\n    // Si es VENDEDOR o GERENTE y el estatus es EXACTAMENTE \"ACEPTADA\"\r\n    // se bloquea TODO, aunque la regla normal haya fallado.\r\n    if ((ROLE === 'VENDEDORES' || ROLE === 'GERENTES') && currentStatus === 'ACEPTADA') {\r\n      plog('⚓ Override: VENDEDORES/GERENTES + ACEPTADA => todo bloqueado');\r\n      rule = {\r\n        enable:   [],          // nada editable\r\n        readonly: ['noserie'], // noserie se mantiene solo lectura\r\n        disable:  ['*']        // el resto a disabled\r\n      };\r\n    }\r\n\r\n    let enableList   = expand(rule.enable);\r\n    let readonlyList = expand(rule.readonly);\r\n    let disableList  = expand(rule.disable);\r\n\r\n    // ⭐ IMPORTANTE: noserie nunca debe quedar en \"enable\"\r\n    if (enableList.includes('noserie')) {\r\n      enableList = enableList.filter(f => f !== 'noserie');\r\n      if (!readonlyList.includes('noserie')) {\r\n        readonlyList.push('noserie');\r\n      }\r\n    }\r\n\r\n    if (disableList.length > 0 && !disableList.includes('*')) {\r\n      enableList   = enableList.filter(f => !disableList.includes(f));\r\n      readonlyList = readonlyList.filter(f => !disableList.includes(f));\r\n    }\r\n\r\n    if (disableList.includes('*') && enableList.length > 0 && !enableList.includes('*')) {\r\n      disableList = CONFIG.fields.filter(f => !enableList.includes(f) && !readonlyList.includes(f));\r\n    }\r\n\r\n    if (disableList.includes('*') && enableList.includes('*')) {\r\n      // Si enable es *, sólo deshabilitamos lo que NO está en readonly\r\n      disableList = [];\r\n    }\r\n\r\n    plog('Campos a HABILITAR:', enableList);\r\n    plog('Campos a READONLY:', readonlyList);\r\n    plog('Campos a DESHABILITAR:', disableList);\r\n\r\n    let enable   = new Set(enableList);\r\n    let readonly = new Set(readonlyList.filter(f=>!enable.has(f)));\r\n    let disable  = new Set(disableList.filter(f=>!enable.has(f) && !readonly.has(f)));\r\n\r\n    const ALL = [...new Set([...enable, ...readonly, ...disable])];\r\n\r\n    const qCtrl   = (f, scope)=>$(scope||document).find(\r\n      `[id^=\"value_${f}_\"],[id^=\"display_value_${f}_\"]`\r\n    );\r\n    const qLookup = (f, scope)=>$(scope||document).find(\r\n      `[id^=\"open_lookup_${f}_\"]`\r\n    );\r\n\r\n    function doEnable(f, scope){\r\n      const $els = qCtrl(f,scope).removeClass('ph-disabled');\r\n      $els.each(function(){\r\n        $(this).prop('disabled', false).prop('readonly', false);\r\n        const $s2 = $(this).next('.select2-container, .select2');\r\n        if ($s2.length) $s2.removeClass('ph-disabled').css('pointer-events','');\r\n      });\r\n      qLookup(f,scope).removeClass('ph-disabled').css('pointer-events','')\r\n        .attr('aria-disabled',null).off('click._lock');\r\n    }\r\n\r\n    function doReadonly(f, scope){\r\n      const $els = qCtrl(f,scope).addClass('ph-disabled');\r\n      $els.each(function(){\r\n        if (this.tagName === 'SELECT') $(this).prop('disabled', true);\r\n        else $(this).prop('readonly', true);\r\n        const $s2 = $(this).next('.select2-container, .select2');\r\n        if ($s2.length) $s2.addClass('ph-disabled').css('pointer-events','none');\r\n      });\r\n      qLookup(f,scope).addClass('ph-disabled').css('pointer-events','none')\r\n        .attr('aria-disabled','true').on('click._lock', e => {\r\n          e.preventDefault();\r\n          e.stopImmediatePropagation();\r\n          return false;\r\n        });\r\n    }\r\n\r\n    function doDisable(f, scope){\r\n      const $els = qCtrl(f,scope).addClass('ph-disabled');\r\n      $els.each(function(){\r\n        $(this).prop('disabled', true).prop('readonly', true);\r\n        const $s2 = $(this).next('.select2-container, .select2');\r\n        if ($s2.length) $s2.addClass('ph-disabled').css('pointer-events','none');\r\n      });\r\n      qLookup(f,scope).addClass('ph-disabled').css('pointer-events','none')\r\n        .attr('aria-disabled','true').on('click._lock', e => {\r\n          e.preventDefault();\r\n          e.stopImmediatePropagation();\r\n          return false;\r\n        });\r\n    }\r\n\r\n    function applyScope(scope){\r\n      enable.forEach(f  => doEnable(f,scope));\r\n      readonly.forEach(f=> doReadonly(f,scope));\r\n      disable.forEach(f => doDisable(f,scope));\r\n    }\r\n\r\n    // Aplica sobre todo el documento\r\n    applyScope(document);\r\n\r\n    // Guardias para bloquear interacciones a futuro\r\n    const selInputs = ALL.map(f=>`[id^=\"value_${f}_\"],[id^=\"display_value_${f}_\"]`).join(',');\r\n    if (selInputs) {\r\n      $(document).off('focusin.lock click.lock', selInputs);\r\n      $(document).on('focusin.lock click.lock', selInputs, function(){\r\n        if (window.__suspendPermissions) return;\r\n\r\n        const id = this.id||'';\r\n        const f = ALL.find(x => id.startsWith('value_'+x+'_') || id.startsWith('display_value_'+x+'_'));\r\n        if (!f) return;\r\n        if (disable.has(f))      doDisable(f, document);\r\n        else if (readonly.has(f))doReadonly(f, document);\r\n        else                     doEnable(f, document);\r\n      });\r\n    }\r\n\r\n    const selLookup = ALL.map(f=>`[id^=\"open_lookup_${f}_\"]`).join(',');\r\n    if (selLookup) {\r\n      $(document).off('click.lock', selLookup);\r\n      $(document).on('click.lock', selLookup, function(e){\r\n        if (window.__suspendPermissions) return true;\r\n\r\n        const id = this.id||'';\r\n        const f = ALL.find(x => id.startsWith('open_lookup_'+x+'_'));\r\n        if (!f) return;\r\n        if (disable.has(f) || readonly.has(f)) {\r\n          e.preventDefault();\r\n          e.stopImmediatePropagation();\r\n          (disable.has(f) ? doDisable : doReadonly)(f, document);\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n     toggleBtnEstatusEntrega();\r\n  }\r\n\r\n\r\n  // Espera activa a que existan los controles\r\n  function waitFor(list, timeout=2000, scope){\r\n    const t0 = performance.now();\r\n    return new Promise(resolve=>{\r\n      (function tick(){\r\n        const ok = list.every(f => $(scope||document).find(`[id^=\"value_${f}_\"],[id^=\"display_value_${f}_\"]`).length);\r\n        if (ok || performance.now()-t0 > timeout) resolve();\r\n        else requestAnimationFrame(tick);\r\n      })();\r\n    });\r\n  }\r\n\r\n  // Nueva función: esperar a que el campo tenga valor\r\n  function waitForFieldValue(fieldName, timeout = 5000) {\r\n    const t0 = performance.now();\r\n    return new Promise(resolve => {\r\n      (function check() {\r\n        const $field = $(`[id^=\"value_${fieldName}_\"],[id^=\"display_value_${fieldName}_\"]`).first();\r\n        let hasValue = false;\r\n        \r\n        if ($field.length) {\r\n          if ($field.is('select')) {\r\n            hasValue = $field.find('option:selected').val() !== '';\r\n          } else {\r\n            hasValue = ($field.val() || '').trim() !== '';\r\n          }\r\n        }\r\n        \r\n        // También verificar proxy\r\n        if (!hasValue && typeof proxy !== 'undefined' && proxy.currentStatus) {\r\n          hasValue = true;\r\n        }\r\n        \r\n        if (hasValue || performance.now() - t0 > timeout) {\r\n          plog('Campo \"' + fieldName + '\" ' + (hasValue ? 'tiene valor' : 'timeout'));\r\n          resolve(hasValue);\r\n        } else {\r\n          setTimeout(check, 50);\r\n        }\r\n      })();\r\n    });\r\n  }\r\n\r\n  // Aplicación inicial del sistema de permisos\r\n  (async function initPermisos(){\r\n    plog('>>> Esperando a que los campos estén listos...');\r\n    \r\n    await waitFor(['estatus'], 3000);\r\n    await waitForFieldValue('estatus', 5000);\r\n    \r\n    plog('>>> Campos listos, aplicando permisos...');\r\n    applyRules();\r\n    \r\n    // ⭐ Forzar que noserie sea siempre readonly al inicio\r\n    const pid = getPid();\r\n    const $noserie = $('#value_noserie_' + pid);\r\n    $noserie.prop('readonly', true).addClass('ph-disabled');\r\n    \r\n    // Reaplicar cuando cambia el estatus\r\n    $(document).on('change', '[id^=\"value_estatus_\"],[id^=\"display_value_estatus_\"]', function(){\r\n      plog('>>> Estatus cambió manualmente, reaplicando reglas...');\r\n      setTimeout(applyRules, 100);\r\n    });\r\n    \r\n    // Observer para cambios en el DOM\r\n    const grid = document.querySelector('.r-grid') || document.body;\r\n    new MutationObserver(async muts => {\r\n      for (const m of muts) {\r\n        if (m.addedNodes && m.addedNodes.length) {\r\n          await waitFor(['estatus'], 2000, grid);\r\n          applyRules();\r\n          break;\r\n        }\r\n      }\r\n    }).observe(grid, { childList: true, subtree: true });\r\n  })();\r\n})();\r\n\r\n\r\n// ====================================================================\r\n// ================== INIT PRINCIPAL ==================\r\n// ====================================================================\r\n$(function(){\r\n  var pid = getPid();\r\n  var ctrlProd = getCtrl('idproducto');\r\n\r\n  // valores originales\r\n  window.__origSolicitud = {\r\n    idsolicitud: parseInt(getQS('editid1') || 0, 10),\r\n    idproducto:  readVal('idproducto'),\r\n    noserie:     readVal('noserie')\r\n  };\r\n  log('ORIGINAL =>', window.__origSolicitud);\r\n  \r\n  // noserie siempre readonly\r\n  const $noserie = $('#value_noserie_' + pid);\r\n  $noserie.prop('readonly', true).addClass('ph-disabled');\r\n\r\n  // cambio de producto\r\n  if (ctrlProd) {\r\n    ctrlProd.on('change', function(){\r\n      var nuevo = ctrlProd.getValue();\r\n      log('==============================================');\r\n      log('CAMBIO DE PRODUCTO DETECTADO');\r\n      log('Producto anterior:', window.__origSolicitud ? window.__origSolicitud.idproducto : 'N/A');\r\n      log('Producto nuevo:', nuevo);\r\n      log('==============================================');\r\n\r\n      if (window.__origSolicitud && nuevo == window.__origSolicitud.idproducto) {\r\n        log('Volviendo al producto original');\r\n        window.__suspendPermissions = true;\r\n        \r\n        if (window.__origSolicitud.noserie) {\r\n          const $ns = $('#value_noserie_' + pid);\r\n          $ns.prop('readonly', false).val(window.__origSolicitud.noserie);\r\n          setVal('noserie', window.__origSolicitud.noserie, true);\r\n          log('Serie original restaurada:', window.__origSolicitud.noserie);\r\n          setTimeout(function(){\r\n            $ns.prop('readonly', true).addClass('ph-disabled');\r\n          }, 100);\r\n        }\r\n        releasePrev();\r\n        \r\n        setTimeout(function(){\r\n          window.__suspendPermissions = false;\r\n          if (typeof applyRules === 'function') applyRules();\r\n        }, 500);\r\n        return;\r\n      }\r\n\r\n      if (nuevo) {\r\n        log('Solicitando nueva serie para producto:', nuevo);\r\n        reserveForProductEdit(nuevo);\r\n      } else {\r\n        log('Producto vaciado, limpiando serie');\r\n        window.__suspendPermissions = true;\r\n        const $ns = $('#value_noserie_' + pid);\r\n        $ns.prop('readonly', false).val('');\r\n        setVal('noserie', '', true);\r\n        setTimeout(function(){\r\n          $ns.prop('readonly', true).addClass('ph-disabled');\r\n        }, 100);\r\n        releasePrev();\r\n        setTimeout(function(){\r\n          window.__suspendPermissions = false;\r\n          if (typeof applyRules === 'function') applyRules();\r\n        }, 500);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Botón Guardar VNP (edit)\r\n  var saveSelector =\r\n    \"[data-itemid='btnGuardarVNP'] a, \" +\r\n    \"[data-itemid='btnGuardarVNP'] button, \" +\r\n    \"#btnGuardarVNP\";\r\n\r\n  $(document).on('click', saveSelector, function(e){\r\n    e.preventDefault();\r\n    log('Click en botón Guardar VNP (edit)');\r\n    sendUpdateAPI();\r\n  });\r\n\r\n  // liberar reserva al salir\r\n  $(window).on('beforeunload pagehide', function(){\r\n    if (!window.__saving_edit) {\r\n      releasePrev();\r\n    }\r\n  });\r\n});\r\n\r\n// Observador para corregir lookups cuando se abren\r\nconst observer = new MutationObserver(() => {\r\n  document.querySelectorAll('.modal-content').forEach(modal => {\r\n    modal.style.fontSize = '14px';\r\n  });\r\n  document.querySelectorAll('.modal-body table, .modal-body table th, .modal-body table td')\r\n    .forEach(el => { el.style.fontSize = '14px'; });\r\n});\r\nobserver.observe(document.body, { childList: true, subtree: true });\r\n"
		},
		{
			"eventId": "EVENT_PROCESSVALUES_EDIT",
			"pageType": "edit",
			"code": "date_default_timezone_set('America/Mexico_City');\n$values[\"tienda\"]=$_SESSION[\"Tienda\"];\n$values['fechacaptura']=date('Y-m-d H:i:s');\n$values[\"almacenatt\"]=$_SESSION[\"Tienda\"];\n$values['ventadomicilio'] = 1;\n$values['equipoincluido']=1;\n$values['tiendamovil']=1;\n$values['clasif']=1\n\n"
		},
		{
			"eventId": "EVENT_JS_ONLOAD",
			"pageType": "list",
			"code": "// Place event code here.\r\n// Use \"Add Action\" button to add code snippets.\r\n\r\n// ================== CONFIG ==================\r\nwindow.API_UPDATE   = 'solicitud_update_api.php';\r\nwindow.ENDPOINT     = 'serial_reserve.php';\r\n\r\nwindow.__saving_edit   = false;\r\nwindow.__origSolicitud = null;\r\nwindow.__res_noserie   = null;\r\n\r\nfunction getPid() {\r\n  return $('[data-pageid]').first().attr('data-pageid') || '';\r\n}\r\nfunction getCtrl(f){\r\n  try { return Runner.getControl(getPid(), f); } catch(e){ return null; }\r\n}\r\nfunction readVal(f){\r\n  var c = getCtrl(f);\r\n  if (c && typeof c.getValue === 'function') return c.getValue();\r\n  var pid = getPid();\r\n  var $el = $('#value_'+f+'_'+pid);\r\n  return $el.length ? $el.val() : '';\r\n}\r\nfunction setVal(f,v,trig){\r\n  var c = getCtrl(f);\r\n  if (c && typeof c.setControlValue === 'function') {\r\n    c.setControlValue(v);\r\n    if (trig && typeof c.fireEvent === 'function') c.fireEvent('change');\r\n    return;\r\n  }\r\n  var pid = getPid();\r\n  var $el = $('#value_'+f+'_'+pid);\r\n  if ($el.length) {\r\n    $el.val(v);\r\n    if (trig) $el.trigger('change');\r\n  }\r\n}\r\nfunction log(){ if(window.console) console.log.apply(console, arguments); }\r\n\r\n// SweetAlert helpers\r\nfunction swalOk(msg){\r\n  return Swal.fire({\r\n    title: 'Éxito',\r\n    text: msg || 'Operación realizada correctamente.',\r\n    icon: 'success',\r\n    confirmButtonText: 'OK'\r\n  });\r\n}\r\nfunction swalError(msg){\r\n  return Swal.fire({\r\n    title: 'Error',\r\n    text: msg || 'Ocurrió un error al guardar la solicitud.',\r\n    icon: 'error',\r\n    confirmButtonText: 'OK'\r\n  });\r\n}\r\n\r\n// ================== RESERVA SOLO SI CAMBIA PRODUCTO ==================\r\nfunction releasePrev(){\r\n  if (!window.__res_noserie) return;\r\n  $.post(window.ENDPOINT, { action:'release', noserie: window.__res_noserie });\r\n  window.__res_noserie = null;\r\n}\r\n\r\nfunction reserveForProductEdit(productId){\r\n  if (!productId) return;\r\n  \r\n  log('=== INICIANDO CAMBIO DE PRODUCTO ===');\r\n  log('Nuevo producto ID:', productId);\r\n  \r\n  // suspender permisos temporalmente para poder tocar noserie\r\n  window.__suspendPermissions = true;\r\n  \r\n  releasePrev();\r\n  \r\n  const pid = getPid();\r\n  const $noserie = $('#value_noserie_' + pid);\r\n  $noserie.prop('readonly', false).val('');\r\n\r\n  $.post(window.ENDPOINT, { action:'reserve_by_product', product_id: productId })\r\n    .done(function(resp){\r\n      var r = (typeof resp === 'object') ? resp : (function(){ try {return JSON.parse(resp);}catch(e){return null;} })();\r\n      log('Respuesta reserva (edit):', r);\r\n      \r\n      if (r && r.ok && r.noserie) {\r\n        window.__res_noserie = r.noserie;\r\n        log('Nueva serie asignada:', r.noserie);\r\n        \r\n        $noserie.prop('readonly', false).prop('disabled', false);\r\n        $noserie.val(r.noserie);\r\n        setVal('noserie', r.noserie, true);\r\n        \r\n        setTimeout(function(){\r\n          const valorActual = readVal('noserie');\r\n          log('Verificación noserie:', valorActual);\r\n          if (valorActual !== r.noserie) {\r\n            log('⚠️ Reintentando setear noserie...');\r\n            $noserie.val(r.noserie).trigger('change');\r\n          }\r\n          $noserie.prop('readonly', true);\r\n        }, 100);\r\n        \r\n      } else if (r && r.error === 'no-stock') {\r\n        swalError('No hay series disponibles para el producto seleccionado.');\r\n        setVal('idproducto', '', true);\r\n      } else {\r\n        swalError('No se pudo reservar la serie.');\r\n        setVal('idproducto', '', true);\r\n      }\r\n    })\r\n    .fail(function(xhr, status, error){\r\n      log('Error AJAX reserva:', status, error);\r\n      swalError('Error de comunicación al reservar la serie.');\r\n      setVal('idproducto', '', true);\r\n    })\r\n    .always(function(){\r\n      setTimeout(function(){\r\n        log('=== RESTAURANDO PERMISOS ===');\r\n        window.__suspendPermissions = false;\r\n        const pid = getPid();\r\n        const $noserie = $('#value_noserie_' + pid);\r\n        $noserie.prop('readonly', true).addClass('ph-disabled');\r\n        if (typeof applyRules === 'function') applyRules();\r\n      }, 1000);\r\n    });\r\n}\r\n\r\n// ================== OBTENER ID SOLICITUD DESDE URL ==================\r\nfunction getQS(name){\r\n  var m = new RegExp('[?&]'+name+'=([^&]*)').exec(location.search);\r\n  return m ? decodeURIComponent(m[1].replace(/\\+/g,' ')) : null;\r\n}\r\n\r\n// ================== ENVIAR UPDATE (API + SUBMIT NATIVO PARA FILES) ==================\r\nfunction sendUpdateAPI(){\r\n  if (window.__saving_edit) {\r\n    log('Update en curso, click ignorado');\r\n    return;\r\n  }\r\n  window.__saving_edit = true;\r\n\r\n  var idsol = parseInt(getQS('editid1') || 0, 10);\r\n  if (!idsol) {\r\n    window.__saving_edit = false;\r\n    swalError('No se pudo determinar el ID de la solicitud.');\r\n    return;\r\n  }\r\n\r\n  var datos = {\r\n    idsolicitud: idsol,\r\n    // originales para la lógica en PHP\r\n    orig_idproducto: window.__origSolicitud ? window.__origSolicitud.idproducto : '',\r\n    orig_noserie:    window.__origSolicitud ? window.__origSolicitud.noserie    : '',\r\n    // nuevos valores\r\n    idproducto:    readVal('idproducto'),\r\n    idtipoventa:   readVal('idtipoventa'),\r\n    idplan:        readVal('idplan'),\r\n    idcliente:     readVal('idcliente'),\r\n    orden:         readVal('orden'),\r\n    plazo:         readVal('plazo'),\r\n    rfc:           readVal('rfc'),\r\n    idcli:         readVal('idcli'),\r\n    dn:            readVal('dn'),\r\n    cuenta:        readVal('cuenta'),\r\n    contrato:      readVal('contrato'),\r\n    contratoportal:readVal('contratoportal'),\r\n    plazopendiente:readVal('plazopendiente'),\r\n    dnpreferido:   readVal('dnpreferido'),\r\n    factura:       readVal('factura'),\r\n    fechavenci:    readVal('fechavenci'),\r\n    noserie:       readVal('noserie'),\r\n    simcard:       readVal('simcard'),\r\n    observaciones: readVal('observaciones'),\r\n    contratolog:   readVal('contratolog'),\r\n    anticipolog:   readVal('anticipolog'),\r\n    ine:             readVal('ine'),\r\n    cartaburocredito:readVal('cartaburocredito'),\r\n    polizaseguro:    readVal('polizaseguro'),\r\n    contratodocto:   readVal('contratodocto'),\r\n    renta:         readVal('renta'),\r\n    estado:        readVal('estado'),\r\n    ciudad:        readVal('ciudad'),\r\n    cp:            readVal('cp'),\r\n    calle:         readVal('calle'),\r\n    numeroext:     readVal('numeroext'),\r\n    numeroint:     readVal('numeroint'),\r\n    colonia:       readVal('colonia'),\r\n    lat:           readVal('lat'),\r\n    lng:           readVal('lng'),\r\n    idtienda:      readVal('idtienda')\r\n  };\r\n\r\n  log('Payload UPDATE API:', datos);\r\n\r\n  $.post(window.API_UPDATE, datos, function(respRaw){\r\n    var r = (typeof respRaw === 'object')\r\n      ? respRaw\r\n      : (function(){ try { return JSON.parse(respRaw); } catch(e){ return null; } })();\r\n\r\n    log('Respuesta UPDATE API:', r || respRaw);\r\n\r\n    if (!r) {\r\n      window.__saving_edit = false;\r\n      swalError('Respuesta inválida del servidor.');\r\n      return;\r\n    }\r\n\r\n    if (!r.ok) {\r\n      window.__saving_edit = false;\r\n      swalError(r.error || 'Error desconocido al actualizar.');\r\n      return;\r\n    }\r\n\r\n    // OK desde la API\r\n    releasePrev();\r\n    swalOk(r.message || 'Solicitud actualizada correctamente.').then(function () {\r\n      // ===== Opción B: usar submit nativo con botón oculto =====\r\n      var $form = $('form').first();  // en tu HTML sólo hay un form\r\n      if (!$form.length) {\r\n        console.error('[edit] No se encontró formulario para enviar');\r\n        window.__saving_edit = false;\r\n        // último recurso\r\n        location.reload();\r\n        return;\r\n      }\r\n\r\n      console.log('[edit] Formulario principal detectado =>', $form[0]);\r\n\r\n      // hidden flag para que BeforeEdit sepa que es \"sólo archivos\"\r\n      var $filesOnly = $form.find('input[name=\"files_only\"]');\r\n      if (!$filesOnly.length) {\r\n        $filesOnly = $('<input type=\"hidden\" name=\"files_only\" value=\"1\">').appendTo($form);\r\n      } else {\r\n        $filesOnly.val('1');\r\n      }\r\n\r\n      // crear (si no existe) un botón submit oculto\r\n      var $fake = $('#fake_phr_submit');\r\n      if (!$fake.length) {\r\n        $fake = $('<button type=\"submit\" id=\"fake_phr_submit\" style=\"display:none\"></button>');\r\n        $form.append($fake);\r\n      }\r\n\r\n      // liberar flag para que, si algo falla, puedas volver a intentar\r\n      window.__saving_edit = false;\r\n\r\n      // disparar el submit nativo → PHPRunner ejecuta BeforeEdit y procesa Files\r\n      console.log('[edit] Disparando submit nativo (botón oculto)');\r\n      $fake.trigger('click');\r\n    });\r\n  })\r\n  .fail(function(xhr){\r\n    log('Fallo AJAX UPDATE:', xhr.status, xhr.responseText);\r\n    window.__saving_edit = false;\r\n    swalError('Error de comunicación con el servidor.');\r\n  });\r\n}\r\n\r\n// ====================================================================\r\n// ================== SISTEMA DE PERMISOS POR ROL ==================\r\n// ====================================================================\r\n(function () {\r\n  const CONFIG = {\r\n    fields: ['estatus', 'estatusentrega', 'idproducto', 'idplan', 'idtipoventa', 'orden', 'plazo', 'rfc', 'idcli', \r\n             'dn', 'cuenta', 'contrato', 'contratoportal', 'plazopendiente', 'dnpreferido', 'factura', 'fechavenci','renta',\r\n       //     'estado', 'ciudad', 'cp', 'calle', 'numeroext', 'numeroint', 'colonia', 'lat', 'lng', 'observaciones',\r\n             'idcliente', 'ciclo','contratolog', 'anticipolog','btnEstatusEntrega'],\r\n    roleAliases: { \r\n      '1': 'ADMIN', \r\n      '2': 'VALIDADOR',\r\n      '3': 'VENDEDORES',\r\n      '4': 'GERENTES',\r\n      '5': 'MESADECONTROL'\r\n    },\r\n    rules: [\r\n      { match: { user: ['ADMIN'] }, enable: ['*'], readonly: ['noserie'] },    \r\n      { match: { role: ['ADMIN'] }, enable: ['*'], readonly: ['noserie'] },\r\n      { match: { role: ['VALIDADOR'] }, \r\n        enable: ['*'], \r\n        disable: ['estatus','estatusentrega'],\r\n        readonly: ['noserie','simcard']\r\n      },\r\n      { match: { role: ['MESADECONTROL'], statusCondition: 'ACEPTADA' }, \r\n    /*    enable: ['estatusentrega'],*/\r\n        readonly: ['noserie','simcard','estatus','estatusentrega']\r\n      },\r\n      { match: { role: ['MESADECONTROL'] }, \r\n        disable: ['*'],\r\n       readonly: ['noserie','simcard','estatus','estatusentrega']\r\n       },\r\n   // VENDEDORES y GERENTES: si es ACEPTADA, bloquear todos\r\n  { match: { role: ['VENDEDORES','GERENTES'], statusCondition: 'ACEPTADA' }, \r\n    disable: ['*'],\r\n    readonly: ['noserie','simcard','estatus','estatusentrega']  // opcional, solo por estilo\r\n  },\r\n\r\n  // VENDEDORES y GERENTES: si NO es ACEPTADA, editar todo EXCEPTO estos campos\r\n  { match: { role: ['VENDEDORES','GERENTES'], statusCondition: '!ACEPTADA' }, \r\n    disable: ['noserie','simcard','estatus','estatusentrega']\r\n  },\r\n\r\n  { match: { default: true }, disable: ['*'] }\r\n]\r\n  };\r\n      \r\n\r\n  const DEBUG = false;\r\n  const plog = (...a)=>{ if (DEBUG) console.log('[permisos]', ...a); };\r\n  window.__suspendPermissions = false;\r\n\r\n  function getUserInfo() {\r\n    let role = '';\r\n    let user = '';\r\n    \r\n    if (typeof proxy !== 'undefined') {\r\n      role = (proxy.currentRole || '').toString().trim();\r\n      user = (proxy.currentUser || '').toString().trim();\r\n    }\r\n    if (!role && window.userRole) role = window.userRole.toString();\r\n    if (!user && window.userName) user = window.userName.toString();\r\n    return { role, user };\r\n  }\r\n  \r\n  const userInfo = getUserInfo();\r\n  let ROLE = (userInfo.role || '').trim();\r\n  let USER = (userInfo.user || '').trim().toUpperCase();\r\n  if (CONFIG.roleAliases[ROLE]) ROLE = CONFIG.roleAliases[ROLE];\r\n  ROLE = ROLE.toUpperCase();\r\n\r\n  function getCurrentStatus() {\r\n    if (typeof proxy !== 'undefined' && proxy.currentStatus) {\r\n      return proxy.currentStatus.toString().trim().toUpperCase();\r\n    }\r\n    const $estatusField = $('[id^=\"value_estatus_\"],[id^=\"display_value_estatus_\"]').first();\r\n    if ($estatusField.length) {\r\n      if ($estatusField.is('select')) {\r\n        const t = $estatusField.find('option:selected').text().trim();\r\n        const v = $estatusField.val();\r\n        return (t || v || '').toUpperCase();\r\n      } else {\r\n        return ($estatusField.val() || '').trim().toUpperCase();\r\n      }\r\n    }\r\n    const $displayField = $('[id^=\"readonly_value_estatus_\"]').first();\r\n    if ($displayField.length) return $displayField.text().trim().toUpperCase();\r\n    return '';\r\n  }\r\n\r\n  function resolveRule() {\r\n    const currentStatus = getCurrentStatus();\r\n    for (let i = 0; i < CONFIG.rules.length; i++) {\r\n      const r = CONFIG.rules[i];\r\n      const m = r.match || {};\r\n      if (m.default) return r;\r\n      const byRole = !m.role || m.role.map(x=>x.toString().toUpperCase()).includes(ROLE);\r\n      const byUser = !m.user || m.user.map(x=>x.toString().toUpperCase()).includes(USER);\r\n      let byStatus = true;\r\n      if (m.statusCondition === 'ACEPTADA') byStatus = (currentStatus === 'ACEPTADA');\r\n      if (m.statusCondition === '!ACEPTADA') byStatus = (currentStatus !== 'ACEPTADA');\r\n      if (byRole && byUser && byStatus) return r;\r\n    }\r\n    return { disable: ['*'] };\r\n  }\r\n  \r\n  function expand(list) {\r\n    if (!list) return [];\r\n    return list.includes('*') ? CONFIG.fields.slice() : list.slice();\r\n  }\r\n\r\n  function toggleBtnEstatusEntrega() {\r\n    const currentStatus = getCurrentStatus(); // reutilizamos tu función\r\n    // Ajusta el selector según cómo esté tu botón:\r\n    // - data-button-id=\"btnEstatusEntrega\" (custom button de PHPRunner)\r\n    // - o id=\"btnEstatusEntrega\"\r\n    const $btn = $('[data-button-id=\"btnEstatusEntrega\"], #btnEstatusEntrega');\r\n\r\n    if (!$btn.length) return;\r\n\r\n    // Regla de ejemplo:\r\n    // VENDEDORES y GERENTES: solo pueden usar el botón si estatus = ACEPTADA\r\n    let debeDesactivar = false;\r\n\r\n    if (['VENDEDORES', 'GERENTES'].includes(ROLE)) {\r\n      if (currentStatus !== 'ACEPTADA') {\r\n        debeDesactivar = true;\r\n      }\r\n    }\r\n\r\n    // Si quieres que otros roles también lo tengan bloqueado, puedes agregar más condiciones arriba\r\n\r\n    if (debeDesactivar) {\r\n      $btn\r\n        .addClass('ph-disabled disabled')\r\n        .prop('disabled', true)\r\n        .css('pointer-events', 'none')\r\n        .on('click._lockEntrega', function(e){\r\n          e.preventDefault();\r\n          e.stopImmediatePropagation();\r\n          return false;\r\n        });\r\n    } else {\r\n      $btn\r\n        .removeClass('ph-disabled disabled')\r\n        .prop('disabled', false)\r\n        .css('pointer-events', '')\r\n        .off('click._lockEntrega');\r\n    }\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  function applyRules() {\r\n    if (window.__suspendPermissions) return;\r\n    const rule = resolveRule();\r\n    let enableList   = expand(rule.enable);\r\n    let readonlyList = expand(rule.readonly);\r\n    let disableList  = expand(rule.disable);\r\n    if (enableList.includes('noserie')) {\r\n      enableList = enableList.filter(f => f !== 'noserie');\r\n      if (!readonlyList.includes('noserie')) readonlyList.push('noserie');\r\n    }\r\n    if (disableList.length > 0 && !disableList.includes('*')) {\r\n      enableList   = enableList.filter(f => !disableList.includes(f));\r\n      readonlyList = readonlyList.filter(f => !disableList.includes(f));\r\n    }\r\n    if (disableList.includes('*') && enableList.length > 0 && !enableList.includes('*')) {\r\n      disableList = CONFIG.fields.filter(f => !enableList.includes(f) && !readonlyList.includes(f));\r\n    }\r\n    if (disableList.includes('*') && enableList.includes('*')) disableList = [];\r\n    let enable   = new Set(enableList);\r\n    let readonly = new Set(readonlyList.filter(f=>!enable.has(f)));\r\n    let disable  = new Set(disableList.filter(f=>!enable.has(f) && !readonly.has(f)));\r\n\r\n    const ALL = [...new Set([...enable, ...readonly, ...disable])];\r\n    const qCtrl   = (f, scope)=>$(scope||document).find(`[id^=\"value_${f}_\"],[id^=\"display_value_${f}_\"]`);\r\n    const qLookup = (f, scope)=>$(scope||document).find(`[id^=\"open_lookup_${f}_\"]`);\r\n\r\n    function doEnable(f, scope){\r\n      const $els = qCtrl(f,scope).removeClass('ph-disabled');\r\n      $els.each(function(){\r\n        $(this).prop('disabled', false).prop('readonly', false);\r\n        const $s2 = $(this).next('.select2-container, .select2');\r\n        if ($s2.length) $s2.removeClass('ph-disabled').css('pointer-events','');\r\n      });\r\n      qLookup(f,scope).removeClass('ph-disabled').css('pointer-events','').attr('aria-disabled',null).off('click._lock');\r\n    }\r\n    function doReadonly(f, scope){\r\n      const $els = qCtrl(f,scope).addClass('ph-disabled');\r\n      $els.each(function(){\r\n        if (this.tagName === 'SELECT') $(this).prop('disabled', true);\r\n        else $(this).prop('readonly', true);\r\n        const $s2 = $(this).next('.select2-container, .select2');\r\n        if ($s2.length) $s2.addClass('ph-disabled').css('pointer-events','none');\r\n      });\r\n      qLookup(f,scope).addClass('ph-disabled').css('pointer-events','none')\r\n        .attr('aria-disabled','true').on('click._lock', e => { e.preventDefault(); e.stopImmediatePropagation(); return false; });\r\n    }\r\n    function doDisable(f, scope){\r\n      const $els = qCtrl(f,scope).addClass('ph-disabled');\r\n      $els.each(function(){\r\n        $(this).prop('disabled', true).prop('readonly', true);\r\n        const $s2 = $(this).next('.select2-container, .select2');\r\n        if ($s2.length) $s2.addClass('ph-disabled').css('pointer-events','none');\r\n      });\r\n      qLookup(f,scope).addClass('ph-disabled').css('pointer-events','none')\r\n        .attr('aria-disabled','true').on('click._lock', e => { e.preventDefault(); e.stopImmediatePropagation(); return false; });\r\n    }\r\n\r\n    function applyScope(scope){\r\n      enable.forEach(f=>doEnable(f,scope));\r\n      readonly.forEach(f=>doReadonly(f,scope));\r\n      disable.forEach(f=>doDisable(f,scope));\r\n    }\r\n\r\n    applyScope(document);\r\n\r\n    const selInputs = ALL.map(f=>`[id^=\"value_${f}_\"],[id^=\"display_value_${f}_\"]`).join(',');\r\n    if (selInputs) {\r\n      $(document).off('focusin.lock click.lock', selInputs);\r\n      $(document).on('focusin.lock click.lock', selInputs, function(){\r\n        if (window.__suspendPermissions) return;\r\n        const id = this.id||'';\r\n        const f = ALL.find(x => id.startsWith('value_'+x+'_') || id.startsWith('display_value_'+x+'_'));\r\n        if (!f) return;\r\n        if (disable.has(f))      doDisable(f, document);\r\n        else if (readonly.has(f))doReadonly(f, document);\r\n        else                     doEnable(f, document);\r\n      });\r\n    }\r\n    const selLookup = ALL.map(f=>`[id^=\"open_lookup_${f}_\"]`).join(',');\r\n    if (selLookup) {\r\n      $(document).off('click.lock', selLookup);\r\n      $(document).on('click.lock', selLookup, function(e){\r\n        if (window.__suspendPermissions) return true;\r\n        const id = this.id||'';\r\n        const f = ALL.find(x => id.startsWith('open_lookup_'+x+'_'));\r\n        if (!f) return;\r\n        if (disable.has(f) || readonly.has(f)) {\r\n          e.preventDefault(); e.stopImmediatePropagation();\r\n          (disable.has(f) ? doDisable : doReadonly)(f, document);\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n        // ... ya aplicaste enable/readonly/disable a los campos ...\r\n\r\n    // Al final, aplicar también la lógica al botón de estatus de entrega\r\n    toggleBtnEstatusEntrega();\r\n\r\n  }\r\n\r\n  function waitFor(list, timeout=2000, scope){\r\n    const t0 = performance.now();\r\n    return new Promise(resolve=>{\r\n      (function tick(){\r\n        const ok = list.every(f => $(scope||document).find(`[id^=\"value_${f}_\"],[id^=\"display_value_${f}_\"]`).length);\r\n        if (ok || performance.now()-t0 > timeout) resolve();\r\n        else requestAnimationFrame(tick);\r\n      })();\r\n    });\r\n  }\r\n  async function initPermisos(){\r\n    await waitFor(['estatus'], 3000);\r\n    applyRules();\r\n    const pid = getPid();\r\n    $('#value_noserie_'+pid).prop('readonly', true).addClass('ph-disabled');\r\n    $(document).on('change', '[id^=\"value_estatus_\"],[id^=\"display_value_estatus_\"]', function(){\r\n      setTimeout(applyRules, 100);\r\n    });\r\n  }\r\n  initPermisos();\r\n})();\r\n\r\n// ====================================================================\r\n// ================== INIT PRINCIPAL ==================\r\n// ====================================================================\r\n$(function(){\r\n  var pid = getPid();\r\n  var ctrlProd = getCtrl('idproducto');\r\n\r\n  // valores originales\r\n  window.__origSolicitud = {\r\n    idsolicitud: parseInt(getQS('editid1') || 0, 10),\r\n    idproducto:  readVal('idproducto'),\r\n    noserie:     readVal('noserie')\r\n  };\r\n  log('ORIGINAL =>', window.__origSolicitud);\r\n  \r\n  $('#value_noserie_' + pid).prop('readonly', true).addClass('ph-disabled');\r\n\r\n  if (ctrlProd) {\r\n    ctrlProd.on('change', function(){\r\n      var nuevo = ctrlProd.getValue();\r\n      log('CAMBIO DE PRODUCTO:', window.__origSolicitud.idproducto, '=>', nuevo);\r\n\r\n      if (window.__origSolicitud && nuevo == window.__origSolicitud.idproducto) {\r\n        window.__suspendPermissions = true;\r\n        if (window.__origSolicitud.noserie) {\r\n          const $ns = $('#value_noserie_' + pid);\r\n          $ns.prop('readonly', false).val(window.__origSolicitud.noserie);\r\n          setVal('noserie', window.__origSolicitud.noserie, true);\r\n          setTimeout(function(){\r\n            $ns.prop('readonly', true).addClass('ph-disabled');\r\n          }, 100);\r\n        }\r\n        releasePrev();\r\n        setTimeout(function(){\r\n          window.__suspendPermissions = false;\r\n          if (typeof applyRules === 'function') applyRules();\r\n        }, 500);\r\n        return;\r\n      }\r\n\r\n      if (nuevo) {\r\n        reserveForProductEdit(nuevo);\r\n      } else {\r\n        window.__suspendPermissions = true;\r\n        const $ns = $('#value_noserie_' + pid);\r\n        $ns.prop('readonly', false).val('');\r\n        setVal('noserie', '', true);\r\n        setTimeout(function(){\r\n          $ns.prop('readonly', true).addClass('ph-disabled');\r\n        }, 100);\r\n        releasePrev();\r\n        setTimeout(function(){\r\n          window.__suspendPermissions = false;\r\n          if (typeof applyRules === 'function') applyRules();\r\n        }, 500);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Botón Guardar VNP (edit)\r\n  var saveSelector =\r\n    \"[data-itemid='btnGuardarVNP'] a, \" +\r\n    \"[data-itemid='btnGuardarVNP'] button, \" +\r\n    \"#btnGuardarVNP\";\r\n\r\n  $(document).on('click', saveSelector, function(e){\r\n    e.preventDefault();\r\n    log('Click en botón Guardar VNP (edit)');\r\n    sendUpdateAPI();\r\n  });\r\n\r\n  // NO bloquear el submit normal del form aquí\r\n\r\n  $(window).on('beforeunload pagehide', function(){\r\n    if (!window.__saving_edit) {\r\n      releasePrev();\r\n    }\r\n  });\r\n});\r\n\r\n// Ajuste de tamaños en lookups\r\nconst observer = new MutationObserver(() => {\r\n  document.querySelectorAll('.modal-content').forEach(modal => {\r\n    modal.style.fontSize = '14px';\r\n  });\r\n  document.querySelectorAll('.modal-body table, .modal-body table th, .modal-body table td').forEach(el => {\r\n    el.style.fontSize = '14px';\r\n  });\r\n});\r\nobserver.observe(document.body, { childList: true, subtree: true });\r\n\r\n\r\n\r\n// === Forzar que \"Editar\" abra /solicitudes_edit.php?page=edit1 ===\r\n(function () {\r\n  // 1) – Aplica solo a MESADECONTROL (borra este bloque si lo quieres para todos)\r\n  var role = \"\";\r\n  try { role = (proxy && proxy.currentRole ? String(proxy.currentRole) : \"\"); } catch(e){}\r\n  if (!role && window.userRole) role = String(window.userRole);\r\n  var onlyMDC = true;\r\n  if (onlyMDC && !/MESADECONTROL/i.test(role||\"\")) return;\r\n\r\n  // 2) – Normaliza una URL de edición a page=edit1\r\n  function toEdit1(url) {\r\n    if (!url) return url;\r\n\r\n    // aseguramos que apunte a *_edit.php (cualquier tabla)\r\n    if (!/_edit\\.php/i.test(url)) return url;\r\n\r\n    // separa base y query\r\n    var parts = url.split('#');\r\n    var hash = parts[1] ? '#' + parts.slice(1).join('#') : '';\r\n    var base_q = parts[0].split('?');\r\n    var base = base_q[0];\r\n    var qs   = base_q[1] || '';\r\n\r\n    // quita 'page=' existente\r\n    qs = qs\r\n      .split('&')\r\n      .filter(function (p) { return p && !/^page=/i.test(p); })\r\n      .join('&');\r\n\r\n    // agrega page=edit1\r\n    qs = (qs ? qs + '&' : '') + 'page=edit1';\r\n\r\n    return base + '?' + qs + hash;\r\n  }\r\n\r\n  // 3) – Parchea enlaces y handlers que usan *_edit.php\r\n  function patch(scope) {\r\n    var $scope = scope ? $(scope) : $(document);\r\n\r\n    // a) enlaces <a href=\"..._edit.php?...\">\r\n    $scope.find('a[href*=\"solicitudes_edit.php\"]').each(function(){\r\n      var a = this;\r\n      // si ya trae page=edit1 lo dejamos\r\n      if (/[\\?&]page=edit1(\\b|&|#)/i.test(a.href)) return;\r\n      a.href = toEdit1(a.href);\r\n\r\n      // blindaje por si algún onclick reescribe\r\n      $(a).off('click.toEdit1').on('click.toEdit1', function(e){\r\n        // deja pasar si ya apunta bien\r\n        if (/[\\?&]page=edit1(\\b|&|#)/i.test(a.href)) return;\r\n        e.preventDefault();\r\n        window.location.href = toEdit1(a.href);\r\n      });\r\n    });\r\n\r\n    // b) elementos con onclick que mencionan *_edit.php\r\n    $scope.find('[onclick*=\"solicitudes_edit.php\"]').each(function(){\r\n      var $el = $(this);\r\n      var s = String($el.attr('onclick') || '');\r\n      if (!/_edit\\.php/i.test(s)) return;\r\n\r\n      // neutraliza y reconstruye al vuelo\r\n      $el.attr('onclick', '');\r\n      $el.off('click.toEdit1').on('click.toEdit1', function(e){\r\n        e.preventDefault();\r\n\r\n        // intenta extraer la URL del onclick original\r\n        var m = s.match(/([A-Za-z0-9_\\/.-]+_edit\\.php\\?[^'\"]*)/i);\r\n        var url = m ? m[1] : null;\r\n\r\n        // fallback: usa la tabla actual\r\n        if (!url) {\r\n          var base = location.pathname.replace(/_list\\.php.*/i, '_edit.php');\r\n          // intenta capturar editid1 de la fila\r\n          var $tr = $el.closest('tr');\r\n          var key = ($tr.find('input[name^=\"editid1\"]').val() || '').trim();\r\n          url = base + (key ? ('?editid1=' + encodeURIComponent(key)) : '');\r\n        }\r\n\r\n        window.location.href = toEdit1(url);\r\n      });\r\n    });\r\n\r\n    // c) (opcional) doble-clic sobre la fila → abre edit1 si existe enlace\r\n  /*  $scope.find('tr').off('dblclick.toEdit1').on('dblclick.toEdit1', function(){\r\n      var $a = $(this).find('a[href*=\"_edit.php\"]').first();\r\n      if ($a.length) window.location.href = toEdit1($a[0].href);\r\n    });*/\r\n  }\r\n\r\n  // aplica ahora y cada vez que la grid se refresque por AJAX\r\n  patch(document);\r\n  new MutationObserver(function(muts){\r\n    for (var i=0;i<muts.length;i++){\r\n      if (muts[i].addedNodes && muts[i].addedNodes.length) { patch(document); break; }\r\n    }\r\n  }).observe(document.body, { childList:true, subtree:true });\r\n})();\r\n\r\n"
		},
		{
			"eventId": "EVENT_AFTEREDIT",
			"pageType": "edit",
			"code": "\n\n/*\n//**********  Insert a record into another table  ************\n// Helpers para armar valores seguros\nfunction q($v){ // cadenas/fechas: 'valor' o NULL\n    return (isset($v) && $v !== '' ? db_prepare_string($v) : \"NULL\");\n}\nfunction qi($v){ // enteros: número o NULL\n    return (isset($v) && $v !== '' ? (int)$v : \"NULL\");\n}\nfunction qb($v){ // booleano/bit: 0/1\n    return (!empty($v) ? 1 : 0);\n}\nfunction qd($v, $scale = 2) { // decimales: número (formateado) o NULL\n    if (!isset($v) || $v === '') return \"NULL\";\n    $n = (float)$v;\n    return number_format($n, $scale, '.', ''); // sin comillas\n}\n\n\n// =========================================================================\n// PREPARACIÓN DE VARIABLES (Asumidas de tus helpers q/qi)\n// =========================================================================\n $idtipoventa = qi($values['idtipoventa']);\n $fecha       = q($values['fecha']);\n $idcliente   = qi($values['idcliente']);\n $esnimei     = q($values['esnimei']);\n $simcard     = q($values['simcard']);\n $idsolicitud = qi($values['idsolicitud']); // Clave de búsqueda\n $estatus     = q($values['estatus']);\n $estatusentrega=qi($values['estatusentrega']);\n $dn          = q($values['dn']);\n $dnpreferido = q($values['dnpreferido']);\n $plan        = qi($values['plan']);\n $orden       = q($values['orden']);\n $factura     = q($values['factura']);\n $cuenta      = q($values['cuenta']);\n $contrato    = q($values['contrato']);\n $contratoportal    = q($values['contratoportal']);\n $renta       = qd($values['renta']);\n  $plazo       = qi($values['plazo']);\n$plazopendiente = qi($values['plazopendiente']);\n $ciclo       = qi($values['ciclo'] ?: 1 );\n $idcli       = q($values['idcli']);    \n// Necesitas la tienda actual, asumiré una variable local o de sesión\n$tienda = qi($values['idtienda'] ?? 2); // Ejemplo: usar tienda 2 o de sesión\n\n// =========================================================================\n// 1. VERIFICACIÓN PREVIA: Buscar si la Solicitud ya tiene una Venta asociada\n// =========================================================================\n\nif ($inline && $values['estatus'] === \"ACEPTADA\" && (int)$values['estatusentrega'] === 6){\n$sql_check = \"SELECT idsolicitud \n              FROM ventas \n              WHERE idsolicitud = \" . $idsolicitud;\n\n// Usamos DB::Query para ejecutar SELECT y fetchAssoc() para obtener la fila\n$row = DB::Query($sql_check)->fetchAssoc();\n\n// Variable para almacenar la acción realizada\n$accion_upsert = ''; \n\nif (!$row) {\n\n\n    // =====================================================================\n    // 3. INSERCIÓN (INSERT): La Solicitud NO existe en la tabla venta\n    // =====================================================================\n if (!($esnimei === '' || $esnimei === null)) {\n  \n \n   \n    $sql_insert = \"\n        INSERT INTO ventas \n            (idtipoventa, fecha, idcliente, esnimei, simcard, tienda, idsolicitud, dn, dnpreferido, plan, orden, factura, cuenta, contrato, contratoportal, renta, plazo, plazopendiente,\n            ciclo)\n        VALUES (\n            \" . $idtipoventa . \", \n            \" . $fecha . \", \n            \" . $idcliente . \", \n            \" . $esnimei . \", \n            \" . $simcard . \", \n            \" . $tienda . \", \n            \" . $idsolicitud . \",\n            \" . $dn . \",\n            \" . $dnpreferido . \",\n            \" . $plan . \",\n            \" . $orden . \",\n            \" . $factura. \",\n            \" . $cuenta. \",\n            \" . $contrato. \",\n            \" . $contratoportal . \",\n            \" . $renta . \",\n            \" . $plazo . \",\n            \" . $plazopendiente. \",\n            \" . $ciclo . \"\n        )\";\n    \n    if (DB::Exec($sql_insert, $conn)) {\n        if (!($esnimei === '' || $esnimei === null)) {\n             $sql_insert = \"\n        INSERT INTO ventas \n            (idtipoventa, fecha, idcliente, esnimei, simcard, tienda, idsolicitud, dn, dnpreferido, plan, orden, factura, cuenta, contrato, contratoportal, renta, plazo, plazopendiente,\n            ciclo)\n        VALUES (\n            \" . 0 . \", \n            \" . $fecha . \", \n            \" . $idcliente . \", \n            \" .$simcard . \", \n            \" . NULL . \", \n            \" . $tienda . \", \n            \" . $idsolicitud . \",\n            \" . $dn . \",\n            \" . $dnpreferido . \",\n            \" . $plan . \",\n            \" . $orden . \",\n            \" . $factura. \",\n            \" . $cuenta. \",\n            \" . $contrato. \",\n            \" . $contratoportal . \",\n            \" . $renta . \",\n            \" . $plazo . \",\n            \" . $plazopendiente. \",\n            \" . $ciclo . \"\n        )\";\n    \n            if (DB::Exec($sql_insert, $conn)) {\n                        $accion_upsert = 'INSERT SIM';\n                error_log(\"VENTA - INSERCIÓN EXITOSA para SIM Solicitud ID: \" . $idsolicitud, 3, \"debug_log.log\");\n            }\n        }\n        $accion_upsert = 'INSERT IMEI';\n        error_log(\"VENTA - INSERCIÓN EXITOSA para ESNIMEI Solicitud ID: \" . $idsolicitud, 3, \"debug_log.log\");\n    } else {\n        error_log(\"VENTA - ERROR AL INSERTAR. SQL: \" . $sql_insert . \" Error: \" . DB::LastError(), 3, \"debug_log.log\");\n        // Puedes agregar aquí una lógica de handle_fail si la inserción es crítica\n    }\n}\n}\n\n// =========================================================================\n// 4. RESULTADO\n// =========================================================================\nif (!empty($accion_upsert)) {\n    // La variable $accion_upsert contiene 'INSERT' o 'UPDATE'\n    // Puedes usarla para lógica posterior, como notificaciones o auditoría.\n    error_log(\"Acción final de VENTA: \" . $accion_upsert, 3, \"debug_log.log\");\n}\n}*/\n\n// =========================================================================\n    // 0. DEFINICIÓN DE HELPERS (Replicar esto en tu evento)\n    // =========================================================================\n// =========================================================================\n// 0. HELPERS\n// =========================================================================\nfunction q($v){ // cadenas/fechas: 'valor' o NULL\n    return (isset($v) && $v !== '' ? db_prepare_string($v) : \"NULL\");\n}\nfunction qi($v){ // enteros: número o NULL\n    return (isset($v) && $v !== '' ? (int)$v : \"NULL\");\n}\nfunction qd($v, $scale = 2) { // decimales: número (formateado) o NULL\n    if (!isset($v) || $v === '') return \"NULL\";\n    $n = (float)$v;\n    return number_format($n, $scale, '.', ''); // sin comillas, SQL lo maneja como número\n}\n\n// =========================================================================\n// 1. PREPARACIÓN DE VARIABLES\n// =========================================================================\n\n// OJO: aquí manejo dos variables para idsolicitud:\n//  - $idsolicitud_raw: entero para comparaciones / logs\n//  - $idsolicitud: para poner directo en SQL (numérico, sin comillas)\n$idsolicitud_raw = (int)$values['idsolicitud'];\n$idsolicitud     = $idsolicitud_raw;\n$ahora = q(date('Y-m-d h:i:sa'));\n$esnimei   = q($values['noserie']);   // IMEI equipo (o NULL)\n$simcard   = q($values['simcard']);   // serie SIM (o NULL)\n\n$idtipoventa     = qi($values['idtipoventa']);\n$fecha           = q($values['fecha']);\n$idcliente       = qi($values['idcliente']);\n$estatus         = q($values['estatus']);\n$estatusentrega  = (int)$values['estatusentrega'];\n$dn              = q($values['dn']);\n$dnpreferido     = q($values['dnpreferido']);\n$plan            = qi($values['plan']);\n$orden           = q($values['orden']);\n$factura         = q($values['factura']);\n$cuenta          = q($values['cuenta']);\n$contrato        = q($values['contrato']);\n$contratoportal  = q($values['contratoportal']);\n$renta           = qd($values['renta']);\n$plazo           = qi($values['plazo']);\n$plazopendiente  = qi($values['plazopendiente']);\n$ciclo           = qi($values['ciclo'] ?: 1);\n$usuario         = q($values['usuario']);\n// tienda: si no viene en values, tomamos la de sesión\n$tienda = isset($values['idtienda']) ? qi($values['idtienda']) : qi($_SESSION['tiendaNP']);\n\n$accion_upsert = '';\n\n// Ayudas booleanas\n$has_esnimei = ($esnimei !== 'NULL');\n$has_sim     = ($simcard !== 'NULL');\n\n// =========================================================================\n// 2. CONDICIÓN DE EJECUCIÓN: SOLO si es VENTA\n// =========================================================================\n// estatus debe ser 'ACEPTADA' y estatusentrega = 6\nif ($estatus === \"'ACEPTADA'\" && $estatusentrega === \"'CERRADO'\") {\n\n    // =========================================================================\n    // 3. LEER VENTAS EXISTENTES DE ESA SOLICITUD (equipo y chip)\n    // =========================================================================\n\n    $sql_ventas = \"\n        SELECT \n            v.idventa,\n            v.esnimei,\n            v.simcard,\n            p.clasif\n        FROM ventas v\n        LEFT JOIN compras c \n               ON v.esnimei = c.noserie\n        LEFT JOIN productos p\n               ON c.codigoproducto = p.codigoiusa\n        WHERE v.idsolicitud = \" . $idsolicitud . \"\n    \";\n\n    $rsVentas = DB::Query($sql_ventas);\n    if ($rsVentas === false || $rsVentas === null) {\n        error_log(\"VENTA - ERROR AL LEER VENTAS EXISTENTES. Solicitud: {$idsolicitud_raw}. Error: \" . DB::LastError() . \"\\n\", 3, \"debug_log.log\");\n        return true; // no bloqueamos el guardado de la solicitud\n    }\n\n    $idVentaEquipo = 0;\n    $idVentaChip   = 0;\n\n    while ($rowV = $rsVentas->fetchAssoc()) {\n        $clasif = $rowV[\"clasif\"];\n        $idv    = (int)$rowV[\"idventa\"];\n\n        if ($clasif === 'Equipo') {\n            $idVentaEquipo = $idv;\n        } elseif ($clasif === 'Chip') {\n            $idVentaChip = $idv;\n        }\n    }\n\n    // =========================================================================\n    // 4. UPSERT VENTA DEL EQUIPO\n    //    - esnimei (IMEI del equipo) va en ventas.esnimei\n    //    - simcard (serie chip) va en ventas.simcard\n    // =========================================================================\n      //                     error_log(\"antes de checar si hay imei: {$idsolicitud_raw}, idventa={$idVentaEquipo}\\n\", 3, \"debug_log.log\");\n\n    if ($has_esnimei) {\n        //                   error_log(\"despues de checar si hay ime: {$idsolicitud_raw}, idventa={$idVentaEquipo}\\n\", 3, \"debug_log.log\");\n\n        if ($idVentaEquipo > 0) {\n            // Ya había venta de equipo → UPDATE\n           //                 error_log(\"Ya habia venta de equipo: {$idsolicitud_raw}, idventa={$idVentaEquipo}\\n\", 3, \"debug_log.log\");\n\n            $sql_upd_imei = \"\n                UPDATE ventas\n                   SET idtipoventa    = \" . $idtipoventa . \",\n                       fecha          = \" . $fecha . \",\n                       idcliente      = \" . $idcliente . \",\n                       esnimei        = \" . $esnimei . \",\n                       simcard        = \" . $simcard . \",\n                       tienda         = \" . $tienda . \",\n                       dn             = \" . $dn . \",\n                       dnpreferido    = \" . $dnpreferido . \",\n                       plan           = \" . $plan . \",\n                       orden          = \" . $orden . \",\n                       factura        = \" . $factura . \",\n                       cuenta         = \" . $cuenta . \",\n                       contrato       = \" . $contrato . \",\n                       contratoportal = \" . $contratoportal . \",\n                       renta          = \" . $renta . \",\n                       plazo          = \" . $plazo . \",\n                       plazopendiente = \" . $plazopendiente . \",\n                       ciclo          = \" . $ciclo . \"\n                 WHERE idventa        = \" . $idVentaEquipo;\n\n            if (DB::Exec($sql_upd_imei)) {\n                $accion_upsert .= \"UPDATE IMEI; \";\n                 $sql_delete_imei_solicitado = \"DELETE FROM seriessolicitadas WHERE esnimei = \".$esnimei.\";\";\n                 DB::Exec($sql_delete_imei_solicitado);\n\n              //  error_log(\"VENTA - UPDATE EQUIPO OK. Solicitud: {$idsolicitud_raw}, idventa={$idVentaEquipo}\\n\", 3, \"debug_log.log\");\n            } else {\n               // error_log(\"VENTA - ERROR UPDATE EQUIPO. SQL: {$sql_upd_imei} Error: \" . DB::LastError() . \"\\n\", 3, \"debug_log.log\");\n                // no hacemos return; decisión tuya si quieres bloquear\n            }\n\n        } else {\n            // No había venta de equipo → INSERT\n              //             error_log(\"No habia venta de equipo: {$idsolicitud_raw}, idventa={$idVentaEquipo}\\n\", 3, \"debug_log.log\");\n            \n            $sql_insert_imei = \"\n                INSERT INTO ventas (\n                    idtipoventa, fecha, fechacaptura, idcliente,\n                    esnimei, simcard,\n                    tienda, idsolicitud,\n                    dn, dnpreferido, plan,\n                    orden, factura, cuenta, contrato, contratoportal,\n                    renta, plazo, plazopendiente, ciclo,usuario\n                ) VALUES (\n                    \" . $idtipoventa . \",\n                    \" . $fecha . \",\n                    \" . $ahora . \",\n                    \" . $idcliente . \",\n                    \" . $esnimei . \",\n                    \" . $simcard . \",\n                    \" . $tienda . \",\n                    \" . $idsolicitud . \",\n                    \" . $dn . \",\n                    \" . $dnpreferido . \",\n                    \" . $plan . \",\n                    \" . $orden . \",\n                    \" . $factura . \",\n                    \" . $cuenta . \",\n                    \" . $contrato . \",\n                    \" . $contratoportal . \",\n                    \" . $renta . \",\n                    \" . $plazo . \",\n                    \" . $plazopendiente . \",\n                    \" . $ciclo . \",\n                     \" . $usuario . \"\n               )\n            \";\n\n            if (DB::Exec($sql_insert_imei)) {\n                $accion_upsert .= \"INSERT IMEI; \";\n              //  error_log(\"VENTA - INSERT EQUIPO OK. Solicitud: {$idsolicitud_raw}\\n\", 3, \"debug_log.log\");\n              \n              $sql_delete_imei_solicitado = \"DELETE FROM seriessolicitadas WHERE esnimei = \".$esnimei.\";\";\n                 DB::Exec($sql_delete_imei_solicitado);\n            } else {\n              //  error_log(\"VENTA - ERROR INSERT EQUIPO. SQL: {$sql_insert_imei} Error: \" . DB::LastError() . \"\\n\", 3, \"debug_log.log\");\n                // decisión si bloqueas o no\n            }\n        }\n    }\n\n    // =========================================================================\n    // 5. UPSERT VENTA DEL CHIP\n    //    Reglas que me diste:\n    //    - Fila de CHIP: su serie se guarda en ventas.esnimei\n    //                   y ventas.simcard permanece NULL\n    // =========================================================================\n\n    if ($has_sim) {\n\n        if ($idVentaChip > 0) {\n            // Ya había venta de chip → UPDATE\n            $sql_upd_chip = \"\n                UPDATE ventas\n                   SET idtipoventa    = \" . $idtipoventa . \",\n                       fecha          = \" . $fecha . \",\n                       idcliente      = \" . $idcliente . \",\n                       esnimei        = \" . $simcard . \",   -- serie del chip\n                       simcard        = NULL,\n                       tienda         = \" . $tienda . \",\n                       dn             = \" . $dn . \",\n                       dnpreferido    = \" . $dnpreferido . \",\n                       plan           = \" . $plan . \",\n                       orden          = \" . $orden . \",\n                       factura        = \" . $factura . \",\n                       cuenta         = \" . $cuenta . \",\n                       contrato       = \" . $contrato . \",\n                       contratoportal = \" . $contratoportal . \",\n                       renta          = \" . $renta . \",\n                       plazo          = \" . $plazo . \",\n                       plazopendiente = \" . $plazopendiente . \",\n                       ciclo          = \" . $ciclo . \"\n                 WHERE idventa        = \" . $idVentaChip;\n\n            if (DB::Exec($sql_upd_chip)) {\n                $accion_upsert .= \"UPDATE SIM; \";\n              //  error_log(\"VENTA - UPDATE CHIP OK. Solicitud: {$idsolicitud_raw}, idventa={$idVentaChip}\\n\", 3, \"debug_log.log\");\n                $sql_delete_chip_solicitado = \"DELETE FROM seriessolicitadas WHERE esnimei = \".$simcard.\";\";\n                 DB::Exec($sql_delete_chip_solicitado);\n\n            } else {\n              //  error_log(\"VENTA - ERROR UPDATE CHIP. SQL: {$sql_upd_chip} Error: \" . DB::LastError() . \"\\n\", 3, \"debug_log.log\");\n            }\n\n        } else {\n            // No había venta de chip → INSERT\n            $sql_insert_sim = \"\n                INSERT INTO ventas (\n                    idtipoventa, fecha, fechacaptura, idcliente,\n                    esnimei, simcard,\n                    tienda, idsolicitud,\n                    dn, dnpreferido, plan,\n                    orden, factura, cuenta, contrato, contratoportal,\n                    renta, plazo, plazopendiente, usuario, ciclo\n                ) VALUES (\n                    \" . $idtipoventa . \",\n                    \" . $fecha . \",\n                    \" . $ahora . \",\n                    \" . $idcliente . \",\n                    \" . $simcard . \",   -- serie del chip\n                    NULL,               -- simcard vacío\n                    \" . $tienda . \",\n                    \" . $idsolicitud . \",\n                    \" . $dn . \",\n                    \" . $dnpreferido . \",\n                    \" . $plan . \",\n                    \" . $orden . \",\n                    \" . $factura . \",\n                    \" . $cuenta . \",\n                    \" . $contrato . \",\n                    \" . $contratoportal . \",\n                    \" . $renta . \",\n                    \" . $plazo . \",\n                    \" . $plazopendiente . \",\n                    \" . $usuario . \",\n                    \" . $ciclo . \"\n                )\n            \";\n\n            if (DB::Exec($sql_insert_sim)) {\n                $accion_upsert .= \"INSERT SIM; \";\n              //  error_log(\"VENTA - INSERT CHIP OK. Solicitud: {$idsolicitud_raw}\\n\", 3, \"debug_log.log\");\n                 $sql_delete_chip_solicitado = \"DELETE FROM seriessolicitadas WHERE esnimei = \".$simcard.\";\";\n                 DB::Exec($sql_delete_chip_solicitado);\n\n            } else {\n               //error_log(\"VENTA - ERROR INSERT CHIP. SQL: {$sql_insert_sim} Error: \" . DB::LastError() . \"\\n\", 3, \"debug_log.log\");\n            }\n        }\n    }\n\n} // fin if estatus/estatusentrega\n\n// =========================================================================\n// 6. LOG FINAL\n// =========================================================================\nif (!empty($accion_upsert)) {\n   // error_log(\"VENTA - Acciones: \" . $accion_upsert . \" Solicitud: {$idsolicitud_raw}\\n\", 3, \"debug_log.log\");\n}\n\nreturn true;\n"
		},
		{
			"eventId": "EVENT_BEFOREPROCESS_ADD",
			"pageType": "add",
			"code": "// Limpieza forzada del formulario cuando viene clean=1\nif ( postvalue(\"clean\") == 1 ) {\n\n    // Nombre de la tabla (use el literal si prefieres)\n    $t = \"solicitudes\";\n\n    // Valores cacheados por PHPRunner para Add/Edit\n    unset($_SESSION[$t . \"_add_values\"]);\n    unset($_SESSION[$t . \"_edit_values\"]);\n\n    // Claves/estructuras auxiliares que pueden mantener estado\n    unset($_SESSION[$t . \"_details\"]);\n    unset($_SESSION[$t . \"_masterkeys\"]);\n    unset($_SESSION[$t . \"_masterkey1\"]);\n    unset($_SESSION[$t . \"_masterkey2\"]);\n    unset($_SESSION[$t . \"_masterkey3\"]);\n\n   /* if ( postvalue(\"ajax_clean\") == 1 ) {\n        header(\"HTTP/1.1 204 No Content\");\n        exit();\n    }*/\n}\n\n\n"
		},
		{
			"eventId": "EVENT_PROCESSVALUES_ADD",
			"pageType": "add",
			"code": "// Place event code here.\n// Use \"Add Action\" button to add code snippets.\n\n$values['idtienda']=$_SESSION['Tienda'];"
		}
	],
	"dbTableInfo": {
		"type": 0,
		"foreignKeys": [],
		"fields": [
			{
				"name": "idsolicitud",
				"type": 20,
				"size": 20,
				"scale": 0,
				"typeName": "bigint(20)",
				"nullable": false,
				"autoinc": true,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idtipoventa",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": false,
				"autoinc": false,
				"defaultValueSQL": "0",
				"defaultValue": "0"
			},
			{
				"name": "fecha",
				"type": 7,
				"size": 0,
				"scale": 0,
				"typeName": "date",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "fechacaptura",
				"type": 135,
				"size": 0,
				"scale": 0,
				"typeName": "datetime",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": "current_timestamp()",
				"defaultValue": "CURRENT_TIMESTAMP"
			},
			{
				"name": "idcliente",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idproducto",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idplan",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "usuario",
				"type": 200,
				"size": 20,
				"scale": 0,
				"typeName": "varchar(20)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idtienda",
				"type": 3,
				"size": 3,
				"scale": 0,
				"typeName": "int(3)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "fechamodif",
				"type": 135,
				"size": 0,
				"scale": 0,
				"typeName": "datetime",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": "current_timestamp()",
				"defaultValue": "CURRENT_TIMESTAMP"
			},
			{
				"name": "orden",
				"type": 200,
				"size": 11,
				"scale": 0,
				"typeName": "varchar(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "solicitudimg",
				"type": 201,
				"size": 0,
				"scale": 0,
				"typeName": "mediumtext",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "estatus",
				"type": 200,
				"size": 20,
				"scale": 0,
				"typeName": "varchar(20)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idsolrazon",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "importeatt",
				"type": 5,
				"size": 0,
				"scale": 0,
				"typeName": "float",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "importesms",
				"type": 5,
				"size": 0,
				"scale": 0,
				"typeName": "float",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "plazo",
				"type": 2,
				"size": 6,
				"scale": 0,
				"typeName": "smallint(6)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "observaciones",
				"type": 200,
				"size": 200,
				"scale": 0,
				"typeName": "varchar(200)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "equipoincluido",
				"type": 16,
				"size": 1,
				"scale": 0,
				"typeName": "tinyint(1)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "rfc",
				"type": 200,
				"size": 20,
				"scale": 0,
				"typeName": "varchar(20)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idtratamiento",
				"type": 3,
				"size": 2,
				"scale": 0,
				"typeName": "int(2)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "riesgo",
				"type": 200,
				"size": 1,
				"scale": 0,
				"typeName": "char(1)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "observacionest",
				"type": 200,
				"size": 200,
				"scale": 0,
				"typeName": "varchar(200)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idcli",
				"type": 200,
				"size": 9,
				"scale": 0,
				"typeName": "varchar(9)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "fecha1avta",
				"type": 7,
				"size": 0,
				"scale": 0,
				"typeName": "date",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idplan1avta",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "dn1avta",
				"type": 200,
				"size": 10,
				"scale": 0,
				"typeName": "varchar(10)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idproceso",
				"type": 16,
				"size": 2,
				"scale": 0,
				"typeName": "tinyint(2)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idorigenventa",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "estatusentrega",
				"type": 200,
				"size": 45,
				"scale": 0,
				"typeName": "varchar(45)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "dn",
				"type": 200,
				"size": 10,
				"scale": 0,
				"typeName": "varchar(10)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "cuenta",
				"type": 200,
				"size": 50,
				"scale": 0,
				"typeName": "varchar(50)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "contrato",
				"type": 200,
				"size": 11,
				"scale": 0,
				"typeName": "varchar(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "contratoportal",
				"type": 200,
				"size": 11,
				"scale": 0,
				"typeName": "varchar(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "plan",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "renta",
				"type": 14,
				"size": 10,
				"scale": 2,
				"typeName": "decimal(10,2)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "plazopendiente",
				"type": 2,
				"size": 6,
				"scale": 0,
				"typeName": "smallint(6)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "dnpreferido",
				"type": 200,
				"size": 10,
				"scale": 0,
				"typeName": "varchar(10)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "Factura",
				"type": 200,
				"size": 10,
				"scale": 0,
				"typeName": "varchar(10)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "fechavenci",
				"type": 7,
				"size": 0,
				"scale": 0,
				"typeName": "date",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "ciclo",
				"type": 3,
				"size": 2,
				"scale": 0,
				"typeName": "int(2)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idcita",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "esnimei",
				"type": 200,
				"size": 30,
				"scale": 0,
				"typeName": "varchar(30)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "simcard",
				"type": 200,
				"size": 30,
				"scale": 0,
				"typeName": "varchar(30)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "contratolog",
				"type": 16,
				"size": 4,
				"scale": 0,
				"typeName": "tinyint(4)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "anticipolog",
				"type": 16,
				"size": 4,
				"scale": 0,
				"typeName": "tinyint(4)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "ine",
				"type": 201,
				"size": 0,
				"scale": 0,
				"typeName": "mediumtext",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "cartaburocredito",
				"type": 201,
				"size": 0,
				"scale": 0,
				"typeName": "mediumtext",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "polizaseguro",
				"type": 201,
				"size": 0,
				"scale": 0,
				"typeName": "mediumtext",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "contratodocto",
				"type": 201,
				"size": 0,
				"scale": 0,
				"typeName": "mediumtext",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "fechahoraentrega",
				"type": 135,
				"size": 0,
				"scale": 0,
				"typeName": "datetime",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "totalapagar",
				"type": 14,
				"size": 10,
				"scale": 2,
				"typeName": "decimal(10,2)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			}
		],
		"primaryKeys": [
			"idsolicitud"
		],
		"uniqueFields": [],
		"name": "solicitudes"
	},
	"pages": [
		{
			"id": "add",
			"type": "add",
			"layoutId": "nomenu",
			"disabled": false,
			"default": 1,
			"forms": {
				"above-grid": {
					"modelId": "add-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"add_message"
							]
						},
						"c2": {
							"model": "c2",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "add-below-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"text1",
								"add_save",
								"add_reset",
								"add_back_list",
								"add_cancel"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "add-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"image",
								"add_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-edit",
					"grid": [
						{
							"cells": [
								{
									"cell": "c4",
									"colspan": 1
								}
							],
							"section": ""
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c9",
									"rowspan": 1
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c",
									"colspan": 1
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c1",
									"colspan": 1
								}
							]
						},
						{
							"cells": [
								{
									"cell": "c8",
									"colspan": 1
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c3"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c4": {
							"model": "c3",
							"items": [
								"sec_cliente"
							],
							"align": "center"
						},
						"c": {
							"model": "c3",
							"items": [
								"sec_venta"
							],
							"align": "center"
						},
						"c1": {
							"model": "c3",
							"items": [],
							"background": "transparent",
							"customCSS": "/* Put  your custom CSS code here */\n\n        body {\n            box-sizing: border-box;\n        }",
							"height": "3em"
						},
						"c8": {
							"model": "c3",
							"items": [
								"section2"
							],
							"align": "center"
						},
						"c9": {
							"model": "c3",
							"items": []
						},
						"c3": {
							"model": "c3",
							"items": []
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section": {
					"modelId": "simple-edit",
					"grid": [
						{
							"section": "",
							"cells": [
								{
									"cell": "c3"
								},
								{
									"cell": "c4"
								}
							]
						},
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"integrated_edit_field4",
								"integrated_edit_field1"
							]
						},
						"c": {
							"model": "c1",
							"items": [
								"integrated_edit_field5",
								"integrated_edit_field6"
							]
						},
						"c3": {
							"model": "c1",
							"items": [
								"integrated_edit_field3"
							]
						},
						"c4": {
							"model": "c1",
							"items": [
								"integrated_edit_field9"
							]
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section1": {
					"modelId": "simple-edit",
					"grid": [
						{
							"section": "",
							"cells": [
								{
									"cell": "c2",
									"colspan": 2
								},
								{
									"cell": "c10"
								},
								{
									"cell": "c"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c4",
									"colspan": 2
								},
								{
									"cell": "c11"
								},
								{
									"cell": "c3"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c9",
									"colspan": 1
								},
								{
									"cell": "c18"
								},
								{
									"cell": "c13"
								},
								{
									"cell": "c5"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c12",
									"colspan": 1
								},
								{
									"cell": "c19"
								},
								{
									"cell": "c14"
								},
								{
									"cell": "c7"
								}
							]
						},
						{
							"cells": [
								{
									"cell": "c6",
									"colspan": 1
								},
								{
									"cell": "c20"
								},
								{
									"cell": "c15"
								},
								{
									"cell": "c8"
								}
							],
							"section": ""
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c16",
									"colspan": 3
								},
								{
									"cell": "c22"
								}
							]
						}
					],
					"cells": {
						"c2": {
							"model": "c1",
							"items": [
								"integrated_edit_field"
							]
						},
						"c4": {
							"model": "c1",
							"items": [
								"integrated_edit_field20"
							]
						},
						"c6": {
							"model": "c1",
							"items": [
								"integrated_edit_field8"
							]
						},
						"c9": {
							"model": "c1",
							"items": [
								"integrated_edit_field7"
							]
						},
						"c12": {
							"model": "c1",
							"items": [
								"integrated_edit_field23"
							]
						},
						"c3": {
							"model": "c1",
							"items": [
								"integrated_edit_field30"
							]
						},
						"c5": {
							"model": "c1",
							"items": [
								"integrated_edit_field22"
							]
						},
						"c7": {
							"model": "c1",
							"items": [
								"integrated_edit_field32"
							]
						},
						"c8": {
							"model": "c1",
							"items": [
								"integrated_edit_field27"
							]
						},
						"c10": {
							"model": "c1",
							"items": [
								"integrated_edit_field19"
							]
						},
						"c11": {
							"model": "c1",
							"items": [
								"integrated_edit_field2"
							]
						},
						"c13": {
							"model": "c1",
							"items": [
								"integrated_edit_field29"
							]
						},
						"c14": {
							"model": "c1",
							"items": [
								"integrated_edit_field26"
							]
						},
						"c15": {
							"model": "c1",
							"items": [
								"integrated_edit_field28"
							]
						},
						"c18": {
							"model": "c1",
							"items": [
								"integrated_edit_field21"
							]
						},
						"c19": {
							"model": "c1",
							"items": [
								"integrated_edit_field24"
							]
						},
						"c20": {
							"model": "c1",
							"items": [
								"integrated_edit_field25"
							]
						},
						"c": {
							"model": "c1",
							"items": []
						},
						"c16": {
							"model": "c1",
							"items": [
								"integrated_edit_field12"
							]
						},
						"c22": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section2": {
					"modelId": "simple-edit",
					"grid": [
						{
							"section": "",
							"cells": [
								{
									"cell": "c4",
									"colspan": 1
								},
								{
									"cell": "c5",
									"colspan": 6
								},
								{
									"cell": "c19"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c9",
									"colspan": 1
								},
								{
									"cell": "c6",
									"colspan": 2
								},
								{
									"cell": "c29",
									"colspan": 2
								},
								{
									"cell": "c25"
								},
								{
									"cell": "c26"
								},
								{
									"cell": "c20"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c14"
								},
								{
									"cell": "c15"
								},
								{
									"cell": "c16",
									"colspan": 2
								},
								{
									"cell": "c17",
									"colspan": 3
								},
								{
									"cell": "c18"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c",
									"colspan": 8
								}
							]
						}
					],
					"cells": {
						"c4": {
							"model": "c1",
							"items": [
								"integrated_edit_field10"
							],
							"align": "left"
						},
						"c9": {
							"model": "c1",
							"items": [
								"integrated_edit_field16"
							],
							"width": "40%"
						},
						"c19": {
							"model": "c1",
							"items": []
						},
						"c20": {
							"model": "c1",
							"items": []
						},
						"c5": {
							"model": "c1",
							"items": [
								"integrated_edit_field11"
							]
						},
						"c6": {
							"model": "c1",
							"items": [
								"integrated_edit_field13"
							],
							"width": "30%"
						},
						"c": {
							"model": "c1",
							"items": [
								"text"
							],
							"align": "center"
						},
						"c14": {
							"model": "c1",
							"items": [
								"integrated_edit_field17"
							]
						},
						"c15": {
							"model": "c1",
							"items": [
								"integrated_edit_field18"
							]
						},
						"c16": {
							"model": "c1",
							"items": [
								"integrated_edit_field31"
							]
						},
						"c17": {
							"model": "c1",
							"items": []
						},
						"c18": {
							"model": "c1",
							"items": []
						},
						"c29": {
							"model": "c1",
							"items": [
								"integrated_edit_field14"
							]
						},
						"c25": {
							"model": "c1",
							"items": [
								"integrated_edit_field15"
							]
						},
						"c26": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				}
			},
			"items": {
				"add_header": {
					"type": "add_header"
				},
				"add_back_list": {
					"type": "add_back_list"
				},
				"add_cancel": {
					"type": "add_cancel",
					"icon": {}
				},
				"add_message": {
					"type": "add_message"
				},
				"add_save": {
					"type": "add_save",
					"icon": {},
					"customCSS": "/* Put  your custom CSS code here */\n\n:host {\n\n   display:none !important; \n\n\n}\n"
				},
				"add_reset": {
					"type": "add_reset"
				},
				"integrated_edit_field3": {
					"field": "idcliente",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idcliente",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field": {
					"field": "idproducto",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idproducto",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field2": {
					"field": "idplan",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idplan",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field1": {
					"field": "nombre",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "nombre",
						"table": "solicitudes",
						"type": 5
					},
					"label": {
						"field": "nombre",
						"table": "solicitudes",
						"type": 3
					}
				},
				"integrated_edit_field4": {
					"field": "paterno",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "paterno",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field5": {
					"field": "materno",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "materno",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field6": {
					"field": "rfc",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field8": {
					"field": "plazo",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "plazo",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field9": {
					"field": "idcli",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field19": {
					"field": "noserie",
					"type": "integrated_edit_field",
					"orientation": 0,
					"bold": true,
					"font-size": "2em"
				},
				"integrated_edit_field20": {
					"field": "idtipoventa",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field21": {
					"field": "dn",
					"type": "integrated_edit_field",
					"orientation": 0,
					"font-size": "1.5em",
					"bold": true
				},
				"integrated_edit_field22": {
					"field": "cuenta",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field23": {
					"field": "contrato",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field24": {
					"field": "contratoportal",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field25": {
					"field": "plazopendiente",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field26": {
					"field": "factura",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field27": {
					"field": "fechavenci",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field28": {
					"field": "ciclo",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field29": {
					"field": "dnpreferido",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"image": {
					"type": "image",
					"image": {
						"image": "LOGO NEGRO Y AZUL PEQUE.png",
						"source": 2
					},
					"width": "168px",
					"height": "80px"
				},
				"text": {
					"type": "text",
					"editedByRte": false,
					"label": {
						"text": "<div id=\"google-map\" style=\"height: 400px; width: 100%; margin-bottom: 10px; border: 1px solid #ccc;\"></div>\n<p><strong>Haz clic en el mapa para ubicar o arrastra el marcador.</strong></p>\n\n<script src=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyBEbOZrRNV7JiveFroZVC2AFkoMJ18VKyg&libraries=geometry,places&callback=initGoogleMap\" async defer></script>\n\n<script>\n// ====================================================================\n// 📌 1. CONFIGURACIÓN DE IDS (AJUSTA ESTOS IDS SI NO COINCIDEN)\n// ====================================================================\nconst FIELD_IDS = {\n    calle:   'value_calle_1',\n    numext:  'value_numeroext_1',\n    colonia: 'value_colonia_1',\n    ciudad:  'value_ciudad_1',\n    estado:  'value_estado_1',\n    cp:      'value_cp_1',\n    lat:     'value_lat_1',\n    lng:     'value_lng_1'\n};\n\n// ====================================================================\n// 📌 2. VARIABLES GLOBALES Y HELPERS\n// ====================================================================\nlet map;\nlet marker;\nlet geocoder;\nlet mapInitialized = false;\n\nconst $id = (id) => document.getElementById(id);\nconst safeTrim = (v) => (v || '').toString().trim();\nconst isValidLatLng = (lat, lng) => {\n    const a = Number(lat), b = Number(lng);\n    return Number.isFinite(a) && Number.isFinite(b) && a <= 90 && a >= -90 && b <= 180 && b >= -180;\n};\n\n// ====================================================================\n// 📌 3. FUNCIONES PRINCIPALES\n// ====================================================================\n\n// --- Inicialización del Mapa (Llamada por el API script) ---\nfunction initGoogleMap() {\n    if (mapInitialized) return;\n\n    const defaultCoords = { lat: 21.0038, lng: -89.6183 }; // Mérida, México como centro por defecto\n    \n    const initialLat = safeTrim($id(FIELD_IDS.lat)?.value);\n    const initialLng = safeTrim($id(FIELD_IDS.lng)?.value);\n    const initialCoords = isValidLatLng(initialLat, initialLng) \n        ? { lat: Number(initialLat), lng: Number(initialLng) } \n        : defaultCoords;\n\n    map = new google.maps.Map($id('google-map'), {\n        center: initialCoords,\n        zoom: isValidLatLng(initialLat, initialLng) ? 17 : 12,\n        mapTypeId: 'roadmap',\n        gestureHandling: 'greedy' // 🚀 Evita el molesto \"Ctrl + Scroll\"\n    });\n\n    geocoder = new google.maps.Geocoder();\n    mapInitialized = true;\n\n    // Colocar marcador si hay coordenadas iniciales\n    if (isValidLatLng(initialLat, initialLng)) {\n        placeMarker(initialCoords);\n    }\n    \n    // Listener: Al hacer CLIC en el mapa\n    map.addListener('click', (e) => {\n        placeMarker(e.latLng); \n        updateFieldsAndGeocode(e.latLng); \n    });\n    \n    // PHPRunner necesita esta línea para que el mapa se muestre correctamente en pestañas/secciones\n    setTimeout(() => google.maps.event.trigger(map, 'resize'), 300);\n}\n\n// --- Coloca el marcador y actualiza Lat/Lng al arrastrar o hacer clic ---\nfunction placeMarker(location) {\n    if (marker) {\n        marker.setPosition(location);\n    } else {\n        marker = new google.maps.Marker({\n            position: location,\n            map: map,\n            draggable: true // 📌 Permite arrastrar el marcador\n        });\n        \n        // Listener: Al terminar de arrastrar el marcador\n        marker.addListener('dragend', function() {\n            const newLocation = marker.getPosition();\n            updateFieldsAndGeocode(newLocation);\n        });\n    }\n    map.setCenter(location);\n    \n    // Si no usamos updateFieldsAndGeocode (ej. al inicio), aseguramos la posición\n    $id(FIELD_IDS.lat).value = location.lat().toFixed(6);\n    $id(FIELD_IDS.lng).value = location.lng().toFixed(6);\n}\n\n// --- Función central: Actualiza campos y pide Geocodificación Inversa ---\nfunction updateFieldsAndGeocode(location) {\n    // 1. Actualiza campos Lat/Lng\n    $id(FIELD_IDS.lat).value = location.lat().toFixed(6);\n    $id(FIELD_IDS.lng).value = location.lng().toFixed(6);\n    \n    // 2. Realiza la geocodificación inversa (Lat/Lng -> Dirección)\n    reverseGeocode(location);\n}\n\n// --- Geocodificación Inversa (Lat/Lng -> Dirección) ---\nfunction reverseGeocode(latLng) {\n    if (!geocoder) return;\n\n    geocoder.geocode({ location: latLng })\n        .then((response) => {\n            if (response.results[0]) {\n                populateAddressFields(response.results[0]);\n            }\n        })\n        .catch((e) => console.error('Falló la geocodificación inversa:', e));\n}\n\nfunction getAddressComponent(components, type) {\n    const component = components.find(c => c.types.includes(type));\n    return component ? component.long_name : '';\n}\n\nfunction populateAddressFields(result) {\n    const components = result.address_components;\n    \n    // Obtener componentes específicos de Google Maps\n    const street = getAddressComponent(components, 'route');\n    const houseNumber = getAddressComponent(components, 'street_number');\n    const neighborhood = getAddressComponent(components, 'sublocality_level_1') || getAddressComponent(components, 'neighborhood');\n    const city = getAddressComponent(components, 'locality') || getAddressComponent(components, 'administrative_area_level_2');\n    const state = getAddressComponent(components, 'administrative_area_level_1');\n    const postalCode = getAddressComponent(components, 'postal_code');\n\n    // Llenar los campos del formulario\n    if ($id(FIELD_IDS.estado)) $id(FIELD_IDS.estado).value = state;\n    if ($id(FIELD_IDS.ciudad)) $id(FIELD_IDS.ciudad).value = city;\n    if ($id(FIELD_IDS.cp)) $id(FIELD_IDS.cp).value = postalCode;\n    if ($id(FIELD_IDS.colonia)) $id(FIELD_IDS.colonia).value = neighborhood;\n    if ($id(FIELD_IDS.calle)) $id(FIELD_IDS.calle).value = street;\n    if ($id(FIELD_IDS.numext)) $id(FIELD_IDS.numext).value = houseNumber;\n}\n\n// --- Geocodificación (Dirección -> Lat/Lng) desde campos de texto ---\nfunction geocodeAddressFromFields() {\n    const calle = safeTrim($id(FIELD_IDS.calle)?.value);\n    const numext = safeTrim($id(FIELD_IDS.numext)?.value);\n    const colonia = safeTrim($id(FIELD_IDS.colonia)?.value);\n    const ciudad = safeTrim($id(FIELD_IDS.ciudad)?.value) || '';\n    const estado = safeTrim($id(FIELD_IDS.estado)?.value) || '';\n    const cp = safeTrim($id(FIELD_IDS.cp)?.value);\n\n    const addressParts = [\n        calle + (numext ? ' ' + numext : ''),\n        colonia,\n        ciudad,\n        estado,\n        cp,\n        'México'\n    ].filter(Boolean);\n    \n    const address = addressParts.join(', ');\n\n    if (!address || !geocoder || (!calle && !colonia)) return;\n\n    geocoder.geocode({ address: address })\n        .then((response) => {\n            if (response.results[0]) {\n                const location = response.results[0].geometry.location;\n                placeMarker(location);\n                map.setZoom(17);\n            }\n        })\n        .catch((e) => console.error('Geocoding falló por:', e));\n}\n\n\n// ====================================================================\n// 📌 4. LÓGICA DE ARRANQUE Y EVENTOS (Manejo de Tabs/Redimensionamiento)\n// ====================================================================\n\nfunction attachListeners() {\n    const addressFields = [FIELD_IDS.calle, FIELD_IDS.numext, FIELD_IDS.colonia, FIELD_IDS.ciudad, FIELD_IDS.estado, FIELD_IDS.cp];\n\n    // Observa cambios en los campos de dirección (al salir o presionar Enter)\n    addressFields.forEach(id => {\n        const el = $id(id);\n        if (!el) return;\n        \n        el.addEventListener('blur', geocodeAddressFromFields);\n        el.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter') {\n                e.preventDefault();\n                geocodeAddressFromFields();\n            }\n        });\n    });\n\n    // Observa cambios en Lat/Lng manuales para centrar el mapa\n    [FIELD_IDS.lat, FIELD_IDS.lng].forEach(id => {\n        const el = $id(id);\n        if (!el) return;\n        el.addEventListener('change', () => {\n            const lat = safeTrim($id(FIELD_IDS.lat)?.value);\n            const lng = safeTrim($id(FIELD_IDS.lng)?.value);\n            if (isValidLatLng(lat, lng)) {\n                placeMarker(new google.maps.LatLng(Number(lat), Number(lng)));\n                map.setZoom(17);\n            }\n        });\n    });\n}\n\n// Maneja la inicialización tardía en caso de que el mapa esté en una pestaña oculta\nfunction checkMapVisibility() {\n    const mapContainer = $id('google-map');\n    if (mapContainer && mapContainer.offsetParent !== null && mapContainer.offsetWidth > 0) {\n        if (!mapInitialized && typeof google !== 'undefined' && typeof google.maps !== 'undefined') {\n             // La inicialización real ocurre por el 'callback=initGoogleMap' en la URL del API\n             // Solo llamamos al resize si ya cargó\n             setTimeout(() => google.maps.event.trigger(map, 'resize'), 100);\n             return true;\n        }\n    }\n    return false;\n}\n\ndocument.addEventListener('DOMContentLoaded', function() {\n    attachListeners();\n\n    // Revisa la visibilidad al inicio\n    checkMapVisibility(); \n    \n    // Observador para cuando se cambie de pestaña\n    document.body.addEventListener('click', function(e) {\n        if (e.target.closest('[data-toggle=\"tab\"], .step-tab, .nav-link')) {\n            setTimeout(() => {\n                if (mapInitialized) google.maps.event.trigger(map, 'resize');\n                else checkMapVisibility();\n            }, 400);\n        }\n    });\n});\n</script>",
						"type": 0
					}
				},
				"integrated_edit_field16": {
					"field": "colonia",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field13": {
					"field": "calle",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field14": {
					"field": "numeroext",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field15": {
					"field": "numeroint",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field11": {
					"field": "ciudad",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field10": {
					"field": "estado",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field17": {
					"field": "lat",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field18": {
					"field": "lng",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"section2": {
					"type": "section",
					"title": {
						"text": "<i class=\"fa-solid fa-location-dot\" style=\"font-size:1.5em; color:#fff;\"></i> Información de Entrega\n",
						"type": 0
					},
					"location": "section2",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "",
					"headerColor": "",
					"bodyBg": "",
					"bodyColor": "",
					"panelBorder": null,
					"borderColor": "",
					"initiallyClosed": true
				},
				"sec_cliente": {
					"type": "section",
					"title": {
						"text": "<i class=\"fa-solid fa-user\" style=\"font-size:1.5em; color:#fff;\"></i> Datos del Cliente\n\n",
						"type": 0
					},
					"location": "section",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "",
					"headerColor": "#ffffff",
					"bodyBg": "",
					"bodyColor": "",
					"panelBorder": null,
					"borderColor": "",
					"initiallyClosed": true
				},
				"sec_venta": {
					"type": "section",
					"title": {
						"text": "<i class=\"fa-solid fa-cart-shopping\" style=\"font-size:1.5em; color:#fff;\"></i> Información de la Venta\n",
						"type": 0
					},
					"location": "section1",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "",
					"headerColor": "",
					"bodyBg": "",
					"bodyColor": "",
					"panelBorder": null,
					"borderColor": "",
					"initiallyClosed": true
				},
				"text1": {
					"type": "text",
					"label": {
						"text": "<button type=\"button\" id=\"btnGuardarVNP\" class=\"btn btn-primary\">\n    Guardar VNP\n</button>\n",
						"type": 0
					},
					"editedByRte": false
				},
				"integrated_edit_field12": {
					"field": "observaciones",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field30": {
					"field": "renta",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field7": {
					"field": "orden",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field31": {
					"field": "fechahoraentrega",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field32": {
					"field": "totalapagar",
					"type": "integrated_edit_field",
					"orientation": 0
				}
			},
			"dbProps": {},
			"version": 13,
			"pageWidth": "standard",
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"pageCSS": "/* Put  your custom CSS code here */\n\n/* Put  your custom CSS code here */\n\n\n\n/* ========================================================= */\n/* VARIABLES DE COLOR */\n/* ========================================================= */\n:root {\n    --color-elegante: #FFFFFF; /* Texto Blanco para contrastar con el fondo oscuro */\n    --naranja-degradado-inicio: #03478A; /* Naranja Suave (Light Salmon) */\n    --naranja-degradado-fin: #6D98C2; /* Naranja Medio (Coral) */\n    --color-borde-base: #FF7F50; /* Color simple para el borde base */\n}\n\n/* ========================================================= */\n/* 1. Fondo de la Página: Degradado Azul Cielo (Se mantiene) */\n/* ========================================================= */\nbody, .container-fluid {\nbackground: linear-gradient(180deg, #E0F7FA 0%, #B3E5FC 100%) !important;    min-height: 100vh;\n}\n\n/* ========================================================= */\n/* 2. Estilo de las Secciones: Efecto Tarjeta/Sombreado (Se mantiene) */\n/* ========================================================= */\n.panel, .rnr-c-body, .rnr-c-grid {\n    background-color: #FFFFFF !important; \n    border: none !important; \n    border-radius: 12px !important; \n    padding: 20px;\n    margin-bottom: 25px; \n    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1), \n                0 2px 6px rgba(0, 0, 0, 0.05) !important; \n                \n    /* 🔑 CAMBIO CLAVE: Agrega 'transform' a la transición */\n    transition: box-shadow 0.3s ease-in-out, \n                transform 0.3s ease-in-out; /* Transición para el movimiento y escala */            \n                \n}\n\n/* ========================================================= */\n/* 3. Estilo de Encabezados de Sección (EL CAMBIO PRINCIPAL) */\n/* ========================================================= */\n.panel-heading, .rnr-c-head {\n    /* Aplicamos el degradado al fondo completo del encabezado */\n    background: linear-gradient(to right, var(--naranja-degradado-inicio), var(--naranja-degradado-fin)) !important;\n    \n    /* El texto del título ahora es blanco para contrastar con el fondo naranja */\n    color: var(--color-elegante) !important; \n    \n    font-weight: 600;\n    \n    /* Mantenemos el centrado vertical */\n    display: flex;\n    align-items: center;\n    height: 40px; /* Aseguramos una altura suficiente */\n    \n    /* Eliminamos el borde degradado y aplicamos un borde simple y fino abajo */\n    border-bottom: 1px solid var(--color-borde-base) !important; \n    border-image-source: none !important; /* Desactivar la propiedad border-image anterior */\n    \n    /* Ajustes de relleno/bordes para que el degradado se vea bien */\n    padding: 0 15px !important; \n    border-top-left-radius: 12px !important; /* Mantenemos el radio del panel superior */\n    border-top-right-radius: 12px !important;\n}\n\n/* ========================================================= */\n/* 3. Estilo de HOVER: Efecto de Elevación/Intensificación    */\n/* ========================================================= */\n.panel:hover, .rnr-c-body:hover, .rnr-c-grid:hover {\n    /* Nueva sombra más intensa y \"elevada\" */\n    box-shadow: 0 15px 400px rgba(0, 0, 0, 0.3), \n                0 5px 15px rgba(0, 0, 0, 0.1) !important; \n    \n    /* Pequeño movimiento hacia arriba para dar más sensación de elevación (opcional) */\n    transform: translateY(-5px) scale(1.005); \n}\n\n\n\n/* 4. Estilo de los Inputs (Se mantiene) */\n.form-control {\n    border-radius: 8px !important; \n    border: 1px solid #e0e0e0 !important;\n}\n.form-control:focus {\n    border-color: #48C9B0 !important; \n    box-shadow: 0 0 0 0.2rem rgba(72, 201, 176, 0.25) !important;\n}\n\n/* Aplica solo a formularios con esas secciones */\n.panel.panel-default.form-section > .panel-body { display: none; }\n\n.panel.panel-default.form-section > .panel-heading:hover {\n  cursor: pointer;\n  filter: brightness(0.98);\n}\n\n/* ========================================================= */\n/* ARREGLO DE COLOR DE TEXTO DE ENCABEZADO DURANTE MODAL     */\n/* ========================================================= */\n\n/* Apuntamos directamente al panel-title, que es el elemento que contiene \n   el texto del encabezado de la sección. \n*/\n.panel-heading .panel-title {\n    color: #FFFFFF !important; \n}\n\n/* Si dentro del panel-title hay un enlace (Ej. si el encabezado permite colapsar/expandir \n   y el título es un <a>), también debemos forzar el color del enlace.\n*/\n.panel-heading .panel-title a {\n    color: #FFFFFF !important;\n}\n\n/* Asegurar que el texto dentro del panel-title no se vea afectado por reglas generales\n   que usen el estado 'modal-open' en el cuerpo de la página.\n*/\n.modal-open .panel-heading .panel-title {\n    color: #FFFFFF !important;\n}\n\n/* Evita encogimiento general */\n#center_block, .rnr-page, .bs-body { min-height: 85vh; }\n\n/* Botón flotante \"Alta rápida\" sobre el modal del lookup (fallback cross-origin) */\n.lkp-floating-add {\n  position: fixed;\n  right: 24px;\n  top: 24px;\n  z-index: 2147483000;\n  padding: 10px 14px;\n  border-radius: 12px;\n  background: #0d6efd;\n  color: #fff;\n  font-weight: 600;\n  cursor: pointer;\n  display: none; /* se activa por JS cuando detectamos el iframe del lookup */\n  box-shadow: 0 6px 20px rgba(0,0,0,.25);\n}\n\n/* Portal del ADD en el top.document */\n#lkpAddPortal {\n  position: fixed;\n  inset: 0;\n  background: rgba(0,0,0,.35);\n  z-index: 2147483647;\n  display: none;\n}\n#lkpAddPortal .shell {\n  position: absolute;\n  inset: 3vh 3vw;           /* 94% del viewport */\n  background: #fff;\n  border-radius: 16px;\n  box-shadow: 0 20px 60px rgba(0,0,0,.4);\n  overflow: hidden;\n}\n#lkpAddPortal iframe {\n  width: 100%;\n  height: 100%;\n  border: 0;\n  display: block;\n}\n#lkpAddPortal .close-btn {\n  position: absolute;\n  top: 10px; right: 10px;\n  z-index: 10;\n  padding: 6px 10px;\n  background: #111;\n  color: #fff;\n  border-radius: 10px;\n  cursor: pointer;\n  font-weight: 600;\n  opacity: .85;\n}\n#lkpAddPortal .close-btn:hover { opacity: 1; }\n",
			"listTotals": 1,
			"customHtml": "",
			"title": {}
		},
		{
			"id": "export",
			"type": "export",
			"layoutId": "first",
			"disabled": false,
			"default": 0,
			"forms": {
				"supertop": {
					"modelId": "panel-top",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "export-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"export_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "export-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"export_field1",
								"export_field2",
								"export_field3",
								"export_field4",
								"export_field5",
								"export_field6",
								"export_field7",
								"export_field8",
								"export_field9",
								"export_field10",
								"export_field11",
								"export_field12",
								"export_field13",
								"export_field14",
								"export_field15",
								"export_field16",
								"export_field17",
								"export_field18",
								"export_field"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"footer": {
					"modelId": "export-footer",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						},
						"c2": {
							"model": "c2",
							"items": [
								"export_export",
								"export_cancel"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				}
			},
			"items": {
				"export_header": {
					"type": "export_header"
				},
				"export_export": {
					"type": "export_export"
				},
				"export_cancel": {
					"type": "export_cancel"
				},
				"export_field1": {
					"field": "lat",
					"type": "export_field"
				},
				"export_field2": {
					"field": "lng",
					"type": "export_field"
				},
				"export_field3": {
					"field": "dn",
					"type": "export_field"
				},
				"export_field4": {
					"field": "cuenta",
					"type": "export_field"
				},
				"export_field5": {
					"field": "contrato",
					"type": "export_field"
				},
				"export_field6": {
					"field": "contratoportal",
					"type": "export_field"
				},
				"export_field7": {
					"field": "plazopendiente",
					"type": "export_field"
				},
				"export_field8": {
					"field": "factura",
					"type": "export_field"
				},
				"export_field9": {
					"field": "fechavenci",
					"type": "export_field"
				},
				"export_field10": {
					"field": "ciclo",
					"type": "export_field"
				},
				"export_field11": {
					"field": "dnpreferido",
					"type": "export_field"
				},
				"export_field12": {
					"field": "renta",
					"type": "export_field"
				},
				"export_field13": {
					"field": "ine",
					"type": "export_field"
				},
				"export_field14": {
					"field": "cartaburocredito",
					"type": "export_field"
				},
				"export_field15": {
					"field": "polizaseguro",
					"type": "export_field"
				},
				"export_field16": {
					"field": "contratodocto",
					"type": "export_field"
				},
				"export_field17": {
					"field": "nombre_completo",
					"type": "export_field"
				},
				"export_field18": {
					"field": "fechahoraentrega",
					"type": "export_field"
				},
				"export_field": {
					"field": "totalapagar",
					"type": "export_field"
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {},
			"exportFormat": 2,
			"exportDelimiter": ",",
			"exportSelectDelimiter": false,
			"exportSelectFields": false
		},
		{
			"id": "import",
			"type": "import",
			"layoutId": "first",
			"disabled": true,
			"default": 0,
			"forms": {
				"supertop": {
					"modelId": "panel-top",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "import-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"import_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "import-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				}
			},
			"items": {
				"import_header": {
					"type": "import_header"
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {}
		},
		{
			"id": "edit",
			"type": "edit",
			"layoutId": "nomenu",
			"disabled": false,
			"default": 7,
			"forms": {
				"above-grid": {
					"modelId": "edit-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"edit_message"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "edit-below-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1",
									"colspan": 1
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"text1",
								"edit_back_list",
								"edit_close"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "edit-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"image",
								"edit_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-edit",
					"grid": [
						{
							"cells": [
								{
									"cell": "c4",
									"colspan": 1
								}
							],
							"section": ""
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c9",
									"rowspan": 1
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c",
									"colspan": 1
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c1",
									"colspan": 1
								}
							]
						},
						{
							"cells": [
								{
									"cell": "c8",
									"colspan": 1
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c3"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c4": {
							"model": "c3",
							"items": [
								"sec_cliente"
							],
							"align": "center"
						},
						"c": {
							"model": "c3",
							"items": [
								"sec_venta"
							],
							"align": "center"
						},
						"c1": {
							"model": "c3",
							"items": [],
							"background": "transparent",
							"customCSS": "/* Put  your custom CSS code here */\n\n        body {\n            box-sizing: border-box;\n        }",
							"height": "3em"
						},
						"c8": {
							"model": "c3",
							"items": [
								"section2"
							],
							"align": "center"
						},
						"c9": {
							"model": "c3",
							"items": []
						},
						"c3": {
							"model": "c3",
							"items": [],
							"align": "center"
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section": {
					"modelId": "simple-edit",
					"grid": [
						{
							"section": "",
							"cells": [
								{
									"cell": "c3"
								},
								{
									"cell": "c4"
								}
							]
						},
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"integrated_edit_field4",
								"integrated_edit_field1"
							]
						},
						"c": {
							"model": "c1",
							"items": [
								"integrated_edit_field5",
								"integrated_edit_field6"
							]
						},
						"c3": {
							"model": "c1",
							"items": [
								"integrated_edit_field3"
							]
						},
						"c4": {
							"model": "c1",
							"items": [
								"integrated_edit_field9"
							]
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section1": {
					"modelId": "simple-edit",
					"grid": [
						{
							"section": "",
							"cells": [
								{
									"cell": "c2",
									"colspan": 2
								},
								{
									"cell": "c10"
								},
								{
									"cell": "c"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c4",
									"colspan": 2
								},
								{
									"cell": "c11"
								},
								{
									"cell": "c3"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c9",
									"colspan": 1
								},
								{
									"cell": "c18"
								},
								{
									"cell": "c13"
								},
								{
									"cell": "c5"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c12",
									"colspan": 1
								},
								{
									"cell": "c19"
								},
								{
									"cell": "c14"
								},
								{
									"cell": "c7"
								}
							]
						},
						{
							"cells": [
								{
									"cell": "c6",
									"colspan": 1
								},
								{
									"cell": "c20"
								},
								{
									"cell": "c15"
								},
								{
									"cell": "c8"
								}
							],
							"section": ""
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c16",
									"colspan": 3
								},
								{
									"cell": "c22"
								}
							]
						}
					],
					"cells": {
						"c2": {
							"model": "c1",
							"items": [
								"integrated_edit_field"
							]
						},
						"c4": {
							"model": "c1",
							"items": [
								"integrated_edit_field20"
							]
						},
						"c6": {
							"model": "c1",
							"items": [
								"integrated_edit_field8"
							]
						},
						"c9": {
							"model": "c1",
							"items": [
								"integrated_edit_field7"
							]
						},
						"c12": {
							"model": "c1",
							"items": [
								"integrated_edit_field23"
							]
						},
						"c3": {
							"model": "c1",
							"items": [
								"integrated_edit_field30"
							]
						},
						"c5": {
							"model": "c1",
							"items": [
								"integrated_edit_field22"
							]
						},
						"c7": {
							"model": "c1",
							"items": [
								"integrated_edit_field33"
							]
						},
						"c8": {
							"model": "c1",
							"items": [
								"integrated_edit_field27"
							]
						},
						"c10": {
							"model": "c1",
							"items": [
								"integrated_edit_field19"
							]
						},
						"c11": {
							"model": "c1",
							"items": [
								"integrated_edit_field2"
							]
						},
						"c13": {
							"model": "c1",
							"items": [
								"integrated_edit_field29"
							]
						},
						"c14": {
							"model": "c1",
							"items": [
								"integrated_edit_field26"
							]
						},
						"c15": {
							"model": "c1",
							"items": [
								"integrated_edit_field28"
							]
						},
						"c18": {
							"model": "c1",
							"items": [
								"integrated_edit_field21"
							]
						},
						"c19": {
							"model": "c1",
							"items": [
								"integrated_edit_field24"
							]
						},
						"c20": {
							"model": "c1",
							"items": [
								"integrated_edit_field25"
							]
						},
						"c": {
							"model": "c1",
							"items": []
						},
						"c16": {
							"model": "c1",
							"items": [
								"integrated_edit_field12"
							]
						},
						"c22": {
							"model": "c1",
							"items": [
								"integrated_edit_field31"
							]
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section2": {
					"modelId": "simple-edit",
					"grid": [
						{
							"section": "",
							"cells": [
								{
									"cell": "c4",
									"colspan": 1
								},
								{
									"cell": "c5",
									"colspan": 6
								},
								{
									"cell": "c19"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c9",
									"colspan": 1
								},
								{
									"cell": "c6",
									"colspan": 2
								},
								{
									"cell": "c29",
									"colspan": 2
								},
								{
									"cell": "c25"
								},
								{
									"cell": "c26"
								},
								{
									"cell": "c20"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c14"
								},
								{
									"cell": "c15"
								},
								{
									"cell": "c16",
									"colspan": 2
								},
								{
									"cell": "c17",
									"colspan": 3
								},
								{
									"cell": "c18"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c",
									"colspan": 8
								}
							]
						}
					],
					"cells": {
						"c4": {
							"model": "c1",
							"items": [
								"integrated_edit_field10"
							],
							"align": "left"
						},
						"c9": {
							"model": "c1",
							"items": [
								"integrated_edit_field16"
							],
							"width": "40%"
						},
						"c19": {
							"model": "c1",
							"items": []
						},
						"c20": {
							"model": "c1",
							"items": []
						},
						"c5": {
							"model": "c1",
							"items": [
								"integrated_edit_field11"
							]
						},
						"c6": {
							"model": "c1",
							"items": [
								"integrated_edit_field13"
							],
							"width": "30%"
						},
						"c": {
							"model": "c1",
							"items": [
								"text"
							],
							"align": "center"
						},
						"c14": {
							"model": "c1",
							"items": [
								"integrated_edit_field17"
							]
						},
						"c15": {
							"model": "c1",
							"items": [
								"integrated_edit_field18"
							]
						},
						"c16": {
							"model": "c1",
							"items": [
								"integrated_edit_field32"
							]
						},
						"c17": {
							"model": "c1",
							"items": []
						},
						"c18": {
							"model": "c1",
							"items": []
						},
						"c29": {
							"model": "c1",
							"items": [
								"integrated_edit_field14"
							]
						},
						"c25": {
							"model": "c1",
							"items": [
								"integrated_edit_field15"
							]
						},
						"c26": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				}
			},
			"items": {
				"edit_header": {
					"type": "edit_header"
				},
				"edit_message": {
					"type": "edit_message"
				},
				"edit_back_list": {
					"type": "edit_back_list",
					"icon": {}
				},
				"edit_close": {
					"type": "edit_close",
					"icon": {}
				},
				"image": {
					"type": "image",
					"image": {
						"image": "LOGO NEGRO Y AZUL PEQUE.png",
						"source": 2
					},
					"width": "168px",
					"height": "80px"
				},
				"text1": {
					"type": "text",
					"label": {
						"text": "<button type=\"button\" id=\"btnGuardarVNP\" class=\"btn btn-primary\">\n    Guardar \n</button>\n",
						"type": 0
					},
					"editedByRte": false
				},
				"sec_cliente": {
					"type": "section",
					"title": {
						"text": "<i class=\"fa-solid fa-user\" style=\"font-size:1.5em; color:#fff;\"></i> Datos del Cliente\n\n",
						"type": 0
					},
					"location": "section",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "",
					"headerColor": "#ffffff",
					"bodyBg": "",
					"bodyColor": "",
					"panelBorder": null,
					"borderColor": "",
					"initiallyClosed": true
				},
				"integrated_edit_field4": {
					"field": "paterno",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "paterno",
						"table": "solicitudes",
						"type": 5
					},
					"updateOnEdit": false
				},
				"integrated_edit_field1": {
					"field": "nombre",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "nombre",
						"table": "solicitudes",
						"type": 5
					},
					"label": {
						"field": "nombre",
						"table": "solicitudes",
						"type": 3
					},
					"updateOnEdit": false
				},
				"integrated_edit_field5": {
					"field": "materno",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "materno",
						"table": "solicitudes",
						"type": 5
					},
					"updateOnEdit": false
				},
				"integrated_edit_field6": {
					"field": "rfc",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field3": {
					"field": "idcliente",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idcliente",
						"table": "solicitudes",
						"type": 5
					},
					"updateOnEdit": false
				},
				"integrated_edit_field9": {
					"field": "idcli",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"sec_venta": {
					"type": "section",
					"title": {
						"text": "<i class=\"fa-solid fa-cart-shopping\" style=\"font-size:1.5em; color:#fff;\"></i> Información de la Venta\n",
						"type": 0
					},
					"location": "section1",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "",
					"headerColor": "",
					"bodyBg": "",
					"bodyColor": "",
					"panelBorder": null,
					"borderColor": "",
					"initiallyClosed": true
				},
				"integrated_edit_field": {
					"field": "idproducto",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idproducto",
						"table": "solicitudes",
						"type": 5
					},
					"updateOnEdit": false
				},
				"integrated_edit_field20": {
					"field": "idtipoventa",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field8": {
					"field": "plazo",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "plazo",
						"table": "solicitudes",
						"type": 5
					},
					"updateOnEdit": false
				},
				"integrated_edit_field7": {
					"field": "orden",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "orden",
						"table": "solicitudes",
						"type": 5
					},
					"font-size": "1.5em",
					"bold": true,
					"updateOnEdit": false
				},
				"integrated_edit_field23": {
					"field": "contrato",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field30": {
					"field": "renta",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field22": {
					"field": "cuenta",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field27": {
					"field": "fechavenci",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field19": {
					"field": "noserie",
					"type": "integrated_edit_field",
					"orientation": 0,
					"bold": true,
					"font-size": "2em",
					"updateOnEdit": false
				},
				"integrated_edit_field2": {
					"field": "idplan",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idplan",
						"table": "solicitudes",
						"type": 5
					},
					"updateOnEdit": false
				},
				"integrated_edit_field29": {
					"field": "dnpreferido",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field26": {
					"field": "factura",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field28": {
					"field": "ciclo",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field21": {
					"field": "dn",
					"type": "integrated_edit_field",
					"orientation": 0,
					"font-size": "1.5em",
					"bold": true,
					"updateOnEdit": false
				},
				"integrated_edit_field24": {
					"field": "contratoportal",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field25": {
					"field": "plazopendiente",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field12": {
					"field": "observaciones",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"section2": {
					"type": "section",
					"title": {
						"text": "<i class=\"fa-solid fa-location-dot\" style=\"font-size:1.5em; color:#fff;\"></i> Información de Entrega\n",
						"type": 0
					},
					"location": "section2",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "",
					"headerColor": "",
					"bodyBg": "",
					"bodyColor": "",
					"panelBorder": null,
					"borderColor": "",
					"initiallyClosed": true
				},
				"integrated_edit_field10": {
					"field": "estado",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field16": {
					"field": "colonia",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field11": {
					"field": "ciudad",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field13": {
					"field": "calle",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"text": {
					"type": "text",
					"editedByRte": false,
					"label": {
						"text": "<div id=\"google-map\" style=\"height: 400px; width: 100%; margin-bottom: 10px; border: 1px solid #ccc;\"></div>\n<p><strong>Haz clic en el mapa para ubicar o arrastra el marcador.</strong></p>\n\n<script src=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyBEbOZrRNV7JiveFroZVC2AFkoMJ18VKyg&libraries=geometry,places&callback=initGoogleMap\" async defer></script>\n\n<script>\n// ====================================================================\n// 📌 1. CONFIGURACIÓN DE IDS (AJUSTA ESTOS IDS SI NO COINCIDEN)\n// ====================================================================\nconst FIELD_IDS = {\n    calle:   'value_calle_1',\n    numext:  'value_numeroext_1',\n    colonia: 'value_colonia_1',\n    ciudad:  'value_ciudad_1',\n    estado:  'value_estado_1',\n    cp:      'value_cp_1',\n    lat:     'value_lat_1',\n    lng:     'value_lng_1'\n};\n\n// ====================================================================\n// 📌 2. VARIABLES GLOBALES Y HELPERS\n// ====================================================================\nlet map;\nlet marker;\nlet geocoder;\nlet mapInitialized = false;\n\nconst $id = (id) => document.getElementById(id);\nconst safeTrim = (v) => (v || '').toString().trim();\nconst isValidLatLng = (lat, lng) => {\n    const a = Number(lat), b = Number(lng);\n    return Number.isFinite(a) && Number.isFinite(b) && a <= 90 && a >= -90 && b <= 180 && b >= -180;\n};\n\n// ====================================================================\n// 📌 3. FUNCIONES PRINCIPALES\n// ====================================================================\n\n// --- Inicialización del Mapa (Llamada por el API script) ---\nfunction initGoogleMap() {\n    if (mapInitialized) return;\n\n    const defaultCoords = { lat: 21.0038, lng: -89.6183 }; // Mérida, México como centro por defecto\n    \n    const initialLat = safeTrim($id(FIELD_IDS.lat)?.value);\n    const initialLng = safeTrim($id(FIELD_IDS.lng)?.value);\n    const initialCoords = isValidLatLng(initialLat, initialLng) \n        ? { lat: Number(initialLat), lng: Number(initialLng) } \n        : defaultCoords;\n\n    map = new google.maps.Map($id('google-map'), {\n        center: initialCoords,\n        zoom: isValidLatLng(initialLat, initialLng) ? 17 : 12,\n        mapTypeId: 'roadmap',\n        gestureHandling: 'greedy' // 🚀 Evita el molesto \"Ctrl + Scroll\"\n    });\n\n    geocoder = new google.maps.Geocoder();\n    mapInitialized = true;\n\n    // Colocar marcador si hay coordenadas iniciales\n    if (isValidLatLng(initialLat, initialLng)) {\n        placeMarker(initialCoords);\n    }\n    \n    // Listener: Al hacer CLIC en el mapa\n    map.addListener('click', (e) => {\n        placeMarker(e.latLng); \n        updateFieldsAndGeocode(e.latLng); \n    });\n    \n    // PHPRunner necesita esta línea para que el mapa se muestre correctamente en pestañas/secciones\n    setTimeout(() => google.maps.event.trigger(map, 'resize'), 300);\n}\n\n// --- Coloca el marcador y actualiza Lat/Lng al arrastrar o hacer clic ---\nfunction placeMarker(location) {\n    if (marker) {\n        marker.setPosition(location);\n    } else {\n        marker = new google.maps.Marker({\n            position: location,\n            map: map,\n            draggable: true // 📌 Permite arrastrar el marcador\n        });\n        \n        // Listener: Al terminar de arrastrar el marcador\n        marker.addListener('dragend', function() {\n            const newLocation = marker.getPosition();\n            updateFieldsAndGeocode(newLocation);\n        });\n    }\n    map.setCenter(location);\n    \n    // Si no usamos updateFieldsAndGeocode (ej. al inicio), aseguramos la posición\n    $id(FIELD_IDS.lat).value = location.lat().toFixed(6);\n    $id(FIELD_IDS.lng).value = location.lng().toFixed(6);\n}\n\n// --- Función central: Actualiza campos y pide Geocodificación Inversa ---\nfunction updateFieldsAndGeocode(location) {\n    // 1. Actualiza campos Lat/Lng\n    $id(FIELD_IDS.lat).value = location.lat().toFixed(6);\n    $id(FIELD_IDS.lng).value = location.lng().toFixed(6);\n    \n    // 2. Realiza la geocodificación inversa (Lat/Lng -> Dirección)\n    reverseGeocode(location);\n}\n\n// --- Geocodificación Inversa (Lat/Lng -> Dirección) ---\nfunction reverseGeocode(latLng) {\n    if (!geocoder) return;\n\n    geocoder.geocode({ location: latLng })\n        .then((response) => {\n            if (response.results[0]) {\n                populateAddressFields(response.results[0]);\n            }\n        })\n        .catch((e) => console.error('Falló la geocodificación inversa:', e));\n}\n\nfunction getAddressComponent(components, type) {\n    const component = components.find(c => c.types.includes(type));\n    return component ? component.long_name : '';\n}\n\nfunction populateAddressFields(result) {\n    const components = result.address_components;\n    \n    // Obtener componentes específicos de Google Maps\n    const street = getAddressComponent(components, 'route');\n    const houseNumber = getAddressComponent(components, 'street_number');\n    const neighborhood = getAddressComponent(components, 'sublocality_level_1') || getAddressComponent(components, 'neighborhood');\n    const city = getAddressComponent(components, 'locality') || getAddressComponent(components, 'administrative_area_level_2');\n    const state = getAddressComponent(components, 'administrative_area_level_1');\n    const postalCode = getAddressComponent(components, 'postal_code');\n\n    // Llenar los campos del formulario\n    if ($id(FIELD_IDS.estado)) $id(FIELD_IDS.estado).value = state;\n    if ($id(FIELD_IDS.ciudad)) $id(FIELD_IDS.ciudad).value = city;\n    if ($id(FIELD_IDS.cp)) $id(FIELD_IDS.cp).value = postalCode;\n    if ($id(FIELD_IDS.colonia)) $id(FIELD_IDS.colonia).value = neighborhood;\n    if ($id(FIELD_IDS.calle)) $id(FIELD_IDS.calle).value = street;\n    if ($id(FIELD_IDS.numext)) $id(FIELD_IDS.numext).value = houseNumber;\n}\n\n// --- Geocodificación (Dirección -> Lat/Lng) desde campos de texto ---\nfunction geocodeAddressFromFields() {\n    const calle = safeTrim($id(FIELD_IDS.calle)?.value);\n    const numext = safeTrim($id(FIELD_IDS.numext)?.value);\n    const colonia = safeTrim($id(FIELD_IDS.colonia)?.value);\n    const ciudad = safeTrim($id(FIELD_IDS.ciudad)?.value) || '';\n    const estado = safeTrim($id(FIELD_IDS.estado)?.value) || '';\n    const cp = safeTrim($id(FIELD_IDS.cp)?.value);\n\n    const addressParts = [\n        calle + (numext ? ' ' + numext : ''),\n        colonia,\n        ciudad,\n        estado,\n        cp,\n        'México'\n    ].filter(Boolean);\n    \n    const address = addressParts.join(', ');\n\n    if (!address || !geocoder || (!calle && !colonia)) return;\n\n    geocoder.geocode({ address: address })\n        .then((response) => {\n            if (response.results[0]) {\n                const location = response.results[0].geometry.location;\n                placeMarker(location);\n                map.setZoom(17);\n            }\n        })\n        .catch((e) => console.error('Geocoding falló por:', e));\n}\n\n\n// ====================================================================\n// 📌 4. LÓGICA DE ARRANQUE Y EVENTOS (Manejo de Tabs/Redimensionamiento)\n// ====================================================================\n\nfunction attachListeners() {\n    const addressFields = [FIELD_IDS.calle, FIELD_IDS.numext, FIELD_IDS.colonia, FIELD_IDS.ciudad, FIELD_IDS.estado, FIELD_IDS.cp];\n\n    // Observa cambios en los campos de dirección (al salir o presionar Enter)\n    addressFields.forEach(id => {\n        const el = $id(id);\n        if (!el) return;\n        \n        el.addEventListener('blur', geocodeAddressFromFields);\n        el.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter') {\n                e.preventDefault();\n                geocodeAddressFromFields();\n            }\n        });\n    });\n\n    // Observa cambios en Lat/Lng manuales para centrar el mapa\n    [FIELD_IDS.lat, FIELD_IDS.lng].forEach(id => {\n        const el = $id(id);\n        if (!el) return;\n        el.addEventListener('change', () => {\n            const lat = safeTrim($id(FIELD_IDS.lat)?.value);\n            const lng = safeTrim($id(FIELD_IDS.lng)?.value);\n            if (isValidLatLng(lat, lng)) {\n                placeMarker(new google.maps.LatLng(Number(lat), Number(lng)));\n                map.setZoom(17);\n            }\n        });\n    });\n}\n\n// Maneja la inicialización tardía en caso de que el mapa esté en una pestaña oculta\nfunction checkMapVisibility() {\n    const mapContainer = $id('google-map');\n    if (mapContainer && mapContainer.offsetParent !== null && mapContainer.offsetWidth > 0) {\n        if (!mapInitialized && typeof google !== 'undefined' && typeof google.maps !== 'undefined') {\n             // La inicialización real ocurre por el 'callback=initGoogleMap' en la URL del API\n             // Solo llamamos al resize si ya cargó\n             setTimeout(() => google.maps.event.trigger(map, 'resize'), 100);\n             return true;\n        }\n    }\n    return false;\n}\n\ndocument.addEventListener('DOMContentLoaded', function() {\n    attachListeners();\n\n    // Revisa la visibilidad al inicio\n    checkMapVisibility(); \n    \n    // Observador para cuando se cambie de pestaña\n    document.body.addEventListener('click', function(e) {\n        if (e.target.closest('[data-toggle=\"tab\"], .step-tab, .nav-link')) {\n            setTimeout(() => {\n                if (mapInitialized) google.maps.event.trigger(map, 'resize');\n                else checkMapVisibility();\n            }, 400);\n        }\n    });\n});\n</script>",
						"type": 0
					}
				},
				"integrated_edit_field17": {
					"field": "lat",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field18": {
					"field": "lng",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field14": {
					"field": "numeroext",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field15": {
					"field": "numeroint",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field31": {
					"field": "estatus",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field32": {
					"field": "fechahoraentrega",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field33": {
					"field": "totalapagar",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				}
			},
			"dbProps": {},
			"version": 13,
			"pageWidth": "standard",
			"imageItem": {
				"type": "page_image",
				"image": null
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"pageCSS": "\n/* Put  your custom CSS code here */\n\n\n\n/* ========================================================= */\n/* VARIABLES DE COLOR */\n/* ========================================================= */\n:root {\n    --color-elegante: #FFFFFF; /* Texto Blanco para contrastar con el fondo oscuro */\n    --naranja-degradado-inicio: #03478A; /* Naranja Suave (Light Salmon) */\n    --naranja-degradado-fin: #6D98C2; /* Naranja Medio (Coral) */\n    --color-borde-base: #FF7F50; /* Color simple para el borde base */\n}\n\n/* ========================================================= */\n/* 1. Fondo de la Página: Degradado Azul Cielo (Se mantiene) */\n/* ========================================================= */\nbody, .container-fluid {\nbackground: linear-gradient(180deg, #FAFAF7 0%, #D6D6D4 100%) !important;    min-height: 100vh;\n}\n\n/* ========================================================= */\n/* 2. Estilo de las Secciones: Efecto Tarjeta/Sombreado (Se mantiene) */\n/* ========================================================= */\n.panel, .rnr-c-body, .rnr-c-grid {\n    background-color: #FFFFFF !important; \n    border: none !important; \n    border-radius: 12px !important; \n    padding: 20px;\n    margin-bottom: 25px; \n    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1), \n                0 2px 6px rgba(0, 0, 0, 0.05) !important; \n                \n    /* 🔑 CAMBIO CLAVE: Agrega 'transform' a la transición */\n    transition: box-shadow 0.3s ease-in-out, \n                transform 0.3s ease-in-out; /* Transición para el movimiento y escala */            \n                \n}\n\n/* ========================================================= */\n/* 3. Estilo de Encabezados de Sección (EL CAMBIO PRINCIPAL) */\n/* ========================================================= */\n.panel-heading, .rnr-c-head {\n    /* Aplicamos el degradado al fondo completo del encabezado */\n    background: linear-gradient(to right, var(--naranja-degradado-inicio), var(--naranja-degradado-fin)) !important;\n    \n    /* El texto del título ahora es blanco para contrastar con el fondo naranja */\n    color: var(--color-elegante) !important; \n    \n    font-weight: 600;\n    \n    /* Mantenemos el centrado vertical */\n    display: flex;\n    align-items: center;\n    height: 40px; /* Aseguramos una altura suficiente */\n    \n    /* Eliminamos el borde degradado y aplicamos un borde simple y fino abajo */\n    border-bottom: 1px solid var(--color-borde-base) !important; \n    border-image-source: none !important; /* Desactivar la propiedad border-image anterior */\n    \n    /* Ajustes de relleno/bordes para que el degradado se vea bien */\n    padding: 0 15px !important; \n    border-top-left-radius: 12px !important; /* Mantenemos el radio del panel superior */\n    border-top-right-radius: 12px !important;\n}\n\n/* ========================================================= */\n/* 3. Estilo de HOVER: Efecto de Elevación/Intensificación    */\n/* ========================================================= */\n.panel:hover, .rnr-c-body:hover, .rnr-c-grid:hover {\n    /* Nueva sombra más intensa y \"elevada\" */\n    box-shadow: 0 15px 400px rgba(0, 0, 0, 0.3), \n                0 5px 15px rgba(0, 0, 0, 0.1) !important; \n    \n    /* Pequeño movimiento hacia arriba para dar más sensación de elevación (opcional) */\n    transform: translateY(-5px) scale(1.005); \n}\n\n\n\n/* 4. Estilo de los Inputs (Se mantiene) */\n.form-control {\n    border-radius: 8px !important; \n    border: 1px solid #e0e0e0 !important;\n}\n.form-control:focus {\n    border-color: #48C9B0 !important; \n    box-shadow: 0 0 0 0.2rem rgba(72, 201, 176, 0.25) !important;\n}\n\n/* Aplica solo a formularios con esas secciones */\n.panel.panel-default.form-section > .panel-body { display: none; }\n\n.panel.panel-default.form-section > .panel-heading:hover {\n  cursor: pointer;\n  filter: brightness(0.98);\n}\n\n.panel-collapse.no-bs-trans {\n  transition: none !important;\n}\n\n/* ========================================================= */\n/* ARREGLO DE COLOR DE TEXTO DE ENCABEZADO DURANTE MODAL     */\n/* ========================================================= */\n\n/* Apuntamos directamente al panel-title, que es el elemento que contiene \n   el texto del encabezado de la sección. \n*/\n.panel-heading .panel-title {\n    color: #FFFFFF !important; \n}\n\n/* Si dentro del panel-title hay un enlace (Ej. si el encabezado permite colapsar/expandir \n   y el título es un <a>), también debemos forzar el color del enlace.\n*/\n.panel-heading .panel-title a {\n    color: #FFFFFF !important;\n}\n\n/* Asegurar que el texto dentro del panel-title no se vea afectado por reglas generales\n   que usen el estado 'modal-open' en el cuerpo de la página.\n*/\n.modal-open .panel-heading .panel-title {\n    color: #FFFFFF !important;\n}\n\n/* Fuerza el tamaño correcto en todo el formulario */\n.r-edit-form {\n    font-size: 14px !important;\n}\n\n.r-edit-form label,\n.r-edit-form input,\n.r-edit-form select {\n    font-size: 14px !important;\n}",
			"listTotals": 1,
			"customHtml": "",
			"title": {}
		},
		{
			"id": "view",
			"type": "view",
			"layoutId": "nomenu",
			"disabled": true,
			"default": 0,
			"forms": {
				"above-grid": {
					"modelId": "view-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1",
									"colspan": 2
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "view-below-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"view_back_list",
								"view_close"
							]
						},
						"c2": {
							"model": "c2",
							"items": [
								"hamburger"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "view-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"view_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-edit",
					"grid": [
						{
							"cells": [
								{
									"cell": "c3"
								},
								{
									"cell": "c"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c4",
									"colspan": 2,
									"rowspan": 1
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c5",
									"colspan": 2
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c3": {
							"model": "c3",
							"items": [
								"section"
							],
							"border": [
								{
									"side": "",
									"width": "0"
								}
							],
							"padding": {
								"right": "10px"
							}
						},
						"c": {
							"model": "c3",
							"items": [
								"section1"
							]
						},
						"c4": {
							"model": "c3",
							"items": [
								"section2"
							]
						},
						"c5": {
							"model": "c3",
							"items": [
								"integrated_edit_field17",
								"integrated_edit_field18",
								"integrated_edit_field19",
								"integrated_edit_field20",
								"integrated_edit_field21",
								"integrated_edit_field22",
								"integrated_edit_field23",
								"integrated_edit_field24",
								"integrated_edit_field25",
								"integrated_edit_field26",
								"integrated_edit_field27",
								"integrated_edit_field28",
								"integrated_edit_field29",
								"integrated_edit_field30",
								"integrated_edit_field31",
								"integrated_edit_field32",
								"integrated_edit_field33",
								"integrated_edit_field34"
							]
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section": {
					"modelId": "simple-edit",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"integrated_edit_field3",
								"integrated_edit_field4",
								"integrated_edit_field5",
								"integrated_edit_field1",
								"integrated_edit_field6",
								"integrated_edit_field9"
							]
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section1": {
					"modelId": "simple-edit",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"integrated_edit_field",
								"integrated_edit_field2",
								"integrated_edit_field7",
								"integrated_edit_field8"
							]
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section2": {
					"modelId": "simple-edit",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"integrated_edit_field13",
								"integrated_edit_field14",
								"integrated_edit_field15",
								"integrated_edit_field16"
							]
						},
						"c": {
							"model": "c1",
							"items": [
								"integrated_edit_field11",
								"integrated_edit_field10",
								"integrated_edit_field12",
								"text"
							]
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				}
			},
			"items": {
				"view_header": {
					"type": "view_header"
				},
				"view_back_list": {
					"type": "view_back_list"
				},
				"view_close": {
					"type": "view_close"
				},
				"hamburger": {
					"type": "hamburger",
					"items": [
						"view_edit"
					]
				},
				"view_edit": {
					"type": "view_edit"
				},
				"section": {
					"type": "section",
					"title": {
						"type": 0,
						"text": "Datos del cliente"
					},
					"location": "section",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "#3e58f3",
					"headerColor": "#f9f6c1",
					"bodyBg": "#565050",
					"bodyColor": "#f3f3f2",
					"panelBorder": "1px",
					"borderColor": "#d7f5e2"
				},
				"integrated_edit_field3": {
					"field": "idcliente",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idcliente",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field4": {
					"field": "paterno",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "paterno",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field5": {
					"field": "materno",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "materno",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field1": {
					"field": "nombre",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "nombre",
						"table": "solicitudes",
						"type": 5
					},
					"label": {
						"field": "nombre",
						"table": "solicitudes",
						"type": 3
					}
				},
				"integrated_edit_field6": {
					"field": "rfc",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field9": {
					"field": "idcli",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"section1": {
					"type": "section",
					"title": {
						"type": 0,
						"text": "Datos de la solicitud"
					},
					"location": "section1",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "#3e58f3",
					"headerColor": "#f9f6c1",
					"bodyBg": "#565050",
					"bodyColor": "#f3f3f2",
					"panelBorder": "1px",
					"borderColor": "#d7f5e2"
				},
				"integrated_edit_field": {
					"field": "idproducto",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idproducto",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field2": {
					"field": "idplan",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idplan",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field7": {
					"field": "orden",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "orden",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field8": {
					"field": "plazo",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "plazo",
						"table": "solicitudes",
						"type": 5
					}
				},
				"section2": {
					"type": "section",
					"title": {
						"type": 0,
						"text": "Datos de entrega"
					},
					"location": "section2",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "#3e58f3",
					"headerColor": "#f9f6c1",
					"bodyBg": "#565050",
					"bodyColor": "#f3f3f2",
					"panelBorder": "1px",
					"borderColor": "#d7f5e2"
				},
				"integrated_edit_field13": {
					"field": "calle",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field14": {
					"field": "numeroext",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field15": {
					"field": "numeroint",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field16": {
					"field": "colonia",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field11": {
					"field": "ciudad",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field10": {
					"field": "estado",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field12": {
					"field": "cp",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"text": {
					"type": "text",
					"label": {
						"text": "<div id=\"map\" style=\"height: 400px; width: 100%; margin-bottom: 10px; border: 1px solid #ccc;\"></div>\n<p><strong>Haz clic en el mapa para establecer la ubicación.</strong></p>\n\n<!-- Cargar la API de Google Maps (Reemplaza TU_API_KEY) -->\n<script src=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyA2P1eBUfOvpeXBIWM5t5Drg3EjZc25Tzs&callback=initMap&libraries=places&v=weekly\" async defer></script>\n\n<script>\n// Variables globales\nlet map;\nlet marker;\nlet geocoder;\n\nfunction initMap() {\n    // Coordenadas iniciales\n    const initialLocation = { lat: 21.0038, lng: -89.6183 };\n    // Crear el mapa\n    map = new google.maps.Map(document.getElementById(\"map\"), {\n        zoom: 12,\n        center: initialLocation,\n        mapTypeId: google.maps.MapTypeId.ROADMAP\n    });\n    // Inicializar el geocoder\n    geocoder = new google.maps.Geocoder();\n    // Escuchar el evento de clic en el mapa\n    map.addListener('click', function(event) {\n        placeMarkerAndGeocode(event.latLng);\n    });\n}\n\nfunction placeMarkerAndGeocode(location) {\n    // Limpiar el marcador anterior si existe\n    if (marker) {\n        marker.setMap(null);\n    }\n    // Colocar un nuevo marcador\n    marker = new google.maps.Marker({\n        position: location,\n        map: map\n    });\n    // Centrar el mapa en la nueva ubicación\n    map.panTo(location);\n    // Obtener la dirección a partir de las coordenadas (Geocodificación Inversa)\n    geocoder.geocode({ 'location': location }, function(results, status) {\n        if (status === 'OK') {\n            if (results[0]) {\n                // Llenar los campos del formulario con los datos obtenidos\n                populateAddressFields(results[0]);\n            } else {\n                alert('No se encontraron resultados para esta ubicación.');\n            }\n        } else {\n            alert('Falló la geocodificación: ' + status);\n        }\n    });\n}\n\nfunction populateAddressFields(addressData) {\n    // Esta función descompone la respuesta de geocodificación y llena los campos.\n    // La estructura de 'address_components' puede variar, ¡debes ajustarla!\n    \n    let addressComponents = addressData.address_components;\n    let addressLookup = {};\n    \n    // Crear un objeto fácil de buscar a partir de los componentes\n    addressComponents.forEach(component => {\n        component.types.forEach(type => {\n            addressLookup[type] = component.long_name;\n        });\n    });\n    // Llenar los campos del formulario de PHPRunner.\n    // ¡IMPORTANTE! Reemplaza 'Editbox1' con los nombres REALES de tus campos.\n    // Puedes encontrar el nombre real del campo en la pestaña \"Fields\" de PHPRunner.\n    \n    // Usar getElementById o un selector por nombre\n    document.getElementById('value_estado_1').value = addressLookup['administrative_area_level_1'] || ''; // Estado\n    document.getElementById('value_ciudad_1').value = addressLookup['locality'] || addressLookup['administrative_area_level_2'] || ''; // Ciudad o Municipio\n    document.getElementById('value_cp_1').value = addressLookup['postal_code'] || ''; // Código Postal\n    document.getElementById('value_colonia_1').value = addressLookup['sublocality_level_1'] || addressLookup['neighborhood'] || ''; // Colonia\n    document.getElementById('value_calle_1').value = getRoute(addressComponents) || ''; // Calle\n}\n\n// Función de ayuda para obtener el nombre de la calle\nfunction getRoute(components) {\n    for (let i = 0; i < components.length; i++) {\n        if (components[i].types.includes('route')) {\n            return components[i].long_name;\n        }\n    }\n    return '';\n}\n// Inicializar el mapa cuando la página esté cargada\n// Google Maps llama a 'initMap' automáticamente por el callback en la URL de la API\n</script>",
						"type": 0
					},
					"editedByRte": false
				},
				"integrated_edit_field17": {
					"field": "idtipoventa",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field18": {
					"field": "dn",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field19": {
					"field": "cuenta",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field20": {
					"field": "contrato",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field21": {
					"field": "contratoportal",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field22": {
					"field": "plazopendiente",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field23": {
					"field": "factura",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field24": {
					"field": "fechavenci",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field25": {
					"field": "ciclo",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field26": {
					"field": "dnpreferido",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field27": {
					"field": "lat",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field28": {
					"field": "lng",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field29": {
					"field": "noserie",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field30": {
					"field": "renta",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field31": {
					"field": "ine",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field32": {
					"field": "cartaburocredito",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field33": {
					"field": "polizaseguro",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field34": {
					"field": "contratodocto",
					"type": "integrated_edit_field",
					"orientation": 0
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {}
		},
		{
			"id": "list",
			"type": "list",
			"layoutId": "leftbar",
			"disabled": false,
			"default": 0,
			"forms": {
				"above-grid": {
					"modelId": "list-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c2"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c3"
								},
								{
									"cell": "c4"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"add",
								"inline_save_all",
								"inline_cancel_all",
								"delete"
							]
						},
						"c2": {
							"model": "c2",
							"items": [
								"text1",
								"snippet",
								"text",
								"snippet1",
								"details_found",
								"page_size",
								"print_details"
							]
						},
						"c3": {
							"model": "c3",
							"items": []
						},
						"c4": {
							"model": "c4",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "list-below-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"pagination"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"left": {
					"modelId": "leftbar-menu",
					"grid": [
						{
							"cells": [
								{
									"cell": "c0"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c0": {
							"model": "c0",
							"items": [
								"logo",
								"expand_button"
							]
						},
						"c1": {
							"model": "c1",
							"items": [
								"menu",
								"search_panel"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"supertop": {
					"modelId": "leftbar-top",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"expand_menu_button",
								"collapse_button",
								"breadcrumb"
							]
						},
						"c2": {
							"model": "c2",
							"items": [
								"simple_search",
								"list_options",
								"loginform_login",
								"username_button"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "list-sidebar-top",
					"grid": [],
					"cells": {},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "horizontal-grid",
					"grid": [
						{
							"section": "head",
							"cells": [
								{
									"cell": "headcell_icons"
								},
								{
									"cell": "headcell_checkbox"
								},
								{
									"cell": "headcell_details"
								},
								{
									"cell": "headcell_field2"
								},
								{
									"cell": "headcell_field22"
								},
								{
									"cell": "headcell_field27"
								},
								{
									"cell": "headcell_field19"
								},
								{
									"cell": "headcell_field3"
								},
								{
									"cell": "headcell_field17"
								},
								{
									"cell": "headcell_field4"
								},
								{
									"cell": "headcell_field12",
									"colspan": 1
								},
								{
									"cell": "headcell_field30"
								},
								{
									"cell": "headcell_field"
								},
								{
									"cell": "headcell_field7"
								},
								{
									"cell": "headcell_field8"
								},
								{
									"cell": "headcell_field10"
								},
								{
									"cell": "headcell_field32"
								},
								{
									"cell": "headcell_field1"
								},
								{
									"cell": "headcell_field16"
								},
								{
									"cell": "headcell_field18"
								},
								{
									"cell": "headcell_field20"
								},
								{
									"cell": "headcell_field21"
								},
								{
									"cell": "headcell_field24"
								},
								{
									"cell": "headcell_field25"
								},
								{
									"cell": "headcell_field28"
								},
								{
									"cell": "headcell_field29"
								},
								{
									"cell": "headcell_field26"
								},
								{
									"cell": "headcell_field9"
								},
								{
									"cell": "headcell_field13"
								},
								{
									"cell": "headcell_field23"
								},
								{
									"cell": "headcell_field31"
								},
								{
									"cell": "headcell_field34"
								},
								{
									"cell": "headcell_field35"
								}
							]
						},
						{
							"section": "body",
							"cells": [
								{
									"cell": "cell_icons",
									"rowspan": 2
								},
								{
									"cell": "cell_checkbox",
									"rowspan": 2
								},
								{
									"cell": "cell_details"
								},
								{
									"cell": "cell_field2",
									"rowspan": 2
								},
								{
									"cell": "cell_field14",
									"rowspan": 2
								},
								{
									"cell": "cell_field19",
									"rowspan": 2
								},
								{
									"cell": "cell_field10",
									"rowspan": 2
								},
								{
									"cell": "headcell_field5",
									"rowspan": 2
								},
								{
									"cell": "headcell_field15",
									"rowspan": 2
								},
								{
									"cell": "cell_field4",
									"rowspan": 2
								},
								{
									"cell": "cell_field12"
								},
								{
									"cell": "cell_field22"
								},
								{
									"cell": "cell_field"
								},
								{
									"cell": "cell_field24",
									"rowspan": 2
								},
								{
									"cell": "cell_field5",
									"rowspan": 2
								},
								{
									"cell": "headcell_field11",
									"rowspan": 2
								},
								{
									"cell": "headcell_field33",
									"rowspan": 2
								},
								{
									"cell": "cell_field1",
									"rowspan": 2
								},
								{
									"cell": "cell_field8",
									"rowspan": 2
								},
								{
									"cell": "cell_field9",
									"rowspan": 2
								},
								{
									"cell": "cell_field11",
									"rowspan": 2
								},
								{
									"cell": "cell_field13",
									"rowspan": 2
								},
								{
									"cell": "cell_field16",
									"rowspan": 2
								},
								{
									"cell": "cell_field17",
									"rowspan": 2
								},
								{
									"cell": "cell_field20",
									"rowspan": 2
								},
								{
									"cell": "cell_field21",
									"rowspan": 2
								},
								{
									"cell": "cell_field18",
									"rowspan": 2
								},
								{
									"cell": "cell_field6",
									"rowspan": 2
								},
								{
									"cell": "cell_field7",
									"rowspan": 2
								},
								{
									"cell": "cell_field15",
									"rowspan": 2
								},
								{
									"cell": "cell_field3",
									"rowspan": 2
								},
								{
									"cell": "cell_field25",
									"rowspan": 2
								},
								{
									"cell": "cell_field26",
									"rowspan": 2
								}
							]
						},
						{
							"section": "body",
							"cells": [
								{
									"cell": "cell_details1"
								},
								{
									"cell": "cell_field23",
									"colspan": 3
								}
							]
						},
						{
							"section": "foot",
							"cells": [
								{
									"cell": "footcell_icons"
								},
								{
									"cell": "footcell_checkbox"
								},
								{
									"cell": "footcell_details"
								},
								{
									"cell": "footcell_field2",
									"colspan": 4
								},
								{
									"cell": "headcell_field6",
									"colspan": 2
								},
								{
									"cell": "footcell_field4"
								},
								{
									"cell": "footcell_field12",
									"colspan": 2
								},
								{
									"cell": "footcell_field"
								},
								{
									"cell": "footcell_field3",
									"colspan": 2
								},
								{
									"cell": "headcell_field14",
									"colspan": 2
								},
								{
									"cell": "footcell_field1"
								},
								{
									"cell": "footcell_field8"
								},
								{
									"cell": "footcell_field9"
								},
								{
									"cell": "footcell_field10"
								},
								{
									"cell": "footcell_field11"
								},
								{
									"cell": "footcell_field14"
								},
								{
									"cell": "footcell_field15",
									"colspan": 4
								},
								{
									"cell": "footcell_field6"
								},
								{
									"cell": "footcell_field7"
								},
								{
									"cell": "footcell_field13"
								},
								{
									"cell": "footcell_field5"
								},
								{
									"cell": "footcell_field16"
								},
								{
									"cell": "footcell_field17"
								}
							]
						}
					],
					"cells": {
						"headcell_field2": {
							"model": "headcell_field",
							"items": [
								"text3"
							],
							"field": "",
							"columnName": "",
							"align": "center"
						},
						"cell_field2": {
							"model": "cell_field",
							"items": [
								"btnCarta"
							],
							"field": "",
							"columnName": "",
							"align": "center"
						},
						"footcell_field2": {
							"model": "footcell_field",
							"items": [],
							"columnName": "",
							"field": ""
						},
						"headcell_field4": {
							"model": "headcell_field",
							"items": [
								"grid_field_label"
							],
							"field": "descripcion",
							"columnName": "field"
						},
						"cell_field4": {
							"model": "cell_field",
							"items": [
								"grid_field"
							],
							"field": "descripcion",
							"columnName": "field"
						},
						"footcell_field4": {
							"model": "footcell_field",
							"items": [],
							"columnName": "field",
							"field": "descripcion"
						},
						"headcell_field12": {
							"model": "headcell_field",
							"items": [
								"simple_grid_field41"
							],
							"field": "",
							"columnName": "",
							"align": "center"
						},
						"cell_field12": {
							"model": "cell_field",
							"items": [
								"simple_grid_field12"
							],
							"field": "",
							"columnName": "",
							"nowrap": false,
							"align": "center"
						},
						"footcell_field12": {
							"model": "footcell_field",
							"items": [],
							"columnName": "",
							"field": ""
						},
						"headcell_checkbox": {
							"model": "headcell_checkbox",
							"items": [
								"grid_checkbox_head"
							],
							"columnName": "checkbox",
							"field": ""
						},
						"cell_checkbox": {
							"model": "cell_checkbox",
							"items": [
								"grid_checkbox"
							],
							"columnName": "checkbox",
							"field": ""
						},
						"footcell_checkbox": {
							"model": "footcell_checkbox",
							"items": [],
							"columnName": "checkbox",
							"field": ""
						},
						"headcell_icons": {
							"model": "headcell_icons",
							"items": [],
							"columnName": "list-icons",
							"field": ""
						},
						"cell_icons": {
							"model": "cell_icons",
							"items": [
								"grid_edit",
								"grid_inline_edit",
								"grid_inline_save",
								"grid_inline_cancel"
							],
							"orientation": "horizontal",
							"columnName": "list-icons",
							"field": ""
						},
						"footcell_icons": {
							"model": "footcell_icons",
							"items": [],
							"columnName": "list-icons",
							"field": ""
						},
						"headcell_field": {
							"model": "headcell_field",
							"items": [
								"grid_field_label2"
							],
							"field": "",
							"columnName": "",
							"align": "center"
						},
						"cell_field": {
							"model": "cell_field",
							"items": [
								"grid_field2"
							],
							"field": "",
							"columnName": "",
							"align": "center"
						},
						"footcell_field": {
							"model": "footcell_field",
							"items": [],
							"columnName": "",
							"field": ""
						},
						"headcell_field3": {
							"model": "headcell_field",
							"items": [
								"simple_grid_field33"
							],
							"field": "",
							"columnName": ""
						},
						"headcell_field5": {
							"model": "cell_field",
							"items": [
								"simple_grid_field4"
							],
							"field": "",
							"columnName": ""
						},
						"headcell_field6": {
							"model": "footcell_field",
							"items": [],
							"columnName": "",
							"field": ""
						},
						"headcell_field7": {
							"model": "headcell_field",
							"items": [],
							"field": "",
							"columnName": ""
						},
						"footcell_field3": {
							"model": "footcell_field",
							"items": [],
							"columnName": "",
							"field": ""
						},
						"headcell_field10": {
							"model": "headcell_field",
							"items": [
								"grid_field_label17"
							],
							"columnName": "",
							"field": ""
						},
						"headcell_field11": {
							"model": "cell_field",
							"items": [
								"grid_field17"
							],
							"columnName": "",
							"field": ""
						},
						"headcell_field14": {
							"model": "footcell_field",
							"items": [],
							"columnName": "",
							"field": ""
						},
						"headcell_field15": {
							"model": "cell_field",
							"items": [
								"grid_field5"
							],
							"field": "",
							"columnName": ""
						},
						"headcell_field17": {
							"model": "headcell_field",
							"items": [
								"grid_field_label5"
							],
							"field": "",
							"columnName": ""
						},
						"headcell_field1": {
							"model": "headcell_field",
							"items": [
								"grid_field_label1"
							],
							"field": "simcard",
							"columnName": "field"
						},
						"cell_field1": {
							"model": "cell_field",
							"items": [
								"grid_field1"
							],
							"field": "simcard",
							"columnName": "field"
						},
						"footcell_field1": {
							"model": "footcell_field",
							"items": [],
							"field": "simcard",
							"columnName": "field"
						},
						"headcell_field16": {
							"model": "headcell_field",
							"items": [
								"grid_field_label6"
							],
							"field": "idtienda",
							"columnName": "field"
						},
						"cell_field8": {
							"model": "cell_field",
							"items": [
								"grid_field6"
							],
							"field": "idtienda",
							"columnName": "field"
						},
						"footcell_field8": {
							"model": "footcell_field",
							"items": [],
							"field": "idtienda",
							"columnName": "field"
						},
						"headcell_field18": {
							"model": "headcell_field",
							"items": [
								"grid_field_label7"
							],
							"field": "usuario",
							"columnName": "field"
						},
						"cell_field9": {
							"model": "cell_field",
							"items": [
								"grid_field7"
							],
							"field": "usuario",
							"columnName": "field"
						},
						"footcell_field9": {
							"model": "footcell_field",
							"items": [],
							"field": "usuario",
							"columnName": "field"
						},
						"headcell_field19": {
							"model": "headcell_field",
							"items": [
								"simple_grid_field31"
							],
							"field": "",
							"columnName": ""
						},
						"cell_field10": {
							"model": "cell_field",
							"items": [
								"simple_grid_field2"
							],
							"field": "",
							"columnName": ""
						},
						"headcell_field20": {
							"model": "headcell_field",
							"items": [
								"grid_field_label8"
							],
							"field": "idsolicitud",
							"columnName": "field"
						},
						"cell_field11": {
							"model": "cell_field",
							"items": [
								"grid_field8"
							],
							"field": "idsolicitud",
							"columnName": "field"
						},
						"footcell_field10": {
							"model": "footcell_field",
							"items": [],
							"field": "idsolicitud",
							"columnName": "field"
						},
						"headcell_field21": {
							"model": "headcell_field",
							"items": [
								"grid_field_label9"
							],
							"field": "nombre_completo",
							"columnName": "field"
						},
						"cell_field13": {
							"model": "cell_field",
							"items": [
								"grid_field9"
							],
							"field": "nombre_completo",
							"columnName": "field"
						},
						"footcell_field11": {
							"model": "footcell_field",
							"items": [],
							"field": "nombre_completo",
							"columnName": "field"
						},
						"cell_field14": {
							"model": "cell_field",
							"items": [
								"btnChkList"
							],
							"field": "",
							"columnName": "",
							"align": "center"
						},
						"headcell_field22": {
							"model": "headcell_field",
							"items": [
								"text4"
							],
							"field": "",
							"columnName": "",
							"align": "center"
						},
						"headcell_field24": {
							"model": "headcell_field",
							"items": [
								"grid_field_label10"
							],
							"field": "contratolog",
							"columnName": "field"
						},
						"cell_field16": {
							"model": "cell_field",
							"items": [
								"grid_field10"
							],
							"field": "contratolog",
							"columnName": "field",
							"align": "center"
						},
						"footcell_field14": {
							"model": "footcell_field",
							"items": [],
							"field": "contratolog",
							"columnName": "field"
						},
						"headcell_field25": {
							"model": "headcell_field",
							"items": [
								"grid_field_label11"
							],
							"field": "",
							"columnName": ""
						},
						"cell_field17": {
							"model": "cell_field",
							"items": [
								"grid_field11"
							],
							"field": "",
							"columnName": "",
							"align": "center"
						},
						"footcell_field15": {
							"model": "footcell_field",
							"items": [],
							"field": "",
							"columnName": ""
						},
						"cell_field18": {
							"model": "cell_field",
							"items": [
								"grid_details_link"
							],
							"field": "",
							"columnName": "",
							"align": "center"
						},
						"headcell_field26": {
							"model": "headcell_field",
							"items": [
								"text2"
							],
							"field": "",
							"columnName": ""
						},
						"headcell_field9": {
							"model": "headcell_field",
							"items": [
								"grid_field_label12"
							],
							"field": "cartaburocredito",
							"columnName": "field"
						},
						"cell_field6": {
							"model": "cell_field",
							"items": [
								"grid_field12"
							],
							"field": "cartaburocredito",
							"columnName": "field"
						},
						"footcell_field6": {
							"model": "footcell_field",
							"items": [],
							"field": "cartaburocredito",
							"columnName": "field"
						},
						"headcell_field13": {
							"model": "headcell_field",
							"items": [
								"grid_field_label13"
							],
							"field": "polizaseguro",
							"columnName": "field"
						},
						"cell_field7": {
							"model": "cell_field",
							"items": [
								"grid_field13"
							],
							"field": "polizaseguro",
							"columnName": "field"
						},
						"footcell_field7": {
							"model": "footcell_field",
							"items": [],
							"field": "polizaseguro",
							"columnName": "field"
						},
						"headcell_field23": {
							"model": "headcell_field",
							"items": [
								"grid_field_label14"
							],
							"field": "contratodocto",
							"columnName": "field"
						},
						"cell_field15": {
							"model": "cell_field",
							"items": [
								"grid_field14"
							],
							"field": "contratodocto",
							"columnName": "field"
						},
						"footcell_field13": {
							"model": "footcell_field",
							"items": [],
							"field": "contratodocto",
							"columnName": "field"
						},
						"headcell_field27": {
							"model": "headcell_field",
							"items": [
								"grid_field_label4"
							],
							"field": "",
							"columnName": "",
							"align": "center"
						},
						"cell_field19": {
							"model": "cell_field",
							"items": [
								"grid_field4"
							],
							"field": "",
							"columnName": "",
							"align": "center"
						},
						"headcell_field28": {
							"model": "headcell_field",
							"items": [
								"grid_field_label15"
							],
							"field": "",
							"columnName": ""
						},
						"cell_field20": {
							"model": "cell_field",
							"items": [
								"grid_field15"
							],
							"field": "",
							"columnName": "",
							"align": "center"
						},
						"headcell_field29": {
							"model": "headcell_field",
							"items": [
								"grid_field_label16"
							],
							"field": "",
							"columnName": ""
						},
						"cell_field21": {
							"model": "cell_field",
							"items": [
								"grid_field16"
							],
							"field": "",
							"columnName": "",
							"align": "center"
						},
						"headcell_field30": {
							"model": "headcell_field",
							"items": [],
							"field": "",
							"columnName": ""
						},
						"cell_field22": {
							"model": "cell_field",
							"items": [
								"btnDecision"
							],
							"field": "",
							"columnName": "",
							"align": "center"
						},
						"headcell_details": {
							"model": "headcell_details",
							"items": [],
							"columnName": "details",
							"field": ""
						},
						"cell_details": {
							"model": "cell_details",
							"items": [
								"grid_alldetails_link",
								"grid_details_link1",
								"grid_details_link3",
								"grid_details_link2"
							],
							"columnName": "details",
							"field": ""
						},
						"footcell_details": {
							"model": "footcell_details",
							"items": [],
							"columnName": "details",
							"field": ""
						},
						"headcell_field8": {
							"model": "headcell_field",
							"items": [
								"simple_grid_field39"
							],
							"field": "",
							"columnName": ""
						},
						"cell_field5": {
							"model": "cell_field",
							"items": [
								"simple_grid_field10"
							],
							"field": "",
							"columnName": "",
							"align": "center",
							"bold": true,
							"underline": true
						},
						"cell_details1": {
							"model": "cell_details",
							"items": [],
							"columnName": "details",
							"field": ""
						},
						"cell_field23": {
							"model": "cell_field",
							"items": [
								"details_preview",
								"details_preview1",
								"details_preview2"
							],
							"field": "",
							"columnName": "",
							"nowrap": false,
							"align": "center"
						},
						"cell_field24": {
							"model": "cell_field",
							"items": [
								"btnEstatusEntrega"
							],
							"field": "",
							"columnName": "",
							"align": "center",
							"bold": true,
							"underline": true
						},
						"headcell_field31": {
							"model": "headcell_field",
							"items": [],
							"field": "",
							"columnName": ""
						},
						"cell_field3": {
							"model": "cell_field",
							"items": [],
							"field": "",
							"columnName": ""
						},
						"footcell_field5": {
							"model": "footcell_field",
							"items": [],
							"field": "",
							"columnName": ""
						},
						"headcell_field32": {
							"model": "headcell_field",
							"items": [
								"grid_field_label3"
							],
							"columnName": "",
							"field": ""
						},
						"headcell_field33": {
							"model": "cell_field",
							"items": [
								"grid_field3"
							],
							"columnName": "",
							"field": ""
						},
						"headcell_field34": {
							"model": "headcell_field",
							"items": [
								"grid_field_label18"
							],
							"field": "direccion",
							"columnName": "field"
						},
						"cell_field25": {
							"model": "cell_field",
							"items": [
								"grid_field18"
							],
							"field": "direccion",
							"columnName": "field"
						},
						"footcell_field16": {
							"model": "footcell_field",
							"items": [],
							"field": "direccion",
							"columnName": "field"
						},
						"headcell_field35": {
							"model": "headcell_field",
							"items": [
								"grid_field_label19"
							],
							"field": "totalapagar"
						},
						"cell_field26": {
							"model": "cell_field",
							"items": [
								"grid_field19"
							],
							"field": "totalapagar"
						},
						"footcell_field17": {
							"model": "footcell_field",
							"items": [],
							"field": "totalapagar"
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				}
			},
			"items": {
				"page_size": {
					"type": "page_size"
				},
				"breadcrumb": {
					"type": "breadcrumb"
				},
				"logo": {
					"type": "logo"
				},
				"menu": {
					"type": "menu"
				},
				"simple_search": {
					"type": "simple_search"
				},
				"pagination": {
					"type": "pagination"
				},
				"details_found": {
					"type": "details_found"
				},
				"list_options": {
					"type": "list_options",
					"items": [
						"edit_selected",
						"export_selected",
						"delete_selected",
						"-10",
						"advsearch_link",
						"show_search_panel",
						"hide_search_panel",
						"-9",
						"export"
					]
				},
				"expand_menu_button": {
					"type": "expand_menu_button"
				},
				"collapse_button": {
					"type": "collapse_button"
				},
				"add": {
					"type": "add"
				},
				"export": {
					"type": "export"
				},
				"-": {
					"type": "-"
				},
				"export_selected": {
					"type": "export_selected"
				},
				"-1": {
					"type": "-"
				},
				"-2": {
					"type": "-"
				},
				"delete": {
					"type": "delete"
				},
				"delete_selected": {
					"type": "delete_selected"
				},
				"simple_grid_field2": {
					"field": "fecha",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": true
				},
				"simple_grid_field31": {
					"type": "grid_field_label",
					"field": "fecha",
					"showFilter": true
				},
				"simple_grid_field4": {
					"field": "idcliente",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": true
				},
				"simple_grid_field33": {
					"type": "grid_field_label",
					"field": "idcliente",
					"showFilter": true
				},
				"simple_grid_field10": {
					"field": "orden",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": true
				},
				"simple_grid_field39": {
					"type": "grid_field_label",
					"field": "orden",
					"showFilter": true
				},
				"simple_grid_field12": {
					"field": "estatus",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": true
				},
				"simple_grid_field41": {
					"type": "grid_field_label",
					"field": "estatus",
					"showFilter": true
				},
				"grid_checkbox": {
					"type": "grid_checkbox"
				},
				"grid_checkbox_head": {
					"type": "grid_checkbox_head"
				},
				"grid_edit": {
					"type": "grid_edit",
					"icon": {
						"glyph": "pencil"
					}
				},
				"username_button": {
					"type": "username_button",
					"items": [
						"userinfo_link",
						"logout_link",
						"adminarea_link"
					]
				},
				"loginform_login": {
					"type": "loginform_login",
					"popup": false
				},
				"userinfo_link": {
					"type": "userinfo_link"
				},
				"logout_link": {
					"type": "logout_link"
				},
				"adminarea_link": {
					"type": "adminarea_link"
				},
				"grid_field": {
					"field": "descripcion",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": true
				},
				"grid_field_label": {
					"type": "grid_field_label",
					"field": "descripcion",
					"showFilter": true
				},
				"-3": {
					"type": "-"
				},
				"edit_selected": {
					"type": "edit_selected"
				},
				"grid_inline_edit": {
					"type": "grid_inline_edit"
				},
				"grid_inline_save": {
					"type": "grid_inline_save",
					"icon": {
						"glyph": "ok"
					}
				},
				"grid_inline_cancel": {
					"type": "grid_inline_cancel"
				},
				"inline_save_all": {
					"type": "inline_save_all"
				},
				"inline_cancel_all": {
					"type": "inline_cancel_all"
				},
				"-4": {
					"type": "-"
				},
				"-5": {
					"type": "-"
				},
				"grid_field2": {
					"field": "estatusentrega",
					"type": "grid_field",
					"inlineEdit": true,
					"inlineAdd": true
				},
				"grid_field_label2": {
					"type": "grid_field_label",
					"field": "estatusentrega",
					"showFilter": true
				},
				"-6": {
					"type": "-"
				},
				"-7": {
					"type": "-"
				},
				"-8": {
					"type": "-"
				},
				"-9": {
					"type": "-"
				},
				"snippet": {
					"type": "snippet",
					"eventGid": 3482841917
				},
				"text": {
					"type": "text",
					"label": {
						"text": "-",
						"type": 0
					},
					"editedByRte": false
				},
				"snippet1": {
					"type": "snippet",
					"eventGid": 1209004018
				},
				"advsearch_link": {
					"type": "advsearch_link"
				},
				"-10": {
					"type": "-"
				},
				"text1": {
					"type": "text",
					"label": {
						"type": 0,
						"text": "Rango de fechas: "
					},
					"editedByRte": false
				},
				"grid_details_link": {
					"type": "grid_details_link",
					"table": 3847630651,
					"badge": true,
					"hideIfNone": true,
					"showCount": true,
					"icon": {}
				},
				"print_details": {
					"type": "print_details",
					"tables": {
						"2796458642": true,
						"3847630651": true
					}
				},
				"text2": {
					"type": "text",
					"label": {
						"text": "Logística",
						"type": 0
					},
					"editedByRte": false
				},
				"expand_button": {
					"type": "expand_button"
				},
				"grid_field3": {
					"field": "noserie",
					"type": "grid_field",
					"inlineEdit": false,
					"inlineAdd": false
				},
				"grid_field_label3": {
					"type": "grid_field_label",
					"field": "noserie",
					"showFilter": true
				},
				"grid_field5": {
					"field": "idtipoventa",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label5": {
					"type": "grid_field_label",
					"field": "idtipoventa",
					"showFilter": true
				},
				"grid_field1": {
					"field": "simcard",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label1": {
					"type": "grid_field_label",
					"field": "simcard",
					"showFilter": true
				},
				"grid_field6": {
					"field": "idtienda",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label6": {
					"type": "grid_field_label",
					"field": "idtienda",
					"showFilter": true
				},
				"grid_field7": {
					"field": "usuario",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label7": {
					"type": "grid_field_label",
					"field": "usuario",
					"showFilter": true
				},
				"search_panel": {
					"type": "search_panel",
					"items": [
						"search_panel_field"
					]
				},
				"show_search_panel": {
					"type": "show_search_panel"
				},
				"hide_search_panel": {
					"type": "hide_search_panel"
				},
				"search_panel_field": {
					"field": "nombre_completo",
					"type": "search_panel_field"
				},
				"grid_field8": {
					"field": "idsolicitud",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label8": {
					"type": "grid_field_label",
					"field": "idsolicitud",
					"showFilter": true
				},
				"grid_field9": {
					"field": "nombre_completo",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label9": {
					"type": "grid_field_label",
					"field": "nombre_completo",
					"showFilter": true
				},
				"text3": {
					"type": "text",
					"label": {
						"text": "Carta",
						"type": 0
					},
					"editedByRte": false
				},
				"text4": {
					"type": "text",
					"label": {
						"text": "CheckList",
						"type": 0
					},
					"editedByRte": false
				},
				"btnCarta": {
					"type": "custom_button",
					"eventGid": 1683580953,
					"label": {
						"type": 0,
						"text": ""
					},
					"icon": {
						"glyph": "envelope"
					},
					"buttonSize": "xtra-small"
				},
				"btnChkList": {
					"type": "custom_button",
					"eventGid": 324950159,
					"label": {
						"type": 0,
						"text": ""
					},
					"icon": {
						"fa": "tasks"
					},
					"buttonSize": "xtra-small"
				},
				"grid_field10": {
					"field": "contratolog",
					"type": "grid_field",
					"inlineEdit": true,
					"inlineAdd": false
				},
				"grid_field_label10": {
					"type": "grid_field_label",
					"field": "contratolog",
					"label": {
						"field": "contratolog",
						"table": "solicitudes",
						"type": 3
					},
					"showFilter": true
				},
				"grid_field11": {
					"field": "anticipolog",
					"type": "grid_field",
					"inlineEdit": true,
					"inlineAdd": false
				},
				"grid_field_label11": {
					"type": "grid_field_label",
					"field": "anticipolog",
					"showFilter": true
				},
				"grid_field4": {
					"field": "ine",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": true
				},
				"grid_field_label4": {
					"type": "grid_field_label",
					"field": "ine",
					"showFilter": true
				},
				"grid_field12": {
					"field": "cartaburocredito",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label12": {
					"type": "grid_field_label",
					"field": "cartaburocredito",
					"showFilter": true
				},
				"grid_field13": {
					"field": "polizaseguro",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label13": {
					"type": "grid_field_label",
					"field": "polizaseguro",
					"showFilter": true
				},
				"grid_field14": {
					"field": "contratodocto",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label14": {
					"type": "grid_field_label",
					"field": "contratodocto",
					"showFilter": true
				},
				"grid_field15": {
					"field": "fechahoraentrega",
					"type": "grid_field",
					"inlineEdit": true,
					"inlineAdd": false
				},
				"grid_field_label15": {
					"type": "grid_field_label",
					"field": "fechahoraentrega",
					"showFilter": true
				},
				"grid_field16": {
					"field": "maps_url",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label16": {
					"type": "grid_field_label",
					"field": "maps_url",
					"showFilter": true
				},
				"btnDecision": {
					"type": "custom_button",
					"eventGid": 281338550,
					"label": {
						"type": 0,
						"text": ""
					},
					"icon": {
						"glyph": "refresh"
					},
					"buttonStyle": "info",
					"background": "#dcdbdb",
					"buttonSize": "xtra-small"
				},
				"grid_alldetails_link": {
					"type": "grid_alldetails_link"
				},
				"grid_details_link1": {
					"type": "grid_details_link",
					"table": 2027119892,
					"badge": true,
					"hideIfNone": true,
					"icon": {}
				},
				"details_preview": {
					"type": "details_preview",
					"table": 2027119892,
					"items": [],
					"hideEmptyPreview": true,
					"proceedLink": false,
					"popup": false,
					"pageId": "list",
					"caption": {
						"page": "list",
						"table": "decisionessolicitud_historial",
						"type": 7
					}
				},
				"details_preview1": {
					"type": "deleted",
					"itemId": "details_preview1"
				},
				"grid_details_link2": {
					"type": "deleted",
					"itemId": "grid_details_link2"
				},
				"grid_details_link3": {
					"type": "grid_details_link",
					"table": 2796458642,
					"badge": true,
					"hideIfNone": true
				},
				"details_preview2": {
					"type": "details_preview",
					"table": 2796458642,
					"items": [],
					"popup": false,
					"pageId": "list",
					"caption": {
						"page": "list",
						"table": "estatusentregas_historial",
						"type": 7
					},
					"hideEmptyPreview": true
				},
				"btnEstatusEntrega": {
					"type": "custom_button",
					"eventGid": 1860920411,
					"label": {
						"type": 0,
						"text": ""
					},
					"icon": {
						"glyph": "transfer"
					},
					"buttonSize": "xtra-small",
					"customCSS": "/* Put  your custom CSS code here */\n\n:host {\n  display: none;\n}\n"
				},
				"grid_field17": {
					"field": "dn",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label17": {
					"type": "grid_field_label",
					"field": "dn"
				},
				"grid_field18": {
					"field": "direccion",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label18": {
					"type": "grid_field_label",
					"field": "direccion"
				},
				"grid_field19": {
					"field": "totalapagar",
					"type": "grid_field",
					"inlineEdit": false,
					"inlineAdd": false
				},
				"grid_field_label19": {
					"type": "grid_field_label",
					"field": "totalapagar"
				}
			},
			"dbProps": {},
			"spreadsheetGrid": false,
			"autoAddNewRecord": false,
			"version": 13,
			"pageWidth": "full",
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"pageCSS": "/* Put  your custom CSS code here */\n/*\n.table {\n    font-family: 'Arial', sans-serif !important;\n    font-size: 12px !important;\n    border-collapse: collapse !important;\n}*/\n\n\n/* ========================================================= */\n/* VARIABLES DE COLOR */\n/* ========================================================= */\n:root {\n    /* Color de acento para botones, foco y texto */\n    --color-acento: #48C9B0; /* Turquesa/Menta */ \n    --color-elegante: #1C334A; /* Azul Marino Oscuro */\n}\n\n/* ========================================================= */\n/* 1. Fondo de la Página: Degradado Azul Cielo Intenso       */\n/* ========================================================= */\nbody, .container-fluid {\n    /* Mismo fondo azul que usamos en el formulario de agregar */\n    background: linear-gradient(180deg, #E0F7FA 0%, #B3E5FC 100%) !important; \n    min-height: 100vh;\n}\n\n/* ========================================================= */\n/* 2. Contenedor de la Lista (El \"Body\" principal de la tabla) */\n/* Aplicamos el efecto de Tarjeta y Sombra a este contenedor */\n/* El selector depende del tema, pero '.rnr-b-grid' suele ser el contenedor de la tabla */\n.rnr-body .rnr-c-body, \n.rnr-b-grid, \n.rnr-c-grid,\n.panel-default {\n    background-color: #FFFFFF !important; \n    border: none !important; \n    border-radius: 12px !important; \n    \n    /* Sombreado elegante de la tarjeta */\n    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1), \n                0 2px 6px rgba(0, 0, 0, 0.05) !important; \n}\n\n/* 3. Encabezados y Barras de Herramientas (Parte superior e inferior) */\n/* Limpiamos el diseño de los paneles que rodean la tabla */\n.rnr-c-hsucc, .rnr-c-message, .rnr-c-hcell {\n    background-color: transparent !important;\n    border: none !important;\n}\n\n/* 4. Estilo de las Filas de Datos (Efecto Hover de Elevación) */\n/* Le da interactividad a la tabla */\n.rnr-body tr {\n    transition: box-shadow 0.3s ease-in-out, transform 0.3s ease-in-out;\n}\n\n.rnr-body tr:hover {\n    background-color: #fcfcfc !important; /* Ligeramente más claro al pasar el mouse */\n    \n    /* Sombra y elevación sutil para destacar la fila */\n    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1), \n                0 1px 3px rgba(0, 0, 0, 0.05) !important;\n    transform: translateY(-1px);\n}\n\n/* 5. Asegurar que las celdas del encabezado de la tabla se vean bien */\n.rnr-c-grid th {\n    background-color: #f7f7f7 !important; /* Fondo sutil para el header de la tabla */\n    color: var(--color-elegante) !important;\n    font-weight: 600;\n    border-bottom: 2px solid var(--color-acento) !important;\n}\n\n/* 6. Barras de Paginación y Búsqueda */\n.rnr-bottom .panel, .rnr-c-search, .rnr-c-top, .rnr-bottom-nav {\n    background-color: transparent !important;\n    border: none !important;\n    box-shadow: none !important; /* Quitamos la sombra a estos elementos */\n}\n\n\n\n/* ========================================================= */\n/* ESTILOS PARA CELDAS DE ESTADO (FORMATO CONDICIONAL)       */\n/* ========================================================= */\n\n/* Clase base para el estilo de \"badge\" o \"tag\" */\n.status-badge {\n    display: inline-block; /* Para que tome el tamaño del contenido */\n    padding: 5px 10px; /* Relleno interno */\n    border-radius: 20px; /* MUY REDONDEADO para el efecto de píldora */\n    font-weight: bold;\n    font-size: 0.85em;\n    text-align: center;\n    min-width: 80px; /* Ancho mínimo para que no se vea muy pequeño */\n    box-shadow: 0 1px 3px rgba(0,0,0,0.1); /* Sombra sutil */\n}\n\n/* Estado: Entregado (Verde) */\n.status-entregado {\n    background-color: #D4EDDA; /* Verde pastel claro */\n    color: #155724; /* Texto verde oscuro */\n    border: 1px solid #C3E6CB; /* Borde sutil */\n}\n\n/* Estado: Pendiente (Amarillo) */\n.status-pendiente {\n    background-color: #FFF3CD; /* Amarillo pastel claro */\n    color: #856404; /* Texto amarillo oscuro */\n    border: 1px solid #FFEEBA;\n}\n\n/* Estado: Cancelado (Rojo) */\n.status-cancelado {\n    background-color: #F8D7DA; /* Rojo pastel claro */\n    color: #721C24; /* Texto rojo oscuro */\n    border: 1px solid #F5C6CB;\n}\n\n/* Agrega más estados según sea necesario */\n/* Estado: En Proceso (Azul) */\n.status-en-proceso {\n    background-color: #D1ECF1; /* Azul pastel claro */\n    color: #0C5460; /* Texto azul oscuro */\n    border: 1px solid #BEE5EB;\n}\n\n\n/* ========================================================= */\n/* ELIMINAR SEPARADORES DE COLUMNA (LÍNEAS VERTICALES)        */\n/* ========================================================= */\n/* Mantén líneas horizontales ligeras, borra las verticales */\n.rnr-gridtable td,\n.rnr-gridtable th {\n  border-left: none !important;\n  border-right: none !important;\n  box-shadow: none !important; /* algunos temas usan sombras como divisores */\n}\n\n/* Si quieres una línea horizontal sutil */\n.rnr-gridtable td {\n  border-top: 1px solid #eee !important;\n}\n.rnr-gridtable thead th {\n  border-bottom: 1px solid #e6e6e6 !important;\n}\n",
			"listTotals": 1,
			"title": {
				"Spanish": "Estatus entregas historial"
			}
		},
		{
			"id": "print",
			"type": "print",
			"layoutId": "basic",
			"disabled": true,
			"default": 0,
			"forms": {
				"above-grid": {
					"modelId": "print-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"view_pdf"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "print-below-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "print-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c2": {
							"model": "c2",
							"items": [
								"text"
							]
						},
						"c1": {
							"model": "c1",
							"items": [
								"print_pdf"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						},
						"c2": {
							"model": "c2",
							"items": [
								"details_preview",
								"details_preview2",
								"details_preview3"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				}
			},
			"items": {
				"text": {
					"type": "text",
					"label": {
						"text": "<style>\n  @page { size: A4; margin: 20mm 18mm 22mm 18mm; }\n  body  { font-family: Arial, Helvetica, sans-serif; font-size: 12pt; color:#111; }\n  .wrap { max-width: 700px; margin: 0 auto; }\n  .hdr  { display:flex; align-items:center; gap:16px; margin-bottom: 10px; }\n  .logo { height: 48px; }\n  .ttl  { font-size: 18pt; font-weight:700; color:#222; }\n  .meta { font-size: 10.5pt; color:#333; margin: 10px 0 20px; }\n  .meta div { margin:2px 0; }\n  .body { text-align: justify; text-justify: inter-word; line-height: 1.5; }\n  .body p { margin: 0 0 10pt; }\n  .sig  { margin-top: 16pt; }\n  @media print { .hide-print { display:none !important; } }\n</style>\n\n<div class=\"wrap\">\n  <div class=\"hdr\">\n    <!-- cambia la ruta del logo o quita la img si no usas logo -->\n    <img class=\"logo\" src=\"images/logo.png\" alt=\"\">\n    <div class=\"ttl\">Carta de Bienvenida</div>\n  </div>\n\n  <div class=\"meta\">\n    <div><b>Cliente:</b> {$nombre} {$paterno} {$materno}</div>\n    <div><b>RFC:</b> {$rfc}</div>\n    <div><b>DN:</b> {$dn}</div>\n    <div><b>Plan:</b> {$plan}</div>\n    <div><b>Fecha:</b> {$fecha_hoy}</div>\n    <div><b>Solicitud #:</b> {$idsolicitud}</div>\n  </div>\n\n  <div class=\"body\">\n    <p>Estimado(a) {$nombre} {$paterno} {$materno},</p>\n    <p>\n      ¡Bienvenido(a) a <b>{$empresa}</b>! Esta carta confirma su contratación\n      del servicio <b>{$plan}</b> con número <b>{$dn}</b>. A partir de hoy, tendrá\n      acceso a los beneficios descritos en su contrato.\n    </p>\n    <p>\n      Ante cualquier duda, contáctenos al {$telefono_soporte} o vía correo {$correo_soporte}.\n      Nos encantará atenderle.\n    </p>\n    <p class=\"sig\">\n      Atentamente,<br>\n      <b>{$empresa}</b>\n    </p>\n  </div>\n\n  <!-- Botón opcional para probar desde la print page -->\n  <div class=\"hide-print\" style=\"margin-top:12px\">\n    <button onclick=\"window.print()\">Imprimir / PDF</button>\n  </div>\n</div>\n",
						"type": 0
					},
					"editedByRte": false
				},
				"print_pdf": {
					"type": "print_pdf",
					"targetPages": [],
					"splitModes": [],
					"scopes": []
				},
				"view_pdf": {
					"type": "view_pdf",
					"targetPages": [],
					"splitModes": [],
					"scopes": []
				},
				"details_preview": {
					"type": "deleted",
					"itemId": "details_preview"
				},
				"details_preview2": {
					"type": "deleted",
					"itemId": "details_preview2"
				},
				"details_preview3": {
					"type": "details_preview",
					"table": 2796458642,
					"items": [],
					"popup": false
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {}
		},
		{
			"id": "search",
			"type": "search",
			"layoutId": "nomenu",
			"disabled": false,
			"default": 0,
			"forms": {
				"above-grid": {
					"modelId": "search-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1",
									"colspan": 2
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "search-below-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"search_search",
								"search_reset",
								"search_back_list",
								"search_cancel"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "search-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"search_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-search",
					"grid": [
						{
							"cells": [
								{
									"cell": "c3"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c3": {
							"model": "c3",
							"items": [
								"integrated_search_field",
								"integrated_search_field1",
								"integrated_search_field2",
								"integrated_search_field3",
								"integrated_search_field4",
								"integrated_search_field5",
								"integrated_search_field6",
								"integrated_search_field7",
								"integrated_search_field8",
								"integrated_search_field9",
								"integrated_search_field10",
								"integrated_search_field11",
								"integrated_search_field12",
								"integrated_search_field13",
								"integrated_search_field14",
								"integrated_search_field15",
								"integrated_search_field16",
								"integrated_search_field17",
								"integrated_search_field18",
								"integrated_search_field19",
								"integrated_search_field20"
							]
						}
					},
					"deferredItems": [],
					"separateLabels": false
				}
			},
			"items": {
				"search_header": {
					"type": "search_header"
				},
				"search_reset": {
					"type": "search_reset"
				},
				"search_back_list": {
					"type": "search_back_list"
				},
				"search_search": {
					"type": "search_search"
				},
				"search_cancel": {
					"type": "search_cancel"
				},
				"integrated_search_field": {
					"field": "noserie",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field1": {
					"field": "dn",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field2": {
					"field": "cuenta",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field3": {
					"field": "contrato",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field4": {
					"field": "contratoportal",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field5": {
					"field": "plazopendiente",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field6": {
					"field": "factura",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field7": {
					"field": "fechavenci",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field8": {
					"field": "ciclo",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field9": {
					"field": "dnpreferido",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field10": {
					"field": "simcard",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field11": {
					"field": "renta",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field12": {
					"field": "ine",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field13": {
					"field": "cartaburocredito",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field14": {
					"field": "polizaseguro",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field15": {
					"field": "contratodocto",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field16": {
					"field": "nombre_completo",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field17": {
					"field": "contratolog",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field18": {
					"field": "anticipolog",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field19": {
					"field": "fechahoraentrega",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field20": {
					"field": "totalapagar",
					"type": "integrated_search_field",
					"orientation": 0
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {}
		},
		{
			"id": "masterlist",
			"type": "masterlist",
			"layoutId": "masterlist",
			"disabled": false,
			"default": 0,
			"forms": {
				"above-grid": {
					"modelId": "empty-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "empty-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "masterlist-top",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"back_master",
								"masterlist_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"simple_grid_field",
								"simple_grid_field1",
								"simple_grid_field2",
								"simple_grid_field3",
								"simple_grid_field4",
								"simple_grid_field5",
								"simple_grid_field6",
								"simple_grid_field7",
								"simple_grid_field8",
								"simple_grid_field9",
								"simple_grid_field10",
								"simple_grid_field11",
								"simple_grid_field12",
								"simple_grid_field13",
								"simple_grid_field14",
								"simple_grid_field15",
								"simple_grid_field16",
								"simple_grid_field17",
								"simple_grid_field18",
								"simple_grid_field19",
								"simple_grid_field20",
								"simple_grid_field21",
								"simple_grid_field22",
								"simple_grid_field23",
								"simple_grid_field24",
								"simple_grid_field25",
								"simple_grid_field26",
								"simple_grid_field27",
								"simple_grid_field28",
								"simple_grid_field29",
								"simple_grid_field30",
								"simple_grid_field31",
								"simple_grid_field32",
								"simple_grid_field33",
								"simple_grid_field34",
								"simple_grid_field35",
								"simple_grid_field36",
								"simple_grid_field37",
								"simple_grid_field38",
								"simple_grid_field39",
								"simple_grid_field40",
								"simple_grid_field41",
								"simple_grid_field42",
								"simple_grid_field45",
								"simple_grid_field46",
								"simple_grid_field43",
								"simple_grid_field47",
								"simple_grid_field48",
								"simple_grid_field49",
								"simple_grid_field50",
								"simple_grid_field51",
								"simple_grid_field52",
								"simple_grid_field53",
								"simple_grid_field54",
								"simple_grid_field55",
								"simple_grid_field56",
								"simple_grid_field57",
								"simple_grid_field58",
								"simple_grid_field59",
								"simple_grid_field60",
								"simple_grid_field61",
								"simple_grid_field44",
								"simple_grid_field62",
								"simple_grid_field63",
								"simple_grid_field64",
								"simple_grid_field65",
								"simple_grid_field66"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				}
			},
			"items": {
				"masterlist_header": {
					"type": "masterlist_header"
				},
				"back_master": {
					"type": "back_master"
				},
				"simple_grid_field": {
					"field": "idsolicitud",
					"type": "simple_grid_field"
				},
				"simple_grid_field1": {
					"field": "idtipoventa",
					"type": "simple_grid_field"
				},
				"simple_grid_field2": {
					"field": "fecha",
					"type": "simple_grid_field"
				},
				"simple_grid_field3": {
					"field": "fechacaptura",
					"type": "simple_grid_field"
				},
				"simple_grid_field4": {
					"field": "idcliente",
					"type": "simple_grid_field"
				},
				"simple_grid_field5": {
					"field": "idproducto",
					"type": "simple_grid_field"
				},
				"simple_grid_field6": {
					"field": "idplan",
					"type": "simple_grid_field"
				},
				"simple_grid_field7": {
					"field": "usuario",
					"type": "simple_grid_field"
				},
				"simple_grid_field8": {
					"field": "idtienda",
					"type": "simple_grid_field"
				},
				"simple_grid_field9": {
					"field": "fechamodif",
					"type": "simple_grid_field"
				},
				"simple_grid_field10": {
					"field": "orden",
					"type": "simple_grid_field"
				},
				"simple_grid_field11": {
					"field": "solicitudimg",
					"type": "simple_grid_field"
				},
				"simple_grid_field12": {
					"field": "estatus",
					"type": "simple_grid_field"
				},
				"simple_grid_field13": {
					"field": "idsolrazon",
					"type": "simple_grid_field"
				},
				"simple_grid_field14": {
					"field": "importeatt",
					"type": "simple_grid_field"
				},
				"simple_grid_field15": {
					"field": "importesms",
					"type": "simple_grid_field"
				},
				"simple_grid_field16": {
					"field": "plazo",
					"type": "simple_grid_field"
				},
				"simple_grid_field17": {
					"field": "observaciones",
					"type": "simple_grid_field"
				},
				"simple_grid_field18": {
					"field": "equipoincluido",
					"type": "simple_grid_field"
				},
				"simple_grid_field19": {
					"field": "rfc",
					"type": "simple_grid_field"
				},
				"simple_grid_field20": {
					"field": "idtratamiento",
					"type": "simple_grid_field"
				},
				"simple_grid_field21": {
					"field": "riesgo",
					"type": "simple_grid_field"
				},
				"simple_grid_field22": {
					"field": "observacionest",
					"type": "simple_grid_field"
				},
				"simple_grid_field23": {
					"field": "idcli",
					"type": "simple_grid_field"
				},
				"simple_grid_field24": {
					"field": "fecha1avta",
					"type": "simple_grid_field"
				},
				"simple_grid_field25": {
					"field": "idplan1avta",
					"type": "simple_grid_field"
				},
				"simple_grid_field26": {
					"field": "dn1avta",
					"type": "simple_grid_field"
				},
				"simple_grid_field27": {
					"field": "idproceso",
					"type": "simple_grid_field"
				},
				"simple_grid_field28": {
					"field": "idorigenventa",
					"type": "simple_grid_field"
				},
				"simple_grid_field29": {
					"field": "nombre",
					"type": "simple_grid_field"
				},
				"simple_grid_field30": {
					"field": "paterno",
					"type": "simple_grid_field"
				},
				"simple_grid_field31": {
					"field": "materno",
					"type": "simple_grid_field"
				},
				"simple_grid_field32": {
					"field": "estado",
					"type": "simple_grid_field"
				},
				"simple_grid_field33": {
					"field": "ciudad",
					"type": "simple_grid_field"
				},
				"simple_grid_field34": {
					"field": "cp",
					"type": "simple_grid_field"
				},
				"simple_grid_field35": {
					"field": "calle",
					"type": "simple_grid_field"
				},
				"simple_grid_field36": {
					"field": "numeroext",
					"type": "simple_grid_field"
				},
				"simple_grid_field37": {
					"field": "numeroint",
					"type": "simple_grid_field"
				},
				"simple_grid_field38": {
					"field": "colonia",
					"type": "simple_grid_field"
				},
				"simple_grid_field39": {
					"field": "descripcion",
					"type": "simple_grid_field"
				},
				"simple_grid_field40": {
					"field": "maps_url",
					"type": "simple_grid_field"
				},
				"simple_grid_field41": {
					"field": "direccion",
					"type": "simple_grid_field"
				},
				"simple_grid_field42": {
					"field": "estatusentrega",
					"type": "simple_grid_field"
				},
				"simple_grid_field45": {
					"field": "lat",
					"type": "simple_grid_field"
				},
				"simple_grid_field46": {
					"field": "lng",
					"type": "simple_grid_field"
				},
				"simple_grid_field43": {
					"field": "noserie",
					"type": "simple_grid_field"
				},
				"simple_grid_field47": {
					"field": "dn",
					"type": "simple_grid_field"
				},
				"simple_grid_field48": {
					"field": "cuenta",
					"type": "simple_grid_field"
				},
				"simple_grid_field49": {
					"field": "contrato",
					"type": "simple_grid_field"
				},
				"simple_grid_field50": {
					"field": "contratoportal",
					"type": "simple_grid_field"
				},
				"simple_grid_field51": {
					"field": "plazopendiente",
					"type": "simple_grid_field"
				},
				"simple_grid_field52": {
					"field": "factura",
					"type": "simple_grid_field"
				},
				"simple_grid_field53": {
					"field": "fechavenci",
					"type": "simple_grid_field"
				},
				"simple_grid_field54": {
					"field": "ciclo",
					"type": "simple_grid_field"
				},
				"simple_grid_field55": {
					"field": "dnpreferido",
					"type": "simple_grid_field"
				},
				"simple_grid_field56": {
					"field": "renta",
					"type": "simple_grid_field"
				},
				"simple_grid_field57": {
					"field": "ine",
					"type": "simple_grid_field"
				},
				"simple_grid_field58": {
					"field": "cartaburocredito",
					"type": "simple_grid_field"
				},
				"simple_grid_field59": {
					"field": "polizaseguro",
					"type": "simple_grid_field"
				},
				"simple_grid_field60": {
					"field": "contratodocto",
					"type": "simple_grid_field"
				},
				"simple_grid_field61": {
					"field": "nombre_completo",
					"type": "simple_grid_field"
				},
				"simple_grid_field44": {
					"field": "contratolog",
					"type": "simple_grid_field"
				},
				"simple_grid_field62": {
					"field": "anticipolog",
					"type": "simple_grid_field"
				},
				"simple_grid_field63": {
					"type": "deleted",
					"itemId": "simple_grid_field63"
				},
				"simple_grid_field64": {
					"field": "simcard",
					"type": "simple_grid_field"
				},
				"simple_grid_field65": {
					"field": "fechahoraentrega",
					"type": "simple_grid_field"
				},
				"simple_grid_field66": {
					"field": "totalapagar",
					"type": "simple_grid_field"
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {}
		},
		{
			"id": "masterprint",
			"type": "masterprint",
			"layoutId": "masterprint",
			"disabled": false,
			"default": 0,
			"forms": {
				"above-grid": {
					"modelId": "empty-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "empty-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "masterlist-top",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"masterprint_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"simple_grid_field",
								"simple_grid_field1",
								"simple_grid_field2",
								"simple_grid_field3",
								"simple_grid_field4",
								"simple_grid_field5",
								"simple_grid_field6",
								"simple_grid_field7",
								"simple_grid_field8",
								"simple_grid_field9",
								"simple_grid_field10",
								"simple_grid_field11",
								"simple_grid_field12",
								"simple_grid_field13",
								"simple_grid_field14",
								"simple_grid_field15",
								"simple_grid_field16",
								"simple_grid_field17",
								"simple_grid_field18",
								"simple_grid_field19",
								"simple_grid_field20",
								"simple_grid_field21",
								"simple_grid_field22",
								"simple_grid_field23",
								"simple_grid_field24",
								"simple_grid_field25",
								"simple_grid_field26",
								"simple_grid_field27",
								"simple_grid_field28",
								"simple_grid_field29",
								"simple_grid_field30",
								"simple_grid_field31",
								"simple_grid_field32",
								"simple_grid_field33",
								"simple_grid_field34",
								"simple_grid_field35",
								"simple_grid_field36",
								"simple_grid_field37",
								"simple_grid_field38",
								"simple_grid_field39",
								"simple_grid_field40",
								"simple_grid_field41",
								"simple_grid_field42",
								"simple_grid_field45",
								"simple_grid_field46",
								"simple_grid_field43",
								"simple_grid_field47",
								"simple_grid_field48",
								"simple_grid_field49",
								"simple_grid_field50",
								"simple_grid_field51",
								"simple_grid_field52",
								"simple_grid_field53",
								"simple_grid_field54",
								"simple_grid_field55",
								"simple_grid_field56",
								"simple_grid_field57",
								"simple_grid_field58",
								"simple_grid_field59",
								"simple_grid_field60",
								"simple_grid_field61",
								"simple_grid_field44",
								"simple_grid_field62",
								"simple_grid_field63",
								"simple_grid_field64",
								"simple_grid_field65",
								"simple_grid_field66"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				}
			},
			"items": {
				"masterprint_header": {
					"type": "masterprint_header"
				},
				"simple_grid_field": {
					"field": "idsolicitud",
					"type": "simple_grid_field"
				},
				"simple_grid_field1": {
					"field": "idtipoventa",
					"type": "simple_grid_field"
				},
				"simple_grid_field2": {
					"field": "fecha",
					"type": "simple_grid_field"
				},
				"simple_grid_field3": {
					"field": "fechacaptura",
					"type": "simple_grid_field"
				},
				"simple_grid_field4": {
					"field": "idcliente",
					"type": "simple_grid_field"
				},
				"simple_grid_field5": {
					"field": "idproducto",
					"type": "simple_grid_field"
				},
				"simple_grid_field6": {
					"field": "idplan",
					"type": "simple_grid_field"
				},
				"simple_grid_field7": {
					"field": "usuario",
					"type": "simple_grid_field"
				},
				"simple_grid_field8": {
					"field": "idtienda",
					"type": "simple_grid_field"
				},
				"simple_grid_field9": {
					"field": "fechamodif",
					"type": "simple_grid_field"
				},
				"simple_grid_field10": {
					"field": "orden",
					"type": "simple_grid_field"
				},
				"simple_grid_field11": {
					"field": "solicitudimg",
					"type": "simple_grid_field"
				},
				"simple_grid_field12": {
					"field": "estatus",
					"type": "simple_grid_field"
				},
				"simple_grid_field13": {
					"field": "idsolrazon",
					"type": "simple_grid_field"
				},
				"simple_grid_field14": {
					"field": "importeatt",
					"type": "simple_grid_field"
				},
				"simple_grid_field15": {
					"field": "importesms",
					"type": "simple_grid_field"
				},
				"simple_grid_field16": {
					"field": "plazo",
					"type": "simple_grid_field"
				},
				"simple_grid_field17": {
					"field": "observaciones",
					"type": "simple_grid_field"
				},
				"simple_grid_field18": {
					"field": "equipoincluido",
					"type": "simple_grid_field"
				},
				"simple_grid_field19": {
					"field": "rfc",
					"type": "simple_grid_field"
				},
				"simple_grid_field20": {
					"field": "idtratamiento",
					"type": "simple_grid_field"
				},
				"simple_grid_field21": {
					"field": "riesgo",
					"type": "simple_grid_field"
				},
				"simple_grid_field22": {
					"field": "observacionest",
					"type": "simple_grid_field"
				},
				"simple_grid_field23": {
					"field": "idcli",
					"type": "simple_grid_field"
				},
				"simple_grid_field24": {
					"field": "fecha1avta",
					"type": "simple_grid_field"
				},
				"simple_grid_field25": {
					"field": "idplan1avta",
					"type": "simple_grid_field"
				},
				"simple_grid_field26": {
					"field": "dn1avta",
					"type": "simple_grid_field"
				},
				"simple_grid_field27": {
					"field": "idproceso",
					"type": "simple_grid_field"
				},
				"simple_grid_field28": {
					"field": "idorigenventa",
					"type": "simple_grid_field"
				},
				"simple_grid_field29": {
					"field": "nombre",
					"type": "simple_grid_field"
				},
				"simple_grid_field30": {
					"field": "paterno",
					"type": "simple_grid_field"
				},
				"simple_grid_field31": {
					"field": "materno",
					"type": "simple_grid_field"
				},
				"simple_grid_field32": {
					"field": "estado",
					"type": "simple_grid_field"
				},
				"simple_grid_field33": {
					"field": "ciudad",
					"type": "simple_grid_field"
				},
				"simple_grid_field34": {
					"field": "cp",
					"type": "simple_grid_field"
				},
				"simple_grid_field35": {
					"field": "calle",
					"type": "simple_grid_field"
				},
				"simple_grid_field36": {
					"field": "numeroext",
					"type": "simple_grid_field"
				},
				"simple_grid_field37": {
					"field": "numeroint",
					"type": "simple_grid_field"
				},
				"simple_grid_field38": {
					"field": "colonia",
					"type": "simple_grid_field"
				},
				"simple_grid_field39": {
					"field": "descripcion",
					"type": "simple_grid_field"
				},
				"simple_grid_field40": {
					"field": "maps_url",
					"type": "simple_grid_field"
				},
				"simple_grid_field41": {
					"field": "direccion",
					"type": "simple_grid_field"
				},
				"simple_grid_field42": {
					"field": "estatusentrega",
					"type": "simple_grid_field"
				},
				"simple_grid_field45": {
					"field": "lat",
					"type": "simple_grid_field"
				},
				"simple_grid_field46": {
					"field": "lng",
					"type": "simple_grid_field"
				},
				"simple_grid_field43": {
					"field": "noserie",
					"type": "simple_grid_field"
				},
				"simple_grid_field47": {
					"field": "dn",
					"type": "simple_grid_field"
				},
				"simple_grid_field48": {
					"field": "cuenta",
					"type": "simple_grid_field"
				},
				"simple_grid_field49": {
					"field": "contrato",
					"type": "simple_grid_field"
				},
				"simple_grid_field50": {
					"field": "contratoportal",
					"type": "simple_grid_field"
				},
				"simple_grid_field51": {
					"field": "plazopendiente",
					"type": "simple_grid_field"
				},
				"simple_grid_field52": {
					"field": "factura",
					"type": "simple_grid_field"
				},
				"simple_grid_field53": {
					"field": "fechavenci",
					"type": "simple_grid_field"
				},
				"simple_grid_field54": {
					"field": "ciclo",
					"type": "simple_grid_field"
				},
				"simple_grid_field55": {
					"field": "dnpreferido",
					"type": "simple_grid_field"
				},
				"simple_grid_field56": {
					"field": "renta",
					"type": "simple_grid_field"
				},
				"simple_grid_field57": {
					"field": "ine",
					"type": "simple_grid_field"
				},
				"simple_grid_field58": {
					"field": "cartaburocredito",
					"type": "simple_grid_field"
				},
				"simple_grid_field59": {
					"field": "polizaseguro",
					"type": "simple_grid_field"
				},
				"simple_grid_field60": {
					"field": "contratodocto",
					"type": "simple_grid_field"
				},
				"simple_grid_field61": {
					"field": "nombre_completo",
					"type": "simple_grid_field"
				},
				"simple_grid_field44": {
					"field": "contratolog",
					"type": "simple_grid_field"
				},
				"simple_grid_field62": {
					"field": "anticipolog",
					"type": "simple_grid_field"
				},
				"simple_grid_field63": {
					"type": "deleted",
					"itemId": "simple_grid_field63"
				},
				"simple_grid_field64": {
					"field": "simcard",
					"type": "simple_grid_field"
				},
				"simple_grid_field65": {
					"field": "fechahoraentrega",
					"type": "simple_grid_field"
				},
				"simple_grid_field66": {
					"field": "totalapagar",
					"type": "simple_grid_field"
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {}
		},
		{
			"id": "edit1",
			"type": "edit",
			"layoutId": "nomenu",
			"disabled": false,
			"default": 6,
			"forms": {
				"above-grid": {
					"modelId": "edit-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"edit_message"
							]
						},
						"c2": {
							"model": "c2",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "edit-below-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"edit_save",
								"edit_back_list",
								"edit_close"
							]
						},
						"c2": {
							"model": "c2",
							"items": [
								"hamburger"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "edit-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"edit_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-edit",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c3"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"text"
							],
							"align": "center"
						},
						"c3": {
							"model": "c3",
							"items": [
								"details_preview"
							],
							"align": "center"
						},
						"c": {
							"model": "c3",
							"items": [
								"integrated_edit_field"
							],
							"customCSS": "/* Put  your custom CSS code here */\n/* ========================================================= */\n/* ESTILOS DE TU TEMPLATE */\n/* ========================================================= */\nbody {\n    box-sizing: border-box;\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n    /* Corrección de encogimiento por scroll */\n    overflow-y: scroll !important;\n}\n.gradient-bg {\n    /* Degradado de ejemplo, ajusta tus colores si es necesario */\n    background: linear-gradient(135deg, #03478A 0%, #6D98C2 100%);\n}\n.card-shadow {\n    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n}\n.check-animation {\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n.check-animation:hover {\n    transform: scale(1.1);\n}\n\n/* ========================================================= */\n/* ESTILOS ESPECÍFICOS PARA PHP RUNNER */\n/* ========================================================= */\n\n/* Esconde el checkbox nativo de PHPRunner, ya que lo vamos a reemplazar visualmente */\n.custom-checkbox-phprunner input[type=\"checkbox\"] {\n    opacity: 0; \n    position: absolute; \n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    border: 0;\n}\n\n/* Estilo del input de SIM Card (u otro campo de texto) */\n#control_simcard_1 input[type=\"text\"], \n#control_simcard_1 input[type=\"number\"] {\n    width: 100%;\n    padding: 0.75rem 1rem;\n    border: 1px solid #d1d5db; /* gray-300 */\n    border-radius: 0.5rem; /* rounded-lg */\n    transition: all 0.2s;\n}\n#control_simcard_1 input[type=\"text\"]:focus, \n#control_simcard_1 input[type=\"number\"]:focus {\n    border-color: #3b82f6; /* blue-500 */\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);\n}"
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				}
			},
			"items": {
				"edit_header": {
					"type": "edit_header"
				},
				"hamburger": {
					"type": "hamburger",
					"items": [
						"edit_reset"
					]
				},
				"edit_reset": {
					"type": "edit_reset"
				},
				"edit_message": {
					"type": "edit_message"
				},
				"edit_save": {
					"type": "edit_save",
					"icon": {}
				},
				"edit_back_list": {
					"type": "edit_back_list"
				},
				"edit_close": {
					"type": "edit_close"
				},
				"details_preview": {
					"type": "details_preview",
					"table": 3847630651,
					"items": [],
					"popup": false,
					"pageId": "list"
				},
				"text": {
					"type": "text",
					"label": {
						"text": "<!-- QUICK ADD logisticavnp -->\n<style>\n  .qa-card{background:#fff;border:1px solid #e5e7eb;border-radius:16px;margin:12px 0 18px;\n           box-shadow:0 10px 25px -5px rgba(0,0,0,.1),0 10px 10px -5px rgba(0,0,0,.04)}\n  .qa-head{padding:14px 18px;border-bottom:1px solid #eef2ff;\n           background:linear-gradient(90deg,#667eea,#764ba2);color:#fff;\n           border-top-left-radius:16px;border-top-right-radius:16px}\n  .qa-title{font-size:18px;font-weight:700;display:flex;align-items:center;gap:8px}\n  .qa-body{padding:16px 18px;display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:end}\n  .qa-input{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:10px;font-size:14px}\n  .qa-btn{grid-column:1 / -1; display:inline-flex;align-items:center;justify-content:center;\n          padding:12px 14px;border:none;border-radius:10px;color:#fff;font-weight:700;cursor:pointer;\n          background:linear-gradient(90deg,#10b981,#3b82f6); transition:transform .06s ease}\n  .qa-btn:active{transform:scale(.98)}\n  .qa-btn:disabled{opacity:.6;cursor:not-allowed}\n  @media (max-width: 900px){ .qa-body{grid-template-columns:1fr} }\n</style>\n\n<div id=\"qa_logisticavnp\" class=\"qa-card\">\n  <div class=\"qa-head\"><div class=\"qa-title\">📱 Nueva SIM Card</div></div>\n  <div class=\"qa-body\">\n    <div>\n      <label style=\"display:none;margin:0 0 6px 4px;color:#374151;font-weight:600;font-size:12px\"  >Fecha</label>\n      <input id=\"qa_fecha\" class=\"qa-input\" type=\"date\" style=\"display:none\">\n    </div>\n    <div>\n      <label style=\"display:block;margin:0 0 6px 4px;color:#374151;font-weight:600;font-size:12px\">Número de SIM Card</label>\n      <input id=\"qa_sim\" class=\"qa-input\" type=\"text\" placeholder=\"Ej: 1234567890\">\n    </div>\n    <button id=\"qa_add\" class=\"qa-btn\" type=\"button\">Agregar Nueva SIM Card</button>\n  </div>\n</div>\n\n<script>\n(function(){\n  // ===== Config =====\n  var DATE_FIELD  = 'fechaHora';     // DATETIME en logisticavnp\n  var SIM_FIELD   = 'SIMEntregado';\n  var IDSOL_FIELD = 'idsolicitud';\n  var AUTO_SAVE   = true;\n\n  // ===== Helpers =====\n  function $(s,root){ return (root||document).querySelector(s); }\n  function $all(s,root){ return Array.prototype.slice.call((root||document).querySelectorAll(s)); }\n  function todayISO(){ try{ var z=(new Date()).getTimezoneOffset()*60000; return new Date(Date.now()-z).toISOString().slice(0,10);}catch(_){return ''} }\n  function toast(msg, ok){\n    var id='qa_toast', el=document.getElementById(id);\n    if(!el){ el=document.createElement('div'); el.id=id; document.body.appendChild(el); }\n    el.textContent = msg || 'Listo';\n    el.style.cssText='position:fixed;top:16px;right:16px;padding:10px 14px;border-radius:10px;color:#fff;font-weight:700;z-index:99999;'\n                    +'box-shadow:0 10px 20px rgba(0,0,0,.18);background:'+(ok?'#10b981':'#ef4444');\n    setTimeout(function(){ el && el.remove(); }, 1600);\n  }\n  function waitFor(fn, ms, step){\n    var t0 = Date.now();\n    return new Promise(function(res,rej){\n      (function tick(){\n        try{ var v = fn(); if(v) return res(v); }catch(_){}\n        if(Date.now()-t0 >= (ms||6000)) return rej(new Error('timeout'));\n        setTimeout(tick, step||90);\n      })();\n    });\n  }\n  function findLogisticaPanel(){\n    var p = $all('.bs-details .panel.panel-info.details-grid').find(function(node){\n      var h = node.querySelector('.panel-heading .panel-title');\n      return h && /logisticavnp/i.test(h.textContent||'');\n    });\n    if (p) return p;\n    var any = document.querySelector('[data-table=\"logisticavnp\"]');\n    return any ? any.closest('.panel,.bs-details,.rnr-b-grid,.rnr-grid-block') : null;\n  }\n\n  // === Setear DATETIME robusto en fila inline ===\n  // isoDate: 'YYYY-MM-DD' | hhmm: 'HH:MM' o 'HH:MM:SS' (opcional)\n  async function setInlineDatePHR(rowEl, fieldName, isoDate, hhmm){\n    hhmm = hhmm || '00:00';\n    var hasSS = /^\\d{2}:\\d{2}:\\d{2}$/.test(hhmm);\n    var hh = (hhmm.split(':')[0]||'00'),\n        mm = (hhmm.split(':')[1]||'00'),\n        ss = hasSS ? hhmm.split(':')[2] : '00';\n    var isoDT = isoDate + ' ' + hh + ':' + mm + ':' + ss;\n\n    // 1) Runner control (espera hasta ~1.2s)\n    function getCtrl(){\n      try{\n        var pid = (document.querySelector('[data-pageid]')||{}).getAttribute?.('data-pageid')||'';\n        var rid = rowEl.getAttribute('data-rowid') || rowEl.getAttribute('data-record-id') || '';\n        return (window.Runner && Runner.getControl) ? Runner.getControl(pid, fieldName, rid) : null;\n      }catch(e){ return null; }\n    }\n    var ctrl=null, t0=Date.now();\n    while(!(ctrl=getCtrl()) && Date.now()-t0<1200){ await new Promise(r=>setTimeout(r,90)); }\n    if (ctrl && typeof ctrl.setValue==='function'){\n      ctrl.setValue(isoDT);\n      if (typeof ctrl.fireEvent==='function') ctrl.fireEvent('change');\n      return true;\n    }\n\n    // 2) Dentro del TD del campo, cubre tipos conocidos\n    var td = rowEl.querySelector('td[data-field=\"'+fieldName+'\"]') || rowEl;\n\n    var dtl = td.querySelector('input[type=\"datetime-local\"]');\n    if (dtl){ dtl.value = isoDate + 'T' + hh + ':' + mm; dtl.dispatchEvent(new Event('change',{bubbles:true})); return true; }\n\n    var di = td.querySelector('input[type=\"date\"]');\n    var ti = td.querySelector('input[type=\"time\"], input.timepicker');\n    if (di){\n      di.value = isoDate; di.dispatchEvent(new Event('change',{bubbles:true}));\n      if (ti){ ti.value = hh + ':' + mm + (hasSS? ':'+ss : ''); ti.dispatchEvent(new Event('change',{bubbles:true})); }\n      return true;\n    }\n\n    var sel = (s)=> td.querySelector(s);\n    var y=sel('[id$=\"_year\"],select[name$=\"_year\"]'),\n        m=sel('[id$=\"_month\"],select[name$=\"_month\"]'),\n        d=sel('[id$=\"_day\"],select[name$=\"_day\"]'),\n        H=sel('[id$=\"_hour\"],select[name$=\"_hour\"]'),\n        M=sel('[id$=\"_minute\"],select[name$=\"_minute\"]'),\n        S=sel('[id$=\"_second\"],select[name$=\"_second\"]');\n    if (y&&m&&d){\n      y.value = isoDate.slice(0,4); y.dispatchEvent(new Event('change',{bubbles:true}));\n      m.value = String(parseInt(isoDate.slice(5,7),10)); m.dispatchEvent(new Event('change',{bubbles:true}));\n      d.value = String(parseInt(isoDate.slice(8,10),10)); d.dispatchEvent(new Event('change',{bubbles:true}));\n      if (H){ H.value = hh; H.dispatchEvent(new Event('change',{bubbles:true})); }\n      if (M){ M.value = mm; M.dispatchEvent(new Event('change',{bubbles:true})); }\n      if (S){ S.value = ss; S.dispatchEvent(new Event('change',{bubbles:true})); }\n      return true;\n    }\n\n    var txt = td.querySelector('input[type=\"text\"], input:not([type])');\n    if (txt){ txt.value = isoDT; txt.dispatchEvent(new Event('change',{bubbles:true})); return true; }\n\n    return false;\n  }\n\n  // valor por defecto de la fecha del card\n  var inpFecha = $('#qa_fecha'); if (inpFecha) inpFecha.value = todayISO();\n\n  // === Click en botón \"Agregar Nueva SIM Card\" ===\n  document.addEventListener('click', async function(ev){\n    var btn = ev.target.closest('#qa_add'); if (!btn) return;\n\n    var fecha = ($('#qa_fecha')||{}).value || '';\n    var sim   = (($('#qa_sim')||{}).value||'').trim();\n    if (!fecha || !sim){ toast('Completa Fecha y SIM', false); return; }\n\n    var panel = findLogisticaPanel();\n    if (!panel){ toast('No encuentro el subform logisticavnp', false); return; }\n\n    btn.disabled = true;\n    try{\n      // 1) “Añadir nuevo”\n      var addBtn = panel.querySelector('[data-buttonevent=\"inlineadd\"], #inlineAdd2');\n      if (!addBtn) throw new Error('No encontré el botón \"Añadir nuevo\"');\n      addBtn.click();\n\n      // 2) Espera fila inline (nos apoyamos en SIM, que sí existe)\n      var row = await waitFor(function(){\n        var si = panel.querySelector('[id^=\"value_'+SIM_FIELD+'_\"]');\n        return si ? si.closest('tr') : null;\n      }, 8000, 100);\n\n      // 3) Llenar fechaHora (datetime) de forma robusta\n  //   var now = new Date();\n  //    var hh = String(now.getHours()).padStart(2,'0');\n  //    var mm = String(now.getMinutes()).padStart(2,'0');\n  //    var okFecha = await setInlineDatePHR(row, // DATE_FIELD, fecha, hh+':'+mm);\n  //    if (!okFecha) console.warn('No pude setear', //DATE_FIELD);\n\n      // 4) Llenar SIM\n      var siIn = row.querySelector('[id^=\"value_'+SIM_FIELD+'_\"]');\n      if (siIn){\n        siIn.value = sim;\n        siIn.dispatchEvent(new Event('input',{bubbles:true}));\n        siIn.dispatchEvent(new Event('change',{bubbles:true}));\n      }\n\n      // 5) (Opcional) Setear idsolicitud si el campo está visible\n      var idSol = (document.querySelector('[id^=\"value_idsolicitud_\"]')||{}).value\n               || (document.querySelector('[name=\"editid1\"]')||{}).value\n               || (new URLSearchParams(location.search).get('editid1'));\n      var idIn = row.querySelector('[id^=\"value_'+IDSOL_FIELD+'_\"]');\n      if (idIn && idSol){ idIn.value = idSol; idIn.dispatchEvent(new Event('change',{bubbles:true})); }\n\n      // 6) Guardar todo\n      if (AUTO_SAVE){\n        var saveBtn = panel.querySelector('[data-buttonevent=\"saveall\"]');\n        if (saveBtn) setTimeout(function(){ saveBtn.click(); }, 150);\n      }\n\n      // limpiar SIM para siguiente alta\n      var simInput = $('#qa_sim'); if (simInput) simInput.value = '';\n      toast('Registro agregado', true);\n    } catch(e){\n      console.error(e);\n      toast('No se pudo agregar', false);\n    } finally {\n      btn.disabled = false;\n    }\n  });\n})();\n</script>\n",
						"type": 0
					},
					"editedByRte": false
				},
				"integrated_edit_field": {
					"field": "totalapagar",
					"type": "integrated_edit_field",
					"orientation": 0
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"pageCSS": "/* ====== Layout utilidades (equivalentes a las que usas en JS) ====== */\r\n.w-full { width: 100%; }\r\n.text-white { color: #fff !important; }\r\n\r\n/* Gradiente del encabezado de la tabla (cuando tu JS agrega ambas clases) */\r\n.bg-gradient-to-r.from-purple-500.to-pink-500 {\r\n  background-image: linear-gradient(90deg, #7c3aed, #ec4899);\r\n  color: #fff;\r\n}\r\n\r\n/* Botón circular “check” (el JS agrega .check-animation) */\r\n.check-animation {\r\n  width: 32px; height: 32px; border-radius: 9999px;\r\n  display: inline-flex; align-items: center; justify-content: center;\r\n  font-weight: 700; color: #fff;\r\n  box-shadow: 0 8px 18px rgba(0,0,0,.18);\r\n  transition: transform .12s ease, box-shadow .12s ease, background-color .12s ease;\r\n  border: 0;\r\n}\r\n.check-animation:hover { box-shadow: 0 10px 22px rgba(0,0,0,.22); transform: translateY(-1px); }\r\n.bg-green-500 { background-color: #22c55e !important; } /* ✓ activo */\r\n.bg-gray-300  { background-color: #d1d5db !important; } /* inactivo */\r\n\r\n/* Pequeña animación al hacer click */\r\n@keyframes bounceIn {\r\n  0% { transform: scale(.94); }\r\n  60% { transform: scale(1.06); }\r\n  100% { transform: scale(1); }\r\n}\r\n.bounce-in { animation: bounceIn .35s cubic-bezier(.2,.8,.2,1); }\r\n\r\n/* ====== Tarjeta superior (tu “Nueva SIM Card”) para igualar estética ====== */\r\n#qa_logisticavnp.qa-card {\r\n  border-radius: 14px;\r\n  box-shadow: 0 18px 40px -12px rgba(66, 56, 157, .35);\r\n  overflow: hidden;\r\n}\r\n#qa_logisticavnp .qa-head {\r\n  background: linear-gradient(90deg, #4f46e5, #7c3aed, #ec4899);\r\n  color: #fff;\r\n}\r\n#qa_logisticavnp .qa-title {\r\n  font-weight: 800; font-size: 19px;\r\n  display: flex; align-items: center; gap: 8px;\r\n}\r\n#qa_logisticavnp .qa-input {\r\n  height: 40px;\r\n  border-radius: 10px;\r\n  border: 1px solid #d1d5db;\r\n  outline: none;\r\n  transition: box-shadow .12s ease, border-color .12s ease;\r\n}\r\n#qa_logisticavnp .qa-input:focus {\r\n  border-color: #7c3aed;\r\n  box-shadow: 0 0 0 3px rgba(124,58,237,.18);\r\n}\r\n#qa_logisticavnp .qa-btn {\r\n  background: linear-gradient(90deg, #10b981, #3b82f6);\r\n  border-radius: 10px;\r\n  color:#fff; font-weight: 800;\r\n  border: none; height: 44px;\r\n  box-shadow: 0 12px 28px rgba(16,185,129,.28);\r\n  transition: transform .08s ease, box-shadow .12s ease, opacity .12s ease;\r\n}\r\n#qa_logisticavnp .qa-btn:hover {\r\n  box-shadow: 0 16px 34px rgba(16,185,129,.34);\r\n  transform: translateY(-1px);\r\n}\r\n\r\n/* ====== Tabla del detalle (grilla PHPRunner) con estilo “canvas” ====== */\r\n\r\n/* Contenedor del block de detalles (flex y padding sutil) */\r\n.rnr-b-grid, .details-grid, .rnr-grid-block {\r\n  border-radius: 12px;\r\n  background: linear-gradient(180deg, #7c3aed0f, #ec48990a);\r\n  padding: 8px 8px 12px;\r\n}\r\n\r\n/* Tabla base (PHPRunner usa varias clases, cubrimos runner-c y tables por defecto) */\r\n.rnr-b-grid table,\r\n.details-grid table,\r\n.rnr-grid-block table,\r\ntable.runner-c {\r\n  width: 100%;\r\n  border-collapse: separate;\r\n  border-spacing: 0;\r\n  background: #fff;\r\n  border-radius: 12px;\r\n  overflow: hidden; /* para redondeado real en bordes */\r\n  box-shadow: 0 12px 26px rgba(0,0,0,.08);\r\n}\r\n\r\n/* Encabezado */\r\n.rnr-b-grid thead tr,\r\n.details-grid thead tr,\r\n.rnr-grid-block thead tr,\r\ntable.runner-c thead tr {\r\n  background-image: linear-gradient(90deg, #7c3aed, #ec4899);\r\n}\r\n.rnr-b-grid thead th,\r\n.details-grid thead th,\r\n.rnr-grid-block thead th,\r\ntable.runner-c thead th {\r\n  color: #fff;\r\n  font-weight: 800;\r\n  text-align: left;\r\n  padding: 12px 14px;\r\n  font-size: 14px;\r\n  border-bottom: 0;\r\n  white-space: nowrap;\r\n}\r\n\r\n/* Filas y celdas */\r\n.rnr-b-grid tbody td,\r\n.details-grid tbody td,\r\n.rnr-grid-block tbody td,\r\ntable.runner-c tbody td {\r\n  padding: 10px 12px;\r\n  font-size: 14px;\r\n  color: #111827;\r\n  border-bottom: 1px solid #f1f5f9; /* línea sutil */\r\n  vertical-align: middle;\r\n}\r\n\r\n/* Zebra + hover suave */\r\n.rnr-b-grid tbody tr:nth-child(odd),\r\n.details-grid tbody tr:nth-child(odd),\r\n.rnr-grid-block tbody tr:nth-child(odd),\r\ntable.runner-c tbody tr:nth-child(odd) {\r\n  background-color: #fafafa;\r\n}\r\n.rnr-b-grid tbody tr:hover,\r\n.details-grid tbody tr:hover,\r\n.rnr-grid-block tbody tr:hover,\r\ntable.runner-c tbody tr:hover {\r\n  background-color: #f5f3ff; /* lavanda light */\r\n}\r\n\r\n/* Primera y última celda con borde redondeado cuando es la primera/última fila */\r\n.rnr-b-grid tbody tr:first-child td:first-child,\r\n.details-grid tbody tr:first-child td:first-child,\r\n.rnr-grid-block tbody tr:first-child td:first-child,\r\ntable.runner-c tbody tr:first-child td:first-child {\r\n  border-top-left-radius: 12px;\r\n}\r\n.rnr-b-grid tbody tr:first-child td:last-child,\r\n.details-grid tbody tr:first-child td:last-child,\r\n.rnr-grid-block tbody tr:first-child td:last-child,\r\ntable.runner-c tbody tr:first-child td:last-child {\r\n  border-top-right-radius: 12px;\r\n}\r\n.rnr-b-grid tbody tr:last-child td:first-child,\r\n.details-grid tbody tr:last-child td:first-child,\r\n.rnr-grid-block tbody tr:last-child td:first-child,\r\ntable.runner-c tbody tr:last-child td:first-child {\r\n  border-bottom-left-radius: 12px;\r\n}\r\n.rnr-b-grid tbody tr:last-child td:last-child,\r\n.details-grid tbody tr:last-child td:last-child,\r\n.rnr-grid-block tbody tr:last-child td:last-child,\r\ntable.runner-c tbody tr:last-child td:last-child {\r\n  border-bottom-right-radius: 12px;\r\n  border-bottom: 0;\r\n}\r\n\r\n/* Barra de acciones del detalle (Añadir nuevo, Guardar todo, Cancelar) */\r\n.details-grid .rnr-buttons-block,\r\n.rnr-b-grid .rnr-buttons-block,\r\n.rnr-grid-block .rnr-buttons-block {\r\n  margin: 8px 4px 10px;\r\n}\r\n.rnr-b-grid .rnr-buttons-block a,\r\n.details-grid .rnr-buttons-block a,\r\n.rnr-grid-block .rnr-buttons-block a,\r\n.rnr-b-grid .rnr-buttons-block button,\r\n.details-grid .rnr-buttons-block button,\r\n.rnr-grid-block .rnr-buttons-block button {\r\n  background: #f3f4f6;\r\n  color: #111827;\r\n  border: 1px solid #e5e7eb;\r\n  border-radius: 8px;\r\n  padding: 6px 10px;\r\n  margin-right: 6px;\r\n  text-decoration: none;\r\n  display: inline-flex; align-items: center; gap: 6px;\r\n  transition: background-color .12s ease, box-shadow .12s ease, transform .06s ease;\r\n}\r\n.rnr-b-grid .rnr-buttons-block a:hover,\r\n.details-grid .rnr-buttons-block a:hover,\r\n.rnr-grid-block .rnr-buttons-block a:hover,\r\n.rnr-b-grid .rnr-buttons-block button:hover,\r\n.details-grid .rnr-buttons-block button:hover,\r\n.rnr-grid-block .rnr-buttons-block button:hover {\r\n  background: #eaeefb;\r\n  box-shadow: 0 6px 18px rgba(124,58,237,.15);\r\n  transform: translateY(-1px);\r\n}\r\n\r\n/* Botón eliminar estilo “pill” rojo (si usas ese texto) */\r\na.btn-delete, button.btn-delete {\r\n  background: #ef4444 !important;\r\n  color: #fff !important;\r\n  border-color: #ef4444 !important;\r\n}\r\na.btn-delete:hover, button.btn-delete:hover {\r\n  box-shadow: 0 8px 20px rgba(239,68,68,.35) !important;\r\n}\r\n\r\n/* Celda de acciones centrada (por estética del ejemplo) */\r\ntd[data-field=\"acciones\"], td.actions, td:last-child {\r\n  text-align: center;\r\n}\r\n\r\n/* ====== Ajustes menores para inputs inline en la grid ====== */\r\n.rnr-b-grid input[type=\"text\"],\r\n.rnr-b-grid input[type=\"date\"],\r\n.details-grid input[type=\"text\"],\r\n.details-grid input[type=\"date\"],\r\n.rnr-grid-block input[type=\"text\"],\r\n.rnr-grid-block input[type=\"date\"] {\r\n  height: 34px;\r\n  border-radius: 8px;\r\n  border: 1px solid #d1d5db;\r\n  padding: 4px 8px;\r\n  outline: none;\r\n  transition: box-shadow .12s ease, border-color .12s ease;\r\n}\r\n.rnr-b-grid input[type=\"text\"]:focus,\r\n.rnr-b-grid input[type=\"date\"]:focus,\r\n.details-grid input[type=\"text\"]:focus,\r\n.details-grid input[type=\"date\"]:focus,\r\n.rnr-grid-block input[type=\"text\"]:focus,\r\n.rnr-grid-block input[type=\"date\"]:focus {\r\n  border-color: #7c3aed;\r\n  box-shadow: 0 0 0 3px rgba(124,58,237,.18);\r\n}\r\n\r\n/* Checkbox centrado bonito */\r\n.rnr-b-grid input[type=\"checkbox\"],\r\n.details-grid input[type=\"checkbox\"],\r\n.rnr-grid-block input[type=\"checkbox\"] {\r\n  width: 18px; height: 18px;\r\n  accent-color: #22c55e; /* verde */\r\n  cursor: pointer;\r\n}\r\n\r\n/* ====== Badge contador (si decides poner uno sobre la tabla) ====== */\r\n.badge-counter {\r\n  display: inline-block;\r\n  background: #eef2ff;\r\n  color: #4338ca;\r\n  font-weight: 700;\r\n  padding: 4px 10px;\r\n  border-radius: 999px;\r\n  font-size: 12px;\r\n  box-shadow: inset 0 0 0 1px rgba(67,56,202,.15);\r\n}\r\n\r\n/* ====== Scroll suave para el bloque de detalle cuando es ancho ====== */\r\n.rnr-b-grid, .details-grid, .rnr-grid-block { overflow-x: auto; }\r\n\r\n\r\n/* ===== Botón redondo “check” (tu JS ya crea .check-animation) ===== */\r\n.check-animation{\r\n  width: 34px; height: 34px; border-radius: 9999px;\r\n  display:inline-flex; align-items:center; justify-content:center;\r\n  font-weight:800; color:#fff; border:0; cursor:pointer;\r\n  box-shadow: 0 10px 22px rgba(0,0,0,.18);\r\n  transition: transform .12s ease, box-shadow .12s ease, background-color .12s ease;\r\n}\r\n.check-animation:hover{ transform: translateY(-1px); box-shadow:0 14px 30px rgba(0,0,0,.22); }\r\n.bg-green-500{ background-color:#22c55e !important; }   /* ON */\r\n.bg-gray-300{  background-color:#d1d5db !important; }   /* OFF */\r\n\r\n/* “bounce” al alternar */\r\n@keyframes pc-bounce { 0%{transform:scale(.94)} 60%{transform:scale(1.06)} 100%{transform:scale(1)} }\r\n.bounce-in{ animation: pc-bounce .32s cubic-bezier(.2,.8,.2,1); }\r\n\r\n/* Centrar las celdas de esos campos en la grilla */\r\ntd[data-field=\"lista_entregada\"],\r\ntd[data-field=\"manual\"],\r\ntd[data-field=\"contrato\"]{ text-align:center; }\r\n\r\n/* ===== Encabezados con icono a la izquierda ===== */\r\n/* Marcamos los TH con class .th-iconized y data-icon=\"📋\" (via JS) */\r\nth.th-iconized{\r\n  position:relative; padding-left:32px !important;\r\n}\r\nth.th-iconized::before{\r\n  content: attr(data-icon);\r\n  position:absolute; left:10px; top:50%; transform:translateY(-50%);\r\n  font-size:16px; line-height:1; opacity:.95;\r\n  filter: drop-shadow(0 1px 0 rgba(0,0,0,.12));\r\n}\r\n\r\n/* Si tu tema no pone data-field en el TH, este fallback estiliza por texto envuelto en <span> */\r\nth.th-iconized > span { display:inline-block; vertical-align:middle; }\r\n\r\n/* ===== Bonus: encabezado con gradiente (si ya lo aplicas desde JS, esto le da estilo) ===== */\r\n.bg-gradient-to-r.from-purple-500.to-pink-500{\r\n  background-image: linear-gradient(90deg,#7c3aed,#ec4899);\r\n  color:#fff;\r\n}\r\n\r\n/* ================== Check redondo estilo \"pill ✓\" ================== */\r\n/* Fuerza tamaño, tipografía y sombras. Va con !important para ganar prioridad */\r\nbutton.check-animation, .check-animation {\r\n  appearance: none;\r\n  width: 36px !important;\r\n  height: 36px !important;\r\n  border-radius: 9999px !important;\r\n  border: 0 !important;\r\n  outline: none !important;\r\n  display: inline-flex !important;\r\n  align-items: center !important;\r\n  justify-content: center !important;\r\n  font-size: 18px !important;         /* tamaño del ✓ / icono */\r\n  font-weight: 800 !important;\r\n  line-height: 1 !important;\r\n  -webkit-font-smoothing: antialiased;\r\n  -moz-osx-font-smoothing: grayscale;\r\n  cursor: pointer;\r\n  transition: transform .12s ease, box-shadow .12s ease, background-color .12s ease;\r\n  /* halo y relieve como en la imagen */\r\n  box-shadow:\r\n    0 8px 18px rgba(0,0,0,.18),        /* sombra externa */\r\n    inset 0 1px 0 rgba(255,255,255,.35); /* brillo superior interior */\r\n}\r\n\r\n/* Efecto hover común */\r\nbutton.check-animation:hover, .check-animation:hover {\r\n  transform: translateY(-1px);\r\n  box-shadow:\r\n    0 12px 26px rgba(0,0,0,.22),\r\n    inset 0 1px 0 rgba(255,255,255,.35);\r\n}\r\n\r\n/* Estado ON: círculo verde con degradé y ✓ blanco */\r\n.check-animation.bg-green-500 {\r\n  /* degradé vertical suave como en el screenshot */\r\n  background: linear-gradient(180deg, #2bdc74 0%, #10b981 60%, #0ea472 100%) !important;\r\n  color: #fff !important;     /* el ✓ en blanco */\r\n  text-shadow: 0 1px 0 rgba(0,0,0,.15);\r\n}\r\n\r\n/* Estado OFF: gris con icono en gris oscuro */\r\n.check-animation.bg-gray-300 {\r\n  background: linear-gradient(180deg, #f0f2f5 0%, #d8dde3 100%) !important;\r\n  color: #6b7280 !important;   /* color del emoji 📋/📖/📄 */\r\n  text-shadow: none;\r\n  box-shadow:\r\n    0 6px 14px rgba(0,0,0,.12),\r\n    inset 0 1px 0 rgba(255,255,255,.6);\r\n}\r\n\r\n/* Animación de “rebote” al alternar (tu JS ya añade .bounce-in) */\r\n@keyframes pc-bounce { 0%{transform:scale(.94)} 60%{transform:scale(1.06)} 100%{transform:scale(1)} }\r\n.bounce-in { animation: pc-bounce .30s cubic-bezier(.2,.8,.2,1); }\r\n\r\n/* Centrado de las celdas de esos campos */\r\ntd[data-field=\"lista_entregada\"],\r\ntd[data-field=\"manual\"],\r\ntd[data-field=\"contrato\"] { text-align: center; }\r\n\r\n/* (Opcional) si el tema mete padding muy grande en la celda, lo aplacamos */\r\ntd[data-field=\"lista_entregada\"] .check-animation,\r\ntd[data-field=\"manual\"] .check-animation,\r\ntd[data-field=\"contrato\"] .check-animation { margin: 2px 0; }\r\n\r\n\r\n\r\n\r\n\r\n/*******************************************************/\r\n/* Botón redondo tipo \"pill ✓\" */\r\nbutton.check-animation, .check-animation{\r\n  appearance:none; width:36px!important; height:36px!important; border-radius:9999px!important;\r\n  border:1px solid rgba(0,0,0,.06)!important; outline:none!important;\r\n  display:inline-flex!important; align-items:center!important; justify-content:center!important;\r\n  font-size:18px!important; font-weight:900!important; line-height:1!important; cursor:pointer;\r\n  background-clip:padding-box;\r\n  box-shadow:0 10px 22px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.38);\r\n  transition:transform .12s, box-shadow .12s, background .12s, color .12s;\r\n}\r\nbutton.check-animation:hover, .check-animation:hover{\r\n  transform:translateY(-1px);\r\n  box-shadow:0 14px 30px rgba(0,0,0,.22), inset 0 1px 0 rgba(255,255,255,.40);\r\n}\r\n.check-animation.bg-green-500{\r\n  background:\r\n    radial-gradient(120% 120% at 30% 20%, rgba(255,255,255,.28), transparent 60%),\r\n    linear-gradient(180deg,#31e07e 0%,#12c06f 60%,#0ea267 100%) !important;\r\n  color:#fff!important; text-shadow:0 1px 0 rgba(0,0,0,.15);\r\n}\r\n.check-animation.bg-gray-300{\r\n  background:\r\n    radial-gradient(120% 120% at 30% 20%, rgba(255,255,255,.55), transparent 60%),\r\n    linear-gradient(180deg,#f2f4f7 0%,#d9dee3 100%) !important;\r\n  color:#6b7280!important; box-shadow:0 8px 18px rgba(0,0,0,.14), inset 0 1px 0 rgba(255,255,255,.65);\r\n}\r\n@keyframes pc-bounce{0%{transform:scale(.94)}60%{transform:scale(1.06)}100%{transform:scale(1)}}\r\n.bounce-in{animation:pc-bounce .30s cubic-bezier(.2,.8,.2,1);}\r\n\r\n/* Centrado de columnas de check */\r\ntd[data-field=\"lista_entregada\"], td[data-field=\"manual\"], td[data-field=\"contrato\"]{ text-align:center; }\r\ntd[data-field=\"lista_entregada\"] .check-animation,\r\ntd[data-field=\"manual\"] .check-animation,\r\ntd[data-field=\"contrato\"] .check-animation{ margin:1px 0; }\r\n\r\n/* Encabezado con icono */\r\nth.th-iconized{ position:relative; padding-left:30px!important; }\r\nth.th-iconized::before{\r\n  content:attr(data-icon); position:absolute; left:10px; top:50%; transform:translateY(-50%);\r\n  font-size:16px; opacity:.95; filter:drop-shadow(0 1px 0 rgba(0,0,0,.12));\r\n}\r\n\r\n/* Gradiente del thead (si ya lo aplicas por JS, esto lo embellece) */\r\n.bg-gradient-to-r.from-purple-500.to-pink-500{\r\n  background-image:linear-gradient(90deg,#7c3aed,#ec4899); color:#fff;\r\n}\r\n\r\n/*********************************************************************/\r\n/* ===== Botón redondo estilo \"pill ✓\" ===== */\r\nbutton.check-animation, .check-animation{\r\n  appearance:none; width:36px!important; height:36px!important; border-radius:9999px!important;\r\n  border:1px solid rgba(0,0,0,.06)!important; outline:none!important;\r\n  display:inline-flex!important; align-items:center!important; justify-content:center!important;\r\n  font-size:18px!important; font-weight:900!important; line-height:1!important; cursor:pointer;\r\n  background-clip:padding-box;\r\n  box-shadow:0 10px 22px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.38);\r\n  transition:transform .12s, box-shadow .12s, background .12s, color .12s;\r\n}\r\nbutton.check-animation:hover, .check-animation:hover{\r\n  transform:translateY(-1px);\r\n  box-shadow:0 14px 30px rgba(0,0,0,.22), inset 0 1px 0 rgba(255,255,255,.40);\r\n}\r\n.check-animation.bg-green-500{\r\n  background:\r\n    radial-gradient(120% 120% at 30% 20%, rgba(255,255,255,.28), transparent 60%),\r\n    linear-gradient(180deg,#31e07e 0%,#12c06f 60%,#0ea267 100%) !important;\r\n  color:#fff!important; text-shadow:0 1px 0 rgba(0,0,0,.15);\r\n}\r\n.check-animation.bg-gray-300{\r\n  background:\r\n    radial-gradient(120% 120% at 30% 20%, rgba(255,255,255,.55), transparent 60%),\r\n    linear-gradient(180deg,#f2f4f7 0%,#d9dee3 100%) !important;\r\n  color:#6b7280!important; box-shadow:0 8px 18px rgba(0,0,0,.14), inset 0 1px 0 rgba(255,255,255,.65);\r\n}\r\n@keyframes pc-bounce{0%{transform:scale(.94)}60%{transform:scale(1.06)}100%{transform:scale(1)}}\r\n.bounce-in{animation:pc-bounce .30s cubic-bezier(.2,.8,.2,1);}\r\n\r\n/* Centrar columnas de check (nombres internos exactos) */\r\ntd[data-field=\"equipoEntregado\"],\r\ntd[data-field=\"checklistEntregado\"],\r\ntd[data-field=\"cartaBienvenida\"]{ text-align:center; }\r\ntd[data-field=\"equipoEntregado\"] .check-animation,\r\ntd[data-field=\"checklistEntregado\"] .check-animation,\r\ntd[data-field=\"cartaBienvenida\"] .check-animation{ margin:1px auto; display:inline-flex; }\r\n\r\n/* Encabezados con icono (el JS añade .th-iconized + data-icon) */\r\nth.th-iconized{ position:relative; padding-left:30px!important; }\r\nth.th-iconized::before{\r\n  content:attr(data-icon); position:absolute; left:10px; top:50%; transform:translateY(-50%);\r\n  font-size:16px; opacity:.95; filter:drop-shadow(0 1px 0 rgba(0,0,0,.12));\r\n}\r\n\r\n/* Gradiente bonito del thead (si ya lo aplicas por clase, lo estiliza) */\r\n.bg-gradient-to-r.from-purple-500.to-pink-500{\r\n  background-image:linear-gradient(90deg,#7c3aed,#ec4899); color:#fff;\r\n}\r\n\r\n\r\n.rnr-b-grid table thead th,\r\n.details-grid table thead th,\r\n.rnr-grid-block table thead th,\r\ntable.runner-c thead th { text-align: center; }\r\n\r\nth.th-iconized{ text-align:center; padding-left:30px!important; }\r\nth.th-iconized::before{ left:10px; }\r\n",
			"listTotals": 1,
			"title": {}
		}
	],
	"geoCoding": {
		"enabled": false,
		"latField": "lat",
		"lonField": "lng",
		"addressFields": [
			"calle",
			"numeroext",
			"numeroint",
			"colonia",
			"ciudad",
			"estado",
			"cp",
			"lat",
			"lng"
		]
	},
	"caption": {
		"English": "Solicitudes"
	}
}