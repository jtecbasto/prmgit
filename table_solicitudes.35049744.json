{
	"orderInfo": [
		{
			"index": 43,
			"field": "estatusentrega",
			"expr": "solicitudes.idsolicitud",
			"asc": false
		}
	],
	"sql": "SELECT\n\tsolicitudes.idtipoventa,\n\tsolicitudes.fecha,\n\tsolicitudes.fechacaptura,\n\tsolicitudes.idcliente,\n\tsolicitudes.idproducto,\n\tsolicitudes.idplan,\n\tsolicitudes.usuario,\n\tsolicitudes.idtienda,\n\tsolicitudes.fechamodif,\n\tsolicitudes.orden,\n\tsolicitudes.solicitudimg,\n\tsolicitudes.estatus,\n\tsolicitudes.idsolrazon,\n\tsolicitudes.importeatt,\n\tsolicitudes.importesms,\n\tsolicitudes.plazo,\n\tsolicitudes.observaciones,\n\tsolicitudes.equipoincluido,\n\tsolicitudes.rfc,\n\tsolicitudes.idtratamiento,\n\tsolicitudes.riesgo,\n\tsolicitudes.observacionest,\n\tsolicitudes.idcli,\n\tsolicitudes.fecha1avta,\n\tsolicitudes.idplan1avta,\n\tsolicitudes.dn1avta,\n\tsolicitudes.idproceso,\n\tsolicitudes.idorigenventa,\n\tsolicitudes.estatusentrega,\n\tcte.nombre,\n\tcte.paterno,\n\tcte.materno,\n\tev.estado,\n\tev.ciudad,\n\tev.cp,\n\tev.calle,\n\tev.numeroext,\n\tev.numeroint,\n\tev.colonia,\n\tp.descripcion,\n\tCONCAT('https://www.google.com/maps/search/?api=1&query=', REPLACE(TRIM(CONCAT_WS(' ',\n             IFNULL(ev.numeroext,''),IFNULL(ev.calle,''),IFNULL(ev.numeroint,''),\n             IFNULL(ev.colonia,''),IFNULL(ev.cp,''),IFNULL(ev.ciudad,''),IFNULL(ev.estado,'')\n           )),' ','+')) AS maps_url,\n\tCONCAT(TRIM(CONCAT_WS(' ',\n      IF(IFNULL(ev.calle,'')='','', CONCAT('C.',ev.calle)),\n      IFNULL(CONCAT('No.',ev.numeroext),''),\n      IFNULL(CONCAT('Int.',ev.numeroint),''),\n      IFNULL(ev.colonia,''), IFNULL(CONCAT('C.P.',ev.cp),''),\n      IFNULL(ev.ciudad,''), IFNULL(ev.estado,'')\n    ))) AS direccion,\n\tsolicitudes.idsolicitud AS idsolicitud,\n\tsolicitudes.esnimei AS noserie,\n\tsolicitudes.simcard as simcard,\n\tss.chip,\n\tev.lat,\n\tev.lng,\n\tsolicitudes.dn AS dn,\n\tsolicitudes.dnpreferido AS dnpreferido,\n\tsolicitudes.cuenta AS cuenta,\n\tsolicitudes.contrato AS contrato,\n\tsolicitudes.contratoportal AS contratoportal,\n\tsolicitudes.plazopendiente AS plazopendiente,\n\tsolicitudes.Factura AS factura,\n\tsolicitudes.fechavenci AS fechavenci,\n\tsolicitudes.ciclo AS ciclo,\n\tidggtipoventa as idggtipoventa\nFROM\n\tsolicitudes AS solicitudes\n\tLEFT OUTER JOIN clientes AS cte ON cte.idcliente = solicitudes.idcliente\n\tLEFT OUTER JOIN entregasvnp AS ev ON ev.idsolicitud = solicitudes.idsolicitud\n\tLEFT OUTER JOIN productos AS p ON p.idproducto = solicitudes.idproducto\n\tleft join tiposventa AS t on solicitudes.idtipoventa=t.idtipoventa\n\tleft join gtiposventa as g on t.idgtipoventa=g.idgtipoventa\n\tLEFT OUTER JOIN (SELECT\n\tss.idsolicitud,\n\tMAX(CASE WHEN pr.clasif = 'Equipo' THEN ss.esnimei END) AS equipo,\n\tMAX(CASE WHEN pr.clasif = 'Chip'   THEN ss.esnimei END) AS chip\nFROM\n\tseriessolicitadas AS ss\n\tINNER JOIN compras AS cp ON cp.noserie = ss.esnimei \n\tINNER JOIN productos AS pr ON pr.codigoIUSA = cp.codigoproducto\n\t\nGROUP BY\n\tss.idsolicitud\n) AS ss ON ss.idsolicitud = solicitudes.idsolicitud\nwhere solicitudes.idtienda=146 and g.idggtipoventa=:session.idggtipoventa and if(solicitudes.usuario=':session.UserID',true,if(':session.Label'='MESADECONTROL' OR ':session.Label'='VALIDADOR',true,false))\nORDER BY\n\tsolicitudes.idsolicitud DESC\n",
	"connId": "conn",
	"originalTable": "solicitudes",
	"name": "solicitudes",
	"shortTableName": "solicitudes",
	"dbType": 0,
	"tableOwnerIdField": "idsolicitud",
	"usersOwnerIdField": "ID",
	"pageSizeRecords": 50,
	"pageSizeSelectorRecords": [
		"20",
		"30",
		"50",
		"100",
		"500",
		"all"
	],
	"keyFields": [
		"idsolicitud"
	],
	"detailsBadgeColor": "1e90ff",
	"detailsTables": [
		3847630651
	],
	"fields": [
		{
			"name": "idsolicitud",
			"sqlExpression": "solicitudes.idsolicitud",
			"index": 43,
			"strField": "idsolicitud",
			"type": 3,
			"autoinc": true,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Idsolicitud"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idtipoventa",
			"sqlExpression": "solicitudes.idtipoventa",
			"index": 1,
			"strField": "idtipoventa",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"required": true,
					"lookupType": 2,
					"lookupTable": "tiposventa",
					"lookupTableConnection": "conn",
					"lookupLinkField": "idtipoventa",
					"lookupDisplayField": "tipoventa",
					"lookupOrderBy": "tipoventa",
					"lookupWhere": "uso='VIGENTE' and g.idggtipoventa=:session.idggtipoventa"
				}
			],
			"label": {
				"English": "Idtipoventa",
				"Spanish": "Tipo de Venta"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "fecha",
			"sqlExpression": "solicitudes.fecha",
			"index": 2,
			"strField": "fecha",
			"type": 7,
			"separateEditViewFormats": true,
			"viewFormats": [
				{
					"format": "Short Date"
				},
				{
					"format": "Short Date",
					"pageType": "list"
				},
				{
					"format": "Short Date",
					"pageType": "print"
				},
				{
					"format": "Short Date",
					"pageType": "export"
				}
			],
			"editFormats": [
				{
					"format": "Readonly",
					"dateEditType": 11
				},
				{
					"format": "Readonly",
					"pageType": "add",
					"dateEditType": 11
				},
				{
					"format": "Date",
					"pageType": "search",
					"dateEditType": 11,
					"dateLastYearFactor": 1
				}
			],
			"defaultSearchOption": "Between",
			"searchOptions": [
				"Between"
			],
			"label": {
				"English": "Fecha"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "fechacaptura",
			"sqlExpression": "solicitudes.fechacaptura",
			"index": 3,
			"strField": "fechacaptura",
			"type": 135,
			"viewFormats": [
				{
					"format": "Short Date"
				}
			],
			"editFormats": [
				{
					"format": "Date",
					"dateEditType": 11
				}
			],
			"label": {
				"English": "Fechacaptura"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idcliente",
			"sqlExpression": "solicitudes.idcliente",
			"index": 4,
			"strField": "idcliente",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"required": true,
					"denyDuplicateMessage": {
						"text": "El cliente %value% ya existe",
						"type": 0
					},
					"lookupType": 2,
					"lookupTable": "clientes",
					"lookupTableConnection": "conn",
					"lookupLinkField": "idcliente",
					"lookupDisplayField": "nombre_completo",
					"lookupAllowAdd": true,
					"lookupAllowEdit": true,
					"lookupControlType": 2,
					"lookupListPage": "list",
					"lookupAddPage": "add",
					"lookupEditPage": "edit",
					"lookupAutofillFields": [
						{
							"masterField": "nombre",
							"lookupField": "nombre"
						},
						{
							"masterField": "paterno",
							"lookupField": "paterno"
						},
						{
							"masterField": "materno",
							"lookupField": "materno"
						},
						{
							"masterField": "rfc",
							"lookupField": "rfc"
						},
						{
							"masterField": "cliente_id",
							"lookupField": "idcliente"
						}
					]
				}
			],
			"label": {
				"English": "Idcliente",
				"Spanish": "Cliente"
			},
			"placeholder": {
				"Spanish": "Seleccione al cliente"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idproducto",
			"sqlExpression": "solicitudes.idproducto",
			"index": 5,
			"strField": "idproducto",
			"type": 3,
			"viewFormats": [
				{
					"textShowFirstN": 20
				}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"required": true,
					"lookupType": 2,
					"lookupTable": "productos",
					"lookupTableConnection": "conn",
					"lookupLinkField": "idproducto",
					"lookupDisplayField": "descripcion",
					"lookupControlType": 2,
					"lookupListPage": "list"
				}
			],
			"filterFormat": {
				"format": "Values list"
			},
			"label": {
				"English": "Idproducto",
				"Spanish": "Producto"
			},
			"placeholder": {
				"Spanish": "Seleccione el equipo"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idplan",
			"sqlExpression": "solicitudes.idplan",
			"index": 6,
			"strField": "idplan",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"required": true,
					"lookupType": 2,
					"lookupTable": "planes",
					"lookupTableConnection": "conn",
					"lookupLinkField": "idplan",
					"lookupDisplayField": "plan",
					"lookupWhere": "uso = 'Vigente' and tipo='Masivo'"
				}
			],
			"label": {
				"English": "Idplan",
				"Spanish": "Plan"
			},
			"placeholder": {
				"Spanish": "Seleccione el plan"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "usuario",
			"sqlExpression": "solicitudes.usuario",
			"index": 7,
			"strField": "usuario",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Usuario"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idtienda",
			"sqlExpression": "solicitudes.idtienda",
			"index": 8,
			"strField": "idtienda",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"lookupTable": "tiendas",
					"lookupTableConnection": "conn",
					"lookupLinkField": "IdTienda",
					"lookupDisplayField": "Tienda",
					"lookupOrderBy": "Tienda"
				}
			],
			"label": {
				"English": "Idtienda"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "fechamodif",
			"sqlExpression": "solicitudes.fechamodif",
			"index": 9,
			"strField": "fechamodif",
			"type": 135,
			"viewFormats": [
				{
					"format": "Short Date"
				}
			],
			"editFormats": [
				{
					"format": "Date",
					"dateEditType": 11
				}
			],
			"label": {
				"English": "Fechamodif"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "orden",
			"sqlExpression": "solicitudes.orden",
			"index": 10,
			"strField": "orden",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"required": true,
					"validateAs": "Regular expression",
					"validateRegex": "^[A-Z0-9]{11}$",
					"validateRegexMessage": {
						"text": "El valor es inválido",
						"type": 0
					},
					"textboxMaxLenth": 11
				}
			],
			"label": {
				"English": "Orden"
			},
			"placeholder": {
				"Spanish": "Ingrese la orden"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "solicitudimg",
			"sqlExpression": "solicitudes.solicitudimg",
			"index": 11,
			"strField": "solicitudimg",
			"type": 201,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Text area"
				}
			],
			"label": {
				"English": "Solicitudimg"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "estatus",
			"sqlExpression": "solicitudes.estatus",
			"index": 12,
			"strField": "estatus",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"lookupTable": "decisionessolicitud_lookup",
					"lookupTableConnection": "conn",
					"lookupLinkField": "decisionsolicitud",
					"lookupDisplayField": "decisionsolicitud",
					"lookupOrderBy": "decisionsolicitud"
				}
			],
			"label": {
				"English": "Estatus"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idsolrazon",
			"sqlExpression": "solicitudes.idsolrazon",
			"index": 13,
			"strField": "idsolrazon",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Idsolrazon"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "importeatt",
			"sqlExpression": "solicitudes.importeatt",
			"index": 14,
			"strField": "importeatt",
			"type": 5,
			"viewFormats": [
				{
					"format": "Number"
				}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Importeatt"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "importesms",
			"sqlExpression": "solicitudes.importesms",
			"index": 15,
			"strField": "importesms",
			"type": 5,
			"viewFormats": [
				{
					"format": "Number"
				}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Importesms"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "plazo",
			"sqlExpression": "solicitudes.plazo",
			"index": 16,
			"strField": "plazo",
			"type": 2,
			"separateEditViewFormats": true,
			"viewFormats": [
				{},
				{
					"pageType": "list"
				},
				{
					"pageType": "print"
				},
				{
					"pageType": "export"
				}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"lookupTable": "plazos",
					"lookupTableConnection": "conn",
					"lookupLinkField": "plazo",
					"lookupDisplayField": "plazo",
					"lookupOrderBy": "plazo"
				},
				{
					"format": "Lookup wizard",
					"pageType": "add",
					"lookupTable": "plazos",
					"lookupTableConnection": "conn",
					"lookupLinkField": "plazo",
					"lookupDisplayField": "plazo",
					"lookupOrderBy": "plazo"
				},
				{
					"format": "Readonly",
					"pageType": "search",
					"required": true,
					"lookupTable": "plazos",
					"lookupTableConnection": "conn",
					"lookupLinkField": "plazo",
					"lookupDisplayField": "plazo",
					"lookupOrderBy": "plazo"
				}
			],
			"label": {
				"English": "Plazo"
			},
			"placeholder": {
				"Spanish": "Ingrese el plazo"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "observaciones",
			"sqlExpression": "solicitudes.observaciones",
			"index": 17,
			"strField": "observaciones",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Text area"
				}
			],
			"label": {
				"English": "Observaciones",
				"Spanish": "Observaciones"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "equipoincluido",
			"sqlExpression": "solicitudes.equipoincluido",
			"index": 18,
			"strField": "equipoincluido",
			"type": 2,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Equipoincluido"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "rfc",
			"sqlExpression": "solicitudes.rfc",
			"index": 19,
			"strField": "rfc",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Readonly"
				}
			],
			"label": {
				"English": "Rfc"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idtratamiento",
			"sqlExpression": "solicitudes.idtratamiento",
			"index": 20,
			"strField": "idtratamiento",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Idtratamiento"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "riesgo",
			"sqlExpression": "solicitudes.riesgo",
			"index": 21,
			"strField": "riesgo",
			"type": 129,
			"viewFormats": [
				{
					"linkDisplay": 2,
					"linkDisplayField": "direccion"
				}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Riesgo"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "observacionest",
			"sqlExpression": "solicitudes.observacionest",
			"index": 22,
			"strField": "observacionest",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Observacionest"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idcli",
			"sqlExpression": "solicitudes.idcli",
			"index": 23,
			"strField": "idcli",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Idcli",
				"Spanish": "Cliente ID"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "fecha1avta",
			"sqlExpression": "solicitudes.fecha1avta",
			"index": 24,
			"strField": "fecha1avta",
			"type": 7,
			"viewFormats": [
				{
					"format": "Short Date"
				}
			],
			"editFormats": [
				{
					"format": "Date",
					"dateEditType": 11
				}
			],
			"label": {
				"English": "Fecha1avta"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idplan1avta",
			"sqlExpression": "solicitudes.idplan1avta",
			"index": 25,
			"strField": "idplan1avta",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Idplan1avta"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "dn1avta",
			"sqlExpression": "solicitudes.dn1avta",
			"index": 26,
			"strField": "dn1avta",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Dn1avta"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idproceso",
			"sqlExpression": "solicitudes.idproceso",
			"index": 27,
			"strField": "idproceso",
			"type": 2,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Idproceso"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idorigenventa",
			"sqlExpression": "solicitudes.idorigenventa",
			"index": 28,
			"strField": "idorigenventa",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"English": "Idorigenventa"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "nombre",
			"sqlExpression": "cte.nombre",
			"index": 30,
			"strField": "nombre",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Readonly"
				}
			],
			"label": {
				"Spanish": "Nombre(s)"
			},
			"placeholder": {
				"Spanish": "Nombre(s) del cliente"
			},
			"tableName": "clientes"
		},
		{
			"name": "paterno",
			"sqlExpression": "cte.paterno",
			"index": 31,
			"strField": "paterno",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Readonly"
				}
			],
			"label": {
				"Spanish": "Paterno"
			},
			"placeholder": {
				"Spanish": "Apellido paterno"
			},
			"tableName": "clientes"
		},
		{
			"name": "materno",
			"sqlExpression": "cte.materno",
			"index": 32,
			"strField": "materno",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Readonly"
				}
			],
			"label": {
				"Spanish": "Materno"
			},
			"placeholder": {
				"Spanish": "Apellido materno"
			},
			"tableName": "clientes"
		},
		{
			"name": "estado",
			"sqlExpression": "ev.estado",
			"index": 33,
			"strField": "estado",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"textHTML5Input": "Text"
				}
			],
			"label": {
				"Spanish": "Estado"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "ciudad",
			"sqlExpression": "ev.ciudad",
			"index": 34,
			"strField": "ciudad",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Ciudad"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "cp",
			"sqlExpression": "ev.cp",
			"index": 35,
			"strField": "cp",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "CP"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "calle",
			"sqlExpression": "ev.calle",
			"index": 36,
			"strField": "calle",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Calle"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "numeroext",
			"sqlExpression": "ev.numeroext",
			"index": 37,
			"strField": "numeroext",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "# Ext"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "numeroint",
			"sqlExpression": "ev.numeroint",
			"index": 38,
			"strField": "numeroint",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "# Int"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "colonia",
			"sqlExpression": "ev.colonia",
			"index": 39,
			"strField": "colonia",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Colonia"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "descripcion",
			"sqlExpression": "p.descripcion",
			"index": 40,
			"strField": "descripcion",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Readonly"
				}
			],
			"label": {
				"Spanish": "Descripción"
			},
			"tableName": "productos"
		},
		{
			"name": "maps_url",
			"sqlExpression": "CONCAT('https://www.google.com/maps/search/?api=1&query=', REPLACE(TRIM(CONCAT_WS(' ',\n             IFNULL(ev.numeroext,''),IFNULL(ev.calle,''),IFNULL(ev.numeroint,''),\n             IFNULL(ev.colonia,''),IFNULL(ev.cp,''),IFNULL(ev.ciudad,''),IFNULL(ev.estado,'')\n           )),' ','+'))",
			"index": 41,
			"strField": "maps_url",
			"type": 200,
			"viewFormats": [
				{
					"format": "Hyperlink",
					"linkNewWindow": true,
					"linkDisplay": 2,
					"linkDisplayField": "direccion",
					"linkDisplayText": {
						"text": "Dirección de entrega...",
						"type": 0
					}
				}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Maps Url"
			},
			"tableName": ""
		},
		{
			"name": "direccion",
			"sqlExpression": "CONCAT(TRIM(CONCAT_WS(' ',\n      IF(IFNULL(ev.calle,'')='','', CONCAT('C.',ev.calle)),\n      IFNULL(CONCAT('No.',ev.numeroext),''),\n      IFNULL(CONCAT('Int.',ev.numeroint),''),\n      IFNULL(ev.colonia,''), IFNULL(CONCAT('C.P.',ev.cp),''),\n      IFNULL(ev.ciudad,''), IFNULL(ev.estado,'')\n    )))",
			"index": 42,
			"strField": "direccion",
			"type": 200,
			"viewFormats": [
				{
					"format": "Custom",
					"customExpression": "\r\n"
				}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Direccion"
			},
			"tableName": ""
		},
		{
			"name": "estatusentrega",
			"sqlExpression": "solicitudes.estatusentrega",
			"index": 29,
			"strField": "estatusentrega",
			"type": 3,
			"separateEditViewFormats": true,
			"viewFormats": [
				{},
				{
					"format": "Custom",
					"pageType": "list",
					"customExpression": "switch($value)\r\n{\r\n    case 'PROGRAMADO';\r\n        $clase .= \" status-en-proceso\";\r\n        break;\r\n    case 'EN TRANSITO';\r\n        $clase .= \" status-en-proceso\";\r\n        break;\r\n    case 'REPROGRAMADO';\r\n        $clase .= \" status-en-proceso\";\r\n        break;\r\n    case 'DEVUELTO/CANCELADO';\r\n        $clase .= \" status-cancelado\";\r\n        break;\r\n    case 'ENTREGADO/INCOMPLETO';\r\n        $clase .= \" status-entregado\";\r\n        break;\r\n    case 'CERRADO';\r\n        $clase .= \" status-entregado\";\r\n        break;\r\n\r\n}\r\n\r\n$value = \"<span class='\" . $clase . \"'>\" . $value . \"</span>\";"
				},
				{
					"pageType": "export"
				},
				{
					"pageType": "masterlist"
				},
				{
					"pageType": "masterprint"
				}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"lookupTable": "estatusentregas",
					"lookupTableConnection": "conn",
					"lookupLinkField": "id",
					"lookupDisplayField": "estatusentrega"
				},
				{
					"format": "Lookup wizard",
					"pageType": "add",
					"lookupTable": "estatusentregas",
					"lookupTableConnection": "conn",
					"lookupLinkField": "id",
					"lookupDisplayField": "estatusentrega"
				},
				{
					"format": "Lookup wizard",
					"pageType": "search",
					"lookupTable": "estatusentregas",
					"lookupTableConnection": "conn",
					"lookupLinkField": "id",
					"lookupDisplayField": "estatusentrega"
				}
			],
			"label": {
				"Spanish": "Estatus entrega"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "chip",
			"sqlExpression": "ss.chip",
			"index": 46,
			"strField": "chip",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Readonly"
				}
			],
			"label": {
				"Spanish": "Simcard"
			},
			"tableName": ""
		},
		{
			"name": "lat",
			"sqlExpression": "ev.lat",
			"index": 47,
			"strField": "lat",
			"type": 14,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"validateAs": "Number"
				}
			],
			"label": {
				"Spanish": "Latitud"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "lng",
			"sqlExpression": "ev.lng",
			"index": 48,
			"strField": "lng",
			"type": 14,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Longitud"
			},
			"tableName": "entregasvnp"
		},
		{
			"name": "noserie",
			"sqlExpression": "solicitudes.esnimei",
			"index": 44,
			"strField": "esnimei",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"required": true
				}
			],
			"label": {
				"Spanish": "IMEI"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "dn",
			"sqlExpression": "solicitudes.dn",
			"index": 49,
			"strField": "dn",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"required": true,
					"textboxMaxLenth": 10,
					"textboxMask": "9999999999"
				}
			],
			"label": {
				"Spanish": "DN"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "cuenta",
			"sqlExpression": "solicitudes.cuenta",
			"index": 51,
			"strField": "cuenta",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"validateAs": "Number",
					"textboxMaxLenth": 50
				}
			],
			"label": {
				"Spanish": "Cuenta"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "contrato",
			"sqlExpression": "solicitudes.contrato",
			"index": 52,
			"strField": "contrato",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"textboxMaxLenth": 10
				}
			],
			"label": {
				"Spanish": "Contrato"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "contratoportal",
			"sqlExpression": "solicitudes.contratoportal",
			"index": 53,
			"strField": "contratoportal",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Contrato Portal"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "plazopendiente",
			"sqlExpression": "solicitudes.plazopendiente",
			"index": 54,
			"strField": "plazopendiente",
			"type": 2,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"validateAs": "Number"
				}
			],
			"label": {
				"Spanish": "Plazo pendiente"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "factura",
			"sqlExpression": "solicitudes.Factura",
			"index": 55,
			"strField": "Factura",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"textboxMaxLenth": 18
				}
			],
			"label": {
				"Spanish": "Factura"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "fechavenci",
			"sqlExpression": "solicitudes.fechavenci",
			"index": 56,
			"strField": "fechavenci",
			"type": 7,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Date"
				}
			],
			"label": {
				"Spanish": "Vencimiento"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "ciclo",
			"sqlExpression": "solicitudes.ciclo",
			"index": 57,
			"strField": "ciclo",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"format": "Lookup wizard",
					"required": true,
					"lookupType": 2,
					"lookupTable": "ciclos",
					"lookupTableConnection": "conn",
					"lookupLinkField": "ciclo",
					"lookupDisplayField": "corte",
					"lookupOrderBy": "corte",
					"lookupWhere": "clasif = 2"
				}
			],
			"label": {
				"Spanish": "Ciclo"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "dnpreferido",
			"sqlExpression": "solicitudes.dnpreferido",
			"index": 50,
			"strField": "dnpreferido",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{
					"textboxMaxLenth": 10
				}
			],
			"label": {
				"Spanish": "DN Preferido"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "simcard",
			"sqlExpression": "solicitudes.simcard",
			"index": 45,
			"strField": "simcard",
			"type": 200,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Simcard"
			},
			"tableName": "solicitudes"
		},
		{
			"name": "idggtipoventa",
			"sqlExpression": "idggtipoventa",
			"index": 58,
			"strField": "idggtipoventa",
			"type": 3,
			"viewFormats": [
				{}
			],
			"editFormats": [
				{}
			],
			"label": {
				"Spanish": "Idggtipoventa"
			},
			"tableName": ""
		}
	],
	"whereTabs": [
		{
			"where": "\n "
		}
	],
	"queryContext": {
		"session.idggtipoventa": "1",
		"session.UserID": "MCETZVNP",
		"session.Label": "VENDEDORES"
	},
	"eventHandlers": [
		{
			"eventId": "EVENT_BEFOREMOVENEXT_LIST",
			"pageType": "list",
			"code": "date_default_timezone_set('America/Mexico_City');\r\n\r\n\r\n$data[\"tienda\"]=$_SESSION[\"Tienda\"];\r\n$data['fechacaptura']=date('Y-m-d H:i:s');\r\n$data[\"almacenatt\"]=$_SESSION[\"Tienda\"];\r\n$data['ventadomicilio'] = 1;\r\n$data['equipoincluido']=1;\r\n$data['tiendamovil']=1;\r\n$data['clasif']=1;\r\n\r\n\r\n\r\n// Coloring por estatus (igual que ya tienes)\r\n$st = (int)$data[\"estatusentrega\"];\r\nswitch ($st) {\r\n  case 2:  $cls = 'table-success'; break;\r\n  case 3:  $cls = 'table-danger';  break;\r\n  default: $cls = 'table-warning';\r\n}\r\nif (!isset($row[\"rowattrs\"])) $row[\"rowattrs\"] = '';\r\n$row[\"rowattrs\"] .= ' class=\"'.$cls.'\"';\r\n\r\nif ($st === 3) {\r\n    $record[\"css\"]                  = 'background:#FF3A30';\r\n    $record['fecha_css']            = 'color:white';\r\n    $record['idcliente_css']        = 'color:white';\r\n    $record['descripcion_css']      = 'color:white';\r\n    $record['estatus_css']          = 'color:white';\r\n    $record['plazo_css']            = 'color:white';\r\n    $record['orden_css']            = 'color:white';\r\n    $record['maps_url_css']         = 'color:white';\r\n    $record['estatusentrega_css']   = 'color:white';\r\n    $record['equipo_css']           = 'color:white';\r\n    $record['chip_css']             = 'color:white';\r\n}\r\n\r\n// PK\r\n// PK\r\n$pk = $data[\"idsolicitud\"];\r\nif (!$pk) return;\r\n\r\n// Elige la página (usa tu lógica real)\r\n$role = strtoupper($_SESSION[\"Label\"] ?? ''); \r\n\r\n// === 2) Elegir página target ===\r\n// === 2) Página destino ===\r\n$targetPage = ($role === 'MESADECONTROL') ? 'edit1' : 'edit';\r\n\r\n// === 3) Base SIEMPRE a \"edit\" para obtener solicitudes_edit.php\r\n$baseHref = GetTableLink(\"solicitudes\", \"edit\"); // => solicitudes_edit.php\r\n\r\n// === 4) Querystring: page=..., editid1=..., menuItemId (si existe)\r\n$qs = [];\r\n$qs[] = \"page=\".$targetPage;\r\n$qs[] = \"editid1=\".$pk;\r\n\r\n// Conserva menuItemId si llegó por GET/POST\r\n$menuItemId = postvalue(\"menuItemId\");\r\nif( strlen($menuItemId) ){\r\n    $qs[] = \"menuItemId=\".rawurlencode($menuItemId);\r\n}\r\n\r\n$href = $baseHref . \"?\" . implode(\"&\", $qs);\r\n\r\n// === 5) Data-attrs que PHPRunner usa para popup/handlers ===\r\n$keys = array(\"idsolicitud\" => $pk);\r\n$keysJson = runner_htmlspecialchars(my_json_encode($keys));\r\n\r\n$attrs  = 'href=\"'.runner_htmlspecialchars($href).'\"';\r\n$attrs .= ' data-href=\"'.runner_htmlspecialchars($href).'\"';\r\n$attrs .= ' data-table=\"'.GetTableURL(\"solicitudes\").'\"';\r\n$attrs .= ' data-pagetype=\"edit\"';\r\n$attrs .= ' data-page=\"'.$targetPage.'\"';\r\n$attrs .= ' data-keys=\"'.$keysJson.'\"';\r\n$attrs .= ' class=\"rnr-editlink\"';\r\n\r\n// === 6) Reasignar a los tres puntos de enlace comunes ===\r\n$record[\"editlink_attrs\"]        = $attrs;\r\n$record[\"editlink_attrs_icon\"]   = $attrs;\r\n$record[\"editlink_button_attrs\"] = $attrs;\r\n\r\n\r\n\r\n// Debug\r\n//error_log(\"DEBUG-REDIR: Role=$role TargetPage=$targetPage Href=$href\", 3, 'debug_file.log');"
		},
		{
			"eventId": "EVENT_BEFOREQUERY_LIST",
			"pageType": "list",
			"code": "/*\nswitch (true) {\n\n\t//case ($_SESSION[\"Acceso\"]===0 OR strtoupper($_SESSION['UserID'])=='ADMIN'):\n\tcase ( strtoupper($_SESSION['UserID'])=='ADMIN'):\n\t\t\t\t\tbreak;\n\t\tcase (strtoupper($_SESSION[\"Label\"])=='VALIDADOR'  || strtoupper($_SESSION[\"Label\"])=='MESADECONTROL'):\n    //   $strWhereClause=WhereAdd($strWhereClause,\"solicitudes.idtipoventa in (1,11,21,22)\");\n\t       break;\n\t\t\t\n\t\t\tcase ($_SESSION[\"Acceso\"]==1):\n       $strWhereClause=WhereAdd($strWhereClause,\"//solicitudes.idtipoventa not in (1,11,21,22) and solicitudes.idtienda=\".$_SESSION[\"Tienda\"]); //solicitado por Diego\n \n        break;\n  /* case ($_SESSION[\"Acceso\"]==2):\n\t\t\t\t\n         $strWhereClause=WhereAdd($strWhereClause,\"solicitudes.idtipoventa>1 AND solicitudes.idtienda=\".$_SESSION[\"Tienda\"]);\n        break;*//*\n    case ($_SESSION[\"Acceso\"]===10 ):\n        $strWhereClause=whereAdd($strWhereClause,\" solicitudes.idtienda in (\nselect distinct t.idtienda from tiendas t inner join\n userssectores us on t.idsector=us.idsector\n where username='\".$_SESSION[\"UserID\"].\"')\");\n        break;\n\t\tdefault:\n\t\t\t\t$strWhereClause=whereAdd($strWhereClause,\"solicitudes.usuario='\".$_SESSION['UserID'].\"'\");\n\t\t\t\tbreak;\n}\n*/\n\n/*\nswitch (true) {\n\n\n\tcase ( strtoupper($_SESSION['UserID'])=='ADMIN'):\n\t\t\t\t\tbreak;\n\t\tcase (strtoupper($_SESSION[\"Label\"])=='VALIDADOR'):\n       $strWhereClause=WhereAdd($strWhereClause,\"solicitudes.idtipoventa in (1,11,21,22)\");\n\t       break;\n\t\t\t\n\t\t\tcase ($_SESSION[\"Acceso\"]==1):\n       $strWhereClause=WhereAdd($strWhereClause,\"solicitudes.idtipoventa not in (1,11,21,22) and solicitudes.idtienda=\".$_SESSION[\"Tienda\"]); \n \n        break;\n\n    case ($_SESSION[\"Acceso\"]===10 ):\n        $strWhereClause=whereAdd($strWhereClause,\" solicitudes.idtienda in (\nselect distinct t.idtienda from tiendas t inner join\n userssectores us on t.idsector=us.idsector\n where username='\".$_SESSION[\"UserID\"].\"')\");\n        break;\n\t\tdefault:\n\t\t\t\t$strWhereClause=whereAdd($strWhereClause,\"solicitudes.usuario='\".$_SESSION['UserID'].\"'\");\n\t\t\t\tbreak;\n}\n*/\n\n\n\n// Antes de SQL Query (& $where, & $orderby, $pageObject)\n/*\n$tipoventa_from_url = postvalue(\"tipoventa\");\n\nif (!empty($tipoventa_from_url)) {\n    \n    // 1. Construir la condición usando el alias de la tabla 'g'\n    // La clave es referenciar 'g.idggtipoventa'\n    $filtro = \"g.idggtipoventa = \" . (int)$tipoventa_from_url;\n\n    // 2. Agregar el filtro a la cláusula $where existente\n    if (strlen($where) > 0) {\n        // Si ya hay un WHERE, lo concatenamos\n        $where.= \" AND ( \" . $filtro . \" ) \";\n    } else {\n        // Si no hay WHERE, este es el único filtro\n        $where = $filtro;\n    }\n    \n  \n  //  error_log(\"Filtro aplicado por IDGG: \" . $where, 3, \"debug_log.log\");\n}\n\n//return true;\n*/\n\n// 1) Tomar fechas en este orden de prioridad: GET -> SESSION -> defaults\n$in  = isset($_GET['FechaIn']) ? $_GET['FechaIn'] : ( isset($_SESSION['FechaIn']) ? $_SESSION['FechaIn'] : date('Y-m-d', strtotime('-30 days')) );\n$fn  = isset($_GET['FechaFn']) ? $_GET['FechaFn'] : ( isset($_SESSION['FechaFn']) ? $_SESSION['FechaFn'] : date('Y-m-d') );\n\n// 2) Validar formato (YYYY-MM-DD); si no es válido, poner defaults\n$check = function($d){\n    $dt = DateTime::createFromFormat('Y-m-d', $d);\n    return $dt && $dt->format('Y-m-d') === $d;\n};\nif( !$check($in) ) $in = date('Y-m-d', strtotime('-30 days'));\nif( !$check($fn) ) $fn = date('Y-m-d');\n\n// 3) Si el usuario invirtió el rango, corregir (swap)\nif( $in > $fn ){\n    $tmp = $in; $in = $fn; $fn = $tmp;\n}\n\n// 4) Guardar en sesión (para siguientes cargas)\n$_SESSION['FechaIn'] = $in;\n$_SESSION['FechaFn'] = $fn;\n\n// 5) Construir el WHERE\n//    - Si tu campo 'fecha' es DATE, BETWEEN es inclusivo y esto basta.\n//    - Si fuese DATETIME y quieres incluir todo el día final, usa <= DATE_ADD($fn, INTERVAL 1 DAY)\nif( $strWhereClause != \"\" ) {\n    $strWhereClause .= \" AND \";\n}\n$strWhereClause .= \" solicitudes.fecha BETWEEN \" . add_db_quotes(\"fecha\", $in) . \" AND \" . add_db_quotes(\"fecha\", $fn);\n\n// Para depurar:\n// LogInfo(\"Rango aplicado: $in a $fn\");\n// LogInfo(\"WHERE: \".$strWhereClause);\n"
		},
		{
			"eventId": "EVENT_BEFOREPROCESSROW_LIST",
			"pageType": "list",
			"code": "/*\n$params = [];\n$i = 1;\nforeach( $pageObject->pSet->getTableKeys() as $pk ){\n  $params[] = \"editid\".$i.\"=\".rawurlencode($data[$pk]);\n  $i++;\n}\n$q = implode(\"&\", $params);\n\n// Decide en servidor\n$userId  = isset($_SESSION['UserID']) ? strtoupper((string)$_SESSION['UserID']) : '';\n$isAdmin = ($userId === 'ADMIN');\n\n$dest = GetTableLink(\"solicitudes\", $isAdmin ? \"edit1\" : \"edit\") . \"?\" . $q;\n\n// Edit no-popup: usa href (también seteo data-href por si el tema lo usa)\n$attr = 'href=\"'.runner_htmlspecialchars($dest).'\" data-href=\"'.runner_htmlspecialchars($dest).'\" class=\"rnr-editlink\"';\n$record[\"editlink_attrs\"]       = $attr;\n$record[\"editlink_attrs_icon\"]  = $attr;   // si el tema muestra icono aparte\n$record[\"editlink_button_attrs\"]= $attr;   // por si renderiza un botón\n*/"
		},
		{
			"eventId": "EVENT_BEFORESHOW_LIST",
			"pageType": "list",
			"code": "// Place event code here.\n// Use \"Add Action\" button to add code snippets.\n\n// Detecta ADMIN y otras banderas servidor-side\n// Detecta ADMIN y otras banderas servidor-side\n// --- Reglas de acceso ---\n$userId      = isset($_SESSION['UserID']) ? strtoupper((string)$_SESSION['UserID']) : '';\n$isAdmin     = ($userId === 'ADMIN');\n$isValidador = (isset($_SESSION['Label'])  && $_SESSION['Label'] === 'VALIDADOR');\n$hasAcceso   = (isset($_SESSION['Acceso']) && intval($_SESSION['Acceso']) === 1);\n\n$role = $_SESSION['Label'];\n\n$pageObject->setProxyValue(\"currentRole\", $role);\n$pageObject->setProxyValue(\"currentUser\", $userId);\n// Cambia la condición a tu gusto:\n$allowLogistic =  $isAdmin || ($isValidador && $hasAcceso);\n\n// IMPORTANTE: usa el *itemid* real del botón en el diseñador (Builder).\n// Te recomiendo renombrarlo a \"logistic_btn\". Si en tu HTML ves data-itemid=\"custom_button\",\n// entonces cambia \"logistic_btn\" por \"custom_button\".\nif (!$allowLogistic) {\n  //  $pageObject->hideItem(\"logistic_btn\");   // oculta la columna/botón para ese usuario\n} else {\n    // lo exponemos por si quieres usarlo del lado cliente (opcional)\n    $pageObject->setProxyValue(\"allowLogistic\", true);\n}\n\n\n\n"
		},
		{
			"eventId": "EVENT_BEFOREPROCESS_LIST",
			"pageType": "list",
			"code": "\t$_SESSION[\"Modulo\"]=1;\n\n// BeforeProcessList (o BeforeSQLQuery si usas un query de SQL)\n\n$tipoventa_from_url = postvalue(\"tipoventa\");\n\nif (!empty($tipoventa_from_url)) {\n    // 1. Construir la condición de filtro\n   // $where = \"idggtipoventa = \" . (int)$tipoventa_from_url;\n    $_SESSION['idggtipoventa']=(int)$tipoventa_from_url;\n     // Versión 10+ (Recomendada):\n  //  $pageObject->setTableFilter($where);\n    \n    // Versiones anteriores (o si tienes $gQuery):\n    // $gQuery->setWhere( $gQuery->getWhere() . \" AND \" . $where );\n}\n\n"
		},
		{
			"eventId": "EVENT_JS_ONLOAD",
			"pageType": "add",
			"code": "// ====================== CONFIG ======================\nwindow.STORAGE_KEY   = 'solicitud_vnp_draft';\nwindow.ENDPOINT      = 'serial_reserve.php';        // reserva/libera series\nwindow.API_SAVE      = 'solicitud_save_api.php';    // guarda solicitud vía API\n\nwindow.FIELDS = [\n  'idcliente','idproducto','idtipoventa','idplan','orden','plazo','rfc','idcli',\n  'estado','ciudad','colonia','calle','numeroext','numeroint','noserie','cp',\n  'dn','cuenta','contrato','contratoportal','plazopendiente','dnpreferido','idtienda',\n  'factura','fechavenci','observaciones'\n];\n\nwindow.__recovering  = false;\nwindow.__res_noserie = null;\nwindow.__saving      = false;\n\nvar DRAFT_TTL = 2 * 60 * 60 * 1000; // 2 horas\n\n// ====================== CARGAR SWEETALERT2 (si no existe) ======================\n(function ensureSwal(){\n  if (typeof Swal !== 'undefined') return;\n  var s = document.createElement('script');\n  s.src = \"https://cdn.jsdelivr.net/npm/sweetalert2@11\";\n  s.async = true;\n  document.head.appendChild(s);\n})();\n\n// ====================== HELPERS BÁSICOS ======================\nfunction getPid(){\n  return $('[data-pageid]').first().attr('data-pageid') || '';\n}\nfunction getCtrl(f){\n  try { return Runner.getControl(getPid(), f); } catch(e){ return null; }\n}\nfunction readVal(f){\n  var c = getCtrl(f);\n  if (c && typeof c.getValue === 'function') return c.getValue();\n  var pid = getPid();\n  var $el = $('#value_'+f+'_'+pid);\n  return $el.length ? $el.val() : '';\n}\nfunction setVal(f,v,fire){\n  var c = getCtrl(f);\n  if (c && typeof c.setControlValue === 'function') {\n    c.setControlValue(v);\n    if (fire && typeof c.fireEvent === 'function') c.fireEvent('change');\n    return;\n  }\n  var pid = getPid();\n  var $el = $('#value_'+f+'_'+pid);\n  if ($el.length){\n    $el.val(v);\n    if (fire) $el.trigger('change');\n  }\n}\nfunction log(){ if (window.console && console.log) console.log.apply(console, arguments); }\n\n// ====================== SWEETALERT WRAPPERS ======================\nfunction showSuccess(msg, cb){\n  if (typeof Swal !== 'undefined') {\n    Swal.fire({\n      title: 'Guardado correctamente',\n      text: msg || '',\n      icon: 'success',\n      confirmButtonText: 'Aceptar',\n      timer: 2200,\n      timerProgressBar: true\n    }).then(function(){ if (typeof cb === 'function') cb(); });\n  } else {\n    alert(msg || 'Guardado correctamente.');\n    if (typeof cb === 'function') cb();\n  }\n}\nfunction showError(msg){\n  if (typeof Swal !== 'undefined') {\n    Swal.fire({ title: 'Error', text: msg || 'Ocurrió un error.', icon: 'error', confirmButtonText: 'Aceptar' });\n  } else {\n    alert(msg || 'Ocurrió un error.');\n  }\n}\n\n// ====================== AUTOSAVE ======================\nfunction buildDraft(){\n  var d = {};\n  (window.FIELDS || []).forEach(function(f){\n    var v = readVal(f);\n    if (v !== null && v !== undefined && v !== '') d[f] = v;\n  });\n  d.timestamp = Date.now();\n  return d;\n}\nfunction saveDraft(){\n  if (window.__recovering) return;\n  try {\n    var d = buildDraft();\n    sessionStorage.setItem(window.STORAGE_KEY, JSON.stringify(d));\n  } catch(e){ log('Error saveDraft', e); }\n}\nfunction recoverDraft(){\n  var raw = sessionStorage.getItem(window.STORAGE_KEY);\n  if (!raw) return;\n  try {\n    var d = JSON.parse(raw);\n    if (!d.timestamp || (Date.now() - d.timestamp) > DRAFT_TTL) {\n      sessionStorage.removeItem(window.STORAGE_KEY);\n      return;\n    }\n    window.__recovering = true;\n    log('Draft encontrado', d);\n\n    if (d.idproducto){\n      setVal('idproducto', d.idproducto, true);\n      setTimeout(function(){\n        Object.keys(d).forEach(function(k){\n          if (k !== 'timestamp' && k !== 'idproducto') setVal(k, d[k], false);\n        });\n        window.__recovering = false;\n      }, 300);\n    } else {\n      Object.keys(d).forEach(function(k){\n        if (k !== 'timestamp') setVal(k, d[k], false);\n      });\n      window.__recovering = false;\n    }\n  } catch(e){ log('Draft inválido', e); }\n  sessionStorage.removeItem(window.STORAGE_KEY);\n}\n\n// ====================== RESERVAS (serial_reserve.php) ======================\nfunction releasePrev(){\n  if (!window.__res_noserie) return;\n  log('Liberando reserva previa', window.__res_noserie);\n  $.post(window.ENDPOINT, { action:'release', noserie: window.__res_noserie });\n  window.__res_noserie = null;\n}\nfunction reserveForProduct(productId){\n  if (!productId || window.__recovering) return;\n  log('Reservando serie para producto', productId);\n\n  releasePrev();\n  setVal('noserie','',true);\n\n  $.post(window.ENDPOINT, { action:'reserve_by_product', product_id: productId })\n    .done(function(resp){\n      var r = (typeof resp === 'object') ? resp : (function(){ try {return JSON.parse(resp);}catch(e){return null;} })();\n      log('Respuesta reserva', r);\n\n      if (r && r.ok && r.noserie) {\n        window.__res_noserie = r.noserie;\n        setVal('noserie', r.noserie, true);\n        saveDraft();\n      } else if (r && r.error === 'no-stock') {\n        showError('No hay series disponibles para este producto.');\n        setVal('idproducto','',true);\n      } else {\n        showError('No se pudo reservar la serie.');\n        setVal('idproducto','',true);\n      }\n    })\n    .fail(function(){\n      showError('Error de comunicación al reservar la serie.');\n      setVal('idproducto','',true);\n    });\n}\n\n// ====================== RESET UI INMEDIATO (nuevo) ======================\nfunction resetAddFormUI(){\n  try {\n    var pid = getPid();\n\n    // 1) reset nativo por si el form existe\n    var frm = $('form').get(0);\n    if (frm && typeof frm.reset === 'function') frm.reset();\n\n    // 2) limpiar controles PHPRunner\n    (window.FIELDS || []).forEach(function(f){\n      try {\n        var c = getCtrl(f);\n        if (c && typeof c.setValue === 'function') {\n          c.setValue('');\n          if (typeof c.fireEvent === 'function') c.fireEvent('change');\n        } else {\n          // fallback DOM\n          var $el = $('#value_'+f+'_'+pid);\n          if ($el.length) { $el.val(''); $el.trigger('change'); }\n        }\n      } catch(e){}\n    });\n\n    // 3) limpiar select2 si existiera\n    $('.select2').each(function(){ try { $(this).val(null).trigger('change'); } catch(e){} });\n\n  } catch(e){ /* ignore */ }\n}\n\n// ====================== CLEAN FORM TRAS ÉXITO (modificado) ======================\nfunction cleanAfterSuccess(){\n  // Libera serie reservada si existe\n  if (window.__res_noserie) {\n    $.post(window.ENDPOINT, { action:'release', noserie: window.__res_noserie });\n    window.__res_noserie = null;\n  }\n\n  // Limpieza visual inmediata (sin esperar reload)\n  resetAddFormUI();\n\n  // Borrar draft\n  try { sessionStorage.removeItem(window.STORAGE_KEY); } catch(e){}\n\n  // Disparo silencioso para que el BeforeDisplay/BeforeProcess limpie la sesión\n  // (tu evento PHP mira clean=1 y hace unset de las *_add_values)\n  $.post('solicitudes_add.php', { clean: 1, ajax_clean: 1 });\n\n  // Recargamos con clean=1 para garantizar formulario fresco\n  var url = window.location.pathname + '?new=1&clean=1&_t=' + Date.now();\n  window.location.href = url;\n}\n\n// ====================== API SAVE (solicitud_save_api.php) ======================\nfunction sendToAPI(){\n  if (window.__saving) return;\n  window.__saving = true;\n\n  var datos = {};\n  (window.FIELDS || []).forEach(function(f){ datos[f] = readVal(f); });\n\n  log('Payload a API_SAVE:', datos);\n\n  $.post(window.API_SAVE, datos, function(respRaw){\n    var r = (typeof respRaw === 'object') ? respRaw : (function(){ try { return JSON.parse(respRaw); } catch(e){ return null; } })();\n    log('Respuesta API_SAVE:', r || respRaw);\n\n    if (!r) {\n      showError('Respuesta inválida del servidor.');\n      window.__saving = false;\n      return;\n    }\n\n    var ok = (r.ok === true || r.ok === 1 || r.ok === \"1\" || r.ok === \"ok\" || r.ok === \"OK\");\n\n    if (ok) {\n      var msg = r.message || 'Solicitud guardada correctamente.';\n      showSuccess(msg, function(){ cleanAfterSuccess(); });\n    } else {\n      showError(r.error || 'Error desconocido al guardar.');\n    }\n\n    window.__saving = false;\n  })\n  .fail(function(xhr){\n    log('Fallo AJAX API_SAVE:', xhr.status, xhr.responseText);\n    showError('Error de comunicación con el servidor.');\n    window.__saving = false;\n  });\n}\n\n// ====================== INIT ======================\n$(function(){\n  var pid      = getPid();\n  var ctrlProd = getCtrl('idproducto');\n\n  log('INIT solicitudes_add pid=', pid, 'ctrlProd=', !!ctrlProd);\n\n  // 1) Recuperar borrador si existe\n  recoverDraft();\n\n  // 2) Autosave en cambios\n  var sel = (window.FIELDS || []).map(function(f){\n    return \"[data-field='\"+f+\"'][data-pageid='\"+pid+\"'] input,\" +\n           \"[data-field='\"+f+\"'][data-pageid='\"+pid+\"'] select,\" +\n           \"[data-field='\"+f+\"'][data-pageid='\"+pid+\"'] textarea\";\n  }).join(',');\n  if (sel) {\n    $(document).on('input change', sel, function(){ saveDraft(); });\n  }\n\n  // 3) Reserva automática al cambiar producto\n  if (ctrlProd) {\n    ctrlProd.on('change', function(){\n      if (window.__recovering) return;\n      var v = ctrlProd.getValue();\n      log('Cambio de idproducto =>', v);\n      if (v) reserveForProduct(v);\n    });\n  }\n\n  // 4) Botón personalizado \"Guardar VNP\"\n  var saveSelector =\n    \"[data-itemid='btnGuardarVNP'] a, \" +\n    \"[data-itemid='btnGuardarVNP'] button, \" +\n    \"#btnGuardarVNP\";\n\n  $(document).on('click', saveSelector, function(e){\n    e.preventDefault();\n    log('Click en botón VNP detectado');\n    sendToAPI();\n  });\n\n  // 5) Bloquear submit clásico\n  $('form').on('submit', function(e){ e.preventDefault(); return false; });\n\n  // 6) Liberar reserva al salir si no se está guardando\n  $(window).on('beforeunload pagehide', function(){\n    if (!window.__saving) {\n      releasePrev();\n      saveDraft();\n    }\n  });\n});\n\n\n(function(){\n  var $ = window.jQuery || window.$;\n  if (!$) return;\n\n  // ------------- Config -------------\n  var LOOKUP_IFR_SELECTOR = 'iframe[src*=\"_list.php\"]'; // iframes de LIST del lookup\n  var ADD_HINT = 'Alta rápida';                          // texto del botón fallback\n\n  // ------------- Portal en TOP -------------\n  function ensureTopPortal(){\n    var topDoc = window.top.document;\n    if (!topDoc.getElementById('lkpAddPortal')){\n      var wrap = topDoc.createElement('div');\n      wrap.id = 'lkpAddPortal';\n      wrap.innerHTML =\n        '<div class=\"shell\">' +\n          '<div class=\"close-btn\" id=\"lkpAddPortalClose\">Cerrar</div>' +\n          '<iframe id=\"lkpAddPortalFrame\" src=\"about:blank\" allow=\"clipboard-write; clipboard-read\"></iframe>' +\n        '</div>';\n      topDoc.body.appendChild(wrap);\n      topDoc.getElementById('lkpAddPortalClose').addEventListener('click', closeTopPortal);\n    }\n  }\n  function openTopPortal(url, onClose){\n    ensureTopPortal();\n    var topDoc = window.top.document;\n    var portal = topDoc.getElementById('lkpAddPortal');\n    var frame  = topDoc.getElementById('lkpAddPortalFrame');\n\n    // bloquear scroll del top mientras está abierto\n    window.top.document.body.style.overflow = 'hidden';\n\n    // abre el _add en el iframe del portal\n    if (url.indexOf('embedded=1') === -1){\n      url += (url.indexOf('?')>-1 ? '&' : '?') + 'embedded=1';\n    }\n    frame.src = url;\n\n    // marca handler de cierre\n    portal._onClose = (typeof onClose === 'function') ? onClose : null;\n\n    portal.style.display = 'block';\n  }\n  function closeTopPortal(){\n    var topDoc = window.top.document;\n    var portal = topDoc.getElementById('lkpAddPortal');\n    var frame  = topDoc.getElementById('lkpAddPortalFrame');\n    if (!portal) return;\n\n    // limpia y oculta\n    try { frame.src = 'about:blank'; } catch(e){}\n    portal.style.display = 'none';\n    window.top.document.body.style.overflow = '';\n\n    // callback para recargar la LIST\n    if (portal._onClose){ try { portal._onClose(); } catch(e){} }\n    portal._onClose = null;\n  }\n\n  // Permite que el _add (si es mismo origen) pueda enviar un postMessage {type:'lkp-add-close'}\n  window.top.addEventListener('message', function(ev){\n    try {\n      if (ev && ev.data && ev.data.type === 'lkp-add-close') closeTopPortal();\n    } catch(e){}\n  });\n\n  // ------------- Fijar tamaño del modal del LIST (padre) -------------\n  function fitListModal(){\n    var $modal = $('.modal:has(' + LOOKUP_IFR_SELECTOR + ')');\n    if (!$modal.length) return;\n    $modal.find('.modal-dialog').css({ maxWidth: '95vw', width: '92vw' });\n    $modal.find('.modal-body').css({ height: '85vh' });\n    $(LOOKUP_IFR_SELECTOR).css({ width: '100%', height: '100%', minHeight: '600px' });\n  }\n\n  // ------------- Hook del botón \"Add\" dentro del LIST (si es mismo origen) -------------\n  function hookAddInsideIframe($ifr){\n    if ($ifr.data('wiredAdd')) return;\n    $ifr.data('wiredAdd', true);\n\n    $ifr.on('load', function(){\n      fitListModal();\n\n      try {\n        var idoc  = this.contentDocument || this.contentWindow.document;\n        var $idoc = window.jQuery(idoc);\n\n        function rewire(){\n          // enlaces o botones que llevan al _add\n          $idoc.find('a[href*=\"_add.php\"], button[id*=\"add\"]').off('.lkp3').on('click.lkp3', (ev)=>{\n            ev.preventDefault(); ev.stopPropagation();\n\n            // construye URL del add\n            var addUrl = ev.currentTarget.href || '';\n            if (!addUrl){\n              var cur = idoc.location.href;\n              addUrl = cur.replace('_list.php','_add.php').replace(/\\?.*/,'');\n            }\n\n            // abre en portal TOP, y al cerrar recarga la LIST\n            openTopPortal(addUrl, ()=>{ try { idoc.location.reload(true); } catch(e){} });\n            return false;\n          });\n        }\n\n        rewire();\n        // si la LIST es AJAX, reengancha\n        var mo = new (window.MutationObserver || window.WebKitMutationObserver)(rewire);\n        mo.observe(idoc.body, { childList:true, subtree:true });\n\n        // Si el _add que se abre dentro del propio iframe se intentara inyectar,\n        // evitamos que cambie el src del iframe (defensa adicional):\n        var originalSrc = this.src;\n        var self = this;\n        setInterval(function(){\n          if (self.src.indexOf('_add.php')>-1) self.src = originalSrc;\n        }, 300);\n\n      } catch(e){\n        // cross-origin: no podemos enganchar dentro\n      }\n    });\n  }\n\n  // ------------- Fallback CROSS-ORIGIN (botón \"Alta rápida\") -------------\n  var floatingBtn;\n  function ensureFloatingButton(){\n    if (floatingBtn && document.body.contains(floatingBtn)) return floatingBtn;\n    floatingBtn = document.createElement('div');\n    floatingBtn.className = 'lkp-floating-add';\n    floatingBtn.textContent = ADD_HINT;\n    document.body.appendChild(floatingBtn);\n    return floatingBtn;\n  }\n  function wireFloatingButton($ifr){\n    var btn = ensureFloatingButton();\n    // Calcula la URL del ADD a partir del src del LIST (esto SÍ se puede leer cross-origin)\n    var src = $ifr.attr('src') || '';\n    if (!src || src.indexOf('_list.php') === -1){\n      btn.style.display = 'none';\n      return;\n    }\n    var addUrl = src.replace('_list.php','_add.php').replace(/\\?.*/,'');\n    btn.onclick = function(){\n      openTopPortal(addUrl, function(){\n        // intenta recargar el iframe de la LIST\n        try { $ifr[0].contentWindow.location.reload(true); } catch(e){ /* cross-origin: ignora */ }\n        // como fallback cross-origin, fuerza recargar el src:\n        var s = $ifr.attr('src');\n        $ifr.attr('src', s);\n      });\n    };\n    btn.style.display = 'block';\n  }\n\n  // ------------- Escaneo + Observers -------------\n  function scan(){\n    fitListModal();\n    $(LOOKUP_IFR_SELECTOR).each(function(){\n      var $ifr = $(this);\n      hookAddInsideIframe($ifr);\n      // Activa botón flotante siempre, sirve de fallback y es cómodo\n      wireFloatingButton($ifr);\n    });\n  }\n\n  var mo = new (window.MutationObserver || window.WebKitMutationObserver)(scan);\n  mo.observe(document.body, { childList:true, subtree:true });\n  scan();\n\n  // Ajuste por resize del viewport\n  $(window).on('resize.lkp3', fitListModal);\n})();\n\n\n\n\n\n"
		},
		{
			"eventId": "EVENT_BEFORESHOW_EDIT",
			"pageType": "edit",
			"code": "// BeforeShowEdit(&$xt, &$templatefile, $pageObject)\r\n\r\nglobal $pageObject;\r\n\r\n$values['estatus'] = \r\n/*$userGroupID = Security::getUserGroupID();\r\n$userName = Security::getUserName*/\r\n$pageObject->setProxyValue(\"currentUser\", $_SESSION[\"UserID\"]);\r\n$pageObject->setProxyValue(\"currentRole\", $_SESSION[\"Label\"]);\r\n$pageObject->setProxyValue(\"currentStatus\", $values[\"estatus\"]);\r\n\r\n/*\r\necho \"<script type='text/javascript'>\r\n    window.userRole = '{$userGroupID}';\r\n    window.userName = '{$userName}';\r\n</script>\";\r\n*/\r\n// Aseguramos que tenemos los valores actuales del registro\r\n$idsolicitud = isset($values[\"idsolicitud\"]) ? (int)$values[\"idsolicitud\"] : 0;\r\n$idproducto  = isset($values[\"idproducto\"])  ? (int)$values[\"idproducto\"]  : 0;\r\n\r\n// Guardamos en sesión para que el lookup pueda incluir este producto\r\n$_SESSION[\"CurrIdSolicitud\"] = $idsolicitud;\r\n$_SESSION[\"CurrIdProducto\"]  = $idproducto;\r\n\r\n// Buscar la serie (esnimei) actualmente asociada a esta solicitud\r\n$noserie = \"\";\r\nif ($idsolicitud > 0) {\r\n    $sql = \"SELECT esnimei \r\n            FROM seriessolicitadas \r\n            WHERE idsolicitud = \".$idsolicitud.\"\r\n            LIMIT 1\";\r\n    $rs  = DB::Query($sql);\r\n    if ($rs) {\r\n        $data = $rs->fetchAssoc();\r\n        if ($data && isset($data[\"esnimei\"])) {\r\n            $noserie = $data[\"esnimei\"];\r\n        }\r\n    }\r\n}\r\n\r\n// Exponer datos originales al JS\r\n$pageid = $pageObject->id;\r\n\r\necho \"<script>\r\nwindow.EDIT_PAGEID    = \".json_encode((string)$pageid).\";\r\nwindow.ORIG_IDPRODUCTO = \".(int)$idproducto.\";\r\nwindow.ORIG_NOSERIE    = \".json_encode((string)$noserie).\";\r\nwindow.ENDPOINT        = 'serial_reserve.php';\r\n</script>\";\r\n\r\nreturn true;\r\n"
		},
		{
			"eventId": "EVENT_JS_ONLOAD",
			"pageType": "edit",
			"code": "// Place event code here.\n// Use \"Add Action\" button to add code snippets.\n\n// ================== CONFIG ==================\nwindow.API_UPDATE   = 'solicitud_update_api.php';\nwindow.ENDPOINT     = 'serial_reserve.php';\n\nwindow.__saving_edit = false;\nwindow.__origSolicitud = null;\nwindow.__res_noserie = null;\n\nfunction getPid() {\n  return $('[data-pageid]').first().attr('data-pageid') || '';\n}\nfunction getCtrl(f){\n  try { return Runner.getControl(getPid(), f); } catch(e){ return null; }\n}\nfunction readVal(f){\n  var c = getCtrl(f);\n  if (c && typeof c.getValue === 'function') return c.getValue();\n  var pid = getPid();\n  var $el = $('#value_'+f+'_'+pid);\n  return $el.length ? $el.val() : '';\n}\nfunction setVal(f,v,trig){\n  var c = getCtrl(f);\n  if (c && typeof c.setControlValue === 'function') {\n    c.setControlValue(v);\n    if (trig && typeof c.fireEvent === 'function') c.fireEvent('change');\n    return;\n  }\n  var pid = getPid();\n  var $el = $('#value_'+f+'_'+pid);\n  if ($el.length) {\n    $el.val(v);\n    if (trig) $el.trigger('change');\n  }\n}\nfunction log(){ if(window.console) console.log.apply(console, arguments); }\n\n// SweetAlert helpers\nfunction swalOk(msg){\n  return Swal.fire({\n    title: 'Éxito',\n    text: msg || 'Operación realizada correctamente.',\n    icon: 'success',\n    confirmButtonText: 'OK'\n  });\n}\nfunction swalError(msg){\n  return Swal.fire({\n    title: 'Error',\n    text: msg || 'Ocurrió un error al guardar la solicitud.',\n    icon: 'error',\n    confirmButtonText: 'OK'\n  });\n}\n\n// ================== RESERVA SOLO SI CAMBIA PRODUCTO ==================\nfunction releasePrev(){\n  if (!window.__res_noserie) return;\n  $.post(window.ENDPOINT, { action:'release', noserie: window.__res_noserie });\n  window.__res_noserie = null;\n}\n\nfunction reserveForProductEdit(productId){\n  if (!productId) return;\n  \n  log('=== INICIANDO CAMBIO DE PRODUCTO ===');\n  log('Nuevo producto ID:', productId);\n  \n  // ⭐ SUSPENDER PERMISOS TEMPORALMENTE para poder actualizar noserie\n  window.__suspendPermissions = true;\n  \n  releasePrev();\n  \n  // Limpiar campo noserie (temporalmente habilitado para actualizar)\n  const pid = getPid();\n  const $noserie = $('#value_noserie_' + pid);\n  $noserie.prop('readonly', false).val('');\n\n  $.post(window.ENDPOINT, { action:'reserve_by_product', product_id: productId })\n    .done(function(resp){\n      var r = (typeof resp === 'object') ? resp : (function(){ try {return JSON.parse(resp);}catch(e){return null;} })();\n      log('Respuesta reserva (edit):', r);\n      \n      if (r && r.ok && r.noserie) {\n        window.__res_noserie = r.noserie;\n        \n        log('Nueva serie asignada:', r.noserie);\n        \n        // Habilitar temporalmente para setear el valor\n        $noserie.prop('readonly', false).prop('disabled', false);\n        \n        // Setear el valor\n        $noserie.val(r.noserie);\n        setVal('noserie', r.noserie, true);\n        \n        // Verificar que se asignó correctamente\n        setTimeout(function(){\n          const valorActual = readVal('noserie');\n          log('Verificación - Valor actual de noserie:', valorActual);\n          if (valorActual !== r.noserie) {\n            log('⚠️ El valor no se asignó correctamente, reintentando...');\n            $noserie.val(r.noserie).trigger('change');\n          }\n          \n          // ⭐ IMPORTANTE: Volver a solo lectura\n          $noserie.prop('readonly', true);\n        }, 100);\n        \n      } else if (r && r.error === 'no-stock') {\n        swalError('No hay series disponibles para el producto seleccionado.');\n        setVal('idproducto', '', true);\n      } else {\n        swalError('No se pudo reservar la serie.');\n        setVal('idproducto', '', true);\n      }\n    })\n    .fail(function(xhr, status, error){\n      log('Error AJAX reserva:', status, error);\n      swalError('Error de comunicación al reservar la serie.');\n      setVal('idproducto', '', true);\n    })\n    .always(function(){\n      // ⭐ RESTAURAR PERMISOS después de un delay\n      setTimeout(function(){\n        log('=== RESTAURANDO PERMISOS ===');\n        window.__suspendPermissions = false;\n        \n        // Forzar que noserie sea readonly\n        const pid = getPid();\n        const $noserie = $('#value_noserie_' + pid);\n        $noserie.prop('readonly', true).addClass('ph-disabled');\n        \n        // Reaplicar reglas\n        if (typeof applyRules === 'function') {\n          applyRules();\n        }\n      }, 1000);\n    });\n}\n\n// ================== OBTENER ID SOLICITUD DESDE URL ==================\nfunction getQS(name){\n  var m = new RegExp('[?&]'+name+'=([^&]*)').exec(location.search);\n  return m ? decodeURIComponent(m[1].replace(/\\+/g,' ')) : null;\n}\n\n// ================== ENVIAR UPDATE ==================\nfunction sendUpdateAPI(){\n  if (window.__saving_edit) {\n    log('Update en curso, click ignorado');\n    return;\n  }\n  window.__saving_edit = true;\n\n  var pid = getPid();\n\n  var idsol = parseInt(getQS('editid1') || 0, 10);\n  if (!idsol) {\n    window.__saving_edit = false;\n    swalError('No se pudo determinar el ID de la solicitud.');\n    return;\n  }\n\n  var datos = {\n    idsolicitud: idsol,\n\n    // originales para lógica en PHP\n    orig_idproducto: window.__origSolicitud ? window.__origSolicitud.idproducto : '',\n    orig_noserie:    window.__origSolicitud ? window.__origSolicitud.noserie    : '',\n\n    // nuevos valores del formulario\n    idproducto:    readVal('idproducto'),\n    idtipoventa:   readVal('idtipoventa'),\n    idplan:        readVal('idplan'),\n    idcliente:     readVal('idcliente'),\n    orden:         readVal('orden'),\n    plazo:         readVal('plazo'),\n    rfc:           readVal('rfc'),\n    idcli:         readVal('idcli'),\n    dn:            readVal('dn'),\n    cuenta:        readVal('cuenta'),\n    contrato:      readVal('contrato'),\n    contratoportal:readVal('contratoportal'),\n    plazopendiente:readVal('plazopendiente'),\n    dnpreferido:   readVal('dnpreferido'),\n    factura:       readVal('factura'),\n    fechavenci:    readVal('fechavenci'),\n\n    noserie:       readVal('noserie'),\n    observaciones:  readVal('observaciones'),\n\n    estado:        readVal('estado'),\n    ciudad:        readVal('ciudad'),\n    cp:            readVal('cp'),\n    calle:         readVal('calle'),\n    numeroext:     readVal('numeroext'),\n    numeroint:     readVal('numeroint'),\n    colonia:       readVal('colonia'),\n    lat:           readVal('lat'),\n    lng:           readVal('lng'),\n    idtienda:           readVal('idtienda')\n  };\n\n  log('Payload UPDATE API:', datos);\n\n  $.post(window.API_UPDATE, datos, function(respRaw){\n    var r = (typeof respRaw === 'object')\n      ? respRaw\n      : (function(){ try { return JSON.parse(respRaw); } catch(e){ return null; } })();\n\n    log('Respuesta UPDATE API:', r || respRaw);\n\n    if (!r) {\n      window.__saving_edit = false;\n      swalError('Respuesta inválida del servidor.');\n      return;\n    }\n\n    if (r.ok) {\n      releasePrev();\n      swalOk(r.message || 'Solicitud actualizada correctamente.')\n        .then(function(){\n          location.reload();\n        });\n    } else {\n      window.__saving_edit = false;\n      swalError(r.error || 'Error desconocido al actualizar.');\n    }\n  })\n  .fail(function(xhr){\n    log('Fallo AJAX UPDATE:', xhr.status, xhr.responseText);\n    window.__saving_edit = false;\n    swalError('Error de comunicación con el servidor.');\n  });\n}\n\n// ====================================================================\n// ================== SISTEMA DE PERMISOS POR ROL ==================\n// ====================================================================\n(function () {\n  const CONFIG = {\n    // TODOS los campos que se controlarán\n    fields: ['estatus', 'estatusentrega', 'idproducto', 'idplan', 'idtipoventa', 'orden', 'plazo', 'rfc', 'idcli', \n             'dn', 'cuenta', 'contrato', 'contratoportal', 'plazopendiente', 'dnpreferido', 'factura', 'fechavenci',\n              'estado', 'ciudad', 'cp', 'calle', 'numeroext', 'numeroint', 'colonia', 'lat', 'lng', 'observaciones',\n             'idcliente', 'ciclo'],\n\n    // Mapeo de GroupID numéricos a nombres\n    roleAliases: { \n      '1': 'ADMIN', \n      '2': 'VALIDADOR',\n      '3': 'VENDEDORES',\n      '4': 'GERENTES',\n      '5': 'MESADECONTROL'\n    },\n\n    // Reglas de permisos (primera que coincida se aplica)\n    rules: [\n      // ADMIN puede editar todo siempre\n      { match: { user: ['ADMIN'] }, enable: ['*'], readonly: ['noserie'] },    \n      { match: { role: ['ADMIN'] }, enable: ['*'], readonly: ['noserie'] },\n      \n      // VALIDADOR: puede editar todo EXCEPTO estatusentrega y noserie\n      { match: { role: ['VALIDADOR'] }, \n        enable: ['*'], \n        disable: ['estatusentrega'],\n        readonly: ['noserie']\n      },\n      \n      // MESADECONTROL: si estatus es ACEPTADA, solo 'estatusentrega'\n      { match: { role: ['MESADECONTROL'], statusCondition: 'ACEPTADA' }, \n        enable: ['estatusentrega'],\n        readonly: ['noserie']\n      },\n      \n      // MESADECONTROL: si NO es ACEPTADA, solo 'estatusentrega' también\n      { match: { role: ['MESADECONTROL'] }, \n        disable: ['*'],\n        readonly: ['noserie']\n      },\n      \n      // VENDEDORES y GERENTES: si estatus es ACEPTADA, TODO bloqueado\n      { match: { role: ['VENDEDORES','GERENTES'], statusCondition: 'ACEPTADA' }, \n        disable: ['*']\n      },\n      \n      // VENDEDORES y GERENTES: si NO es ACEPTADA, pueden editar todo EXCEPTO estatus, estatusentrega y noserie\n      { match: { role: ['VENDEDORES','GERENTES'], statusCondition: '!ACEPTADA' }, \n        enable: ['*'], \n        disable: ['estatus', 'estatusentrega'],\n        readonly: ['noserie']\n      },\n      \n      // Fallback: bloquear todo\n      { match: { default: true }, disable: ['*'] }\n    ]\n  };\n\n  const DEBUG = false; // Cambia a true para debugging\n  const plog = (...a)=>{ if (DEBUG) console.log('[permisos]', ...a); };\n  \n  // ⭐ Variable para suspender permisos temporalmente\n  window.__suspendPermissions = false;\n\n  // ========== OBTENER ROL Y USUARIO ==========\n  function getUserInfo() {\n    let role = '';\n    let user = '';\n    \n    plog('=== OBTENIENDO INFORMACIÓN VÍA PROXY ===');\n    \n    // Método correcto para PHPRunner usando proxy\n    if (typeof proxy !== 'undefined') {\n      role = (proxy.currentRole || '').toString().trim();\n      user = (proxy.currentUser || '').toString().trim();\n      plog('✓ Obtenido desde proxy.currentRole:', role);\n      plog('✓ Obtenido desde proxy.currentUser:', user);\n    } else {\n      plog('❌ Objeto proxy no disponible');\n    }\n    \n    // Fallback: desde window\n    if (!role && window.userRole) {\n      role = window.userRole.toString();\n      plog('✓ Fallback desde window.userRole:', role);\n    }\n    if (!user && window.userName) {\n      user = window.userName.toString();\n      plog('✓ Fallback desde window.userName:', user);\n    }\n    \n    plog('=== RESULTADO FINAL ===');\n    plog('Rol:', role || 'NO ENCONTRADO');\n    plog('Usuario:', user || 'NO ENCONTRADO');\n    \n    return { role, user };\n  }\n  \n  const userInfo = getUserInfo();\n  let ROLE = userInfo.role.trim();\n  let USER = userInfo.user.trim().toUpperCase();\n  \n  // Aplicar alias si existe\n  if (CONFIG.roleAliases[ROLE]) {\n    plog('Aplicando alias:', ROLE, '->', CONFIG.roleAliases[ROLE]);\n    ROLE = CONFIG.roleAliases[ROLE];\n  }\n  ROLE = ROLE.toUpperCase();\n  \n  plog('==========================================');\n  plog('ROL FINAL:', ROLE);\n  plog('USUARIO FINAL:', USER);\n  plog('==========================================');\n\n  // ---- OBTENER EL VALOR ACTUAL DEL ESTATUS ----\n  function getCurrentStatus() {\n    let currentStatus = '';\n    \n    plog('=== OBTENIENDO ESTATUS ===');\n    \n    // Método 1: Desde proxy (PREFERIDO si se pasó desde PHP)\n    if (typeof proxy !== 'undefined' && proxy.currentStatus) {\n      currentStatus = proxy.currentStatus.toString().trim().toUpperCase();\n      plog('✓ Estatus desde proxy:', currentStatus);\n      return currentStatus;\n    }\n    \n    // Método 2: Desde el DOM\n    const $estatusField = $('[id^=\"value_estatus_\"],[id^=\"display_value_estatus_\"]').first();\n    \n    if ($estatusField.length) {\n      if ($estatusField.is('select')) {\n        const selectedText = $estatusField.find('option:selected').text().trim();\n        const selectedVal = $estatusField.val();\n        currentStatus = (selectedText || selectedVal || '').toUpperCase();\n      } else {\n        currentStatus = ($estatusField.val() || '').trim().toUpperCase();\n      }\n      plog('Estatus desde DOM:', currentStatus);\n    }\n    \n    // Método 3: Desde readonly\n    if (!currentStatus) {\n      const $displayField = $('[id^=\"readonly_value_estatus_\"]').first();\n      if ($displayField.length) {\n        currentStatus = $displayField.text().trim().toUpperCase();\n        plog('Estatus desde readonly:', currentStatus);\n      }\n    }\n    \n    plog('>>> ESTATUS FINAL:', currentStatus || '⚠️ VACÍO');\n    return currentStatus;\n  }\n\n  // ---- Motor de reglas ----\n  function resolveRule() {\n    const currentStatus = getCurrentStatus();\n    plog('Resolviendo regla para ROL:', ROLE, '| ESTATUS:', currentStatus);\n    \n    for (let i = 0; i < CONFIG.rules.length; i++) {\n      const r = CONFIG.rules[i];\n      const m = r.match || {};\n      \n      if (m.default) {\n        plog('✓ Aplicando regla DEFAULT');\n        return r;\n      }\n      \n      const byRole = !m.role || m.role.map(x=>x.toString().toUpperCase()).includes(ROLE);\n      const byUser = !m.user || m.user.map(x=>x.toString().toUpperCase()).includes(USER);\n      \n      let byStatus = true;\n      if (m.statusCondition) {\n        if (m.statusCondition === 'ACEPTADA') {\n          byStatus = currentStatus === 'ACEPTADA';\n        } else if (m.statusCondition === '!ACEPTADA') {\n          byStatus = currentStatus !== 'ACEPTADA';\n        }\n      }\n      \n      plog(`Regla #${i}: byRole=${byRole}, byUser=${byUser}, byStatus=${byStatus}`);\n      \n      if (byRole && byUser && byStatus) {\n        plog('✓✓✓ REGLA APLICADA #' + i + ':', r);\n        return r;\n      }\n    }\n    \n    plog('Ninguna regla coincidió, aplicando fallback');\n    return { disable: ['*'] };\n  }\n  \n  function expand(list) {\n    if (!list) return [];\n    return list.includes('*') ? CONFIG.fields.slice() : list.slice();\n  }\n\n  function applyRules() {\n    // ⭐ Si los permisos están suspendidos, no aplicar nada\n    if (window.__suspendPermissions) {\n      plog('⚠️ Permisos suspendidos temporalmente');\n      return;\n    }\n    \n    const rule = resolveRule();\n    \n    let enableList = expand(rule.enable);\n    let readonlyList = expand(rule.readonly);\n    let disableList = expand(rule.disable);\n    \n    // ⭐ IMPORTANTE: noserie siempre debe estar en readonly (nunca en enable)\n    if (enableList.includes('noserie')) {\n      enableList = enableList.filter(f => f !== 'noserie');\n      if (!readonlyList.includes('noserie')) {\n        readonlyList.push('noserie');\n      }\n    }\n    \n    if (disableList.length > 0 && !disableList.includes('*')) {\n      enableList = enableList.filter(f => !disableList.includes(f));\n      readonlyList = readonlyList.filter(f => !disableList.includes(f));\n    }\n    \n    if (disableList.includes('*') && enableList.length > 0 && !enableList.includes('*')) {\n      disableList = CONFIG.fields.filter(f => !enableList.includes(f) && !readonlyList.includes(f));\n    }\n    \n    if (disableList.includes('*') && enableList.includes('*')) {\n      // Si enable es *, solo deshabilitar lo que NO está en readonly\n      disableList = [];\n    }\n    \n    plog('Campos a HABILITAR:', enableList.length);\n    plog('Campos a READONLY:', readonlyList.length);\n    plog('Campos a DESHABILITAR:', disableList.length);\n    \n    let enable   = new Set(enableList);\n    let readonly = new Set(readonlyList.filter(f=>!enable.has(f)));\n    let disable  = new Set(disableList.filter(f=>!enable.has(f) && !readonly.has(f)));\n\n    const ALL = [...new Set([...enable, ...readonly, ...disable])];\n\n    const qCtrl   = (f, scope)=>$(scope||document).find(`[id^=\"value_${f}_\"],[id^=\"display_value_${f}_\"]`);\n    const qLookup = (f, scope)=>$(scope||document).find(`[id^=\"open_lookup_${f}_\"]`);\n\n    function doEnable(f, scope){\n      const $els = qCtrl(f,scope).removeClass('ph-disabled');\n      $els.each(function(){\n        $(this).prop('disabled', false).prop('readonly', false);\n        const $s2 = $(this).next('.select2-container, .select2');\n        if ($s2.length) $s2.removeClass('ph-disabled').css('pointer-events','');\n      });\n      qLookup(f,scope).removeClass('ph-disabled').css('pointer-events','').attr('aria-disabled',null).off('click._lock');\n    }\n    \n    function doReadonly(f, scope){\n      const $els = qCtrl(f,scope).addClass('ph-disabled');\n      $els.each(function(){\n        if (this.tagName === 'SELECT') $(this).prop('disabled', true);\n        else $(this).prop('readonly', true);\n        const $s2 = $(this).next('.select2-container, .select2');\n        if ($s2.length) $s2.addClass('ph-disabled').css('pointer-events','none');\n      });\n      // Los lookups también se deshabilitan en readonly\n      qLookup(f,scope).addClass('ph-disabled').css('pointer-events','none')\n        .attr('aria-disabled','true').on('click._lock', e => { e.preventDefault(); e.stopImmediatePropagation(); return false; });\n    }\n    \n    function doDisable(f, scope){\n      const $els = qCtrl(f,scope).addClass('ph-disabled');\n      $els.each(function(){\n        $(this).prop('disabled', true).prop('readonly', true);\n        const $s2 = $(this).next('.select2-container, .select2');\n        if ($s2.length) $s2.addClass('ph-disabled').css('pointer-events','none');\n      });\n      qLookup(f,scope).addClass('ph-disabled').css('pointer-events','none')\n        .attr('aria-disabled','true').on('click._lock', e => { e.preventDefault(); e.stopImmediatePropagation(); return false; });\n    }\n\n    function applyScope(scope){\n      enable.forEach(f=>doEnable(f,scope));\n      readonly.forEach(f=>doReadonly(f,scope));\n      disable.forEach(f=>doDisable(f,scope));\n    }\n\n    applyScope(document);\n\n    // Guardias para bloquear interacciones\n    const selInputs = ALL.map(f=>`[id^=\"value_${f}_\"],[id^=\"display_value_${f}_\"]`).join(',');\n    if (selInputs) {\n      $(document).off('focusin.lock click.lock', selInputs);\n      $(document).on('focusin.lock click.lock', selInputs, function(){\n        // ⭐ No aplicar si los permisos están suspendidos\n        if (window.__suspendPermissions) return;\n        \n        const id = this.id||'';\n        const f = ALL.find(x => id.startsWith('value_'+x+'_') || id.startsWith('display_value_'+x+'_'));\n        if (!f) return;\n        if (disable.has(f))      doDisable(f, document);\n        else if (readonly.has(f))doReadonly(f, document);\n        else                     doEnable(f, document);\n      });\n    }\n    \n    const selLookup = ALL.map(f=>`[id^=\"open_lookup_${f}_\"]`).join(',');\n    if (selLookup) {\n      $(document).off('click.lock', selLookup);\n      $(document).on('click.lock', selLookup, function(e){\n        // ⭐ No aplicar si los permisos están suspendidos\n        if (window.__suspendPermissions) return true;\n        \n        const id = this.id||'';\n        const f = ALL.find(x => id.startsWith('open_lookup_'+x+'_'));\n        if (!f) return;\n        if (disable.has(f) || readonly.has(f)) {\n          e.preventDefault(); e.stopImmediatePropagation();\n          (disable.has(f) ? doDisable : doReadonly)(f, document);\n          return false;\n        }\n      });\n    }\n  }\n\n  // Espera activa a que existan los controles\n  function waitFor(list, timeout=2000, scope){\n    const t0 = performance.now();\n    return new Promise(resolve=>{\n      (function tick(){\n        const ok = list.every(f => $(scope||document).find(`[id^=\"value_${f}_\"],[id^=\"display_value_${f}_\"]`).length);\n        if (ok || performance.now()-t0 > timeout) resolve();\n        else requestAnimationFrame(tick);\n      })();\n    });\n  }\n\n  // Nueva función: esperar a que el campo tenga valor\n  function waitForFieldValue(fieldName, timeout = 5000) {\n    const t0 = performance.now();\n    return new Promise(resolve => {\n      (function check() {\n        const $field = $(`[id^=\"value_${fieldName}_\"],[id^=\"display_value_${fieldName}_\"]`).first();\n        let hasValue = false;\n        \n        if ($field.length) {\n          if ($field.is('select')) {\n            hasValue = $field.find('option:selected').val() !== '';\n          } else {\n            hasValue = ($field.val() || '').trim() !== '';\n          }\n        }\n        \n        // También verificar proxy\n        if (!hasValue && typeof proxy !== 'undefined' && proxy.currentStatus) {\n          hasValue = true;\n        }\n        \n        if (hasValue || performance.now() - t0 > timeout) {\n          plog('Campo \"' + fieldName + '\" ' + (hasValue ? 'tiene valor' : 'timeout'));\n          resolve(hasValue);\n        } else {\n          setTimeout(check, 50);\n        }\n      })();\n    });\n  }\n\n  // Aplicación inicial del sistema de permisos\n  (async function initPermisos(){\n    plog('>>> Esperando a que los campos estén listos...');\n    \n    await waitFor(['estatus'], 3000);\n    await waitForFieldValue('estatus', 5000);\n    \n    plog('>>> Campos listos, aplicando permisos...');\n    applyRules();\n    \n    // ⭐ Forzar que noserie sea siempre readonly al inicio\n    const pid = getPid();\n    const $noserie = $('#value_noserie_' + pid);\n    $noserie.prop('readonly', true).addClass('ph-disabled');\n    \n    // Reaplicar cuando cambia el estatus\n    $(document).on('change', '[id^=\"value_estatus_\"],[id^=\"display_value_estatus_\"]', function(){\n      plog('>>> Estatus cambió manualmente, reaplicando reglas...');\n      setTimeout(applyRules, 100);\n    });\n    \n    // Observer para cambios en el DOM\n    const grid = document.querySelector('.r-grid') || document.body;\n    new MutationObserver(async muts => {\n      for (const m of muts) {\n        if (m.addedNodes && m.addedNodes.length) {\n          await waitFor(['estatus'], 2000, grid);\n          applyRules();\n          break;\n        }\n      }\n    }).observe(grid, { childList: true, subtree: true });\n  })();\n})();\n\n// ====================================================================\n// ================== INIT PRINCIPAL ==================\n// ====================================================================\n$(function(){\n  var pid = getPid();\n  var ctrlProd = getCtrl('idproducto');\n\n  // Capturar valores originales al cargar\n  window.__origSolicitud = {\n    idsolicitud: parseInt(getQS('editid1') || 0, 10),\n    idproducto:  readVal('idproducto'),\n    noserie:     readVal('noserie')\n  };\n  log('ORIGINAL =>', window.__origSolicitud);\n  \n  // ⭐ Forzar noserie a readonly desde el inicio\n  const $noserie = $('#value_noserie_' + pid);\n  $noserie.prop('readonly', true).addClass('ph-disabled');\n\n  // Cambio de producto en edición\n  if (ctrlProd) {\n    ctrlProd.on('change', function(){\n      var nuevo = ctrlProd.getValue();\n      log('==============================================');\n      log('CAMBIO DE PRODUCTO DETECTADO');\n      log('Producto anterior:', window.__origSolicitud ? window.__origSolicitud.idproducto : 'N/A');\n      log('Producto nuevo:', nuevo);\n      log('==============================================');\n\n      // Si vuelve al original, restaurar serie\n      if (window.__origSolicitud && nuevo == window.__origSolicitud.idproducto) {\n        log('Volviendo al producto original');\n        \n        // Suspender permisos\n        window.__suspendPermissions = true;\n        \n        if (window.__origSolicitud.noserie) {\n          const $ns = $('#value_noserie_' + pid);\n          $ns.prop('readonly', false).val(window.__origSolicitud.noserie);\n          setVal('noserie', window.__origSolicitud.noserie, true);\n          log('Serie original restaurada:', window.__origSolicitud.noserie);\n          \n          // Volver a readonly\n          setTimeout(function(){\n            $ns.prop('readonly', true).addClass('ph-disabled');\n          }, 100);\n        }\n        releasePrev();\n        \n        // Restaurar permisos\n        setTimeout(function(){\n          window.__suspendPermissions = false;\n          if (typeof applyRules === 'function') applyRules();\n        }, 500);\n        \n        return;\n      }\n\n      // Si es otro producto → pedir serie nueva\n      if (nuevo) {\n        log('Solicitando nueva serie para producto:', nuevo);\n        reserveForProductEdit(nuevo);\n      } else {\n        log('Producto vaciado, limpiando serie');\n        window.__suspendPermissions = true;\n        const $ns = $('#value_noserie_' + pid);\n        $ns.prop('readonly', false).val('');\n        setVal('noserie', '', true);\n        setTimeout(function(){\n          $ns.prop('readonly', true).addClass('ph-disabled');\n        }, 100);\n        releasePrev();\n        setTimeout(function(){\n          window.__suspendPermissions = false;\n          if (typeof applyRules === 'function') applyRules();\n        }, 500);\n      }\n    });\n  }\n\n  // Botón Guardar VNP (edit)\n  var saveSelector =\n    \"[data-itemid='btnGuardarVNP'] a, \" +\n    \"[data-itemid='btnGuardarVNP'] button, \" +\n    \"#btnGuardarVNP\";\n\n  $(document).on('click', saveSelector, function(e){\n    e.preventDefault();\n    log('Click en botón Guardar VNP (edit)');\n    sendUpdateAPI();\n  });\n\n  // Bloquear submit normal\n  $('form').on('submit', function(e){\n    e.preventDefault();\n    return false;\n  });\n\n  // Salida de la página → liberar reserva temporal\n  $(window).on('beforeunload pagehide', function(){\n    if (!window.__saving_edit) {\n      releasePrev();\n    }\n  });\n});\n\n// Observador para corregir lookups cuando se abren\nconst observer = new MutationObserver(() => {\n    document.querySelectorAll('.modal-content').forEach(modal => {\n        modal.style.fontSize = '14px';\n    });\n    \n    document.querySelectorAll('.modal-body table, .modal-body table th, .modal-body table td').forEach(el => {\n        el.style.fontSize = '14px';\n    });\n});\n\nobserver.observe(document.body, {\n    childList: true,\n    subtree: true\n});\n\n"
		},
		{
			"eventId": "EVENT_PROCESSVALUES_EDIT",
			"pageType": "edit",
			"code": "date_default_timezone_set('America/Mexico_City');\n$values[\"tienda\"]=$_SESSION[\"Tienda\"];\n$values['fechacaptura']=date('Y-m-d H:i:s');\n$values[\"almacenatt\"]=$_SESSION[\"Tienda\"];\n$values['ventadomicilio'] = 1;\n$values['equipoincluido']=1;\n$values['tiendamovil']=1;\n$values['clasif']=1\n\n"
		},
		{
			"eventId": "EVENT_JS_ONLOAD",
			"pageType": "list",
			"code": "// ====== API ENDPOINTS (si no los tienes ya en listado) ======\nwindow.API_UPDATE = window.API_UPDATE || 'solicitud_update_api.php';\nwindow.ENDPOINT   = window.ENDPOINT   || 'serial_reserve.php';\n\n// ====== helpers básicos (versión \"list\") ======\nfunction getPid(){ return $('[data-pageid]').first().attr('data-pageid') || ''; }\n\n// PHPRunner: intenta control con rowId; si no, cae al DOM\nfunction getCtrlL(field, rowId){\n  try {\n    if (window.Runner && typeof Runner.getControl === 'function') {\n      return Runner.getControl(getPid(), field, rowId);\n    }\n  } catch(e){}\n  return null;\n}\n\nfunction readValL(field, rowId){\n  var c = getCtrlL(field, rowId);\n  if (c && typeof c.getValue === 'function') return c.getValue();\n\n  // Fallback DOM común en list (value_<field>_<pid>_<rowid>)\n  var pid = getPid();\n  var sel = '#value_'+field+'_'+pid+'_'+rowId+', #display_value_'+field+'_'+pid+'_'+rowId;\n  var $el = $(sel);\n  if ($el.length) {\n    if ($el.is('select')) {\n      return $el.val();\n    } else {\n      return ($el.val() || $el.text() || '').trim();\n    }\n  }\n  return '';\n}\n\n// Intenta obtener rowId desde el <tr> o desde la celda/checkbox\nfunction getRowIdFromElem(el){\n  var $tr = $(el).closest('tr');\n  return $tr.attr('data-rowid') || $tr.attr('data-record-id') || $tr.data('rowid') || $tr.data('recordId') || '';\n}\n\n// Ids seleccionados por checkbox de PHPRunner\nfunction getSelectedRowIds(){\n  var ids = [];\n  $('.rnr-dbody input[type=checkbox]:checked').each(function(){\n    var $tr = $(this).closest('tr');\n    var rowId = $tr.attr('data-rowid') || $tr.attr('data-record-id') || '';\n    if (rowId) ids.push(rowId);\n  });\n  return ids;\n}\n\n// Obtiene el valor de \"idsolicitud\" visible en la fila\nfunction getIdSolicitudFromRow(rowId){\n  var v = readValL('idsolicitud', rowId);\n  if (v) return parseInt(v, 10) || 0;\n\n  var $tr = $('tr[data-rowid=\"'+rowId+'\"], tr[data-record-id=\"'+rowId+'\"]');\n  var d = $tr.data('idsolicitud') || $tr.attr('data-idsolicitud');\n  return d ? parseInt(d,10) : 0;\n}\n\n// Construye payload con los campos necesarios\nfunction buildPayloadFromRow(rowId){\n  var idsol = getIdSolicitudFromRow(rowId);\n\n  return {\n    idsolicitud: idsol,\n\n    // (ajusta si tus columnas tienen otros nombres o no están visibles)\n    idproducto:    readValL('idproducto', rowId),\n    idtipoventa:   readValL('idtipoventa', rowId),\n    idplan:        readValL('idplan', rowId),\n    idcliente:     readValL('idcliente', rowId),\n    orden:         readValL('orden', rowId),\n    plazo:         readValL('plazo', rowId),\n    rfc:           readValL('rfc', rowId),\n    idcli:         readValL('idcli', rowId),\n    dn:            readValL('dn', rowId),\n    cuenta:        readValL('cuenta', rowId),\n    contrato:      readValL('contrato', rowId),\n    contratoportal:readValL('contratoportal', rowId),\n    plazopendiente:readValL('plazopendiente', rowId),\n    dnpreferido:   readValL('dnpreferido', rowId),\n    factura:       readValL('factura', rowId),\n    fechavenci:    readValL('fechavenci', rowId),\n    noserie:       readValL('noserie', rowId),\n    estado:        readValL('estado', rowId),\n    ciudad:        readValL('ciudad', rowId),\n    cp:            readValL('cp', rowId),\n    calle:         readValL('calle', rowId),\n    numeroext:     readValL('numeroext', rowId),\n    numeroint:     readValL('numeroint', rowId),\n    colonia:       readValL('colonia', rowId),\n    lat:           readValL('lat', rowId),\n    lng:           readValL('lng', rowId),\n    idtienda:      readValL('idtienda', rowId)\n  };\n}\n\n// Consola bonita para la respuesta con debug embebido\nfunction logApiResponseDebug(tag, res){\n  console.group(tag);\n  if (res && (res.debug || res.debug_log)) {\n    var dbg = res.debug || res.debug_log;\n    try { if (typeof dbg === 'string') dbg = JSON.parse(dbg); } catch(e){}\n    if (Array.isArray(dbg)) {\n      var t0 = (dbg[0] && dbg[0].t) ? dbg[0].t : null;\n      var rows = dbg.map(function(d,i){\n        return {\n          i,\n          ms: (t0 && d.t) ? Math.round((d.t - t0) * 1000) : null,\n          msg: d.msg || d.message || '',\n          ctx: d.ctx || null\n        };\n      });\n      console.table(rows);\n    } else {\n      console.log('debug:', dbg);\n    }\n  } else {\n    console.log('sin debug en payload');\n  }\n  console.log('respuesta:', res);\n  console.groupEnd();\n}\n\n// SweetAlert reusables\nfunction swalOk(msg){\n  return Swal.fire({ title:'Éxito', text: msg||'Actualizado correctamente.', icon:'success', confirmButtonText:'OK' });\n}\nfunction swalError(msg){\n  return Swal.fire({ title:'Error', text: msg||'No se pudo actualizar.', icon:'error', confirmButtonText:'OK' });\n}\n\n// ====================================================================\n// ================== SISTEMA DE PERMISOS POR ROL ==================\n// ====================================================================\n(function () {\n  const CONFIG = {\n    fields: ['estatus', 'estatusentrega', 'idproducto', 'idplan', 'idtipoventa', 'orden', 'plazo', 'rfc', 'idcli', \n             'dn', 'cuenta', 'contrato', 'contratoportal', 'plazopendiente', 'dnpreferido', 'factura', 'fechavenci',\n              'estado', 'ciudad', 'cp', 'calle', 'numeroext', 'numeroint', 'colonia', 'lat', 'lng',\n             'idcliente', 'ciclo'],\n\n    roleAliases: { \n      'ADMIN': 'ADMIN', \n      'VALIDADOR': 'VALIDADOR',\n      'VENDEDORES': 'VENDEDORES',\n      'GERENTES': 'GERENTES',\n      'MESADECONTROL': 'MESADECONTROL'\n    },\n\n    rules: [\n      { match: { user: ['ADMIN'] }, enable: ['*'] },    \n      { match: { role: ['ADMIN'] }, enable: ['*'] },\n      \n      { match: { role: ['VALIDADOR'] }, \n        enable: ['*'], \n        disable: ['estatusentrega'] \n      },\n      \n      { match: { role: ['MESADECONTROL'], statusCondition: 'ACEPTADA' }, \n        enable: ['estatusentrega'], \n        disable: ['*']\n      },\n      \n      { match: { role: ['MESADECONTROL'] }, \n        disable: ['*'] \n      },\n      \n      { match: { role: ['VENDEDORES','GERENTES'], statusCondition: 'ACEPTADA' }, \n        disable: ['*'] \n      },\n      \n      { match: { role: ['VENDEDORES','GERENTES'], statusCondition: '!ACEPTADA' }, \n        enable: ['*'], \n        disable: ['estatus', 'estatusentrega'] \n      },\n      \n      { match: { default: true }, disable: ['*'] }\n    ]\n  };\n\n  const DEBUG = true;\n  const plog = (...a)=>{ if (DEBUG) console.log('[permisos]', ...a); };\n\n  // ========== OBTENER ROL Y USUARIO ==========\n  function getUserInfo() {\n    let role = '';\n    let user = '';\n    console.log('=== INTENTANDO OBTENER INFORMACIÓN DEL USUARIO ===');\n    \n    // Método correcto para PHPRunner usando proxy\n    if (typeof proxy !== 'undefined') {\n      role = (proxy.currentRole || '').toString().trim();\n      user = (proxy.currentUser || '').toString().trim();\n      plog('✓ Obtenido desde proxy.currentRole:', role);\n      plog('✓ Obtenido desde proxy.currentUser:', user);\n    } else {\n      plog('❌ Objeto proxy no disponible');\n    }\n    \n    // Método 1: Desde window (inyectado por PHP)\n    if (window.userRole) {\n      role = window.userRole.toString();\n      console.log('✓ Rol obtenido desde window.userRole:', role);\n    }\n    if (window.userName) {\n      user = window.userName.toString();\n      console.log('✓ Usuario obtenido desde window.userName:', user);\n    }\n    \n    // Método 2: Desde Runner.vars\n    if (!role && window.Runner && Runner.vars) {\n      console.log('Explorando Runner.vars:', Runner.vars);\n      if (Runner.vars.userInfo) {\n        role = (Runner.vars.userInfo.groupId || Runner.vars.userInfo.group || '').toString();\n        user = (Runner.vars.userInfo.userName || Runner.vars.userInfo.name || '').toString();\n        console.log('✓ Desde Runner.vars.userInfo - Rol:', role, 'Usuario:', user);\n      }\n    }\n    \n    // Método 3: Desde variables globales comunes de PHPRunner\n    if (!role && window.userGroupId) {\n      role = window.userGroupId.toString();\n      console.log('✓ Rol obtenido desde window.userGroupId:', role);\n    }\n    if (!user && window.currentUser) {\n      user = window.currentUser.toString();\n      console.log('✓ Usuario obtenido desde window.currentUser:', user);\n    }\n    \n    // Método 4: Desde proxy (si existe)\n    if (!role && window.proxy && proxy.currentRole) {\n      role = proxy.currentRole.toString();\n      console.log('✓ Rol obtenido desde proxy.currentRole:', role);\n    }\n    if (!user && window.proxy && proxy.currentUser) {\n      user = proxy.currentUser.toString();\n      console.log('✓ Usuario obtenido desde proxy.currentUser:', user);\n    }\n    \n    console.log('=== RESULTADO FINAL ===');\n    console.log('Rol (antes de procesar):', role);\n    console.log('Usuario (antes de procesar):', user);\n    \n    return { role, user };\n  }\n  \n  const userInfo = getUserInfo();\n  let ROLE = userInfo.role.trim();\n  let USER = userInfo.user.trim().toUpperCase();\n  \n  // Aplicar alias si existe\n  if (CONFIG.roleAliases[ROLE]) {\n    console.log('Aplicando alias:', ROLE, '->', CONFIG.roleAliases[ROLE]);\n    ROLE = CONFIG.roleAliases[ROLE];\n  }\n  ROLE = ROLE.toUpperCase();\n  \n  console.log('==========================================');\n  console.log('ROL FINAL:', ROLE);\n  console.log('USUARIO FINAL:', USER);\n  console.log('==========================================');\n\n  function getCurrentStatus() {\n    const $estatusField = $('[id^=\"value_estatus_\"],[id^=\"display_value_estatus_\"]').first();\n    let currentStatus = '';\n    \n    if ($estatusField.length) {\n      if ($estatusField.is('select')) {\n        currentStatus = $estatusField.find('option:selected').text().trim().toUpperCase();\n      } else {\n        currentStatus = ($estatusField.val() || '').trim().toUpperCase();\n      }\n    }\n    \n    if (!currentStatus) {\n      const $displayField = $('[id^=\"readonly_value_estatus_\"]').first();\n      if ($displayField.length) {\n        currentStatus = $displayField.text().trim().toUpperCase();\n      }\n    }\n    \n    plog('Status actual detectado:', currentStatus);\n    return currentStatus;\n  }\n\n  function resolveRule() {\n    const currentStatus = getCurrentStatus();\n    plog('Resolviendo regla para ROL:', ROLE, '| ESTATUS:', currentStatus);\n    \n    for (let i = 0; i < CONFIG.rules.length; i++) {\n      const r = CONFIG.rules[i];\n      const m = r.match || {};\n      \n      if (m.default) {\n        plog('✓ Aplicando regla DEFAULT');\n        return r;\n      }\n      \n      const byRole = !m.role || m.role.map(x=>x.toString().toUpperCase()).includes(ROLE);\n      const byUser = !m.user || m.user.map(x=>x.toString().toUpperCase()).includes(USER);\n      \n      let byStatus = true;\n      if (m.statusCondition) {\n        if (m.statusCondition === 'ACEPTADA') {\n          byStatus = currentStatus === 'ACEPTADA';\n        } else if (m.statusCondition === '!ACEPTADA') {\n          byStatus = currentStatus !== 'ACEPTADA';\n        }\n      }\n      \n      plog(`Regla #${i}: byRole=${byRole}, byUser=${byUser}, byStatus=${byStatus}`);\n      \n      if (byRole && byUser && byStatus) {\n        plog('✓✓✓ REGLA APLICADA #' + i + ':', r);\n        return r;\n      }\n    }\n    \n    plog('Ninguna regla coincidió, aplicando fallback');\n    return { disable: ['*'] };\n  }\n  \n  function expand(list) {\n    if (!list) return [];\n    return list.includes('*') ? CONFIG.fields.slice() : list.slice();\n  }\n\n  function applyRules() {\n    const rule = resolveRule();\n    \n    let enableList = expand(rule.enable);\n    let readonlyList = expand(rule.readonly);\n    let disableList = expand(rule.disable);\n    \n    if (disableList.length > 0 && !disableList.includes('*')) {\n      enableList = enableList.filter(f => !disableList.includes(f));\n      readonlyList = readonlyList.filter(f => !disableList.includes(f));\n    }\n    \n    if (disableList.includes('*') && enableList.length > 0 && !enableList.includes('*')) {\n      disableList = CONFIG.fields.filter(f => !enableList.includes(f));\n    }\n    \n    if (disableList.includes('*') && enableList.includes('*')) {\n      disableList = [];\n    }\n    \n    plog('Campos a HABILITAR:', enableList.length);\n    plog('Campos a DESHABILITAR:', disableList.length);\n    \n    let enable   = new Set(enableList);\n    let readonly = new Set(readonlyList.filter(f=>!enable.has(f)));\n    let disable  = new Set(disableList.filter(f=>!enable.has(f) && !readonly.has(f)));\n\n    const ALL = [...new Set([...enable, ...readonly, ...disable])];\n\n    const qCtrl   = (f, scope)=>$(scope||document).find(`[id^=\"value_${f}_\"],[id^=\"display_value_${f}_\"]`);\n    const qLookup = (f, scope)=>$(scope||document).find(`[id^=\"open_lookup_${f}_\"]`);\n\n    function doEnable(f, scope){\n      const $els = qCtrl(f,scope).removeClass('ph-disabled');\n      $els.each(function(){\n        $(this).prop('disabled', false).prop('readonly', false);\n        const $s2 = $(this).next('.select2-container, .select2');\n        if ($s2.length) $s2.removeClass('ph-disabled').css('pointer-events','');\n      });\n      qLookup(f,scope).removeClass('ph-disabled').css('pointer-events','').attr('aria-disabled',null).off('click._lock');\n    }\n    \n    function doReadonly(f, scope){\n      const $els = qCtrl(f,scope).addClass('ph-disabled');\n      $els.each(function(){\n        if (this.tagName === 'SELECT') $(this).prop('disabled', true);\n        else $(this).prop('readonly', true);\n        const $s2 = $(this).next('.select2-container, .select2');\n        if ($s2.length) $s2.addClass('ph-disabled').css('pointer-events','none');\n      });\n    }\n    \n    function doDisable(f, scope){\n      const $els = qCtrl(f,scope).addClass('ph-disabled');\n      $els.each(function(){\n        $(this).prop('disabled', true).prop('readonly', true);\n        const $s2 = $(this).next('.select2-container, .select2');\n        if ($s2.length) $s2.addClass('ph-disabled').css('pointer-events','none');\n      });\n      qLookup(f,scope).addClass('ph-disabled').css('pointer-events','none')\n        .attr('aria-disabled','true').on('click._lock', e => { e.preventDefault(); e.stopImmediatePropagation(); return false; });\n    }\n\n    function applyScope(scope){\n      enable.forEach(f=>doEnable(f,scope));\n      readonly.forEach(f=>doReadonly(f,scope));\n      disable.forEach(f=>doDisable(f,scope));\n    }\n\n    applyScope(document);\n\n    const selInputs = ALL.map(f=>`[id^=\"value_${f}_\"],[id^=\"display_value_${f}_\"]`).join(',');\n    if (selInputs) {\n      $(document).off('focusin.lock click.lock', selInputs);\n      $(document).on('focusin.lock click.lock', selInputs, function(){\n        const id = this.id||'';\n        const f = ALL.find(x => id.startsWith('value_'+x+'_') || id.startsWith('display_value_'+x+'_'));\n        if (!f) return;\n        if (disable.has(f))      doDisable(f, document);\n        else if (readonly.has(f))doReadonly(f, document);\n        else                     doEnable(f, document);\n      });\n    }\n    \n    const selLookup = ALL.map(f=>`[id^=\"open_lookup_${f}_\"]`).join(',');\n    if (selLookup) {\n      $(document).off('click.lock', selLookup);\n      $(document).on('click.lock', selLookup, function(e){\n        const id = this.id||'';\n        const f = ALL.find(x => id.startsWith('open_lookup_'+x+'_'));\n        if (!f) return;\n        if (disable.has(f) || readonly.has(f)) {\n          e.preventDefault(); e.stopImmediatePropagation();\n          (disable.has(f) ? doDisable : doReadonly)(f, document);\n          return false;\n        }\n      });\n    }\n  }\n\n  function waitFor(list, timeout=2000, scope){\n    const t0 = performance.now();\n    return new Promise(resolve=>{\n      (function tick(){\n        const ok = list.every(f => $(scope||document).find(`[id^=\"value_${f}_\"],[id^=\"display_value_${f}_\"]`).length);\n        if (ok || performance.now()-t0 > timeout) resolve();\n        else requestAnimationFrame(tick);\n      })();\n    });\n  }\n\n  (async function initPermisos(){\n    await waitFor(['estatus'], 3000);\n    plog('Iniciando aplicación de permisos...');\n    applyRules();\n    \n    $(document).on('change', '[id^=\"value_estatus_\"],[id^=\"display_value_estatus_\"]', function(){\n      plog('Estatus cambió, reaplicando reglas...');\n      setTimeout(applyRules, 100);\n    });\n    \n    const grid = document.querySelector('.r-grid') || document.body;\n    new MutationObserver(async muts=>{\n      for (const m of muts) {\n        if (m.addedNodes && m.addedNodes.length) {\n          await waitFor(['estatus'], 2000, grid);\n          applyRules();\n          break;\n        }\n      }\n    }).observe(grid, { childList:true, subtree:true });\n  })();\n})();\n\n(function () {\n  // --- detecta rol ---\n  var role = '';\n  try { if (typeof proxy !== 'undefined' && proxy.currentRole) role = String(proxy.currentRole); } catch(e){}\n  if (!role && window.userRole) role = String(window.userRole);\n  var isMesa = role.toUpperCase().trim() === 'MESADECONTROL';\n  console.log('[EDIT-HREF] role=\"%s\" isMesa=%s', role, isMesa);\n  if (!isMesa) return;\n\n  // --- selectores de links \"Editar\" en PHPRunner ---\n  var EDIT_SEL = [\n    'span[data-itemid=\"edit_record\"] a[id^=\"editLink\"]',\n    'span[data-itemtype=\"grid_edit\"] a[id^=\"editLink\"]',\n    'a[id^=\"editLink\"]',\n    'a[href*=\"solicitudes_edit.php\"][href*=\"editid1=\"]' // fallback\n  ].join(',');\n\n function retarget(a){\n  if (!a || a.__retargeted) return;\n\n  var oldHref = a.getAttribute('href') || '';\n  var newHref;\n\n  // --- Resolver href preservando el subdirectorio actual (p.ej. /prm1/)\n  function resolveHref(href){\n    // Absoluto: ya está bien\n    if (/^(?:https?:)?\\/\\//i.test(href)) return href;\n\n    var cur = new URL(window.location.href);\n\n    // Directorio actual (e.g. https://dominio.com/prm1/)\n    var baseDir = cur.href.replace(/[^\\/?#]+([?#].*)?$/, '');\n\n    // Si empieza con \"/\" (ruta absoluta en el sitio), reinyecta la carpeta actual\n    if (href.charAt(0) === '/') {\n      // p.ej. /solicitudes_edit.php  => https://dominio.com/prm1/solicitudes_edit.php\n      var currentDir = cur.pathname.replace(/\\/[^\\/]*$/, '/'); // \"/prm1/\"\n      return cur.origin + currentDir + href.replace(/^\\//, '');\n    }\n\n    // Relativo normal: resuélvelo contra el directorio actual\n    return new URL(href, baseDir).toString();\n  }\n\n  try {\n    newHref = resolveHref(oldHref);\n\n    var url = new URL(newHref);\n\n    // Ajusta/añade parámetros deseados (evita duplicados)\n    url.searchParams.set('page', 'edit1');\n    url.searchParams.set('menuItemId', '11');\n\n    a.setAttribute('href', url.toString());\n    a.__retargeted = true;\n    console.log('[EDIT-HREF] actualizado:', oldHref, '→', a.getAttribute('href'));\n  } catch (e) {\n    // Fallback (muy simple) por si algo raro ocurre\n    var sep = oldHref.indexOf('?') >= 0 ? '&' : '?';\n    var fallback = resolveHref(oldHref) + sep + 'page=edit1&menuItemId=11';\n    a.setAttribute('href', fallback);\n    a.__retargeted = true;\n    console.log('[EDIT-HREF] actualizado (fallback):', oldHref, '→', fallback);\n  }\n}\n\n\n  function retargetAll(ctx){\n    (ctx || document).querySelectorAll(EDIT_SEL).forEach(retarget);\n    var n = (ctx || document).querySelectorAll(EDIT_SEL).length;\n    console.log('[EDIT-HREF] links encontrados:', n);\n  }\n\n  // inicial\n  retargetAll();\n  setTimeout(retargetAll, 250);\n\n  // si la grilla renderiza después, observar y retargetear\n  var root = document.querySelector('.r-grid') || document.body;\n  new MutationObserver(function(muts){\n    muts.forEach(function(m){\n      m.addedNodes && m.addedNodes.forEach(function(n){\n        if (n.querySelectorAll){\n          n.querySelectorAll(EDIT_SEL).forEach(retarget);\n        }\n        if (n.matches && n.matches(EDIT_SEL)) retarget(n);\n      });\n    });\n  }).observe(root, { childList: true, subtree: true });\n})();\n"
		},
		{
			"eventId": "EVENT_AFTEREDIT",
			"pageType": "edit",
			"code": "\n\n\n//**********  Insert a record into another table  ************\n// Helpers para armar valores seguros\nfunction q($v){ // cadenas/fechas: 'valor' o NULL\n    return (isset($v) && $v !== '' ? db_prepare_string($v) : \"NULL\");\n}\nfunction qi($v){ // enteros: número o NULL\n    return (isset($v) && $v !== '' ? (int)$v : \"NULL\");\n}\nfunction qb($v){ // booleano/bit: 0/1\n    return (!empty($v) ? 1 : 0);\n}\nfunction qd($v, $scale = 2) { // decimales: número (formateado) o NULL\n    if (!isset($v) || $v === '') return \"NULL\";\n    $n = (float)$v;\n    return number_format($n, $scale, '.', ''); // sin comillas\n}\n\nerror_log(\"ENTRANDO \" , 3, \"debug_log.log\");\n// =========================================================================\n// PREPARACIÓN DE VARIABLES (Asumidas de tus helpers q/qi)\n// =========================================================================\n $idtipoventa = qi($values['idtipoventa']);\n $fecha       = q($values['fecha']);\n $idcliente   = qi($values['idcliente']);\n $esnimei     = q($values['esnimei']);\n $simcard     = q($values['simcard']);\n $idsolicitud = qi($values['idsolicitud']); // Clave de búsqueda\n $estatus     = q($values['estatus']);\n $estatusentrega=qi($values['estatusentrega']);\n $dn          = q($values['dn']);\n $dnpreferido = q($values['dnpreferido']);\n $plan        = qi($values['plan']);\n $orden       = q($values['orden']);\n $factura     = q($values['factura']);\n $cuenta      = q($values['cuenta']);\n $contrato    = q($values['contrato']);\n $contratoportal    = q($values['contratoportal']);\n $renta       = qd($values['renta']);\n  $plazo       = qi($values['plazo']);\n$plazopendiente = qi($values['plazopendiente']);\n $ciclo       = qi($values['ciclo'] ?: 1 );\n $idcli       = q($values['idcli']);    \n// Necesitas la tienda actual, asumiré una variable local o de sesión\n$tienda = qi($values['idtienda'] ?? 2); // Ejemplo: usar tienda 2 o de sesión\n\n// =========================================================================\n// 1. VERIFICACIÓN PREVIA: Buscar si la Solicitud ya tiene una Venta asociada\n// =========================================================================\n\nif ($inline && $values['estatus'] === \"ACEPTADA\" && (int)$values['estatusentrega'] === 6){\n$sql_check = \"SELECT idsolicitud \n              FROM ventas \n              WHERE idsolicitud = \" . $idsolicitud;\n\n// Usamos DB::Query para ejecutar SELECT y fetchAssoc() para obtener la fila\n$row = DB::Query($sql_check)->fetchAssoc();\n\n// Variable para almacenar la acción realizada\n$accion_upsert = ''; \n\nif ($row) {\n/*    // =====================================================================\n    // 2. ACTUALIZACIÓN (UPDATE): La Solicitud ya existe en la tabla venta\n    // =====================================================================\n           error_log(\"actualizacion \" . $idsolicitud, 3, \"debug_log.log\");\n\n    $sql_update = \"\n        UPDATE ventas SET \n            tienda      = \" . $tienda . \"           \n        WHERE idsolicitud = \" . $idsolicitud;\n    \n    if (DB::Exec($sql_update, $conn)) {\n        $accion_upsert = 'UPDATE';\n        error_log(\"VENTA - ACTUALIZACIÓN EXITOSA para Solicitud ID: \" . $idsolicitud, 3, \"debug_log.log\");\n    } else {\n        error_log(\"VENTA - ERROR AL ACTUALIZAR. SQL: \" . $sql_update . \" Error: \" . DB::LastError(), 3, \"debug_log.log\");\n        // Puedes agregar aquí una lógica de handle_fail si la actualización es crítica\n    }\n$idtipoventa = qi($values['idtipoventa']);\n $fecha       = q($values['fecha']);\n $idcliente   = qi($values['idcliente']);\n $esnimei     = q($values['esnimei']);\n $simcard     = q($values['simcard']);\n $idsolicitud = qi($values['idsolicitud']); // Clave de búsqueda\n $estatus     = q($values['estatus']);\n $estatusentrega=qi($values['estatusentrega']);\n $dn          = q($values['dn']);\n $dnpreferido = q($values['dnpreferido']);\n $plan        = qi($values['plan']);\n $orden       = q($values['orden']);\n $factura     = q($values['factura']);\n $cuenta      = q($values['cuenta']);\n $contrato    = q($values['contrato']);\n $contratoportal    = q($values['contratoportal']);\n $renta       = qd($values['renta']);\n $plazo       = qi($values['plazo']);\n $plazopendiente = qi($values['plazopendiente']);\n $ciclo       = qi($values['ciclo']);\n $idcli       = q($values['idcli']);    \n// Necesitas la tienda actual, asumiré una variable local o de sesión\n$tienda = qi($values['idtienda'] ?? 2);*/\n} else {\n    // =====================================================================\n    // 3. INSERCIÓN (INSERT): La Solicitud NO existe en la tabla venta\n    // =====================================================================\n         error_log(\"insercion  \" . $idsolicitud, 3, \"debug_log.log\");\n\n    $sql_insert = \"\n        INSERT INTO ventas \n            (idtipoventa, fecha, idcliente, esnimei, simcard, tienda, idsolicitud, dn, dnpreferido, plan, orden, factura, cuenta, contrato, contratoportal, renta, plazo, plazopendiente,\n            ciclo)\n        VALUES (\n            \" . $idtipoventa . \", \n            \" . $fecha . \", \n            \" . $idcliente . \", \n            \" . $esnimei . \", \n            \" . $simcard . \", \n            \" . $tienda . \", \n            \" . $idsolicitud . \",\n            \" . $dn . \",\n            \" . $dnpreferido . \",\n            \" . $plan . \",\n            \" . $orden . \",\n            \" . $factura. \",\n            \" . $cuenta. \",\n            \" . $contrato. \",\n            \" . $contratoportal . \",\n            \" . $renta . \",\n            \" . $plazo . \",\n            \" . $plazopendiente. \",\n            \" . $ciclo . \"\n        )\";\n    \n    if (DB::Exec($sql_insert, $conn)) {\n        $accion_upsert = 'INSERT';\n        error_log(\"VENTA - INSERCIÓN EXITOSA para Solicitud ID: \" . $idsolicitud, 3, \"debug_log.log\");\n    } else {\n        error_log(\"VENTA - ERROR AL INSERTAR. SQL: \" . $sql_insert . \" Error: \" . DB::LastError(), 3, \"debug_log.log\");\n        // Puedes agregar aquí una lógica de handle_fail si la inserción es crítica\n    }\n}\n\n// =========================================================================\n// 4. RESULTADO\n// =========================================================================\nif (!empty($accion_upsert)) {\n    // La variable $accion_upsert contiene 'INSERT' o 'UPDATE'\n    // Puedes usarla para lógica posterior, como notificaciones o auditoría.\n    error_log(\"Acción final de VENTA: \" . $accion_upsert, 3, \"debug_log.log\");\n}\n}\n"
		},
		{
			"eventId": "EVENT_BEFOREPROCESS_ADD",
			"pageType": "add",
			"code": "// Limpieza forzada del formulario cuando viene clean=1\nif ( postvalue(\"clean\") == 1 ) {\n\n    // Nombre de la tabla (use el literal si prefieres)\n    $t = \"solicitudes\";\n\n    // Valores cacheados por PHPRunner para Add/Edit\n    unset($_SESSION[$t . \"_add_values\"]);\n    unset($_SESSION[$t . \"_edit_values\"]);\n\n    // Claves/estructuras auxiliares que pueden mantener estado\n    unset($_SESSION[$t . \"_details\"]);\n    unset($_SESSION[$t . \"_masterkeys\"]);\n    unset($_SESSION[$t . \"_masterkey1\"]);\n    unset($_SESSION[$t . \"_masterkey2\"]);\n    unset($_SESSION[$t . \"_masterkey3\"]);\n\n   /* if ( postvalue(\"ajax_clean\") == 1 ) {\n        header(\"HTTP/1.1 204 No Content\");\n        exit();\n    }*/\n}\n\n\n"
		},
		{
			"eventId": "EVENT_PROCESSVALUES_ADD",
			"pageType": "add",
			"code": "// Place event code here.\n// Use \"Add Action\" button to add code snippets.\n\n$values['idtienda']=$_SESSION['Tienda'];"
		}
	],
	"dbTableInfo": {
		"type": 0,
		"foreignKeys": [],
		"fields": [
			{
				"name": "idsolicitud",
				"type": 20,
				"size": 20,
				"scale": 0,
				"typeName": "bigint(20)",
				"nullable": false,
				"autoinc": true,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idtipoventa",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": false,
				"autoinc": false,
				"defaultValueSQL": "0",
				"defaultValue": "0"
			},
			{
				"name": "fecha",
				"type": 7,
				"size": 0,
				"scale": 0,
				"typeName": "date",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "fechacaptura",
				"type": 135,
				"size": 0,
				"scale": 0,
				"typeName": "datetime",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": "current_timestamp()",
				"defaultValue": "CURRENT_TIMESTAMP"
			},
			{
				"name": "idcliente",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idproducto",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idplan",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "usuario",
				"type": 200,
				"size": 20,
				"scale": 0,
				"typeName": "varchar(20)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idtienda",
				"type": 3,
				"size": 3,
				"scale": 0,
				"typeName": "int(3)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "fechamodif",
				"type": 135,
				"size": 0,
				"scale": 0,
				"typeName": "datetime",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": "current_timestamp()",
				"defaultValue": "CURRENT_TIMESTAMP"
			},
			{
				"name": "orden",
				"type": 200,
				"size": 11,
				"scale": 0,
				"typeName": "varchar(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "solicitudimg",
				"type": 201,
				"size": 0,
				"scale": 0,
				"typeName": "mediumtext",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "estatus",
				"type": 200,
				"size": 20,
				"scale": 0,
				"typeName": "varchar(20)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idsolrazon",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "importeatt",
				"type": 5,
				"size": 0,
				"scale": 0,
				"typeName": "float",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "importesms",
				"type": 5,
				"size": 0,
				"scale": 0,
				"typeName": "float",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "plazo",
				"type": 2,
				"size": 6,
				"scale": 0,
				"typeName": "smallint(6)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "observaciones",
				"type": 200,
				"size": 200,
				"scale": 0,
				"typeName": "varchar(200)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "equipoincluido",
				"type": 16,
				"size": 1,
				"scale": 0,
				"typeName": "tinyint(1)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "rfc",
				"type": 200,
				"size": 20,
				"scale": 0,
				"typeName": "varchar(20)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idtratamiento",
				"type": 3,
				"size": 2,
				"scale": 0,
				"typeName": "int(2)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "riesgo",
				"type": 200,
				"size": 1,
				"scale": 0,
				"typeName": "char(1)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "observacionest",
				"type": 200,
				"size": 200,
				"scale": 0,
				"typeName": "varchar(200)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idcli",
				"type": 200,
				"size": 9,
				"scale": 0,
				"typeName": "varchar(9)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "fecha1avta",
				"type": 7,
				"size": 0,
				"scale": 0,
				"typeName": "date",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idplan1avta",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "dn1avta",
				"type": 200,
				"size": 10,
				"scale": 0,
				"typeName": "varchar(10)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idproceso",
				"type": 16,
				"size": 2,
				"scale": 0,
				"typeName": "tinyint(2)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idorigenventa",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "estatusentrega",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "dn",
				"type": 200,
				"size": 10,
				"scale": 0,
				"typeName": "varchar(10)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "cuenta",
				"type": 200,
				"size": 50,
				"scale": 0,
				"typeName": "varchar(50)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "contrato",
				"type": 200,
				"size": 11,
				"scale": 0,
				"typeName": "varchar(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "contratoportal",
				"type": 200,
				"size": 11,
				"scale": 0,
				"typeName": "varchar(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "plan",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "renta",
				"type": 14,
				"size": 10,
				"scale": 2,
				"typeName": "decimal(10,2)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "plazopendiente",
				"type": 2,
				"size": 6,
				"scale": 0,
				"typeName": "smallint(6)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "dnpreferido",
				"type": 200,
				"size": 10,
				"scale": 0,
				"typeName": "varchar(10)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "Factura",
				"type": 200,
				"size": 18,
				"scale": 0,
				"typeName": "varchar(18)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "fechavenci",
				"type": 7,
				"size": 0,
				"scale": 0,
				"typeName": "date",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "ciclo",
				"type": 3,
				"size": 2,
				"scale": 0,
				"typeName": "int(2)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "idcita",
				"type": 3,
				"size": 11,
				"scale": 0,
				"typeName": "int(11)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "esnimei",
				"type": 200,
				"size": 30,
				"scale": 0,
				"typeName": "varchar(30)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			},
			{
				"name": "simcard",
				"type": 200,
				"size": 30,
				"scale": 0,
				"typeName": "varchar(30)",
				"nullable": true,
				"autoinc": false,
				"defaultValueSQL": null,
				"defaultValue": ""
			}
		],
		"primaryKeys": [
			"idsolicitud"
		],
		"uniqueFields": [],
		"name": "solicitudes"
	},
	"pages": [
		{
			"id": "add",
			"type": "add",
			"layoutId": "nomenu",
			"disabled": false,
			"default": 1,
			"forms": {
				"above-grid": {
					"modelId": "add-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"add_message"
							]
						},
						"c2": {
							"model": "c2",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "add-below-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"text1",
								"add_save",
								"add_reset",
								"add_back_list",
								"add_cancel"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "add-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"image",
								"add_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-edit",
					"grid": [
						{
							"cells": [
								{
									"cell": "c4",
									"colspan": 1
								}
							],
							"section": ""
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c9",
									"rowspan": 1
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c",
									"colspan": 1
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c1",
									"colspan": 1
								}
							]
						},
						{
							"cells": [
								{
									"cell": "c8",
									"colspan": 1
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c3"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c4": {
							"model": "c3",
							"items": [
								"sec_cliente"
							],
							"align": "center"
						},
						"c": {
							"model": "c3",
							"items": [
								"sec_venta"
							],
							"align": "center"
						},
						"c1": {
							"model": "c3",
							"items": [],
							"background": "transparent",
							"customCSS": "/* Put  your custom CSS code here */\n\n        body {\n            box-sizing: border-box;\n        }",
							"height": "3em"
						},
						"c8": {
							"model": "c3",
							"items": [
								"section2"
							],
							"align": "center"
						},
						"c9": {
							"model": "c3",
							"items": []
						},
						"c3": {
							"model": "c3",
							"items": []
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section": {
					"modelId": "simple-edit",
					"grid": [
						{
							"section": "",
							"cells": [
								{
									"cell": "c3"
								},
								{
									"cell": "c4"
								}
							]
						},
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"integrated_edit_field4",
								"integrated_edit_field1"
							]
						},
						"c": {
							"model": "c1",
							"items": [
								"integrated_edit_field5",
								"integrated_edit_field6"
							]
						},
						"c3": {
							"model": "c1",
							"items": [
								"integrated_edit_field3"
							]
						},
						"c4": {
							"model": "c1",
							"items": [
								"integrated_edit_field9"
							]
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section1": {
					"modelId": "simple-edit",
					"grid": [
						{
							"section": "",
							"cells": [
								{
									"cell": "c2",
									"colspan": 2
								},
								{
									"cell": "c10"
								},
								{
									"cell": "c"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c4",
									"colspan": 2
								},
								{
									"cell": "c11"
								},
								{
									"cell": "c3"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c9",
									"colspan": 1
								},
								{
									"cell": "c18"
								},
								{
									"cell": "c13"
								},
								{
									"cell": "c5"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c12",
									"colspan": 1
								},
								{
									"cell": "c19"
								},
								{
									"cell": "c14"
								},
								{
									"cell": "c7"
								}
							]
						},
						{
							"cells": [
								{
									"cell": "c6",
									"colspan": 1
								},
								{
									"cell": "c20"
								},
								{
									"cell": "c15"
								},
								{
									"cell": "c8"
								}
							],
							"section": ""
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c16",
									"colspan": 3
								},
								{
									"cell": "c22"
								}
							]
						}
					],
					"cells": {
						"c2": {
							"model": "c1",
							"items": [
								"integrated_edit_field"
							]
						},
						"c4": {
							"model": "c1",
							"items": [
								"integrated_edit_field20"
							]
						},
						"c6": {
							"model": "c1",
							"items": [
								"integrated_edit_field8"
							]
						},
						"c9": {
							"model": "c1",
							"items": [
								"integrated_edit_field7"
							]
						},
						"c12": {
							"model": "c1",
							"items": [
								"integrated_edit_field23"
							]
						},
						"c3": {
							"model": "c1",
							"items": []
						},
						"c5": {
							"model": "c1",
							"items": [
								"integrated_edit_field22"
							]
						},
						"c7": {
							"model": "c1",
							"items": []
						},
						"c8": {
							"model": "c1",
							"items": [
								"integrated_edit_field27"
							]
						},
						"c10": {
							"model": "c1",
							"items": [
								"integrated_edit_field19"
							]
						},
						"c11": {
							"model": "c1",
							"items": [
								"integrated_edit_field2"
							]
						},
						"c13": {
							"model": "c1",
							"items": [
								"integrated_edit_field29"
							]
						},
						"c14": {
							"model": "c1",
							"items": [
								"integrated_edit_field26"
							]
						},
						"c15": {
							"model": "c1",
							"items": [
								"integrated_edit_field28"
							]
						},
						"c18": {
							"model": "c1",
							"items": [
								"integrated_edit_field21"
							]
						},
						"c19": {
							"model": "c1",
							"items": [
								"integrated_edit_field24"
							]
						},
						"c20": {
							"model": "c1",
							"items": [
								"integrated_edit_field25"
							]
						},
						"c": {
							"model": "c1",
							"items": []
						},
						"c16": {
							"model": "c1",
							"items": [
								"integrated_edit_field12"
							]
						},
						"c22": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section2": {
					"modelId": "simple-edit",
					"grid": [
						{
							"section": "",
							"cells": [
								{
									"cell": "c4",
									"colspan": 1
								},
								{
									"cell": "c5",
									"colspan": 6
								},
								{
									"cell": "c19"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c9",
									"colspan": 1
								},
								{
									"cell": "c6",
									"colspan": 2
								},
								{
									"cell": "c29",
									"colspan": 2
								},
								{
									"cell": "c25"
								},
								{
									"cell": "c26"
								},
								{
									"cell": "c20"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c14"
								},
								{
									"cell": "c15"
								},
								{
									"cell": "c16",
									"colspan": 2
								},
								{
									"cell": "c17",
									"colspan": 3
								},
								{
									"cell": "c18"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c",
									"colspan": 8
								}
							]
						}
					],
					"cells": {
						"c4": {
							"model": "c1",
							"items": [
								"integrated_edit_field10"
							],
							"align": "left"
						},
						"c9": {
							"model": "c1",
							"items": [
								"integrated_edit_field16"
							],
							"width": "40%"
						},
						"c19": {
							"model": "c1",
							"items": []
						},
						"c20": {
							"model": "c1",
							"items": []
						},
						"c5": {
							"model": "c1",
							"items": [
								"integrated_edit_field11"
							]
						},
						"c6": {
							"model": "c1",
							"items": [
								"integrated_edit_field13"
							],
							"width": "30%"
						},
						"c": {
							"model": "c1",
							"items": [
								"text"
							],
							"align": "center"
						},
						"c14": {
							"model": "c1",
							"items": [
								"integrated_edit_field17"
							]
						},
						"c15": {
							"model": "c1",
							"items": [
								"integrated_edit_field18"
							]
						},
						"c16": {
							"model": "c1",
							"items": []
						},
						"c17": {
							"model": "c1",
							"items": []
						},
						"c18": {
							"model": "c1",
							"items": []
						},
						"c29": {
							"model": "c1",
							"items": [
								"integrated_edit_field14"
							]
						},
						"c25": {
							"model": "c1",
							"items": [
								"integrated_edit_field15"
							]
						},
						"c26": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				}
			},
			"items": {
				"add_header": {
					"type": "add_header"
				},
				"add_back_list": {
					"type": "add_back_list"
				},
				"add_cancel": {
					"type": "add_cancel",
					"icon": {}
				},
				"add_message": {
					"type": "add_message"
				},
				"add_save": {
					"type": "add_save",
					"icon": {},
					"customCSS": "/* Put  your custom CSS code here */\n\n:host {\n\n   display:none !important; \n\n\n}\n"
				},
				"add_reset": {
					"type": "add_reset"
				},
				"integrated_edit_field3": {
					"field": "idcliente",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idcliente",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field": {
					"field": "idproducto",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idproducto",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field2": {
					"field": "idplan",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idplan",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field1": {
					"field": "nombre",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "nombre",
						"table": "solicitudes",
						"type": 5
					},
					"label": {
						"field": "nombre",
						"table": "solicitudes",
						"type": 3
					}
				},
				"integrated_edit_field4": {
					"field": "paterno",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "paterno",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field5": {
					"field": "materno",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "materno",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field6": {
					"field": "rfc",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field7": {
					"field": "orden",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "orden",
						"table": "solicitudes",
						"type": 5
					},
					"font-size": "1.5em",
					"bold": true
				},
				"integrated_edit_field8": {
					"field": "plazo",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "plazo",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field9": {
					"field": "idcli",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field19": {
					"field": "noserie",
					"type": "integrated_edit_field",
					"orientation": 0,
					"bold": true,
					"font-size": "2em"
				},
				"integrated_edit_field20": {
					"field": "idtipoventa",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field21": {
					"field": "dn",
					"type": "integrated_edit_field",
					"orientation": 0,
					"font-size": "1.5em",
					"bold": true
				},
				"integrated_edit_field22": {
					"field": "cuenta",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field23": {
					"field": "contrato",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field24": {
					"field": "contratoportal",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field25": {
					"field": "plazopendiente",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field26": {
					"field": "factura",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field27": {
					"field": "fechavenci",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field28": {
					"field": "ciclo",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field29": {
					"field": "dnpreferido",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"image": {
					"type": "image",
					"image": {
						"image": "LOGO NEGRO Y AZUL PEQUE.png",
						"source": 2
					},
					"width": "168px",
					"height": "80px"
				},
				"text": {
					"type": "text",
					"editedByRte": false,
					"label": {
						"text": "<div id=\"google-map\" style=\"height: 400px; width: 100%; margin-bottom: 10px; border: 1px solid #ccc;\"></div>\n<p><strong>Haz clic en el mapa para ubicar o arrastra el marcador.</strong></p>\n\n<script src=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyBEbOZrRNV7JiveFroZVC2AFkoMJ18VKyg&libraries=geometry,places&callback=initGoogleMap\" async defer></script>\n\n<script>\n// ====================================================================\n// 📌 1. CONFIGURACIÓN DE IDS (AJUSTA ESTOS IDS SI NO COINCIDEN)\n// ====================================================================\nconst FIELD_IDS = {\n    calle:   'value_calle_1',\n    numext:  'value_numeroext_1',\n    colonia: 'value_colonia_1',\n    ciudad:  'value_ciudad_1',\n    estado:  'value_estado_1',\n    cp:      'value_cp_1',\n    lat:     'value_lat_1',\n    lng:     'value_lng_1'\n};\n\n// ====================================================================\n// 📌 2. VARIABLES GLOBALES Y HELPERS\n// ====================================================================\nlet map;\nlet marker;\nlet geocoder;\nlet mapInitialized = false;\n\nconst $id = (id) => document.getElementById(id);\nconst safeTrim = (v) => (v || '').toString().trim();\nconst isValidLatLng = (lat, lng) => {\n    const a = Number(lat), b = Number(lng);\n    return Number.isFinite(a) && Number.isFinite(b) && a <= 90 && a >= -90 && b <= 180 && b >= -180;\n};\n\n// ====================================================================\n// 📌 3. FUNCIONES PRINCIPALES\n// ====================================================================\n\n// --- Inicialización del Mapa (Llamada por el API script) ---\nfunction initGoogleMap() {\n    if (mapInitialized) return;\n\n    const defaultCoords = { lat: 21.0038, lng: -89.6183 }; // Mérida, México como centro por defecto\n    \n    const initialLat = safeTrim($id(FIELD_IDS.lat)?.value);\n    const initialLng = safeTrim($id(FIELD_IDS.lng)?.value);\n    const initialCoords = isValidLatLng(initialLat, initialLng) \n        ? { lat: Number(initialLat), lng: Number(initialLng) } \n        : defaultCoords;\n\n    map = new google.maps.Map($id('google-map'), {\n        center: initialCoords,\n        zoom: isValidLatLng(initialLat, initialLng) ? 17 : 12,\n        mapTypeId: 'roadmap',\n        gestureHandling: 'greedy' // 🚀 Evita el molesto \"Ctrl + Scroll\"\n    });\n\n    geocoder = new google.maps.Geocoder();\n    mapInitialized = true;\n\n    // Colocar marcador si hay coordenadas iniciales\n    if (isValidLatLng(initialLat, initialLng)) {\n        placeMarker(initialCoords);\n    }\n    \n    // Listener: Al hacer CLIC en el mapa\n    map.addListener('click', (e) => {\n        placeMarker(e.latLng); \n        updateFieldsAndGeocode(e.latLng); \n    });\n    \n    // PHPRunner necesita esta línea para que el mapa se muestre correctamente en pestañas/secciones\n    setTimeout(() => google.maps.event.trigger(map, 'resize'), 300);\n}\n\n// --- Coloca el marcador y actualiza Lat/Lng al arrastrar o hacer clic ---\nfunction placeMarker(location) {\n    if (marker) {\n        marker.setPosition(location);\n    } else {\n        marker = new google.maps.Marker({\n            position: location,\n            map: map,\n            draggable: true // 📌 Permite arrastrar el marcador\n        });\n        \n        // Listener: Al terminar de arrastrar el marcador\n        marker.addListener('dragend', function() {\n            const newLocation = marker.getPosition();\n            updateFieldsAndGeocode(newLocation);\n        });\n    }\n    map.setCenter(location);\n    \n    // Si no usamos updateFieldsAndGeocode (ej. al inicio), aseguramos la posición\n    $id(FIELD_IDS.lat).value = location.lat().toFixed(6);\n    $id(FIELD_IDS.lng).value = location.lng().toFixed(6);\n}\n\n// --- Función central: Actualiza campos y pide Geocodificación Inversa ---\nfunction updateFieldsAndGeocode(location) {\n    // 1. Actualiza campos Lat/Lng\n    $id(FIELD_IDS.lat).value = location.lat().toFixed(6);\n    $id(FIELD_IDS.lng).value = location.lng().toFixed(6);\n    \n    // 2. Realiza la geocodificación inversa (Lat/Lng -> Dirección)\n    reverseGeocode(location);\n}\n\n// --- Geocodificación Inversa (Lat/Lng -> Dirección) ---\nfunction reverseGeocode(latLng) {\n    if (!geocoder) return;\n\n    geocoder.geocode({ location: latLng })\n        .then((response) => {\n            if (response.results[0]) {\n                populateAddressFields(response.results[0]);\n            }\n        })\n        .catch((e) => console.error('Falló la geocodificación inversa:', e));\n}\n\nfunction getAddressComponent(components, type) {\n    const component = components.find(c => c.types.includes(type));\n    return component ? component.long_name : '';\n}\n\nfunction populateAddressFields(result) {\n    const components = result.address_components;\n    \n    // Obtener componentes específicos de Google Maps\n    const street = getAddressComponent(components, 'route');\n    const houseNumber = getAddressComponent(components, 'street_number');\n    const neighborhood = getAddressComponent(components, 'sublocality_level_1') || getAddressComponent(components, 'neighborhood');\n    const city = getAddressComponent(components, 'locality') || getAddressComponent(components, 'administrative_area_level_2');\n    const state = getAddressComponent(components, 'administrative_area_level_1');\n    const postalCode = getAddressComponent(components, 'postal_code');\n\n    // Llenar los campos del formulario\n    if ($id(FIELD_IDS.estado)) $id(FIELD_IDS.estado).value = state;\n    if ($id(FIELD_IDS.ciudad)) $id(FIELD_IDS.ciudad).value = city;\n    if ($id(FIELD_IDS.cp)) $id(FIELD_IDS.cp).value = postalCode;\n    if ($id(FIELD_IDS.colonia)) $id(FIELD_IDS.colonia).value = neighborhood;\n    if ($id(FIELD_IDS.calle)) $id(FIELD_IDS.calle).value = street;\n    if ($id(FIELD_IDS.numext)) $id(FIELD_IDS.numext).value = houseNumber;\n}\n\n// --- Geocodificación (Dirección -> Lat/Lng) desde campos de texto ---\nfunction geocodeAddressFromFields() {\n    const calle = safeTrim($id(FIELD_IDS.calle)?.value);\n    const numext = safeTrim($id(FIELD_IDS.numext)?.value);\n    const colonia = safeTrim($id(FIELD_IDS.colonia)?.value);\n    const ciudad = safeTrim($id(FIELD_IDS.ciudad)?.value) || '';\n    const estado = safeTrim($id(FIELD_IDS.estado)?.value) || '';\n    const cp = safeTrim($id(FIELD_IDS.cp)?.value);\n\n    const addressParts = [\n        calle + (numext ? ' ' + numext : ''),\n        colonia,\n        ciudad,\n        estado,\n        cp,\n        'México'\n    ].filter(Boolean);\n    \n    const address = addressParts.join(', ');\n\n    if (!address || !geocoder || (!calle && !colonia)) return;\n\n    geocoder.geocode({ address: address })\n        .then((response) => {\n            if (response.results[0]) {\n                const location = response.results[0].geometry.location;\n                placeMarker(location);\n                map.setZoom(17);\n            }\n        })\n        .catch((e) => console.error('Geocoding falló por:', e));\n}\n\n\n// ====================================================================\n// 📌 4. LÓGICA DE ARRANQUE Y EVENTOS (Manejo de Tabs/Redimensionamiento)\n// ====================================================================\n\nfunction attachListeners() {\n    const addressFields = [FIELD_IDS.calle, FIELD_IDS.numext, FIELD_IDS.colonia, FIELD_IDS.ciudad, FIELD_IDS.estado, FIELD_IDS.cp];\n\n    // Observa cambios en los campos de dirección (al salir o presionar Enter)\n    addressFields.forEach(id => {\n        const el = $id(id);\n        if (!el) return;\n        \n        el.addEventListener('blur', geocodeAddressFromFields);\n        el.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter') {\n                e.preventDefault();\n                geocodeAddressFromFields();\n            }\n        });\n    });\n\n    // Observa cambios en Lat/Lng manuales para centrar el mapa\n    [FIELD_IDS.lat, FIELD_IDS.lng].forEach(id => {\n        const el = $id(id);\n        if (!el) return;\n        el.addEventListener('change', () => {\n            const lat = safeTrim($id(FIELD_IDS.lat)?.value);\n            const lng = safeTrim($id(FIELD_IDS.lng)?.value);\n            if (isValidLatLng(lat, lng)) {\n                placeMarker(new google.maps.LatLng(Number(lat), Number(lng)));\n                map.setZoom(17);\n            }\n        });\n    });\n}\n\n// Maneja la inicialización tardía en caso de que el mapa esté en una pestaña oculta\nfunction checkMapVisibility() {\n    const mapContainer = $id('google-map');\n    if (mapContainer && mapContainer.offsetParent !== null && mapContainer.offsetWidth > 0) {\n        if (!mapInitialized && typeof google !== 'undefined' && typeof google.maps !== 'undefined') {\n             // La inicialización real ocurre por el 'callback=initGoogleMap' en la URL del API\n             // Solo llamamos al resize si ya cargó\n             setTimeout(() => google.maps.event.trigger(map, 'resize'), 100);\n             return true;\n        }\n    }\n    return false;\n}\n\ndocument.addEventListener('DOMContentLoaded', function() {\n    attachListeners();\n\n    // Revisa la visibilidad al inicio\n    checkMapVisibility(); \n    \n    // Observador para cuando se cambie de pestaña\n    document.body.addEventListener('click', function(e) {\n        if (e.target.closest('[data-toggle=\"tab\"], .step-tab, .nav-link')) {\n            setTimeout(() => {\n                if (mapInitialized) google.maps.event.trigger(map, 'resize');\n                else checkMapVisibility();\n            }, 400);\n        }\n    });\n});\n</script>",
						"type": 0
					}
				},
				"integrated_edit_field16": {
					"field": "colonia",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field13": {
					"field": "calle",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field14": {
					"field": "numeroext",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field15": {
					"field": "numeroint",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field11": {
					"field": "ciudad",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field10": {
					"field": "estado",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field17": {
					"field": "lat",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field18": {
					"field": "lng",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"section2": {
					"type": "section",
					"title": {
						"text": "<i class=\"fa-solid fa-location-dot\" style=\"font-size:1.5em; color:#fff;\"></i> Dirección de Entrega\n",
						"type": 0
					},
					"location": "section2",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "",
					"headerColor": "",
					"bodyBg": "",
					"bodyColor": "",
					"panelBorder": null,
					"borderColor": "",
					"initiallyClosed": true
				},
				"sec_cliente": {
					"type": "section",
					"title": {
						"text": "<i class=\"fa-solid fa-user\" style=\"font-size:1.5em; color:#fff;\"></i> Datos del Cliente\n\n",
						"type": 0
					},
					"location": "section",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "",
					"headerColor": "#ffffff",
					"bodyBg": "",
					"bodyColor": "",
					"panelBorder": null,
					"borderColor": "",
					"initiallyClosed": true
				},
				"sec_venta": {
					"type": "section",
					"title": {
						"text": "<i class=\"fa-solid fa-cart-shopping\" style=\"font-size:1.5em; color:#fff;\"></i> Información de la Venta\n",
						"type": 0
					},
					"location": "section1",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "",
					"headerColor": "",
					"bodyBg": "",
					"bodyColor": "",
					"panelBorder": null,
					"borderColor": "",
					"initiallyClosed": true
				},
				"text1": {
					"type": "text",
					"label": {
						"text": "<button type=\"button\" id=\"btnGuardarVNP\" class=\"btn btn-primary\">\n    Guardar VNP\n</button>\n",
						"type": 0
					},
					"editedByRte": false
				},
				"integrated_edit_field12": {
					"field": "observaciones",
					"type": "integrated_edit_field",
					"orientation": 0
				}
			},
			"dbProps": {},
			"version": 13,
			"pageWidth": "standard",
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"pageCSS": "/* Put  your custom CSS code here */\n\n/* Put  your custom CSS code here */\n\n\n\n/* ========================================================= */\n/* VARIABLES DE COLOR */\n/* ========================================================= */\n:root {\n    --color-elegante: #FFFFFF; /* Texto Blanco para contrastar con el fondo oscuro */\n    --naranja-degradado-inicio: #03478A; /* Naranja Suave (Light Salmon) */\n    --naranja-degradado-fin: #6D98C2; /* Naranja Medio (Coral) */\n    --color-borde-base: #FF7F50; /* Color simple para el borde base */\n}\n\n/* ========================================================= */\n/* 1. Fondo de la Página: Degradado Azul Cielo (Se mantiene) */\n/* ========================================================= */\nbody, .container-fluid {\nbackground: linear-gradient(180deg, #E0F7FA 0%, #B3E5FC 100%) !important;    min-height: 100vh;\n}\n\n/* ========================================================= */\n/* 2. Estilo de las Secciones: Efecto Tarjeta/Sombreado (Se mantiene) */\n/* ========================================================= */\n.panel, .rnr-c-body, .rnr-c-grid {\n    background-color: #FFFFFF !important; \n    border: none !important; \n    border-radius: 12px !important; \n    padding: 20px;\n    margin-bottom: 25px; \n    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1), \n                0 2px 6px rgba(0, 0, 0, 0.05) !important; \n                \n    /* 🔑 CAMBIO CLAVE: Agrega 'transform' a la transición */\n    transition: box-shadow 0.3s ease-in-out, \n                transform 0.3s ease-in-out; /* Transición para el movimiento y escala */            \n                \n}\n\n/* ========================================================= */\n/* 3. Estilo de Encabezados de Sección (EL CAMBIO PRINCIPAL) */\n/* ========================================================= */\n.panel-heading, .rnr-c-head {\n    /* Aplicamos el degradado al fondo completo del encabezado */\n    background: linear-gradient(to right, var(--naranja-degradado-inicio), var(--naranja-degradado-fin)) !important;\n    \n    /* El texto del título ahora es blanco para contrastar con el fondo naranja */\n    color: var(--color-elegante) !important; \n    \n    font-weight: 600;\n    \n    /* Mantenemos el centrado vertical */\n    display: flex;\n    align-items: center;\n    height: 40px; /* Aseguramos una altura suficiente */\n    \n    /* Eliminamos el borde degradado y aplicamos un borde simple y fino abajo */\n    border-bottom: 1px solid var(--color-borde-base) !important; \n    border-image-source: none !important; /* Desactivar la propiedad border-image anterior */\n    \n    /* Ajustes de relleno/bordes para que el degradado se vea bien */\n    padding: 0 15px !important; \n    border-top-left-radius: 12px !important; /* Mantenemos el radio del panel superior */\n    border-top-right-radius: 12px !important;\n}\n\n/* ========================================================= */\n/* 3. Estilo de HOVER: Efecto de Elevación/Intensificación    */\n/* ========================================================= */\n.panel:hover, .rnr-c-body:hover, .rnr-c-grid:hover {\n    /* Nueva sombra más intensa y \"elevada\" */\n    box-shadow: 0 15px 400px rgba(0, 0, 0, 0.3), \n                0 5px 15px rgba(0, 0, 0, 0.1) !important; \n    \n    /* Pequeño movimiento hacia arriba para dar más sensación de elevación (opcional) */\n    transform: translateY(-5px) scale(1.005); \n}\n\n\n\n/* 4. Estilo de los Inputs (Se mantiene) */\n.form-control {\n    border-radius: 8px !important; \n    border: 1px solid #e0e0e0 !important;\n}\n.form-control:focus {\n    border-color: #48C9B0 !important; \n    box-shadow: 0 0 0 0.2rem rgba(72, 201, 176, 0.25) !important;\n}\n\n/* Aplica solo a formularios con esas secciones */\n.panel.panel-default.form-section > .panel-body { display: none; }\n\n.panel.panel-default.form-section > .panel-heading:hover {\n  cursor: pointer;\n  filter: brightness(0.98);\n}\n\n/* ========================================================= */\n/* ARREGLO DE COLOR DE TEXTO DE ENCABEZADO DURANTE MODAL     */\n/* ========================================================= */\n\n/* Apuntamos directamente al panel-title, que es el elemento que contiene \n   el texto del encabezado de la sección. \n*/\n.panel-heading .panel-title {\n    color: #FFFFFF !important; \n}\n\n/* Si dentro del panel-title hay un enlace (Ej. si el encabezado permite colapsar/expandir \n   y el título es un <a>), también debemos forzar el color del enlace.\n*/\n.panel-heading .panel-title a {\n    color: #FFFFFF !important;\n}\n\n/* Asegurar que el texto dentro del panel-title no se vea afectado por reglas generales\n   que usen el estado 'modal-open' en el cuerpo de la página.\n*/\n.modal-open .panel-heading .panel-title {\n    color: #FFFFFF !important;\n}\n\n/* Evita encogimiento general */\n#center_block, .rnr-page, .bs-body { min-height: 85vh; }\n\n/* Botón flotante \"Alta rápida\" sobre el modal del lookup (fallback cross-origin) */\n.lkp-floating-add {\n  position: fixed;\n  right: 24px;\n  top: 24px;\n  z-index: 2147483000;\n  padding: 10px 14px;\n  border-radius: 12px;\n  background: #0d6efd;\n  color: #fff;\n  font-weight: 600;\n  cursor: pointer;\n  display: none; /* se activa por JS cuando detectamos el iframe del lookup */\n  box-shadow: 0 6px 20px rgba(0,0,0,.25);\n}\n\n/* Portal del ADD en el top.document */\n#lkpAddPortal {\n  position: fixed;\n  inset: 0;\n  background: rgba(0,0,0,.35);\n  z-index: 2147483647;\n  display: none;\n}\n#lkpAddPortal .shell {\n  position: absolute;\n  inset: 3vh 3vw;           /* 94% del viewport */\n  background: #fff;\n  border-radius: 16px;\n  box-shadow: 0 20px 60px rgba(0,0,0,.4);\n  overflow: hidden;\n}\n#lkpAddPortal iframe {\n  width: 100%;\n  height: 100%;\n  border: 0;\n  display: block;\n}\n#lkpAddPortal .close-btn {\n  position: absolute;\n  top: 10px; right: 10px;\n  z-index: 10;\n  padding: 6px 10px;\n  background: #111;\n  color: #fff;\n  border-radius: 10px;\n  cursor: pointer;\n  font-weight: 600;\n  opacity: .85;\n}\n#lkpAddPortal .close-btn:hover { opacity: 1; }\n",
			"listTotals": 1,
			"customHtml": "",
			"title": {}
		},
		{
			"id": "export",
			"type": "export",
			"layoutId": "first",
			"disabled": false,
			"default": 0,
			"forms": {
				"supertop": {
					"modelId": "panel-top",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "export-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"export_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "export-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"export_field",
								"export_field1",
								"export_field2",
								"export_field3",
								"export_field4",
								"export_field5",
								"export_field6",
								"export_field7",
								"export_field8",
								"export_field9",
								"export_field10",
								"export_field11"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"footer": {
					"modelId": "export-footer",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						},
						"c2": {
							"model": "c2",
							"items": [
								"export_export",
								"export_cancel"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				}
			},
			"items": {
				"export_header": {
					"type": "export_header"
				},
				"export_export": {
					"type": "export_export"
				},
				"export_cancel": {
					"type": "export_cancel"
				},
				"export_field": {
					"field": "direccion",
					"type": "export_field"
				},
				"export_field1": {
					"field": "lat",
					"type": "export_field"
				},
				"export_field2": {
					"field": "lng",
					"type": "export_field"
				},
				"export_field3": {
					"field": "dn",
					"type": "export_field"
				},
				"export_field4": {
					"field": "cuenta",
					"type": "export_field"
				},
				"export_field5": {
					"field": "contrato",
					"type": "export_field"
				},
				"export_field6": {
					"field": "contratoportal",
					"type": "export_field"
				},
				"export_field7": {
					"field": "plazopendiente",
					"type": "export_field"
				},
				"export_field8": {
					"field": "factura",
					"type": "export_field"
				},
				"export_field9": {
					"field": "fechavenci",
					"type": "export_field"
				},
				"export_field10": {
					"field": "ciclo",
					"type": "export_field"
				},
				"export_field11": {
					"field": "dnpreferido",
					"type": "export_field"
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {},
			"exportFormat": 2,
			"exportDelimiter": ",",
			"exportSelectDelimiter": false,
			"exportSelectFields": false
		},
		{
			"id": "import",
			"type": "import",
			"layoutId": "first",
			"disabled": true,
			"default": 0,
			"forms": {
				"supertop": {
					"modelId": "panel-top",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "import-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"import_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "import-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				}
			},
			"items": {
				"import_header": {
					"type": "import_header"
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {}
		},
		{
			"id": "edit",
			"type": "edit",
			"layoutId": "nomenu",
			"disabled": false,
			"default": 7,
			"forms": {
				"above-grid": {
					"modelId": "edit-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"edit_message"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "edit-below-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1",
									"colspan": 1
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"text1",
								"edit_back_list",
								"edit_close"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "edit-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"image",
								"edit_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-edit",
					"grid": [
						{
							"cells": [
								{
									"cell": "c4",
									"colspan": 1
								}
							],
							"section": ""
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c9",
									"rowspan": 1
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c",
									"colspan": 1
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c1",
									"colspan": 1
								}
							]
						},
						{
							"cells": [
								{
									"cell": "c8",
									"colspan": 1
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c3"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c4": {
							"model": "c3",
							"items": [
								"sec_cliente"
							],
							"align": "center"
						},
						"c": {
							"model": "c3",
							"items": [
								"sec_venta"
							],
							"align": "center"
						},
						"c1": {
							"model": "c3",
							"items": [],
							"background": "transparent",
							"customCSS": "/* Put  your custom CSS code here */\n\n        body {\n            box-sizing: border-box;\n        }",
							"height": "3em"
						},
						"c8": {
							"model": "c3",
							"items": [
								"section2"
							],
							"align": "center"
						},
						"c9": {
							"model": "c3",
							"items": []
						},
						"c3": {
							"model": "c3",
							"items": []
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section": {
					"modelId": "simple-edit",
					"grid": [
						{
							"section": "",
							"cells": [
								{
									"cell": "c3"
								},
								{
									"cell": "c4"
								}
							]
						},
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"integrated_edit_field4",
								"integrated_edit_field1"
							]
						},
						"c": {
							"model": "c1",
							"items": [
								"integrated_edit_field5",
								"integrated_edit_field6"
							]
						},
						"c3": {
							"model": "c1",
							"items": [
								"integrated_edit_field3"
							]
						},
						"c4": {
							"model": "c1",
							"items": [
								"integrated_edit_field9"
							]
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section1": {
					"modelId": "simple-edit",
					"grid": [
						{
							"section": "",
							"cells": [
								{
									"cell": "c2",
									"colspan": 2
								},
								{
									"cell": "c10"
								},
								{
									"cell": "c"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c4",
									"colspan": 2
								},
								{
									"cell": "c11"
								},
								{
									"cell": "c3"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c9",
									"colspan": 1
								},
								{
									"cell": "c18"
								},
								{
									"cell": "c13"
								},
								{
									"cell": "c5"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c12",
									"colspan": 1
								},
								{
									"cell": "c19"
								},
								{
									"cell": "c14"
								},
								{
									"cell": "c7"
								}
							]
						},
						{
							"cells": [
								{
									"cell": "c6",
									"colspan": 1
								},
								{
									"cell": "c20"
								},
								{
									"cell": "c15"
								},
								{
									"cell": "c8"
								}
							],
							"section": ""
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c16",
									"colspan": 3
								},
								{
									"cell": "c22"
								}
							]
						}
					],
					"cells": {
						"c2": {
							"model": "c1",
							"items": [
								"integrated_edit_field"
							]
						},
						"c4": {
							"model": "c1",
							"items": [
								"integrated_edit_field20"
							]
						},
						"c6": {
							"model": "c1",
							"items": [
								"integrated_edit_field8"
							]
						},
						"c9": {
							"model": "c1",
							"items": [
								"integrated_edit_field7"
							]
						},
						"c12": {
							"model": "c1",
							"items": [
								"integrated_edit_field23"
							]
						},
						"c3": {
							"model": "c1",
							"items": [
								"integrated_edit_field30"
							]
						},
						"c5": {
							"model": "c1",
							"items": [
								"integrated_edit_field22"
							]
						},
						"c7": {
							"model": "c1",
							"items": []
						},
						"c8": {
							"model": "c1",
							"items": [
								"integrated_edit_field27"
							]
						},
						"c10": {
							"model": "c1",
							"items": [
								"integrated_edit_field19"
							]
						},
						"c11": {
							"model": "c1",
							"items": [
								"integrated_edit_field2"
							]
						},
						"c13": {
							"model": "c1",
							"items": [
								"integrated_edit_field29"
							]
						},
						"c14": {
							"model": "c1",
							"items": [
								"integrated_edit_field26"
							]
						},
						"c15": {
							"model": "c1",
							"items": [
								"integrated_edit_field28"
							]
						},
						"c18": {
							"model": "c1",
							"items": [
								"integrated_edit_field21"
							]
						},
						"c19": {
							"model": "c1",
							"items": [
								"integrated_edit_field24"
							]
						},
						"c20": {
							"model": "c1",
							"items": [
								"integrated_edit_field25"
							]
						},
						"c": {
							"model": "c1",
							"items": []
						},
						"c16": {
							"model": "c1",
							"items": [
								"integrated_edit_field12"
							]
						},
						"c22": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section2": {
					"modelId": "simple-edit",
					"grid": [
						{
							"section": "",
							"cells": [
								{
									"cell": "c4",
									"colspan": 1
								},
								{
									"cell": "c5",
									"colspan": 6
								},
								{
									"cell": "c19"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c9",
									"colspan": 1
								},
								{
									"cell": "c6",
									"colspan": 2
								},
								{
									"cell": "c29",
									"colspan": 2
								},
								{
									"cell": "c25"
								},
								{
									"cell": "c26"
								},
								{
									"cell": "c20"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c14"
								},
								{
									"cell": "c15"
								},
								{
									"cell": "c16",
									"colspan": 2
								},
								{
									"cell": "c17",
									"colspan": 3
								},
								{
									"cell": "c18"
								}
							]
						},
						{
							"section": "",
							"cells": [
								{
									"cell": "c",
									"colspan": 8
								}
							]
						}
					],
					"cells": {
						"c4": {
							"model": "c1",
							"items": [
								"integrated_edit_field10"
							],
							"align": "left"
						},
						"c9": {
							"model": "c1",
							"items": [
								"integrated_edit_field16"
							],
							"width": "40%"
						},
						"c19": {
							"model": "c1",
							"items": []
						},
						"c20": {
							"model": "c1",
							"items": []
						},
						"c5": {
							"model": "c1",
							"items": [
								"integrated_edit_field11"
							]
						},
						"c6": {
							"model": "c1",
							"items": [
								"integrated_edit_field13"
							],
							"width": "30%"
						},
						"c": {
							"model": "c1",
							"items": [
								"text"
							],
							"align": "center"
						},
						"c14": {
							"model": "c1",
							"items": [
								"integrated_edit_field17"
							]
						},
						"c15": {
							"model": "c1",
							"items": [
								"integrated_edit_field18"
							]
						},
						"c16": {
							"model": "c1",
							"items": []
						},
						"c17": {
							"model": "c1",
							"items": []
						},
						"c18": {
							"model": "c1",
							"items": []
						},
						"c29": {
							"model": "c1",
							"items": [
								"integrated_edit_field14"
							]
						},
						"c25": {
							"model": "c1",
							"items": [
								"integrated_edit_field15"
							]
						},
						"c26": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				}
			},
			"items": {
				"edit_header": {
					"type": "edit_header"
				},
				"edit_message": {
					"type": "edit_message"
				},
				"edit_back_list": {
					"type": "edit_back_list",
					"icon": {}
				},
				"edit_close": {
					"type": "edit_close",
					"icon": {}
				},
				"image": {
					"type": "image",
					"image": {
						"image": "LOGO NEGRO Y AZUL PEQUE.png",
						"source": 2
					},
					"width": "168px",
					"height": "80px"
				},
				"sec_cliente": {
					"type": "section",
					"title": {
						"text": "<i class=\"fa-solid fa-user\" style=\"font-size:1.5em; color:#fff;\"></i> Datos del Cliente\n\n",
						"type": 0
					},
					"location": "section",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "",
					"headerColor": "#ffffff",
					"bodyBg": "",
					"bodyColor": "",
					"panelBorder": null,
					"borderColor": "",
					"initiallyClosed": true
				},
				"integrated_edit_field4": {
					"field": "paterno",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "paterno",
						"table": "solicitudes",
						"type": 5
					},
					"updateOnEdit": false
				},
				"integrated_edit_field1": {
					"field": "nombre",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "nombre",
						"table": "solicitudes",
						"type": 5
					},
					"label": {
						"field": "nombre",
						"table": "solicitudes",
						"type": 3
					},
					"updateOnEdit": false
				},
				"integrated_edit_field5": {
					"field": "materno",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "materno",
						"table": "solicitudes",
						"type": 5
					},
					"updateOnEdit": false
				},
				"integrated_edit_field6": {
					"field": "rfc",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field3": {
					"field": "idcliente",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idcliente",
						"table": "solicitudes",
						"type": 5
					},
					"updateOnEdit": false
				},
				"integrated_edit_field9": {
					"field": "idcli",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"sec_venta": {
					"type": "section",
					"title": {
						"text": "<i class=\"fa-solid fa-cart-shopping\" style=\"font-size:1.5em; color:#fff;\"></i> Información de la Venta\n",
						"type": 0
					},
					"location": "section1",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "",
					"headerColor": "",
					"bodyBg": "",
					"bodyColor": "",
					"panelBorder": null,
					"borderColor": "",
					"initiallyClosed": true
				},
				"integrated_edit_field": {
					"field": "idproducto",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idproducto",
						"table": "solicitudes",
						"type": 5
					},
					"updateOnEdit": false
				},
				"integrated_edit_field20": {
					"field": "idtipoventa",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field8": {
					"field": "plazo",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "plazo",
						"table": "solicitudes",
						"type": 5
					},
					"updateOnEdit": false
				},
				"integrated_edit_field7": {
					"field": "orden",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "orden",
						"table": "solicitudes",
						"type": 5
					},
					"font-size": "1.5em",
					"bold": true,
					"updateOnEdit": false
				},
				"integrated_edit_field23": {
					"field": "contrato",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field22": {
					"field": "cuenta",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field27": {
					"field": "fechavenci",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field19": {
					"field": "noserie",
					"type": "integrated_edit_field",
					"orientation": 0,
					"bold": true,
					"font-size": "2em",
					"updateOnEdit": false
				},
				"integrated_edit_field2": {
					"field": "idplan",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idplan",
						"table": "solicitudes",
						"type": 5
					},
					"updateOnEdit": false
				},
				"integrated_edit_field29": {
					"field": "dnpreferido",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field26": {
					"field": "factura",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field28": {
					"field": "ciclo",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field21": {
					"field": "dn",
					"type": "integrated_edit_field",
					"orientation": 0,
					"font-size": "1.5em",
					"bold": true,
					"updateOnEdit": false
				},
				"integrated_edit_field24": {
					"field": "contratoportal",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field25": {
					"field": "plazopendiente",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"section2": {
					"type": "section",
					"title": {
						"text": "<i class=\"fa-solid fa-location-dot\" style=\"font-size:1.5em; color:#fff;\"></i> Dirección de Entrega\n",
						"type": 0
					},
					"location": "section2",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "",
					"headerColor": "",
					"bodyBg": "",
					"bodyColor": "",
					"panelBorder": null,
					"borderColor": "",
					"initiallyClosed": true
				},
				"integrated_edit_field10": {
					"field": "estado",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field16": {
					"field": "colonia",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field11": {
					"field": "ciudad",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field13": {
					"field": "calle",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"text": {
					"type": "text",
					"editedByRte": false,
					"label": {
						"text": "<div id=\"google-map\" style=\"height: 400px; width: 100%; margin-bottom: 10px; border: 1px solid #ccc;\"></div>\n<p><strong>Haz clic en el mapa para ubicar o arrastra el marcador.</strong></p>\n\n<script src=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyBEbOZrRNV7JiveFroZVC2AFkoMJ18VKyg&libraries=geometry,places&callback=initGoogleMap\" async defer></script>\n\n<script>\n// ====================================================================\n// 📌 1. CONFIGURACIÓN DE IDS (AJUSTA ESTOS IDS SI NO COINCIDEN)\n// ====================================================================\nconst FIELD_IDS = {\n    calle:   'value_calle_1',\n    numext:  'value_numeroext_1',\n    colonia: 'value_colonia_1',\n    ciudad:  'value_ciudad_1',\n    estado:  'value_estado_1',\n    cp:      'value_cp_1',\n    lat:     'value_lat_1',\n    lng:     'value_lng_1'\n};\n\n// ====================================================================\n// 📌 2. VARIABLES GLOBALES Y HELPERS\n// ====================================================================\nlet map;\nlet marker;\nlet geocoder;\nlet mapInitialized = false;\n\nconst $id = (id) => document.getElementById(id);\nconst safeTrim = (v) => (v || '').toString().trim();\nconst isValidLatLng = (lat, lng) => {\n    const a = Number(lat), b = Number(lng);\n    return Number.isFinite(a) && Number.isFinite(b) && a <= 90 && a >= -90 && b <= 180 && b >= -180;\n};\n\n// ====================================================================\n// 📌 3. FUNCIONES PRINCIPALES\n// ====================================================================\n\n// --- Inicialización del Mapa (Llamada por el API script) ---\nfunction initGoogleMap() {\n    if (mapInitialized) return;\n\n    const defaultCoords = { lat: 21.0038, lng: -89.6183 }; // Mérida, México como centro por defecto\n    \n    const initialLat = safeTrim($id(FIELD_IDS.lat)?.value);\n    const initialLng = safeTrim($id(FIELD_IDS.lng)?.value);\n    const initialCoords = isValidLatLng(initialLat, initialLng) \n        ? { lat: Number(initialLat), lng: Number(initialLng) } \n        : defaultCoords;\n\n    map = new google.maps.Map($id('google-map'), {\n        center: initialCoords,\n        zoom: isValidLatLng(initialLat, initialLng) ? 17 : 12,\n        mapTypeId: 'roadmap',\n        gestureHandling: 'greedy' // 🚀 Evita el molesto \"Ctrl + Scroll\"\n    });\n\n    geocoder = new google.maps.Geocoder();\n    mapInitialized = true;\n\n    // Colocar marcador si hay coordenadas iniciales\n    if (isValidLatLng(initialLat, initialLng)) {\n        placeMarker(initialCoords);\n    }\n    \n    // Listener: Al hacer CLIC en el mapa\n    map.addListener('click', (e) => {\n        placeMarker(e.latLng); \n        updateFieldsAndGeocode(e.latLng); \n    });\n    \n    // PHPRunner necesita esta línea para que el mapa se muestre correctamente en pestañas/secciones\n    setTimeout(() => google.maps.event.trigger(map, 'resize'), 300);\n}\n\n// --- Coloca el marcador y actualiza Lat/Lng al arrastrar o hacer clic ---\nfunction placeMarker(location) {\n    if (marker) {\n        marker.setPosition(location);\n    } else {\n        marker = new google.maps.Marker({\n            position: location,\n            map: map,\n            draggable: true // 📌 Permite arrastrar el marcador\n        });\n        \n        // Listener: Al terminar de arrastrar el marcador\n        marker.addListener('dragend', function() {\n            const newLocation = marker.getPosition();\n            updateFieldsAndGeocode(newLocation);\n        });\n    }\n    map.setCenter(location);\n    \n    // Si no usamos updateFieldsAndGeocode (ej. al inicio), aseguramos la posición\n    $id(FIELD_IDS.lat).value = location.lat().toFixed(6);\n    $id(FIELD_IDS.lng).value = location.lng().toFixed(6);\n}\n\n// --- Función central: Actualiza campos y pide Geocodificación Inversa ---\nfunction updateFieldsAndGeocode(location) {\n    // 1. Actualiza campos Lat/Lng\n    $id(FIELD_IDS.lat).value = location.lat().toFixed(6);\n    $id(FIELD_IDS.lng).value = location.lng().toFixed(6);\n    \n    // 2. Realiza la geocodificación inversa (Lat/Lng -> Dirección)\n    reverseGeocode(location);\n}\n\n// --- Geocodificación Inversa (Lat/Lng -> Dirección) ---\nfunction reverseGeocode(latLng) {\n    if (!geocoder) return;\n\n    geocoder.geocode({ location: latLng })\n        .then((response) => {\n            if (response.results[0]) {\n                populateAddressFields(response.results[0]);\n            }\n        })\n        .catch((e) => console.error('Falló la geocodificación inversa:', e));\n}\n\nfunction getAddressComponent(components, type) {\n    const component = components.find(c => c.types.includes(type));\n    return component ? component.long_name : '';\n}\n\nfunction populateAddressFields(result) {\n    const components = result.address_components;\n    \n    // Obtener componentes específicos de Google Maps\n    const street = getAddressComponent(components, 'route');\n    const houseNumber = getAddressComponent(components, 'street_number');\n    const neighborhood = getAddressComponent(components, 'sublocality_level_1') || getAddressComponent(components, 'neighborhood');\n    const city = getAddressComponent(components, 'locality') || getAddressComponent(components, 'administrative_area_level_2');\n    const state = getAddressComponent(components, 'administrative_area_level_1');\n    const postalCode = getAddressComponent(components, 'postal_code');\n\n    // Llenar los campos del formulario\n    if ($id(FIELD_IDS.estado)) $id(FIELD_IDS.estado).value = state;\n    if ($id(FIELD_IDS.ciudad)) $id(FIELD_IDS.ciudad).value = city;\n    if ($id(FIELD_IDS.cp)) $id(FIELD_IDS.cp).value = postalCode;\n    if ($id(FIELD_IDS.colonia)) $id(FIELD_IDS.colonia).value = neighborhood;\n    if ($id(FIELD_IDS.calle)) $id(FIELD_IDS.calle).value = street;\n    if ($id(FIELD_IDS.numext)) $id(FIELD_IDS.numext).value = houseNumber;\n}\n\n// --- Geocodificación (Dirección -> Lat/Lng) desde campos de texto ---\nfunction geocodeAddressFromFields() {\n    const calle = safeTrim($id(FIELD_IDS.calle)?.value);\n    const numext = safeTrim($id(FIELD_IDS.numext)?.value);\n    const colonia = safeTrim($id(FIELD_IDS.colonia)?.value);\n    const ciudad = safeTrim($id(FIELD_IDS.ciudad)?.value) || '';\n    const estado = safeTrim($id(FIELD_IDS.estado)?.value) || '';\n    const cp = safeTrim($id(FIELD_IDS.cp)?.value);\n\n    const addressParts = [\n        calle + (numext ? ' ' + numext : ''),\n        colonia,\n        ciudad,\n        estado,\n        cp,\n        'México'\n    ].filter(Boolean);\n    \n    const address = addressParts.join(', ');\n\n    if (!address || !geocoder || (!calle && !colonia)) return;\n\n    geocoder.geocode({ address: address })\n        .then((response) => {\n            if (response.results[0]) {\n                const location = response.results[0].geometry.location;\n                placeMarker(location);\n                map.setZoom(17);\n            }\n        })\n        .catch((e) => console.error('Geocoding falló por:', e));\n}\n\n\n// ====================================================================\n// 📌 4. LÓGICA DE ARRANQUE Y EVENTOS (Manejo de Tabs/Redimensionamiento)\n// ====================================================================\n\nfunction attachListeners() {\n    const addressFields = [FIELD_IDS.calle, FIELD_IDS.numext, FIELD_IDS.colonia, FIELD_IDS.ciudad, FIELD_IDS.estado, FIELD_IDS.cp];\n\n    // Observa cambios en los campos de dirección (al salir o presionar Enter)\n    addressFields.forEach(id => {\n        const el = $id(id);\n        if (!el) return;\n        \n        el.addEventListener('blur', geocodeAddressFromFields);\n        el.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter') {\n                e.preventDefault();\n                geocodeAddressFromFields();\n            }\n        });\n    });\n\n    // Observa cambios en Lat/Lng manuales para centrar el mapa\n    [FIELD_IDS.lat, FIELD_IDS.lng].forEach(id => {\n        const el = $id(id);\n        if (!el) return;\n        el.addEventListener('change', () => {\n            const lat = safeTrim($id(FIELD_IDS.lat)?.value);\n            const lng = safeTrim($id(FIELD_IDS.lng)?.value);\n            if (isValidLatLng(lat, lng)) {\n                placeMarker(new google.maps.LatLng(Number(lat), Number(lng)));\n                map.setZoom(17);\n            }\n        });\n    });\n}\n\n// Maneja la inicialización tardía en caso de que el mapa esté en una pestaña oculta\nfunction checkMapVisibility() {\n    const mapContainer = $id('google-map');\n    if (mapContainer && mapContainer.offsetParent !== null && mapContainer.offsetWidth > 0) {\n        if (!mapInitialized && typeof google !== 'undefined' && typeof google.maps !== 'undefined') {\n             // La inicialización real ocurre por el 'callback=initGoogleMap' en la URL del API\n             // Solo llamamos al resize si ya cargó\n             setTimeout(() => google.maps.event.trigger(map, 'resize'), 100);\n             return true;\n        }\n    }\n    return false;\n}\n\ndocument.addEventListener('DOMContentLoaded', function() {\n    attachListeners();\n\n    // Revisa la visibilidad al inicio\n    checkMapVisibility(); \n    \n    // Observador para cuando se cambie de pestaña\n    document.body.addEventListener('click', function(e) {\n        if (e.target.closest('[data-toggle=\"tab\"], .step-tab, .nav-link')) {\n            setTimeout(() => {\n                if (mapInitialized) google.maps.event.trigger(map, 'resize');\n                else checkMapVisibility();\n            }, 400);\n        }\n    });\n});\n</script>",
						"type": 0
					}
				},
				"integrated_edit_field17": {
					"field": "lat",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field18": {
					"field": "lng",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field14": {
					"field": "numeroext",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field15": {
					"field": "numeroint",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"text1": {
					"type": "text",
					"label": {
						"text": "<button type=\"button\" id=\"btnGuardarVNP\" class=\"btn btn-primary\">\n    Guardar \n</button>\n",
						"type": 0
					},
					"editedByRte": false
				},
				"integrated_edit_field30": {
					"field": "estatus",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				},
				"integrated_edit_field12": {
					"field": "observaciones",
					"type": "integrated_edit_field",
					"orientation": 0,
					"updateOnEdit": false
				}
			},
			"dbProps": {},
			"version": 13,
			"pageWidth": "standard",
			"imageItem": {
				"type": "page_image",
				"image": null
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"pageCSS": "\n/* Put  your custom CSS code here */\n\n\n\n/* ========================================================= */\n/* VARIABLES DE COLOR */\n/* ========================================================= */\n:root {\n    --color-elegante: #FFFFFF; /* Texto Blanco para contrastar con el fondo oscuro */\n    --naranja-degradado-inicio: #03478A; /* Naranja Suave (Light Salmon) */\n    --naranja-degradado-fin: #6D98C2; /* Naranja Medio (Coral) */\n    --color-borde-base: #FF7F50; /* Color simple para el borde base */\n}\n\n/* ========================================================= */\n/* 1. Fondo de la Página: Degradado Azul Cielo (Se mantiene) */\n/* ========================================================= */\nbody, .container-fluid {\nbackground: linear-gradient(180deg, #FAFAF7 0%, #D6D6D4 100%) !important;    min-height: 100vh;\n}\n\n/* ========================================================= */\n/* 2. Estilo de las Secciones: Efecto Tarjeta/Sombreado (Se mantiene) */\n/* ========================================================= */\n.panel, .rnr-c-body, .rnr-c-grid {\n    background-color: #FFFFFF !important; \n    border: none !important; \n    border-radius: 12px !important; \n    padding: 20px;\n    margin-bottom: 25px; \n    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1), \n                0 2px 6px rgba(0, 0, 0, 0.05) !important; \n                \n    /* 🔑 CAMBIO CLAVE: Agrega 'transform' a la transición */\n    transition: box-shadow 0.3s ease-in-out, \n                transform 0.3s ease-in-out; /* Transición para el movimiento y escala */            \n                \n}\n\n/* ========================================================= */\n/* 3. Estilo de Encabezados de Sección (EL CAMBIO PRINCIPAL) */\n/* ========================================================= */\n.panel-heading, .rnr-c-head {\n    /* Aplicamos el degradado al fondo completo del encabezado */\n    background: linear-gradient(to right, var(--naranja-degradado-inicio), var(--naranja-degradado-fin)) !important;\n    \n    /* El texto del título ahora es blanco para contrastar con el fondo naranja */\n    color: var(--color-elegante) !important; \n    \n    font-weight: 600;\n    \n    /* Mantenemos el centrado vertical */\n    display: flex;\n    align-items: center;\n    height: 40px; /* Aseguramos una altura suficiente */\n    \n    /* Eliminamos el borde degradado y aplicamos un borde simple y fino abajo */\n    border-bottom: 1px solid var(--color-borde-base) !important; \n    border-image-source: none !important; /* Desactivar la propiedad border-image anterior */\n    \n    /* Ajustes de relleno/bordes para que el degradado se vea bien */\n    padding: 0 15px !important; \n    border-top-left-radius: 12px !important; /* Mantenemos el radio del panel superior */\n    border-top-right-radius: 12px !important;\n}\n\n/* ========================================================= */\n/* 3. Estilo de HOVER: Efecto de Elevación/Intensificación    */\n/* ========================================================= */\n.panel:hover, .rnr-c-body:hover, .rnr-c-grid:hover {\n    /* Nueva sombra más intensa y \"elevada\" */\n    box-shadow: 0 15px 400px rgba(0, 0, 0, 0.3), \n                0 5px 15px rgba(0, 0, 0, 0.1) !important; \n    \n    /* Pequeño movimiento hacia arriba para dar más sensación de elevación (opcional) */\n    transform: translateY(-5px) scale(1.005); \n}\n\n\n\n/* 4. Estilo de los Inputs (Se mantiene) */\n.form-control {\n    border-radius: 8px !important; \n    border: 1px solid #e0e0e0 !important;\n}\n.form-control:focus {\n    border-color: #48C9B0 !important; \n    box-shadow: 0 0 0 0.2rem rgba(72, 201, 176, 0.25) !important;\n}\n\n/* Aplica solo a formularios con esas secciones */\n.panel.panel-default.form-section > .panel-body { display: none; }\n\n.panel.panel-default.form-section > .panel-heading:hover {\n  cursor: pointer;\n  filter: brightness(0.98);\n}\n\n.panel-collapse.no-bs-trans {\n  transition: none !important;\n}\n\n/* ========================================================= */\n/* ARREGLO DE COLOR DE TEXTO DE ENCABEZADO DURANTE MODAL     */\n/* ========================================================= */\n\n/* Apuntamos directamente al panel-title, que es el elemento que contiene \n   el texto del encabezado de la sección. \n*/\n.panel-heading .panel-title {\n    color: #FFFFFF !important; \n}\n\n/* Si dentro del panel-title hay un enlace (Ej. si el encabezado permite colapsar/expandir \n   y el título es un <a>), también debemos forzar el color del enlace.\n*/\n.panel-heading .panel-title a {\n    color: #FFFFFF !important;\n}\n\n/* Asegurar que el texto dentro del panel-title no se vea afectado por reglas generales\n   que usen el estado 'modal-open' en el cuerpo de la página.\n*/\n.modal-open .panel-heading .panel-title {\n    color: #FFFFFF !important;\n}\n\n/* Fuerza el tamaño correcto en todo el formulario */\n.r-edit-form {\n    font-size: 14px !important;\n}\n\n.r-edit-form label,\n.r-edit-form input,\n.r-edit-form select {\n    font-size: 14px !important;\n}",
			"listTotals": 1,
			"customHtml": "",
			"title": {}
		},
		{
			"id": "view",
			"type": "view",
			"layoutId": "nomenu",
			"disabled": false,
			"default": 0,
			"forms": {
				"above-grid": {
					"modelId": "view-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1",
									"colspan": 2
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "view-below-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"view_back_list",
								"view_close"
							]
						},
						"c2": {
							"model": "c2",
							"items": [
								"hamburger"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "view-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"view_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-edit",
					"grid": [
						{
							"cells": [
								{
									"cell": "c3"
								},
								{
									"cell": "c"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c4",
									"colspan": 2,
									"rowspan": 1
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c5",
									"colspan": 2
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c3": {
							"model": "c3",
							"items": [
								"section"
							],
							"border": [
								{
									"side": "",
									"width": "0"
								}
							],
							"padding": {
								"right": "10px"
							}
						},
						"c": {
							"model": "c3",
							"items": [
								"section1"
							]
						},
						"c4": {
							"model": "c3",
							"items": [
								"section2"
							]
						},
						"c5": {
							"model": "c3",
							"items": [
								"integrated_edit_field17",
								"integrated_edit_field18",
								"integrated_edit_field19",
								"integrated_edit_field20",
								"integrated_edit_field21",
								"integrated_edit_field22",
								"integrated_edit_field23",
								"integrated_edit_field24",
								"integrated_edit_field25",
								"integrated_edit_field26",
								"integrated_edit_field27",
								"integrated_edit_field28",
								"integrated_edit_field29"
							]
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section": {
					"modelId": "simple-edit",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"integrated_edit_field3",
								"integrated_edit_field4",
								"integrated_edit_field5",
								"integrated_edit_field1",
								"integrated_edit_field6",
								"integrated_edit_field9"
							]
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section1": {
					"modelId": "simple-edit",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"integrated_edit_field",
								"integrated_edit_field2",
								"integrated_edit_field7",
								"integrated_edit_field8"
							]
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				},
				"section2": {
					"modelId": "simple-edit",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"integrated_edit_field13",
								"integrated_edit_field14",
								"integrated_edit_field15",
								"integrated_edit_field16"
							]
						},
						"c": {
							"model": "c1",
							"items": [
								"integrated_edit_field11",
								"integrated_edit_field10",
								"integrated_edit_field12",
								"text"
							]
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				}
			},
			"items": {
				"view_header": {
					"type": "view_header"
				},
				"view_back_list": {
					"type": "view_back_list"
				},
				"view_close": {
					"type": "view_close"
				},
				"hamburger": {
					"type": "hamburger",
					"items": [
						"view_edit"
					]
				},
				"view_edit": {
					"type": "view_edit"
				},
				"section": {
					"type": "section",
					"title": {
						"type": 0,
						"text": "Datos del cliente"
					},
					"location": "section",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "#3e58f3",
					"headerColor": "#f9f6c1",
					"bodyBg": "#565050",
					"bodyColor": "#f3f3f2",
					"panelBorder": "1px",
					"borderColor": "#d7f5e2"
				},
				"integrated_edit_field3": {
					"field": "idcliente",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idcliente",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field4": {
					"field": "paterno",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "paterno",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field5": {
					"field": "materno",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "materno",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field1": {
					"field": "nombre",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "nombre",
						"table": "solicitudes",
						"type": 5
					},
					"label": {
						"field": "nombre",
						"table": "solicitudes",
						"type": 3
					}
				},
				"integrated_edit_field6": {
					"field": "rfc",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field9": {
					"field": "idcli",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"section1": {
					"type": "section",
					"title": {
						"type": 0,
						"text": "Datos de la solicitud"
					},
					"location": "section1",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "#3e58f3",
					"headerColor": "#f9f6c1",
					"bodyBg": "#565050",
					"bodyColor": "#f3f3f2",
					"panelBorder": "1px",
					"borderColor": "#d7f5e2"
				},
				"integrated_edit_field": {
					"field": "idproducto",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idproducto",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field2": {
					"field": "idplan",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "idplan",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field7": {
					"field": "orden",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "orden",
						"table": "solicitudes",
						"type": 5
					}
				},
				"integrated_edit_field8": {
					"field": "plazo",
					"type": "integrated_edit_field",
					"orientation": 0,
					"placeholder": {
						"field": "plazo",
						"table": "solicitudes",
						"type": 5
					}
				},
				"section2": {
					"type": "section",
					"title": {
						"type": 0,
						"text": "Datos de entrega"
					},
					"location": "section2",
					"bsStyle": "default",
					"panelType": 3,
					"headerBg": "#3e58f3",
					"headerColor": "#f9f6c1",
					"bodyBg": "#565050",
					"bodyColor": "#f3f3f2",
					"panelBorder": "1px",
					"borderColor": "#d7f5e2"
				},
				"integrated_edit_field13": {
					"field": "calle",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field14": {
					"field": "numeroext",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field15": {
					"field": "numeroint",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field16": {
					"field": "colonia",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field11": {
					"field": "ciudad",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field10": {
					"field": "estado",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field12": {
					"field": "cp",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"text": {
					"type": "text",
					"label": {
						"text": "<div id=\"map\" style=\"height: 400px; width: 100%; margin-bottom: 10px; border: 1px solid #ccc;\"></div>\n<p><strong>Haz clic en el mapa para establecer la ubicación.</strong></p>\n\n<!-- Cargar la API de Google Maps (Reemplaza TU_API_KEY) -->\n<script src=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyA2P1eBUfOvpeXBIWM5t5Drg3EjZc25Tzs&callback=initMap&libraries=places&v=weekly\" async defer></script>\n\n<script>\n// Variables globales\nlet map;\nlet marker;\nlet geocoder;\n\nfunction initMap() {\n    // Coordenadas iniciales\n    const initialLocation = { lat: 21.0038, lng: -89.6183 };\n    // Crear el mapa\n    map = new google.maps.Map(document.getElementById(\"map\"), {\n        zoom: 12,\n        center: initialLocation,\n        mapTypeId: google.maps.MapTypeId.ROADMAP\n    });\n    // Inicializar el geocoder\n    geocoder = new google.maps.Geocoder();\n    // Escuchar el evento de clic en el mapa\n    map.addListener('click', function(event) {\n        placeMarkerAndGeocode(event.latLng);\n    });\n}\n\nfunction placeMarkerAndGeocode(location) {\n    // Limpiar el marcador anterior si existe\n    if (marker) {\n        marker.setMap(null);\n    }\n    // Colocar un nuevo marcador\n    marker = new google.maps.Marker({\n        position: location,\n        map: map\n    });\n    // Centrar el mapa en la nueva ubicación\n    map.panTo(location);\n    // Obtener la dirección a partir de las coordenadas (Geocodificación Inversa)\n    geocoder.geocode({ 'location': location }, function(results, status) {\n        if (status === 'OK') {\n            if (results[0]) {\n                // Llenar los campos del formulario con los datos obtenidos\n                populateAddressFields(results[0]);\n            } else {\n                alert('No se encontraron resultados para esta ubicación.');\n            }\n        } else {\n            alert('Falló la geocodificación: ' + status);\n        }\n    });\n}\n\nfunction populateAddressFields(addressData) {\n    // Esta función descompone la respuesta de geocodificación y llena los campos.\n    // La estructura de 'address_components' puede variar, ¡debes ajustarla!\n    \n    let addressComponents = addressData.address_components;\n    let addressLookup = {};\n    \n    // Crear un objeto fácil de buscar a partir de los componentes\n    addressComponents.forEach(component => {\n        component.types.forEach(type => {\n            addressLookup[type] = component.long_name;\n        });\n    });\n    // Llenar los campos del formulario de PHPRunner.\n    // ¡IMPORTANTE! Reemplaza 'Editbox1' con los nombres REALES de tus campos.\n    // Puedes encontrar el nombre real del campo en la pestaña \"Fields\" de PHPRunner.\n    \n    // Usar getElementById o un selector por nombre\n    document.getElementById('value_estado_1').value = addressLookup['administrative_area_level_1'] || ''; // Estado\n    document.getElementById('value_ciudad_1').value = addressLookup['locality'] || addressLookup['administrative_area_level_2'] || ''; // Ciudad o Municipio\n    document.getElementById('value_cp_1').value = addressLookup['postal_code'] || ''; // Código Postal\n    document.getElementById('value_colonia_1').value = addressLookup['sublocality_level_1'] || addressLookup['neighborhood'] || ''; // Colonia\n    document.getElementById('value_calle_1').value = getRoute(addressComponents) || ''; // Calle\n}\n\n// Función de ayuda para obtener el nombre de la calle\nfunction getRoute(components) {\n    for (let i = 0; i < components.length; i++) {\n        if (components[i].types.includes('route')) {\n            return components[i].long_name;\n        }\n    }\n    return '';\n}\n// Inicializar el mapa cuando la página esté cargada\n// Google Maps llama a 'initMap' automáticamente por el callback en la URL de la API\n</script>",
						"type": 0
					},
					"editedByRte": false
				},
				"integrated_edit_field17": {
					"field": "idtipoventa",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field18": {
					"field": "dn",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field19": {
					"field": "cuenta",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field20": {
					"field": "contrato",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field21": {
					"field": "contratoportal",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field22": {
					"field": "plazopendiente",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field23": {
					"field": "factura",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field24": {
					"field": "fechavenci",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field25": {
					"field": "ciclo",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field26": {
					"field": "dnpreferido",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field27": {
					"field": "lat",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field28": {
					"field": "lng",
					"type": "integrated_edit_field",
					"orientation": 0
				},
				"integrated_edit_field29": {
					"field": "noserie",
					"type": "integrated_edit_field",
					"orientation": 0
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {}
		},
		{
			"id": "list",
			"type": "list",
			"layoutId": "leftbar",
			"disabled": false,
			"default": 0,
			"forms": {
				"above-grid": {
					"modelId": "list-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c2"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c3"
								},
								{
									"cell": "c4"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"add",
								"inline_save_all",
								"inline_cancel_all",
								"delete"
							]
						},
						"c2": {
							"model": "c2",
							"items": [
								"text1",
								"snippet",
								"text",
								"snippet1",
								"details_found",
								"page_size",
								"print_panel"
							]
						},
						"c3": {
							"model": "c3",
							"items": []
						},
						"c4": {
							"model": "c4",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "list-below-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"pagination"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"left": {
					"modelId": "leftbar-menu",
					"grid": [
						{
							"cells": [
								{
									"cell": "c0"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c0": {
							"model": "c0",
							"items": [
								"logo",
								"expand_button"
							]
						},
						"c1": {
							"model": "c1",
							"items": [
								"menu"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"supertop": {
					"modelId": "leftbar-top",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"expand_menu_button",
								"collapse_button",
								"breadcrumb"
							]
						},
						"c2": {
							"model": "c2",
							"items": [
								"simple_search",
								"list_options",
								"loginform_login",
								"username_button"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "list-sidebar-top",
					"grid": [],
					"cells": {},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "horizontal-grid",
					"grid": [
						{
							"section": "head",
							"cells": [
								{
									"cell": "headcell_icons"
								},
								{
									"cell": "headcell_checkbox"
								},
								{
									"cell": "headcell_field2"
								},
								{
									"cell": "headcell_field3"
								},
								{
									"cell": "headcell_field17"
								},
								{
									"cell": "headcell_field4"
								},
								{
									"cell": "headcell_field12"
								},
								{
									"cell": "headcell_field"
								},
								{
									"cell": "headcell_field7"
								},
								{
									"cell": "headcell_field9"
								},
								{
									"cell": "headcell_field10"
								},
								{
									"cell": "headcell_field8"
								},
								{
									"cell": "headcell_field13"
								},
								{
									"cell": "headcell_field1"
								},
								{
									"cell": "headcell_field16"
								},
								{
									"cell": "headcell_field18"
								}
							]
						},
						{
							"section": "body",
							"cells": [
								{
									"cell": "cell_icons"
								},
								{
									"cell": "cell_checkbox"
								},
								{
									"cell": "cell_field2"
								},
								{
									"cell": "headcell_field5"
								},
								{
									"cell": "headcell_field15"
								},
								{
									"cell": "cell_field4"
								},
								{
									"cell": "cell_field12"
								},
								{
									"cell": "cell_field"
								},
								{
									"cell": "cell_field3"
								},
								{
									"cell": "cell_field6"
								},
								{
									"cell": "headcell_field11"
								},
								{
									"cell": "cell_field5"
								},
								{
									"cell": "cell_field7"
								},
								{
									"cell": "cell_field1"
								},
								{
									"cell": "cell_field8"
								},
								{
									"cell": "cell_field9"
								}
							]
						},
						{
							"cells": [
								{
									"cell": "cell_dpreview",
									"colspan": 16
								}
							],
							"section": "body"
						},
						{
							"section": "foot",
							"cells": [
								{
									"cell": "footcell_icons"
								},
								{
									"cell": "footcell_checkbox"
								},
								{
									"cell": "footcell_field2"
								},
								{
									"cell": "headcell_field6",
									"colspan": 2
								},
								{
									"cell": "footcell_field4"
								},
								{
									"cell": "footcell_field12"
								},
								{
									"cell": "footcell_field"
								},
								{
									"cell": "footcell_field3"
								},
								{
									"cell": "footcell_field6"
								},
								{
									"cell": "headcell_field14"
								},
								{
									"cell": "footcell_field5"
								},
								{
									"cell": "footcell_field7"
								},
								{
									"cell": "footcell_field1"
								},
								{
									"cell": "footcell_field8"
								},
								{
									"cell": "footcell_field9"
								}
							]
						}
					],
					"cells": {
						"headcell_field2": {
							"model": "headcell_field",
							"items": [
								"simple_grid_field31"
							],
							"field": "fecha",
							"columnName": "field"
						},
						"cell_field2": {
							"model": "cell_field",
							"items": [
								"simple_grid_field2"
							],
							"field": "fecha",
							"columnName": "field"
						},
						"footcell_field2": {
							"model": "footcell_field",
							"items": [],
							"columnName": "field",
							"field": "fecha"
						},
						"headcell_field4": {
							"model": "headcell_field",
							"items": [
								"grid_field_label"
							],
							"field": "descripcion",
							"columnName": "field"
						},
						"cell_field4": {
							"model": "cell_field",
							"items": [
								"grid_field"
							],
							"field": "descripcion",
							"columnName": "field"
						},
						"footcell_field4": {
							"model": "footcell_field",
							"items": [],
							"columnName": "field",
							"field": "descripcion"
						},
						"headcell_field12": {
							"model": "headcell_field",
							"items": [
								"simple_grid_field41"
							],
							"field": "estatus",
							"columnName": "field"
						},
						"cell_field12": {
							"model": "cell_field",
							"items": [
								"simple_grid_field12"
							],
							"field": "estatus",
							"columnName": "field"
						},
						"footcell_field12": {
							"model": "footcell_field",
							"items": [],
							"columnName": "field",
							"field": "estatus"
						},
						"headcell_checkbox": {
							"model": "headcell_checkbox",
							"items": [
								"grid_checkbox_head"
							],
							"columnName": "checkbox",
							"field": ""
						},
						"cell_checkbox": {
							"model": "cell_checkbox",
							"items": [
								"grid_checkbox"
							],
							"columnName": "checkbox",
							"field": ""
						},
						"footcell_checkbox": {
							"model": "footcell_checkbox",
							"items": [],
							"columnName": "checkbox",
							"field": ""
						},
						"headcell_icons": {
							"model": "headcell_icons",
							"items": [],
							"columnName": "list-icons",
							"field": ""
						},
						"cell_icons": {
							"model": "cell_icons",
							"items": [
								"grid_edit",
								"grid_inline_edit",
								"grid_inline_save",
								"grid_inline_cancel",
								"grid_view"
							],
							"orientation": "horizontal",
							"columnName": "list-icons",
							"field": ""
						},
						"footcell_icons": {
							"model": "footcell_icons",
							"items": [],
							"columnName": "list-icons",
							"field": ""
						},
						"headcell_field": {
							"model": "headcell_field",
							"items": [
								"simple_grid_field39"
							],
							"field": "orden",
							"columnName": "field"
						},
						"cell_field": {
							"model": "cell_field",
							"items": [
								"simple_grid_field10"
							],
							"field": "orden",
							"columnName": "field"
						},
						"footcell_field": {
							"model": "footcell_field",
							"items": [],
							"columnName": "field",
							"field": "orden"
						},
						"headcell_field3": {
							"model": "headcell_field",
							"items": [
								"simple_grid_field33"
							],
							"field": "",
							"columnName": ""
						},
						"headcell_field5": {
							"model": "cell_field",
							"items": [
								"simple_grid_field4"
							],
							"field": "",
							"columnName": ""
						},
						"headcell_field6": {
							"model": "footcell_field",
							"items": [],
							"columnName": "",
							"field": ""
						},
						"headcell_field7": {
							"model": "headcell_field",
							"items": [
								"grid_field_label2"
							],
							"field": "estatusentrega",
							"columnName": "field"
						},
						"cell_field3": {
							"model": "cell_field",
							"items": [
								"grid_field2"
							],
							"field": "estatusentrega",
							"columnName": "field",
							"align": "center",
							"bold": true,
							"underline": true
						},
						"footcell_field3": {
							"model": "footcell_field",
							"items": [],
							"columnName": "field",
							"field": "estatusentrega"
						},
						"headcell_field9": {
							"model": "headcell_field",
							"items": [
								"grid_field_label4"
							],
							"field": "chip",
							"columnName": "field"
						},
						"cell_field6": {
							"model": "cell_field",
							"items": [
								"grid_field4"
							],
							"field": "chip",
							"columnName": "field"
						},
						"footcell_field6": {
							"model": "footcell_field",
							"items": [],
							"columnName": "field",
							"field": "chip"
						},
						"cell_dpreview": {
							"model": "cell_dpreview",
							"items": [],
							"columnName": "field",
							"field": "usuario"
						},
						"headcell_field10": {
							"model": "headcell_field",
							"items": [
								"grid_field_label3"
							],
							"columnName": "field",
							"field": "noserie"
						},
						"headcell_field11": {
							"model": "cell_field",
							"items": [
								"grid_field3"
							],
							"columnName": "field",
							"field": "noserie"
						},
						"headcell_field14": {
							"model": "footcell_field",
							"items": [],
							"columnName": "field",
							"field": "noserie"
						},
						"headcell_field8": {
							"model": "headcell_field",
							"items": [
								"text2"
							],
							"field": "",
							"columnName": "details"
						},
						"cell_field5": {
							"model": "cell_field",
							"items": [
								"grid_details_link"
							],
							"field": "",
							"columnName": "details"
						},
						"footcell_field5": {
							"model": "footcell_field",
							"items": [],
							"field": "",
							"columnName": "details"
						},
						"headcell_field13": {
							"model": "headcell_field",
							"items": [],
							"field": "",
							"columnName": ""
						},
						"cell_field7": {
							"model": "cell_field",
							"items": [],
							"field": "",
							"columnName": ""
						},
						"footcell_field7": {
							"model": "footcell_field",
							"items": [],
							"field": "",
							"columnName": ""
						},
						"headcell_field15": {
							"model": "cell_field",
							"items": [
								"grid_field5"
							],
							"field": "",
							"columnName": ""
						},
						"headcell_field17": {
							"model": "headcell_field",
							"items": [
								"grid_field_label5"
							],
							"field": "",
							"columnName": ""
						},
						"headcell_field1": {
							"model": "headcell_field",
							"items": [
								"grid_field_label1"
							],
							"field": "simcard",
							"columnName": "field"
						},
						"cell_field1": {
							"model": "cell_field",
							"items": [
								"grid_field1"
							],
							"field": "simcard",
							"columnName": "field"
						},
						"footcell_field1": {
							"model": "footcell_field",
							"items": [],
							"field": "simcard",
							"columnName": "field"
						},
						"headcell_field16": {
							"model": "headcell_field",
							"items": [
								"grid_field_label6"
							],
							"field": "idtienda",
							"columnName": "field"
						},
						"cell_field8": {
							"model": "cell_field",
							"items": [
								"grid_field6"
							],
							"field": "idtienda",
							"columnName": "field"
						},
						"footcell_field8": {
							"model": "footcell_field",
							"items": [],
							"field": "idtienda",
							"columnName": "field"
						},
						"headcell_field18": {
							"model": "headcell_field",
							"items": [
								"grid_field_label7"
							],
							"field": "usuario",
							"columnName": "field"
						},
						"cell_field9": {
							"model": "cell_field",
							"items": [
								"grid_field7"
							],
							"field": "usuario",
							"columnName": "field"
						},
						"footcell_field9": {
							"model": "footcell_field",
							"items": [],
							"field": "usuario",
							"columnName": "field"
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				}
			},
			"items": {
				"page_size": {
					"type": "page_size"
				},
				"breadcrumb": {
					"type": "breadcrumb"
				},
				"logo": {
					"type": "logo"
				},
				"menu": {
					"type": "menu"
				},
				"simple_search": {
					"type": "simple_search"
				},
				"pagination": {
					"type": "pagination"
				},
				"details_found": {
					"type": "details_found"
				},
				"list_options": {
					"type": "list_options",
					"items": [
						"edit_selected",
						"export_selected",
						"delete_selected",
						"-10",
						"advsearch_link",
						"-9",
						"export"
					]
				},
				"expand_menu_button": {
					"type": "expand_menu_button"
				},
				"collapse_button": {
					"type": "collapse_button"
				},
				"add": {
					"type": "add"
				},
				"export": {
					"type": "export"
				},
				"-": {
					"type": "-"
				},
				"export_selected": {
					"type": "export_selected"
				},
				"-1": {
					"type": "-"
				},
				"-2": {
					"type": "-"
				},
				"delete": {
					"type": "delete"
				},
				"delete_selected": {
					"type": "delete_selected"
				},
				"simple_grid_field2": {
					"field": "fecha",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": true
				},
				"simple_grid_field31": {
					"type": "grid_field_label",
					"field": "fecha"
				},
				"simple_grid_field4": {
					"field": "idcliente",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": true
				},
				"simple_grid_field33": {
					"type": "grid_field_label",
					"field": "idcliente"
				},
				"simple_grid_field10": {
					"field": "orden",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": true
				},
				"simple_grid_field39": {
					"type": "grid_field_label",
					"field": "orden"
				},
				"simple_grid_field12": {
					"field": "estatus",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": true
				},
				"simple_grid_field41": {
					"type": "grid_field_label",
					"field": "estatus"
				},
				"grid_checkbox": {
					"type": "grid_checkbox"
				},
				"grid_checkbox_head": {
					"type": "grid_checkbox_head"
				},
				"grid_edit": {
					"type": "grid_edit",
					"icon": {
						"glyph": "pencil"
					}
				},
				"grid_view": {
					"type": "grid_view",
					"icon": {
						"glyph": "search"
					}
				},
				"username_button": {
					"type": "username_button",
					"items": [
						"userinfo_link",
						"logout_link",
						"adminarea_link"
					]
				},
				"loginform_login": {
					"type": "loginform_login",
					"popup": false
				},
				"userinfo_link": {
					"type": "userinfo_link"
				},
				"logout_link": {
					"type": "logout_link"
				},
				"adminarea_link": {
					"type": "adminarea_link"
				},
				"grid_field": {
					"field": "descripcion",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": true
				},
				"grid_field_label": {
					"type": "grid_field_label",
					"field": "descripcion"
				},
				"-3": {
					"type": "-"
				},
				"edit_selected": {
					"type": "edit_selected"
				},
				"grid_inline_edit": {
					"type": "grid_inline_edit"
				},
				"grid_inline_save": {
					"type": "grid_inline_save",
					"icon": {
						"glyph": "ok"
					}
				},
				"grid_inline_cancel": {
					"type": "grid_inline_cancel"
				},
				"inline_save_all": {
					"type": "inline_save_all"
				},
				"inline_cancel_all": {
					"type": "inline_cancel_all"
				},
				"-4": {
					"type": "-"
				},
				"-5": {
					"type": "-"
				},
				"grid_field2": {
					"field": "estatusentrega",
					"type": "grid_field",
					"inlineEdit": true,
					"inlineAdd": true
				},
				"grid_field_label2": {
					"type": "grid_field_label",
					"field": "estatusentrega"
				},
				"-6": {
					"type": "-"
				},
				"-7": {
					"type": "-"
				},
				"grid_field4": {
					"field": "chip",
					"type": "grid_field",
					"inlineEdit": false,
					"inlineAdd": false
				},
				"grid_field_label4": {
					"type": "grid_field_label",
					"field": "chip"
				},
				"-8": {
					"type": "-"
				},
				"-9": {
					"type": "-"
				},
				"snippet": {
					"type": "snippet",
					"eventGid": 3482841917
				},
				"text": {
					"type": "text",
					"label": {
						"text": "-",
						"type": 0
					},
					"editedByRte": false
				},
				"snippet1": {
					"type": "snippet",
					"eventGid": 1209004018
				},
				"advsearch_link": {
					"type": "advsearch_link"
				},
				"-10": {
					"type": "-"
				},
				"text1": {
					"type": "text",
					"label": {
						"type": 0,
						"text": "Rango de fechas: "
					},
					"editedByRte": false
				},
				"grid_details_link": {
					"type": "grid_details_link",
					"table": 3847630651,
					"badge": true,
					"hideIfNone": true,
					"showCount": true,
					"icon": {}
				},
				"print_panel": {
					"type": "print_panel",
					"items": [
						"print_details"
					]
				},
				"print_details": {
					"type": "print_details",
					"tables": {
						"3847630651": true
					}
				},
				"text2": {
					"type": "text",
					"label": {
						"text": "Logística",
						"type": 0
					},
					"editedByRte": false
				},
				"expand_button": {
					"type": "expand_button"
				},
				"grid_field3": {
					"field": "noserie",
					"type": "grid_field",
					"inlineEdit": false,
					"inlineAdd": false
				},
				"grid_field_label3": {
					"type": "grid_field_label",
					"field": "noserie"
				},
				"grid_field5": {
					"field": "idtipoventa",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label5": {
					"type": "grid_field_label",
					"field": "idtipoventa"
				},
				"grid_field1": {
					"field": "simcard",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label1": {
					"type": "grid_field_label",
					"field": "simcard"
				},
				"grid_field6": {
					"field": "idtienda",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label6": {
					"type": "grid_field_label",
					"field": "idtienda"
				},
				"grid_field7": {
					"field": "usuario",
					"type": "grid_field",
					"inlineAdd": false,
					"inlineEdit": false
				},
				"grid_field_label7": {
					"type": "grid_field_label",
					"field": "usuario"
				}
			},
			"dbProps": {},
			"spreadsheetGrid": false,
			"autoAddNewRecord": false,
			"version": 13,
			"pageWidth": "full",
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"pageCSS": "/* Put  your custom CSS code here */\n/*\n.table {\n    font-family: 'Arial', sans-serif !important;\n    font-size: 12px !important;\n    border-collapse: collapse !important;\n}*/\n\n\n/* ========================================================= */\n/* VARIABLES DE COLOR */\n/* ========================================================= */\n:root {\n    /* Color de acento para botones, foco y texto */\n    --color-acento: #48C9B0; /* Turquesa/Menta */ \n    --color-elegante: #1C334A; /* Azul Marino Oscuro */\n}\n\n/* ========================================================= */\n/* 1. Fondo de la Página: Degradado Azul Cielo Intenso       */\n/* ========================================================= */\nbody, .container-fluid {\n    /* Mismo fondo azul que usamos en el formulario de agregar */\n    background: linear-gradient(180deg, #E0F7FA 0%, #B3E5FC 100%) !important; \n    min-height: 100vh;\n}\n\n/* ========================================================= */\n/* 2. Contenedor de la Lista (El \"Body\" principal de la tabla) */\n/* Aplicamos el efecto de Tarjeta y Sombra a este contenedor */\n/* El selector depende del tema, pero '.rnr-b-grid' suele ser el contenedor de la tabla */\n.rnr-body .rnr-c-body, \n.rnr-b-grid, \n.rnr-c-grid,\n.panel-default {\n    background-color: #FFFFFF !important; \n    border: none !important; \n    border-radius: 12px !important; \n    \n    /* Sombreado elegante de la tarjeta */\n    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1), \n                0 2px 6px rgba(0, 0, 0, 0.05) !important; \n}\n\n/* 3. Encabezados y Barras de Herramientas (Parte superior e inferior) */\n/* Limpiamos el diseño de los paneles que rodean la tabla */\n.rnr-c-hsucc, .rnr-c-message, .rnr-c-hcell {\n    background-color: transparent !important;\n    border: none !important;\n}\n\n/* 4. Estilo de las Filas de Datos (Efecto Hover de Elevación) */\n/* Le da interactividad a la tabla */\n.rnr-body tr {\n    transition: box-shadow 0.3s ease-in-out, transform 0.3s ease-in-out;\n}\n\n.rnr-body tr:hover {\n    background-color: #fcfcfc !important; /* Ligeramente más claro al pasar el mouse */\n    \n    /* Sombra y elevación sutil para destacar la fila */\n    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1), \n                0 1px 3px rgba(0, 0, 0, 0.05) !important;\n    transform: translateY(-1px);\n}\n\n/* 5. Asegurar que las celdas del encabezado de la tabla se vean bien */\n.rnr-c-grid th {\n    background-color: #f7f7f7 !important; /* Fondo sutil para el header de la tabla */\n    color: var(--color-elegante) !important;\n    font-weight: 600;\n    border-bottom: 2px solid var(--color-acento) !important;\n}\n\n/* 6. Barras de Paginación y Búsqueda */\n.rnr-bottom .panel, .rnr-c-search, .rnr-c-top, .rnr-bottom-nav {\n    background-color: transparent !important;\n    border: none !important;\n    box-shadow: none !important; /* Quitamos la sombra a estos elementos */\n}\n\n\n\n/* ========================================================= */\n/* ESTILOS PARA CELDAS DE ESTADO (FORMATO CONDICIONAL)       */\n/* ========================================================= */\n\n/* Clase base para el estilo de \"badge\" o \"tag\" */\n.status-badge {\n    display: inline-block; /* Para que tome el tamaño del contenido */\n    padding: 5px 10px; /* Relleno interno */\n    border-radius: 20px; /* MUY REDONDEADO para el efecto de píldora */\n    font-weight: bold;\n    font-size: 0.85em;\n    text-align: center;\n    min-width: 80px; /* Ancho mínimo para que no se vea muy pequeño */\n    box-shadow: 0 1px 3px rgba(0,0,0,0.1); /* Sombra sutil */\n}\n\n/* Estado: Entregado (Verde) */\n.status-entregado {\n    background-color: #D4EDDA; /* Verde pastel claro */\n    color: #155724; /* Texto verde oscuro */\n    border: 1px solid #C3E6CB; /* Borde sutil */\n}\n\n/* Estado: Pendiente (Amarillo) */\n.status-pendiente {\n    background-color: #FFF3CD; /* Amarillo pastel claro */\n    color: #856404; /* Texto amarillo oscuro */\n    border: 1px solid #FFEEBA;\n}\n\n/* Estado: Cancelado (Rojo) */\n.status-cancelado {\n    background-color: #F8D7DA; /* Rojo pastel claro */\n    color: #721C24; /* Texto rojo oscuro */\n    border: 1px solid #F5C6CB;\n}\n\n/* Agrega más estados según sea necesario */\n/* Estado: En Proceso (Azul) */\n.status-en-proceso {\n    background-color: #D1ECF1; /* Azul pastel claro */\n    color: #0C5460; /* Texto azul oscuro */\n    border: 1px solid #BEE5EB;\n}\n\n\n/* ========================================================= */\n/* ELIMINAR SEPARADORES DE COLUMNA (LÍNEAS VERTICALES)        */\n/* ========================================================= */\n/* Mantén líneas horizontales ligeras, borra las verticales */\n.rnr-gridtable td,\n.rnr-gridtable th {\n  border-left: none !important;\n  border-right: none !important;\n  box-shadow: none !important; /* algunos temas usan sombras como divisores */\n}\n\n/* Si quieres una línea horizontal sutil */\n.rnr-gridtable td {\n  border-top: 1px solid #eee !important;\n}\n.rnr-gridtable thead th {\n  border-bottom: 1px solid #e6e6e6 !important;\n}\n",
			"listTotals": 1,
			"title": {}
		},
		{
			"id": "print",
			"type": "print",
			"layoutId": "basic",
			"disabled": true,
			"default": 0,
			"forms": {
				"above-grid": {
					"modelId": "print-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"print_pages"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "print-below-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "print-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c2": {
							"model": "c2",
							"items": [
								"print_header",
								"print_subheader"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"simple_grid_field",
								"simple_grid_field1",
								"simple_grid_field2"
							]
						},
						"c2": {
							"model": "c2",
							"items": [
								"details_preview"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				}
			},
			"items": {
				"print_header": {
					"type": "print_header"
				},
				"print_subheader": {
					"type": "print_subheader"
				},
				"print_pages": {
					"type": "print_pages"
				},
				"simple_grid_field": {
					"field": "direccion",
					"type": "simple_grid_field"
				},
				"simple_grid_field1": {
					"field": "lat",
					"type": "simple_grid_field"
				},
				"simple_grid_field2": {
					"field": "lng",
					"type": "simple_grid_field"
				},
				"details_preview": {
					"type": "details_preview",
					"table": 3847630651,
					"items": [],
					"popup": false
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {}
		},
		{
			"id": "search",
			"type": "search",
			"layoutId": "nomenu",
			"disabled": false,
			"default": 0,
			"forms": {
				"above-grid": {
					"modelId": "search-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1",
									"colspan": 2
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "search-below-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"search_search",
								"search_reset",
								"search_back_list",
								"search_cancel"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "search-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"search_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-search",
					"grid": [
						{
							"cells": [
								{
									"cell": "c3"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c3": {
							"model": "c3",
							"items": [
								"integrated_search_field",
								"integrated_search_field1",
								"integrated_search_field2",
								"integrated_search_field3",
								"integrated_search_field4",
								"integrated_search_field5",
								"integrated_search_field6",
								"integrated_search_field7",
								"integrated_search_field8",
								"integrated_search_field9",
								"integrated_search_field10",
								"integrated_search_field11"
							]
						}
					},
					"deferredItems": [],
					"separateLabels": false
				}
			},
			"items": {
				"search_header": {
					"type": "search_header"
				},
				"search_reset": {
					"type": "search_reset"
				},
				"search_back_list": {
					"type": "search_back_list"
				},
				"search_search": {
					"type": "search_search"
				},
				"search_cancel": {
					"type": "search_cancel"
				},
				"integrated_search_field": {
					"field": "noserie",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field1": {
					"field": "dn",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field2": {
					"field": "cuenta",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field3": {
					"field": "contrato",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field4": {
					"field": "contratoportal",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field5": {
					"field": "plazopendiente",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field6": {
					"field": "factura",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field7": {
					"field": "fechavenci",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field8": {
					"field": "ciclo",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field9": {
					"field": "dnpreferido",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field10": {
					"field": "simcard",
					"type": "integrated_search_field",
					"orientation": 0
				},
				"integrated_search_field11": {
					"field": "idggtipoventa",
					"type": "integrated_search_field",
					"orientation": 0
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {}
		},
		{
			"id": "masterlist",
			"type": "masterlist",
			"layoutId": "masterlist",
			"disabled": false,
			"default": 0,
			"forms": {
				"above-grid": {
					"modelId": "empty-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "empty-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "masterlist-top",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"back_master",
								"masterlist_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"simple_grid_field",
								"simple_grid_field1",
								"simple_grid_field2",
								"simple_grid_field3",
								"simple_grid_field4",
								"simple_grid_field5",
								"simple_grid_field6",
								"simple_grid_field7",
								"simple_grid_field8",
								"simple_grid_field9",
								"simple_grid_field10",
								"simple_grid_field11",
								"simple_grid_field12",
								"simple_grid_field13",
								"simple_grid_field14",
								"simple_grid_field15",
								"simple_grid_field16",
								"simple_grid_field17",
								"simple_grid_field18",
								"simple_grid_field19",
								"simple_grid_field20",
								"simple_grid_field21",
								"simple_grid_field22",
								"simple_grid_field23",
								"simple_grid_field24",
								"simple_grid_field25",
								"simple_grid_field26",
								"simple_grid_field27",
								"simple_grid_field28",
								"simple_grid_field29",
								"simple_grid_field30",
								"simple_grid_field31",
								"simple_grid_field32",
								"simple_grid_field33",
								"simple_grid_field34",
								"simple_grid_field35",
								"simple_grid_field36",
								"simple_grid_field37",
								"simple_grid_field38",
								"simple_grid_field39",
								"simple_grid_field40",
								"simple_grid_field41",
								"simple_grid_field42",
								"simple_grid_field44",
								"simple_grid_field45",
								"simple_grid_field46",
								"simple_grid_field43",
								"simple_grid_field47",
								"simple_grid_field48",
								"simple_grid_field49",
								"simple_grid_field50",
								"simple_grid_field51",
								"simple_grid_field52",
								"simple_grid_field53",
								"simple_grid_field54",
								"simple_grid_field55"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				}
			},
			"items": {
				"masterlist_header": {
					"type": "masterlist_header"
				},
				"back_master": {
					"type": "back_master"
				},
				"simple_grid_field": {
					"field": "idsolicitud",
					"type": "simple_grid_field"
				},
				"simple_grid_field1": {
					"field": "idtipoventa",
					"type": "simple_grid_field"
				},
				"simple_grid_field2": {
					"field": "fecha",
					"type": "simple_grid_field"
				},
				"simple_grid_field3": {
					"field": "fechacaptura",
					"type": "simple_grid_field"
				},
				"simple_grid_field4": {
					"field": "idcliente",
					"type": "simple_grid_field"
				},
				"simple_grid_field5": {
					"field": "idproducto",
					"type": "simple_grid_field"
				},
				"simple_grid_field6": {
					"field": "idplan",
					"type": "simple_grid_field"
				},
				"simple_grid_field7": {
					"field": "usuario",
					"type": "simple_grid_field"
				},
				"simple_grid_field8": {
					"field": "idtienda",
					"type": "simple_grid_field"
				},
				"simple_grid_field9": {
					"field": "fechamodif",
					"type": "simple_grid_field"
				},
				"simple_grid_field10": {
					"field": "orden",
					"type": "simple_grid_field"
				},
				"simple_grid_field11": {
					"field": "solicitudimg",
					"type": "simple_grid_field"
				},
				"simple_grid_field12": {
					"field": "estatus",
					"type": "simple_grid_field"
				},
				"simple_grid_field13": {
					"field": "idsolrazon",
					"type": "simple_grid_field"
				},
				"simple_grid_field14": {
					"field": "importeatt",
					"type": "simple_grid_field"
				},
				"simple_grid_field15": {
					"field": "importesms",
					"type": "simple_grid_field"
				},
				"simple_grid_field16": {
					"field": "plazo",
					"type": "simple_grid_field"
				},
				"simple_grid_field17": {
					"field": "observaciones",
					"type": "simple_grid_field"
				},
				"simple_grid_field18": {
					"field": "equipoincluido",
					"type": "simple_grid_field"
				},
				"simple_grid_field19": {
					"field": "rfc",
					"type": "simple_grid_field"
				},
				"simple_grid_field20": {
					"field": "idtratamiento",
					"type": "simple_grid_field"
				},
				"simple_grid_field21": {
					"field": "riesgo",
					"type": "simple_grid_field"
				},
				"simple_grid_field22": {
					"field": "observacionest",
					"type": "simple_grid_field"
				},
				"simple_grid_field23": {
					"field": "idcli",
					"type": "simple_grid_field"
				},
				"simple_grid_field24": {
					"field": "fecha1avta",
					"type": "simple_grid_field"
				},
				"simple_grid_field25": {
					"field": "idplan1avta",
					"type": "simple_grid_field"
				},
				"simple_grid_field26": {
					"field": "dn1avta",
					"type": "simple_grid_field"
				},
				"simple_grid_field27": {
					"field": "idproceso",
					"type": "simple_grid_field"
				},
				"simple_grid_field28": {
					"field": "idorigenventa",
					"type": "simple_grid_field"
				},
				"simple_grid_field29": {
					"field": "nombre",
					"type": "simple_grid_field"
				},
				"simple_grid_field30": {
					"field": "paterno",
					"type": "simple_grid_field"
				},
				"simple_grid_field31": {
					"field": "materno",
					"type": "simple_grid_field"
				},
				"simple_grid_field32": {
					"field": "estado",
					"type": "simple_grid_field"
				},
				"simple_grid_field33": {
					"field": "ciudad",
					"type": "simple_grid_field"
				},
				"simple_grid_field34": {
					"field": "cp",
					"type": "simple_grid_field"
				},
				"simple_grid_field35": {
					"field": "calle",
					"type": "simple_grid_field"
				},
				"simple_grid_field36": {
					"field": "numeroext",
					"type": "simple_grid_field"
				},
				"simple_grid_field37": {
					"field": "numeroint",
					"type": "simple_grid_field"
				},
				"simple_grid_field38": {
					"field": "colonia",
					"type": "simple_grid_field"
				},
				"simple_grid_field39": {
					"field": "descripcion",
					"type": "simple_grid_field"
				},
				"simple_grid_field40": {
					"field": "maps_url",
					"type": "simple_grid_field"
				},
				"simple_grid_field41": {
					"field": "direccion",
					"type": "simple_grid_field"
				},
				"simple_grid_field42": {
					"field": "estatusentrega",
					"type": "simple_grid_field"
				},
				"simple_grid_field44": {
					"field": "chip",
					"type": "simple_grid_field"
				},
				"simple_grid_field45": {
					"field": "lat",
					"type": "simple_grid_field"
				},
				"simple_grid_field46": {
					"field": "lng",
					"type": "simple_grid_field"
				},
				"simple_grid_field43": {
					"field": "noserie",
					"type": "simple_grid_field"
				},
				"simple_grid_field47": {
					"field": "dn",
					"type": "simple_grid_field"
				},
				"simple_grid_field48": {
					"field": "cuenta",
					"type": "simple_grid_field"
				},
				"simple_grid_field49": {
					"field": "contrato",
					"type": "simple_grid_field"
				},
				"simple_grid_field50": {
					"field": "contratoportal",
					"type": "simple_grid_field"
				},
				"simple_grid_field51": {
					"field": "plazopendiente",
					"type": "simple_grid_field"
				},
				"simple_grid_field52": {
					"field": "factura",
					"type": "simple_grid_field"
				},
				"simple_grid_field53": {
					"field": "fechavenci",
					"type": "simple_grid_field"
				},
				"simple_grid_field54": {
					"field": "ciclo",
					"type": "simple_grid_field"
				},
				"simple_grid_field55": {
					"field": "dnpreferido",
					"type": "simple_grid_field"
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {}
		},
		{
			"id": "masterprint",
			"type": "masterprint",
			"layoutId": "masterprint",
			"disabled": false,
			"default": 0,
			"forms": {
				"above-grid": {
					"modelId": "empty-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "empty-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "masterlist-top",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"masterprint_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"simple_grid_field",
								"simple_grid_field1",
								"simple_grid_field2",
								"simple_grid_field3",
								"simple_grid_field4",
								"simple_grid_field5",
								"simple_grid_field6",
								"simple_grid_field7",
								"simple_grid_field8",
								"simple_grid_field9",
								"simple_grid_field10",
								"simple_grid_field11",
								"simple_grid_field12",
								"simple_grid_field13",
								"simple_grid_field14",
								"simple_grid_field15",
								"simple_grid_field16",
								"simple_grid_field17",
								"simple_grid_field18",
								"simple_grid_field19",
								"simple_grid_field20",
								"simple_grid_field21",
								"simple_grid_field22",
								"simple_grid_field23",
								"simple_grid_field24",
								"simple_grid_field25",
								"simple_grid_field26",
								"simple_grid_field27",
								"simple_grid_field28",
								"simple_grid_field29",
								"simple_grid_field30",
								"simple_grid_field31",
								"simple_grid_field32",
								"simple_grid_field33",
								"simple_grid_field34",
								"simple_grid_field35",
								"simple_grid_field36",
								"simple_grid_field37",
								"simple_grid_field38",
								"simple_grid_field39",
								"simple_grid_field40",
								"simple_grid_field41",
								"simple_grid_field42",
								"simple_grid_field44",
								"simple_grid_field45",
								"simple_grid_field46",
								"simple_grid_field43",
								"simple_grid_field47",
								"simple_grid_field48",
								"simple_grid_field49",
								"simple_grid_field50",
								"simple_grid_field51",
								"simple_grid_field52",
								"simple_grid_field53",
								"simple_grid_field54",
								"simple_grid_field55"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				}
			},
			"items": {
				"masterprint_header": {
					"type": "masterprint_header"
				},
				"simple_grid_field": {
					"field": "idsolicitud",
					"type": "simple_grid_field"
				},
				"simple_grid_field1": {
					"field": "idtipoventa",
					"type": "simple_grid_field"
				},
				"simple_grid_field2": {
					"field": "fecha",
					"type": "simple_grid_field"
				},
				"simple_grid_field3": {
					"field": "fechacaptura",
					"type": "simple_grid_field"
				},
				"simple_grid_field4": {
					"field": "idcliente",
					"type": "simple_grid_field"
				},
				"simple_grid_field5": {
					"field": "idproducto",
					"type": "simple_grid_field"
				},
				"simple_grid_field6": {
					"field": "idplan",
					"type": "simple_grid_field"
				},
				"simple_grid_field7": {
					"field": "usuario",
					"type": "simple_grid_field"
				},
				"simple_grid_field8": {
					"field": "idtienda",
					"type": "simple_grid_field"
				},
				"simple_grid_field9": {
					"field": "fechamodif",
					"type": "simple_grid_field"
				},
				"simple_grid_field10": {
					"field": "orden",
					"type": "simple_grid_field"
				},
				"simple_grid_field11": {
					"field": "solicitudimg",
					"type": "simple_grid_field"
				},
				"simple_grid_field12": {
					"field": "estatus",
					"type": "simple_grid_field"
				},
				"simple_grid_field13": {
					"field": "idsolrazon",
					"type": "simple_grid_field"
				},
				"simple_grid_field14": {
					"field": "importeatt",
					"type": "simple_grid_field"
				},
				"simple_grid_field15": {
					"field": "importesms",
					"type": "simple_grid_field"
				},
				"simple_grid_field16": {
					"field": "plazo",
					"type": "simple_grid_field"
				},
				"simple_grid_field17": {
					"field": "observaciones",
					"type": "simple_grid_field"
				},
				"simple_grid_field18": {
					"field": "equipoincluido",
					"type": "simple_grid_field"
				},
				"simple_grid_field19": {
					"field": "rfc",
					"type": "simple_grid_field"
				},
				"simple_grid_field20": {
					"field": "idtratamiento",
					"type": "simple_grid_field"
				},
				"simple_grid_field21": {
					"field": "riesgo",
					"type": "simple_grid_field"
				},
				"simple_grid_field22": {
					"field": "observacionest",
					"type": "simple_grid_field"
				},
				"simple_grid_field23": {
					"field": "idcli",
					"type": "simple_grid_field"
				},
				"simple_grid_field24": {
					"field": "fecha1avta",
					"type": "simple_grid_field"
				},
				"simple_grid_field25": {
					"field": "idplan1avta",
					"type": "simple_grid_field"
				},
				"simple_grid_field26": {
					"field": "dn1avta",
					"type": "simple_grid_field"
				},
				"simple_grid_field27": {
					"field": "idproceso",
					"type": "simple_grid_field"
				},
				"simple_grid_field28": {
					"field": "idorigenventa",
					"type": "simple_grid_field"
				},
				"simple_grid_field29": {
					"field": "nombre",
					"type": "simple_grid_field"
				},
				"simple_grid_field30": {
					"field": "paterno",
					"type": "simple_grid_field"
				},
				"simple_grid_field31": {
					"field": "materno",
					"type": "simple_grid_field"
				},
				"simple_grid_field32": {
					"field": "estado",
					"type": "simple_grid_field"
				},
				"simple_grid_field33": {
					"field": "ciudad",
					"type": "simple_grid_field"
				},
				"simple_grid_field34": {
					"field": "cp",
					"type": "simple_grid_field"
				},
				"simple_grid_field35": {
					"field": "calle",
					"type": "simple_grid_field"
				},
				"simple_grid_field36": {
					"field": "numeroext",
					"type": "simple_grid_field"
				},
				"simple_grid_field37": {
					"field": "numeroint",
					"type": "simple_grid_field"
				},
				"simple_grid_field38": {
					"field": "colonia",
					"type": "simple_grid_field"
				},
				"simple_grid_field39": {
					"field": "descripcion",
					"type": "simple_grid_field"
				},
				"simple_grid_field40": {
					"field": "maps_url",
					"type": "simple_grid_field"
				},
				"simple_grid_field41": {
					"field": "direccion",
					"type": "simple_grid_field"
				},
				"simple_grid_field42": {
					"field": "estatusentrega",
					"type": "simple_grid_field"
				},
				"simple_grid_field44": {
					"field": "chip",
					"type": "simple_grid_field"
				},
				"simple_grid_field45": {
					"field": "lat",
					"type": "simple_grid_field"
				},
				"simple_grid_field46": {
					"field": "lng",
					"type": "simple_grid_field"
				},
				"simple_grid_field43": {
					"field": "noserie",
					"type": "simple_grid_field"
				},
				"simple_grid_field47": {
					"field": "dn",
					"type": "simple_grid_field"
				},
				"simple_grid_field48": {
					"field": "cuenta",
					"type": "simple_grid_field"
				},
				"simple_grid_field49": {
					"field": "contrato",
					"type": "simple_grid_field"
				},
				"simple_grid_field50": {
					"field": "contratoportal",
					"type": "simple_grid_field"
				},
				"simple_grid_field51": {
					"field": "plazopendiente",
					"type": "simple_grid_field"
				},
				"simple_grid_field52": {
					"field": "factura",
					"type": "simple_grid_field"
				},
				"simple_grid_field53": {
					"field": "fechavenci",
					"type": "simple_grid_field"
				},
				"simple_grid_field54": {
					"field": "ciclo",
					"type": "simple_grid_field"
				},
				"simple_grid_field55": {
					"field": "dnpreferido",
					"type": "simple_grid_field"
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {}
		},
		{
			"id": "edit1",
			"type": "edit",
			"layoutId": "nomenu",
			"disabled": false,
			"default": 6,
			"forms": {
				"above-grid": {
					"modelId": "edit-above-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"edit_message"
							]
						},
						"c2": {
							"model": "c2",
							"items": []
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"below-grid": {
					"modelId": "edit-below-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"edit_save",
								"edit_back_list",
								"edit_close"
							]
						},
						"c2": {
							"model": "c2",
							"items": [
								"hamburger"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "edit-header",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"edit_header"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"grid": {
					"modelId": "simple-edit",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c3"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"text"
							],
							"align": "center"
						},
						"c3": {
							"model": "c3",
							"items": [
								"details_preview"
							],
							"align": "center"
						},
						"c": {
							"model": "c3",
							"items": []
						}
					},
					"deferredItems": [],
					"columnCount": 1,
					"inlineLabels": false,
					"separateLabels": false
				}
			},
			"items": {
				"edit_header": {
					"type": "edit_header"
				},
				"hamburger": {
					"type": "hamburger",
					"items": [
						"edit_reset",
						"edit_view"
					]
				},
				"edit_reset": {
					"type": "edit_reset"
				},
				"edit_message": {
					"type": "edit_message"
				},
				"edit_save": {
					"type": "edit_save"
				},
				"edit_back_list": {
					"type": "edit_back_list"
				},
				"edit_close": {
					"type": "edit_close"
				},
				"edit_view": {
					"type": "edit_view"
				},
				"details_preview": {
					"type": "details_preview",
					"table": 3847630651,
					"items": [],
					"popup": false,
					"pageId": "list"
				},
				"text": {
					"type": "text",
					"label": {
						"text": "<!-- ======================== QUICK ADD logisticavnp (FULL SNIPPET) ======================== -->\n<style>\n  /* Card base */\n  .qa-card{\n    background:#fff;border:1px solid #e5e7eb;border-radius:16px;margin:12px 0 18px;\n    box-shadow:0 10px 25px -5px rgba(0,0,0,.1),0 10px 10px -5px rgba(0,0,0,.04)\n  }\n  .qa-head{\n    padding:14px 18px;border-bottom:1px solid #eef2ff;\n    background:linear-gradient(90deg,#667eea,#764ba2);color:#fff;\n    border-top-left-radius:16px;border-top-right-radius:16px\n  }\n  .qa-title{font-size:18px;font-weight:700;display:flex;align-items:center;gap:8px}\n  /* Cuerpo: 2 columnas en desktop, 1 en móvil */\n  .qa-body{\n    padding:16px 18px;display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:end\n  }\n  .qa-input{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:10px;font-size:14px}\n  .qa-btn{\n    grid-column:1 / -1; display:inline-flex;align-items:center;justify-content:center;\n    padding:12px 14px;border:none;border-radius:10px;color:#fff;font-weight:700;cursor:pointer;\n    background:linear-gradient(90deg,#10b981,#3b82f6); transition:transform .06s ease\n  }\n  .qa-btn:active{transform:scale(.98)}\n  .qa-btn:disabled{opacity:.6;cursor:not-allowed}\n  @media (max-width: 900px){ .qa-body{grid-template-columns:1fr} }\n</style>\n\n<div id=\"qa_logisticavnp\" class=\"qa-card\">\n  <div class=\"qa-head\"><div class=\"qa-title\">📱 Nueva SIM Card</div></div>\n  <div class=\"qa-body\">\n    <div>\n      <label style=\"display:block;margin:0 0 6px 4px;color:#374151;font-weight:600;font-size:12px\">Fecha</label>\n      <input id=\"qa_fecha\" class=\"qa-input\" type=\"date\">\n    </div>\n    <div>\n      <label style=\"display:block;margin:0 0 6px 4px;color:#374151;font-weight:600;font-size:12px\">Número de SIM Card</label>\n      <input id=\"qa_sim\" class=\"qa-input\" type=\"text\" placeholder=\"Ej: 1234567890\">\n    </div>\n    <button id=\"qa_add\" class=\"qa-btn\" type=\"button\">Agregar Nueva SIM Card</button>\n  </div>\n</div>\n\n<script>\n/* ======================== QUICK ADD logisticavnp (JS) ========================\n   Coloca este script UNA sola vez en la página (debajo del HTML anterior).\n   Si ya tenías otro script para este botón, elimínalo para evitar duplicados.\n----------------------------------------------------------------------------- */\n(function(){\n  // ======== CONFIG (ajusta si tus campos tienen otros nombres) ========\n  var DATE_FIELD  = 'fechaHora';     // campo fecha en grid logisticavnp\n  var SIM_FIELD   = 'SIMEntregado';  // campo SIM en grid logisticavnp\n  var IDSOL_FIELD = 'idsolicitud';   // id de la solicitud si el subdetalle lo pide\n  var AUTO_SAVE   = true;            // guardar todo automáticamente después de llenar\n\n  // ======== HELPERS (sin duplicados) ========\n  function $(s,root){ return (root||document).querySelector(s); }\n  function $all(s,root){ return Array.prototype.slice.call((root||document).querySelectorAll(s)); }\n  function deaccent(s){ return (s||'').normalize('NFD').replace(/[\\u0300-\\u036f]/g,''); }\n  function waitFor(fn, ms, step){\n    var t0 = Date.now();\n    return new Promise(function(res,rej){\n      (function tick(){\n        try{ var v = fn(); if(v) return res(v); }catch(_){}\n        if(Date.now()-t0 >= (ms||7000)) return rej(new Error('timeout'));\n        setTimeout(tick, step||120);\n      })();\n    });\n  }\n  function todayISO(){\n    try{ var z=(new Date()).getTimezoneOffset()*60000; return new Date(Date.now()-z).toISOString().slice(0,10);}catch(_){return '';}\n  }\n  function toast(msg, ok){\n    var id='qa_toast', el=document.getElementById(id);\n    if(!el){ el=document.createElement('div'); el.id=id; document.body.appendChild(el); }\n    el.textContent = msg || 'Listo';\n    el.style.cssText='position:fixed;top:16px;right:16px;padding:10px 14px;border-radius:10px;color:#fff;font-weight:700;z-index:2147483000;'\n                    +'box-shadow:0 10px 20px rgba(0,0,0,.18);background:'+(ok?'#10b981':'#ef4444');\n    setTimeout(function(){ el && el.remove(); }, 1800);\n  }\n\n  // ======== 1) Asegura que la pestaña del subdetalle esté visible (si existe) ========\n  async function ensureLogisticaTabVisible(){\n    var tabs = $all('.nav-tabs a, .tabs-above a');\n    if (!tabs.length) return;\n    var target = tabs.find(function(a){\n      var t = deaccent((a.textContent||'').toLowerCase());\n      var h = ((a.getAttribute('href')||'')+' '+(a.getAttribute('aria-controls')||'')+' '+(a.getAttribute('data-href')||'')).toLowerCase();\n      return /logistica\\s*vnp|logisticavnp/.test(t) || /logistica|logisticavnp/.test(h);\n    });\n    if (target) {\n      if (!target.classList.contains('active')) target.click();\n      var paneSel = (target.getAttribute('href')||'').replace(/^.*(#.+)$/, '$1');\n      if (paneSel && paneSel !== target.getAttribute('href')) {\n        await waitFor(function(){ var el = document.querySelector(paneSel); return el && el.offsetParent; }, 4000, 120);\n      } else {\n        await new Promise(r=>setTimeout(r,160));\n      }\n    }\n  }\n\n  // ======== 2) Localiza el panel del subdetalle logisticavnp con múltiples señales ========\n  function findLogisticaPanel(){\n    // por atributo exacto\n    var byDataTable = document.querySelector('[data-table=\"logisticavnp\"]');\n    if (byDataTable) return byDataTable.closest('.panel, .bs-details, .rnr-b-grid, .rnr-grid-block');\n\n    // por data-gridname\n    var byGridName = $all('[data-gridname]').find(function(n){\n      return /logisticavnp/i.test(n.getAttribute('data-gridname')||'');\n    });\n    if (byGridName) return byGridName.closest('.panel, .bs-details, .rnr-b-grid, .rnr-grid-block');\n\n    // por encabezado visible\n    var panels = $all('.panel, .panel-info, .details-grid, .rnr-grid-block');\n    var hit = panels.find(function(node){\n      var h = node.querySelector('.panel-heading, .panel-title, [data-appearence=\"panel\"]');\n      var txt = deaccent((h && h.textContent)||'').toLowerCase();\n      return /logistica\\s*vnp|logisticavnp/.test(txt);\n    });\n    if (hit) return hit;\n\n    // último recurso: cualquier data-table parecido\n    var fuzzy = $all('[data-table]').find(function(n){\n      return /logistic/i.test(n.getAttribute('data-table')||'');\n    });\n    if (fuzzy) return fuzzy.closest('.panel, .bs-details, .rnr-b-grid, .rnr-grid-block');\n\n    return null;\n  }\n\n  // ======== 3) Botones robustos InlineAdd / SaveAll ========\n  function findInlineAddButton(ctx){\n    return (\n      (ctx && (ctx.querySelector('[data-buttonevent=\"inlineadd\"]')\n            || ctx.querySelector('[data-buttonevent^=\"inlineadd\"]')\n            || ctx.querySelector('#inlineAdd2')\n            || ctx.querySelector('a[id^=\"inlineAdd\"]'))) || null\n    );\n  }\n  function findSaveAllButton(ctx){\n    return (\n      (ctx && (ctx.querySelector('[data-buttonevent=\"saveall\"]')\n            || ctx.querySelector('[data-buttonevent^=\"save\"]')\n            || ctx.querySelector('#saveall'))) || null\n    );\n  }\n\n  // ======== 4) Inicializa valores por defecto en la tarjeta ========\n  var inpFecha = document.getElementById('qa_fecha');\n  if (inpFecha) inpFecha.value = todayISO();\n\n  // ======== 5) Handler único del botón (sin duplicados) ========\n  document.addEventListener('click', async function(ev){\n    var btn = ev.target.closest('#qa_add');\n    if (!btn) return;\n\n    var fecha = (document.getElementById('qa_fecha')||{}).value || '';\n    var sim   = (document.getElementById('qa_sim')||{}).value;\n    sim = sim ? sim.trim() : '';\n    if (!fecha || !sim){ toast('Completa Fecha y SIM', false); return; }\n\n    btn.disabled = true;\n    try{\n      // A) Asegura que la pestaña esté visible\n      await ensureLogisticaTabVisible();\n\n      // B) Espera el panel hasta 7s\n      var panel = await waitFor(function(){ return findLogisticaPanel(); }, 7000, 120);\n      if (!panel) throw new Error('No encuentro el subform logisticavnp');\n\n      // C) Click en “Añadir nuevo”\n      var addBtn = findInlineAddButton(panel);\n      if (!addBtn) throw new Error('No encontré el botón \"Añadir nuevo\"');\n      addBtn.click();\n\n      // D) Espera los controles de la fila inline\n      var row = await waitFor(function(){\n        var fe = panel.querySelector('[id^=\"value_'+DATE_FIELD+'_\"]');\n        var si = panel.querySelector('[id^=\"value_'+SIM_FIELD+'_\"]');\n        return (fe && si) ? fe.closest('tr') : null;\n      }, 7000, 120);\n\n      // E) Llena valores\n      var feIn = row.querySelector('[id^=\"value_'+DATE_FIELD+'_\"]');\n      var siIn = row.querySelector('[id^=\"value_'+SIM_FIELD+'_\"]');\n      feIn.value = fecha; feIn.dispatchEvent(new Event('change',{bubbles:true}));\n      siIn.value = sim;   siIn.dispatchEvent(new Event('input',{bubbles:true}));\n                          siIn.dispatchEvent(new Event('change',{bubbles:true}));\n\n      // F) Intenta pasar id de solicitud si el subdetalle lo pide\n      var idSol = (document.querySelector('[id^=\"value_idsolicitud_\"]')||{}).value\n               || (document.querySelector('[name=\"editid1\"]')||{}).value\n               || (new URLSearchParams(location.search).get('editid1'));\n      var idIn = row.querySelector('[id^=\"value_'+IDSOL_FIELD+'_\"]');\n      if (idIn && idSol){ idIn.value = idSol; idIn.dispatchEvent(new Event('change',{bubbles:true})); }\n\n      // G) Guarda todo (opcional)\n      if (AUTO_SAVE){\n        var saveBtn = findSaveAllButton(panel);\n        if (saveBtn) setTimeout(function(){ saveBtn.click(); }, 120);\n      }\n\n      // H) Limpia SIM en el card\n      var simInput = document.getElementById('qa_sim'); if (simInput) simInput.value = '';\n\n      toast('Registro agregado', true);\n    } catch(e){\n      console.error('[QA-LOG] ', e);\n      toast(e && e.message ? e.message : 'No se pudo agregar', false);\n    } finally {\n      btn.disabled = false;\n    }\n  });\n})();\n</script>\n<!-- ====================== / QUICK ADD logisticavnp (END) ====================== -->\n",
						"type": 0
					},
					"editedByRte": false
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {}
		}
	],
	"geoCoding": {
		"enabled": false,
		"latField": "lat",
		"lonField": "lng",
		"addressFields": [
			"calle",
			"numeroext",
			"numeroint",
			"colonia",
			"ciudad",
			"estado",
			"cp",
			"lat",
			"lng"
		]
	},
	"caption": {
		"English": "Solicitudes"
	}
}