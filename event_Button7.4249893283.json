{
	"type": "EVENT_BUTTON",
	"name": "Button7",
	"serverCode": "// Put your code here.\n\n$result[\"txt\"] = $params[\"txt\"].\" world!\";\n",
	"beforeJsCode": "try {\r\n  alert(\"Exportar a Excel\");\r\n\r\n  // 1) Obtener checkboxes marcados del grid (sin depender de PageObj)\r\n  // NOTA: excluimos el \"select all\" típico si existe\r\n  var $checked = $(\"input[type=checkbox]:checked\").filter(function(){\r\n    var id = (this.id || \"\").toLowerCase();\r\n    if(id.indexOf(\"selectall\") >= 0) return false;\r\n    return true;\r\n  });\r\n\r\n  console.log(\"checked:\", $checked.length);\r\n\r\n  // 2) Extraer idventa de los checkboxes\r\n  var ids = [];\r\n  $checked.each(function(){\r\n    var $cb = $(this);\r\n\r\n    // A) value numérico\r\n    var v = $cb.val();\r\n    if(v && /^\\d+$/.test(String(v))) {\r\n      ids.push(String(v));\r\n      return;\r\n    }\r\n\r\n    // B) data attributes comunes\r\n    var dk = $cb.attr(\"data-key\") || $cb.data(\"key\");\r\n    if(dk && /^\\d+$/.test(String(dk))) {\r\n      ids.push(String(dk));\r\n      return;\r\n    }\r\n\r\n    var dr = $cb.attr(\"data-recordid\") || $cb.data(\"recordid\");\r\n    if(dr && /^\\d+$/.test(String(dr))) {\r\n      ids.push(String(dr));\r\n      return;\r\n    }\r\n\r\n    // C) Si no lo encontró, log para ajustar\r\n    console.log(\"Checkbox sin idventa numérico:\", {\r\n      id: $cb.attr(\"id\"),\r\n      name: $cb.attr(\"name\"),\r\n      value: $cb.val(),\r\n      dataKey: $cb.attr(\"data-key\"),\r\n      dataRecordid: $cb.attr(\"data-recordid\"),\r\n      class: $cb.attr(\"class\")\r\n    });\r\n  });\r\n\r\n  // quitar duplicados\r\n  ids = ids.filter((x,i,a)=>a.indexOf(x)===i);\r\n\r\n  console.log(\"ids:\", ids);\r\n\r\n  if(!ids.length){\r\n    alert(\"No pude leer el idventa desde los checkboxes.\\n\" +\r\n          \"Abre consola (F12) y copia el log: 'Checkbox sin idventa numérico'.\");\r\n    return false;\r\n  }\r\n\r\n  // 3) Enviar POST al exportador (sin _blank para evitar bloqueos)\r\n  var f = $('<form method=\"POST\" action=\"export_ventas_sel.php\"></form>');\r\n  f.append('<input type=\"hidden\" name=\"ids\" value=\"'+ ids.join(\",\") +'\">');\r\n  $(\"body\").append(f);\r\n  f[0].submit();\r\n  f.remove();\r\n\r\n  return false;\r\n\r\n} catch(e){\r\n  console.error(\"ERROR export:\", e);\r\n  alert(\"Error: \" + (e && e.message ? e.message : e));\r\n  return false;\r\n}",
	"afterJsCode": "// Put your code here.\n\nvar message = result[\"txt\"] + \" !!!\";\najax.setMessage(message);\n"
}